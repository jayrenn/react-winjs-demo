!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};!function(t){"function"==typeof define&&define.amd?define(["./base"],t):(e.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.1 4.1.0.winjs.2015.7.10 ui.js,StartTM"),t("undefined"!=typeof module?require("./base"):e.WinJS),e.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.1 4.1.0.winjs.2015.7.10 ui.js,StopTM"))}(function(t){var i=t.Utilities._require,n=t.Utilities._define;n("WinJS/VirtualizedDataSource/_VirtualizedDataSourceImpl",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../_Signal","../Utilities/_UI"],function(e,t,i,n,s,o,r,a,l,h,d,u,c){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{VirtualizedDataSource:i.Namespace._lazy(function(){function e(e,i){function o(e){var t="WinJS.UI.VirtualizedDataSource:"+fn+":"+e+",StartTM";l(t),r.log&&r.log(t,"winjs vds","perf")}function C(e){var t="WinJS.UI.VirtualizedDataSource:"+fn+":"+e+",StopTM";l(t),r.log&&r.log(t,"winjs vds","perf")}function w(e){return"number"==typeof e&&e>=0}function b(e){return w(e)&&e===Math.floor(e)}function I(e){if(null===e)e=void 0;else if(void 0!==e&&!b(e))throw new s("WinJS.UI.ListDataSource.InvalidIndexReturned",v.invalidIndexReturned);return e}function S(e){if(null===e)e=void 0;else if(void 0!==e&&!b(e)&&e!==p.unknown)throw new s("WinJS.UI.ListDataSource.InvalidCountReturned",v.invalidCountReturned);return e}function x(){var e=(_i++).toString(),t={handle:e,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return Hi[e]=t,t}function E(){return x()}function P(e,t){e.prev=t.prev,e.next=t,e.prev.next=e,t.prev=e}function M(e){e.lastInSequence&&(delete e.lastInSequence,e.prev.lastInSequence=!0),e.firstInSequence&&(delete e.firstInSequence,e.next.firstInSequence=!0),e.prev.next=e.next,e.next.prev=e.prev}function T(e){for(;!e.firstInSequence;)e=e.prev;return e}function k(e){for(;!e.lastInSequence;)e=e.next;return e}function D(e,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=e.prev,i.next=e,t.prev.next=t,e.prev=i,!0}function A(e,t,i){return t.prev.next=i.next,i.next.prev=t.prev,t.prev=e,i.next=e.next,e.next=t,i.next.prev=i,!0}function O(e){delete e.lastInSequence,delete e.next.firstInSequence}function B(e){var t=e.next;e.lastInSequence=!0,t.firstInSequence=!0,t===Fi&&_e(Fi,void 0)}function L(e,t,i,n){P(e,t);var s=e.prev;s.lastInSequence&&(i?delete s.lastInSequence:e.firstInSequence=!0,n?delete t.firstInSequence:e.lastInSequence=!0)}function R(e,t){e.key=t,Ni[e.key]=e}function F(e,t,i){+t===t&&(e.index=t,i[t]=e,Ei||(e.firstInSequence&&e.prev&&e.prev.index===t-1&&O(e.prev),e.lastInSequence&&e.next&&e.next.index===t+1&&O(e)))}function z(e,t){var i=t===Wi?E():x();return P(i,e),i}function H(e,t,i){var n=z(e,i);return n.firstInSequence=!0,n.lastInSequence=!0,F(n,t,i),n}function N(e,t){return H(e,t,Wi)}function W(e,t){var i=z(e,t);return delete e.firstInSequence,i.prev.index===i.index-1?delete i.prev.lastInSequence:i.firstInSequence=!0,F(i,e.index-1,t),i}function V(e,t){var i=z(e.next,t);return delete e.lastInSequence,i.next.index===i.index+1?delete i.next.firstInSequence:i.lastInSequence=!0,F(i,e.index+1,t),i}function U(e,t,i,n){L(e,t,i,n),Ni[e.key]=e,void 0!==e.index&&(Wi[e.index]=e)}function j(e){M(e),e.key&&delete Ni[e.key],void 0!==e.index&&Wi[e.index]===e&&delete Wi[e.index];var t=e.bindingMap;for(var i in t){var n=t[i].handle;n&&Hi[n]===e&&delete Hi[n]}Hi[e.handle]===e&&delete Hi[e.handle]}function q(e){return!Hi[e.handle]}function J(e,t,i,n,s){var o=s?null:t[e-1];if(o&&(o.next!==n||n.firstInSequence))o=o.next;else if(o=t[e+1],!o){o=i.next;for(var r;o.firstInSequence&&(r=o),e>=o.index&&o!==n;)o=o.next;o!==n||n.firstInSequence||(o=r&&void 0===r.index?r:void 0)}return o}function K(e){return!e.item&&!e.itemNew&&e!==Fi}function G(e,t){Object.defineProperty(e,"handle",{value:t,writable:!1,enumerable:!1,configurable:!0})}function Z(e,t,i){G(e,i),Object.defineProperty(e,"index",{get:function(){for(;t.slotMergedWith;)t=t.slotMergedWith;return t.index},enumerable:!1,configurable:!0})}function Y(e){if(void 0===e)return e;var t=JSON.stringify(e);if(void 0===t)throw new s("WinJS.UI.ListDataSource.ObjectIsNotValidJson",v.objectIsNotValidJson);return t}function X(t){return e.itemSignature?e.itemSignature(t.data):Y(t.data)}function Q(t){var i=t.itemNew;t.itemNew=null,i&&(i=Object.create(i),Z(i,t,t.handle),e.compareByIdentity||(t.signature=X(i))),t.item=i,delete t.indexRequested,delete t.keyRequested}function $(e){return e.bindingMap||e.cursorCount>0}function ee(e){return $(e)||e.fetchListeners||e.directFetchListeners}function te(e){return ee(e)||!e.firstInSequence&&$(e.prev)||!e.lastInSequence&&$(e.next)||!hn&&(!e.firstInSequence&&e.prev!==Ri&&!(e.prev.item||e.prev.itemNew))|(!e.lastInSequence&&e.next!==Fi&&!(e.next.item||e.next.itemNew))}function ie(e){B(e),j(e)}function ne(){if(!wi){(!Ui||q(Ui))&&(Ui=Fi.prev);for(var e=Ui.prev,t=Ui.next,i=0,n=function(e){e===Fi||te(e)||(ai>=i?i++:ie(e))};e||t;){if(e){var s=e;e=s.prev,s!==Ri&&n(s)}if(t){var o=t;t=o.next,o!==zi&&n(o)}}Vi=0}}function se(e){ee(e)||(Vi++,wi||Ji||(Ui=e,Vi>ai&&!ji&&(ji=!0,d.schedule(function(){ji=!1,ne()},d.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested"))))}function oe(e){for(var t in ui)e(ui[t])}function re(e,t){for(var i in e.bindingMap)t(e.bindingMap[i].bindingRecord,i)}function ae(e){return e.notificationsSent||(e.notificationsSent=!0,e.notificationHandler.beginNotifications&&e.notificationHandler.beginNotifications()),e.notificationHandler}function le(){vi||Si||oe(function(e){e.notificationsSent&&(e.notificationsSent=!1,e.notificationHandler.endNotifications&&e.notificationHandler.endNotifications())})}function he(e,t){var i=e.bindingMap;if(i){var n=i[t];if(n){var s=n.handle;if(s)return s}}return e.handle}function de(e,t){return e&&e.handle!==t&&(e=Object.create(e),G(e,t)),e}function ue(e){var t=Li;Li=e,oe(function(e){e.notificationHandler&&e.notificationHandler.countChanged&&ae(e).countChanged(Li,t)})}function ce(e,t){re(e,function(i,n){i.notificationHandler.indexChanged&&ae(i).indexChanged(he(e,n),e.index,t)})}function _e(e,t){var i=e.index;if(void 0!==i&&Wi[i]===e&&delete Wi[i],+t===t)F(e,t,Wi);else{if(+i!==i)return;delete e.index}ce(e,i)}function me(e,t,i,n,s){var o={};if(!(!n&&t.lastInSequence||!s&&i.firstInSequence))if(t===Ri)if(i===Fi)for(var r in ui)o[r]=ui[r];else for(var r in i.bindingMap)o[r]=ui[r];else if(i===Fi||i.bindingMap)for(var r in t.bindingMap)(i===Fi||i.bindingMap[r])&&(o[r]=ui[r]);for(var r in e.bindingMap)o[r]=ui[r];return o}function pe(e){var t,i=e.prev,n=e.next,s=me(e,i,n);for(t in s){var o=s[t];o.notificationHandler&&ae(o).inserted(o.itemPromiseFromKnownSlot(e),i.lastInSequence||i===Ri?null:he(i,t),n.firstInSequence||n===Fi?null:he(n,t))}}function fe(e){var t=e.item;Q(e),re(e,function(i,n){var s=he(e,n);ae(i).changed(de(e.item,s),de(t,s))})}function ge(e,t,i,n,s){var o,r=t.prev;if(t===e){if(!e.firstInSequence||!i)return;t=e.next}else if(r===e){if(!e.lastInSequence||!n)return;r=e.prev}if(!s){var a=me(e,r,t,i,n);for(o in a){var l=a[o];ae(l).moved(l.itemPromiseFromKnownSlot(e),(r.lastInSequence||r===e.prev)&&!i||r===Ri?null:he(r,o),(t.firstInSequence||t===e.next)&&!n||t===Fi?null:he(t,o))}oe(function(t){t.adjustCurrentSlot(e)})}M(e),L(e,t,i,n)}function ve(e,t){Pe(e,!0),re(e,function(i,n){ae(i).removed(he(e,n),t)}),oe(function(t){t.adjustCurrentSlot(e)}),j(e)}function ye(e){for(;!e.firstInSequence;)e=e.prev;var t;do{t=e.lastInSequence;var i=e.next;ve(e,!0),e=i}while(!t)}function Ce(e){var t;if(!e)return t;for(var i=0;!e.firstInSequence;)i++,e=e.prev;return"number"==typeof e.indexNew?e.indexNew+i:"number"==typeof e.index?e.index+i:t}function we(e,t){for(e=e.next;e;e=e.next)if(e.firstInSequence){var i=void 0!==e.indexNew?e.indexNew:e.index;void 0!==i&&(e.indexNew=i+t)}xi+=t,Ei=!0,Ji?bt():Mi++}function be(e,t){if(e.firstInSequence){var i;if(0>t)i=e.indexNew,void 0!==i?delete e.indexNew:i=e.index,e.lastInSequence||(e=e.next,void 0!==i&&(e.indexNew=i));else if(!e.lastInSequence){var n=e.next;i=n.indexNew,void 0!==i?delete n.indexNew:i=n.index,void 0!==i&&(e.indexNew=i)}}we(e,t)}function Ie(e,t){for(var i=Ri;i!==Fi;i=i.next){var n=i.indexNew;if(void 0!==n&&n>=e){we(i,t);break}}}function Se(){var e,t,i;for(e=Ri;;e=e.next){if(e.firstInSequence){if(t=e,void 0!==e.indexNew){if(i=e.indexNew,delete e.indexNew,isNaN(i))break}else i=e.index;e!==Ri&&e.prev.index===i-1&&O(e.prev)}if(e.lastInSequence)for(var n=i,s=t;s!==e.next;s=s.next)n!==s.index&&_e(s,n),+n===n&&n++;if(e===Fi)break}for(;e!==zi;e=e.next)void 0!==e.index&&e!==Fi&&_e(e,void 0);Ei=!1,xi&&+Li===Li&&(pi?pi.reset():ue(Li+xi),xi=0)}function xe(e,t,i,n,s){if(e.item)return new h(function(t){s?s(t,e.item):t(e.item)});var o={listBindingID:n,retained:!1};return e[t]||(e[t]={}),e[t][i]=o,o.promise=new h(function(e,t){o.complete=s?function(t){s(e,t)}:e,o.error=t},function(){for(;e.slotMergedWith;)e=e.slotMergedWith;var n=e[t];if(n){if(delete n[i],Object.keys(n).length>0)return;delete e[t]}se(e)}),o.promise}function Ee(e,t){for(var i in t)t[i].complete(e)}function Pe(e,t){var i=e.fetchListeners,n=e.directFetchListeners;if(i||n){Q(e);var s=e.item,o=function(e){t?Ee(s,e):Ai.push(function(){Ee(s,e)})};n&&(e.directFetchListeners=null,o(n)),i&&(e.fetchListeners=null,o(i)),se(e)}}function Me(){var e=Ai;Ai=[];for(var t=0,i=e.length;i>t;t++)e[t]()}function Te(e,t){var i=e.directFetchListeners;if(i){e.directFetchListeners=null;for(var n in i)i[n].error(t);se(e)}}function ke(e){return e.firstInSequence&&W(e,Wi),e.lastInSequence&&V(e,Wi),e.itemNew&&Q(e),et(),e}function De(e){if(!e.firstInSequence){var t=e.prev;return t===Ri?null:ke(t)}return ke(W(e,Wi))}function Ae(e){if(!e.lastInSequence){var t=e.next;return t===Fi?null:ke(t)}return ke(V(e,Wi))}function Oe(e){return e?xe(e,"directFetchListeners",(mi++).toString()):h.wrap(null)}function Be(e){if("string"!=typeof e||!e)throw new s("WinJS.UI.ListDataSource.KeyIsInvalid",v.keyIsInvalid)}function Le(e){var t=N(zi);return R(t,e),t.keyRequested=!0,t}function Re(e,t){Be(e);var i=Ni[e];return i||(i=Le(e),i.hints=t),ke(i)}function Fe(e){if("number"!=typeof e||0>e)throw new s("WinJS.UI.ListDataSource.IndexIsInvalid",v.indexIsInvalid);if(Fi.index<=e)return null;var t=Wi[e];if(!t){var i=J(e,Wi,Ri,Fi);if(!i)return null;i===Fi&&e>=Fi&&_e(Fi,void 0),t=i.prev.index===e-1?V(i.prev,Wi):i.index===e+1?W(i,Wi):N(i,e)}return t.item||(t.indexRequested=!0),ke(t)}function ze(e){var t=N(zi);return t.description=e,ke(t)}function He(e){if(hi=e,li!==hi){var i=function(){di=!1,li!==hi&&(li=hi,gn.dispatchEvent(y,li))};hi===m.failure?i():di||(di=!0,t.setTimeout(i,40))}}function Ne(e){var t=e.fetchID;return t&&Di[t]}function We(e,t){e.fetchID=t}function Ve(){var e=ki;return ki++,Di[e]=!0,e}function Ue(e,t,i){var n=Ve();We(e,n);for(var s=e;!s.firstInSequence&&t>0;)s=s.prev,t--,We(s,n);for(var o=e;!o.lastInSequence&&i>0;)o=o.next,i--,We(o,n);return n}function je(e){var t=e.items,i=e.offset,n=e.totalCount,s=e.absoluteIndex,o=e.atStart,r=e.atEnd;if(w(s)){if(w(n)){var a=t.length;s-i+a===n&&(r=!0)}i===s&&(o=!0)}o&&(t.unshift(Oi),e.offset++),r&&t.push(Bi)}function qe(e,t,i){return delete Di[i],t!==Mi||q(e)?(et(),!1):!0}function Je(e,t,i,n){var r=Mi;i.then(function(i){if(!i.items||!i.items.length)return h.wrapError(new s(f.doesNotExist));var a="itemsFetched id="+t+" count="+i.items.length;o(a),qe(e,r,t)&&(+n===n&&(i.absoluteIndex=n),je(i),ft(e,i.items,i.offset,i.totalCount,i.absoluteIndex)),C(a)}).then(null,function(i){qe(e,r,t)&&gt(e,i)})}function Ke(e,t,i,n){var r=Mi;n.then(function(n){if(!n.items||!n.items.length)return h.wrapError(new s(f.doesNotExist));var a="itemsFetched id="+i+" count="+n.items.length;o(a),qe(t,r,i)&&(n.absoluteIndex=e,je(n),vt(e,t,n.items,n.offset,n.totalCount,n.absoluteIndex)),C(a)}).then(null,function(){qe(t,r,i)&&yt(e,t,r)})}function Ge(e,t){var i=Ue(e,0,t-1);dn?Je(e,i,dn(i,t),0):Je(e,i,hn(i,0,0,t-1),0)}function Ze(e,t){var i=Ue(e,t-1,0);Je(e,i,un(i,t))}function Ye(e,t,i){var n=Ue(e,t,i);Je(e,n,ln(n,e.key,t,i,e.hints))}function Xe(e,t,i){var n=e.index;if(t>n&&(t=n),hn){var s=Ue(e,t,i);Je(e,s,hn(s,n,t,i),n)}else if(e.key)Ye(e,t,i);else{var o,r,a=Ri,l=n+1;for(o=e.prev;o!==Ri;o=o.prev)if(void 0!==o.index&&o.key){r=n-o.index,l>r&&(l=r,a=o);break}for(o=e.next;o!==Fi;o=o.next)if(void 0!==o.index&&o.key){r=o.index-n,l>r&&(l=r,a=o);break}if(a===Ri){var s=Ue(e,0,n+1);Ke(0,e,s,dn(s,n+1))}else{var h=Math.max(a.index-n,0),d=Math.max(n-a.index,0),s=Ue(a,h,d);Ke(a.index,e,s,ln(s,a.key,h,d,e.hints))}}}function Qe(e,t,i){var n=Ue(e,t,i);Je(e,n,cn(n,e.description,t,i))}function $e(){if(!Ji){for(var e,t,i,n,s,o,r,a,l=!1,h=!1,d=Ri.next;d!==zi;){var u=d.next;if(d!==Fi&&K(d)&&(h=!0,e?t++:(e=d,t=1),Ne(d)&&(l=!0),d.keyRequested&&!i&&(i=d,n=t-1),void 0===d.description||s||(s=d,o=t-1),d.indexRequested&&!r&&(r=d,a=t-1),d.lastInSequence||u===zi||!K(u))){if(l)l=!1;else{if(fi=!1,!e.firstInSequence&&e.prev.key&&ln?Ye(e.prev,0,t):!d.lastInSequence&&u.key&&ln?Ye(u,t,0):e.prev!==Ri||e.firstInSequence||!dn&&!hn?u===Fi&&!d.lastInSequence&&un?Ze(d,t):i?Ye(i,n,t-1-n):s?Qe(s,o,t-1-o):r?Xe(r,a,t-1-a):"number"==typeof e.index?Xe(e,t-1,0):ye(e):Ge(e,t),fi)return void et();if(Ji)return}e=r=i=null}d=u}He(h?m.waiting:m.ready)}}function et(){Ti||(Ti=!0,d.schedule(function(){Ti=!1,$e(),le()},d.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function tt(t){var i=t.itemNew;if(!i)return!1;var n=t.item;for(var s in n)switch(s){case"data":break;default:if(n[s]!==i[s])return!0}return e.compareByIdentity?n.data!==i.data:t.signature!==X(i)}function it(e){ee(e)?tt(e)?fe(e):e.itemNew=null:e.item=null}function nt(e){e.item?it(e):Pe(e)}function st(e,t){e.key||R(e,t.key),e.itemNew=t,nt(e)}function ot(e,t,i){var n=t.bindingMap;if(n)for(var s in i)if(n[s]){var o=t.fetchListeners;for(var r in o){var a=o[r];a.listBindingID===s&&a.retained&&(delete o[r],a.complete(null))}var l=n[s].bindingRecord;ae(l).removed(he(t,s),!0,he(e,s)),t.bindingMap&&delete t.bindingMap[s]}}function rt(e,t){if(e.index!==t.index){var i=t.index;t.index=e.index,ce(t,i)}t.slotMergedWith=e;var n=t.bindingMap;for(var s in n){e.bindingMap||(e.bindingMap={});var o=n[s];o.handle||(o.handle=t.handle),Hi[o.handle]=e,e.bindingMap[s]=o}oe(function(i){i.adjustCurrentSlot(t,e)});var r=t.itemNew||t.item;if(r&&(r=Object.create(r),Z(r,e,e.handle),st(e,r)),e.item)t.directFetchListeners&&Ai.push(function(){Ee(e.item,t.directFetchListeners)}),t.fetchListeners&&Ai.push(function(){Ee(e.item,t.fetchListeners)});else{var a;for(a in t.directFetchListeners)e.directFetchListeners||(e.directFetchListeners={}),e.directFetchListeners[a]=t.directFetchListeners[a];for(a in t.fetchListeners)e.fetchListeners||(e.fetchListeners={}),e.fetchListeners[a]=t.fetchListeners[a]}e.itemNew&&Pe(e),t.handle=(_i++).toString(),B(t),j(t)}function at(e,t,i){t&&t.key&&(i||(i=t.itemNew||t.item),delete t.key,delete Ni[i.key],t.itemNew=null,t.item=null),i&&st(e,i),t&&rt(e,t)}function lt(e){if("object"!=typeof e)throw new s("WinJS.UI.ListDataSource.InvalidItemReturned",v.invalidItemReturned);if(e===Oi)return Ri;if(e===Bi)return Fi;if(e.key)return n.validation&&Be(e.key),Ni[e.key];throw new s("WinJS.UI.ListDataSource.InvalidKeyReturned",v.invalidKeyReturned)}function ht(e,t){var i=lt(t);i===e&&(i=null),i&&ot(e,i,e.bindingMap),at(e,i,t)}function dt(e,t,i,n){if(t&&e.key&&e.key!==t.key)return bt(),!1;var s=Wi[i];if(s)if(s===e)s=null;else{if(s.key&&(e.key||t&&s.key!==t.key))return bt(),!1;if(!e.key&&s.bindingMap)return!1}var o;if(t)if(o=Ni[t.key],o===e)o=null;else if(o&&o.bindingMap)return!1;return s?(ot(e,s,e.bindingMap),delete Wi[i],_e(e,i),e.prev.index===i-1&&O(e.prev),e.next.index===i+1&&O(e),n.slotNext=s.slotNext,t||(t=s.itemNew||s.item,t&&(o=Ni[t.key]))):_e(e,i),o&&s!==o&&ot(e,o,e.bindingMap),at(e,o,t),s&&s!==o&&rt(e,s),!0}function ut(e,t,i){if(t.key&&e.key&&t.key!==e.key)return bt(),!1;for(var n in e.bindingMap)i[n]=!0;return ot(e,t,i),at(e,t),!0}function ct(e,t){for(var i={};e;){var n=e.firstInSequence?null:e.prev;if(t.firstInSequence||t.prev!==Ri){if(t=t.firstInSequence?W(t,Wi):t.prev,!ut(t,e,i))return}else ve(e,!0);e=n}}function _t(e,t){for(var i={};e;){var n=e.lastInSequence?null:e.next;if(t.lastInSequence||t.next!==Fi){if(t=t.lastInSequence?V(t,Wi):t.next,!ut(t,e,i))return}else ve(e,!0);e=n}}function mt(e){for(var t=0;t<e.length;t++){var i=e[t];ct(i.slotBeforeSequence,i.slotFirstInSequence),_t(i.slotAfterSequence,i.slotLastInSequence)}}function pt(e,t){function i(t){for(var i=Fi.prev;!(i.index<e)&&i!==t;){var s=i.prev;void 0!==i.index&&ve(i,!0),i=s}n=0}for(var n=0,s=Fi.prev;!(s.index<e)||n>0;){var o=s.prev;if(s===Ri){i(Ri);break}if(s.key){if(s.index>=e)return bt(),!1;if(!(s.index>=t))return ln?Ye(s,0,n):Xe(s,0,n),!1;i(s)}else s.indexRequested||s.firstInSequence?i(o):n++;s=o}return!0}function ft(e,t,i,n,s){var r="WinJS.UI.ListDataSource.processResults";return o(r),s=I(s),n=S(n),wi?void C(r):(Ei&&Se(),!w(n)&&n!==p.unknown||n===Li||Fi.firstInSequence?(fi=!0,function(){var o,r,a,l,h=t.length;if("number"!=typeof s)for(o=0;h>o;o++)if(a=lt(t[o]),a&&void 0!==a.index){s=a.index+i-o;break}"number"==typeof s&&t[h-1]===Bi?n=s-i+h-1:!w(n)||void 0!==s&&null!==s||(s=n-(h-1)+i),w(n)&&!pt(n,s-i)&&(n=void 0);var d=new Array(h);for(o=0;h>o;o++){var u=null;if(a=lt(t[o])){if(o>0&&!a.firstInSequence&&a.prev.key&&a.prev.key!==t[o-1].key||"number"==typeof s&&void 0!==a.index&&a.index!==s-i+o)return void bt();(a===Ri||a===Fi||a.bindingMap)&&(u=a)}if("number"==typeof s&&(a=Wi[s-i+o])){if(a.key&&a.key!==t[o].key)return void bt();!u&&a.bindingMap&&(u=a)}if(o===i){if(e.key&&e.key!==t[o].key||"number"==typeof e.index&&"number"==typeof s&&e.index!==s)return void bt();u||(u=e)}d[o]=u}for(o=0;h>o;o++)a=d[o],a&&void 0!==a.index&&a!==Ri&&a!==Fi&&ht(a,t[o]);var c,_,m=[],p=!0;for(o=0;h>o;o++)if(a=d[o],a&&a!==Fi){var f=o;if(void 0===a.index){var g={};dt(a,t[o],s-i+o,g);var v,y=a,C=a;for(r=o-1;!y.firstInSequence&&(v=t[r],v!==Oi);r--){var b=s-i+r;if(0>b)break;if(!dt(y.prev,v,b,g))break;y=y.prev,r>=0&&(d[r]=y)}for(r=o+1;!C.lastInSequence&&(v=t[r],v!==Bi&&r!==n||C.next===Fi)&&(C.next===Fi||dt(C.next,v,s-i+r,g))&&(C=C.next,h>r&&(d[r]=C),f=r,C!==Fi);r++);if(c=y.firstInSequence?null:y.prev,_=C.lastInSequence?null:C.next,c&&B(c),_&&B(C),"number"==typeof s){if(C===Fi)c&&A(Fi,T(c),c);else{var I=g.slotNext;I||(I=J(C.index,Wi,Ri,Fi,!0)),D(I,y,C)}y.prev.index===y.index-1&&O(y.prev),C.next.index===C.index+1&&O(C)}else p||(l=d[o-1],l&&(y.prev!==l&&(C===Fi?(c&&A(Fi,T(c),c),D(y,T(l),l)):A(l,y,C)),O(l)));if(p=!1,qi)return;m.push({slotBeforeSequence:c,slotFirstInSequence:y,slotLastInSequence:C,slotAfterSequence:_})}o!==i||a===e||q(e)||(c=e.firstInSequence?null:e.prev,_=e.lastInSequence?null:e.next,ot(a,e,a.bindingMap),rt(a,e),m.push({slotBeforeSequence:c,slotFirstInSequence:a,slotLastInSequence:a,slotAfterSequence:_})),o=f}for(w(n)&&Fi.index!==n&&_e(Fi,n),mt(m),o=0;h>o;o++)if(a=d[o]){for(r=o-1;r>=0;r--){var S=d[r+1];ht(d[r]=S.firstInSequence?W(d[r+1],Wi):S.prev,t[r])}for(r=o+1;h>r;r++)l=d[r-1],a=d[r],a?a.firstInSequence&&(a.prev!==l&&A(l,a,k(a)),O(l)):ht(d[r]=l.lastInSequence?V(l,Wi):l.next,t[r]);break}delete e.description}(),qi||(void 0!==n&&n!==Li&&ue(n),et()),le(),Me(),void C(r)):(bt(),void C(r)))}function gt(e,t){switch(t.name){case f.noResponse:He(m.failure),Te(e,t);break;case f.doesNotExist:e.indexRequested?pt(e.index):(e.keyRequested||e.description)&&ye(e),le(),bt()}}function vt(e,t,i,n,o,r){r=I(r),o=S(o);var a=e-n,l=i.length;if(t.index>=a&&t.index<a+l)ft(t,i,t.index-a,o,t.index);else if(n===l-1&&e<t.index||w(o)&&o<=t.index)gt(t,new s(f.doesNotExist));else if(t.index<a){var h=Ue(t,0,a-t.index);Ke(a,t,h,ln(h,i[0].key,a-t.index,0))}else{var d=a+l-1,h=Ue(t,t.index-d,0);Ke(d,t,h,ln(h,i[l-1].key,0,t.index-d))}}function yt(e,t,i){switch(i.name){case f.doesNotExist:e===Ri.index?(pt(0),gt(t,i)):bt();break;default:gt(t,i)}}function Ct(){for(var e=0;e<mn.length&&"beginRefresh"!==mn[e].kind;e++);for(var t=e;t<mn.length&&"beginRefresh"!==mn[t].kind;t++);if(t>e&&t+(t-e)<mn.length){for(var i=!0,n=t-e,s=0;n>s;s++)if(mn[e+s].kind!==mn[t+s].kind){i=!1;break}if(i&&r.log){r.log(v.refreshCycleIdentified,"winjs vds","error");for(var s=e;t>s;s++)r.log(""+(s-e)+": "+JSON.stringify(mn[s]),"winjs vds","error")}return i}}function wt(){return++_n>a&&Ct()?void He(m.failure):(mn[++pn%mn.length]={kind:"beginRefresh"},Xi={firstInSequence:!0,lastInSequence:!0,index:-1},Qi={firstInSequence:!0,lastInSequence:!0},Xi.next=Qi,Qi.prev=Xi,Zi=!1,Yi=void 0,$i={},en={},tn={},tn[-1]=Xi,void(nn={}))}function bt(){if(!qi){if(qi=!0,He(m.waiting),Ii)return Ii=!1,void Xt();if(!wi){var e=++Mi;Ji=!0,Gi=0,d.schedule(function(){if(Mi===e){qi=!1,wt();for(var t=Ri.next;t!==zi;){var i=t.next;te(t)||t===Fi||ie(t),t=i}kt()}},d.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function It(){return Ki=Ki||new u,bt(),Ki.promise}function St(e,t){return delete Di[t],e!==Mi?!1:(Gi--,!0)}function xt(e,t,i,n,r){var a=Mi;Gi++,n.then(function(t){if(!t.items||!t.items.length)return h.wrapError(new s(f.doesNotExist));var n="itemsFetched id="+i+" count="+t.items.length;o(n),St(a,i)&&(je(t),Rt(e,t.items,t.offset,t.totalCount,"number"==typeof r?r:t.absoluteIndex)),C(n)}).then(null,function(n){St(a,i)&&Ft(e,t,n)})}function Et(e,t,i,n){if(ln)xt(e.key,!1,t,ln(t,e.key,i,n,e.hints));else{var s=10,o=e.index;tn[o]&&tn[o].firstInSequence?xt(e.key,!1,t,hn(t,o-1,Math.min(i+s,o)-1,n+1+s),o-1):tn[o]&&tn[o].lastInSequence?xt(e.key,!1,t,hn(t,o+1,Math.min(i+s,o)+1,n-1+s),o+1):xt(e.key,!1,t,hn(t,o,Math.min(i+s,o),n+s),o)}}function Pt(e){dn?xt(null,!0,e,dn(e,1),0):hn&&xt(null,!0,e,hn(e,0,0,0),0)}function Mt(e){return Di[$i[e]]}function Tt(e,t){for(var i,n,s,o=3,r=Mi,a=0,l=e;l!==zi;l=l.next){if(!i&&l.key&&!nn[l.key]&&!Mt(l.key)){var h=en[l.key];(!h||h.firstInSequence||h.lastInSequence)&&(i=l,n=h,s=Ve())}if(i){var d=Mt(l.key);if(nn[l.key]||en[l.key]||d||(l.key&&($i[l.key]=s),a++),l.lastInSequence||l.next===Fi||d){if(Et(i,s,!n||n.firstInSequence?o:0,a-1+o),!t)break;i=null,a=0}}else l.key&&K(l)&&!nn[l.key]&&(en[l.key]||(s=Ve(),xt(l.key,!1,s,ln(s,l.key,1,1,l.hints))))}0!==Gi||Zi||Mi!==r||Pt(Ve())}function kt(){var e=Mi;do sn=!1,on=!0,Tt(Ri.next,!0),on=!1;while(0===Gi&&sn&&Mi===e&&Ji);0===Gi&&Mi===e&&Jt()}function Dt(e){var t=Mi;if(e){var i=Ni[e];i||(i=Ri.next);do rn=!1,an=!0,Tt(i,!1),an=!1;while(rn&&Mi===t&&Ji)}on?sn=!0:0===Gi&&Mi===t&&kt()}function At(e){if("object"==typeof e&&e){if(e===Oi)return Xi;if(e===Bi)return Qi;if(e.key)return en[e.key];throw new s("WinJS.UI.ListDataSource.InvalidKeyReturned",v.invalidKeyReturned)}throw new s("WinJS.UI.ListDataSource.InvalidItemReturned",v.invalidItemReturned)}function Ot(e,t){for(;void 0===e.index;){if(F(e,t,tn),e.firstInSequence)return!0;e=e.prev,t--}return e.index!==t?(bt(),!1):!0}function Bt(e,t){e.key=t.key,en[e.key]=e,e.item=t}function Lt(){for(var e=Qi;!e.firstInSequence;)if(e=e.prev,e===Xi)return null;return e}function Rt(e,t,i,n,s){s=I(s),n=S(n);var o=!1;Zi=!0;var r=s-i,a=t[0];a.key===e&&(o=!0);var l=At(a);if(l){if(+r===r&&!Ot(l,r))return}else{if(tn[r])return void bt();var h;if(void 0!==s&&(h=tn[r-1])){if(!h.lastInSequence)return void bt();l=V(h,tn)}else{var d=+r===r?J(r,tn,Xi,Qi):Lt(Xi,Qi);if(!d)return void bt();l=H(d,r,tn)}Bt(l,t[0])}for(var u=t.length,c=1;u>c;c++){a=t[c],a.key===e&&(o=!0);var _=At(a);if(_){if(void 0!==l.index&&!Ot(_,l.index+1))return;if(_!==l.next){if(!l.lastInSequence||!_.firstInSequence)return void bt();var m=k(_);if(m!==Qi)A(l,_,m);else{var f=T(l);if(f===Xi)return void bt();D(_,f,l)}O(l)}else l.lastInSequence&&O(l)}else{if(!l.lastInSequence)return void bt();_=V(l,tn),Bt(_,a)}l=_}if(o||(nn[e]=!0),!w(n)&&!Qi.firstInSequence){var g=Qi.prev.index;void 0!==g&&(n=g+1)}if(w(n)||n===p.unknown){if(w(Yi)){if(n!==Yi)return void bt()}else Yi=n;w(Yi)&&!tn[Yi]&&F(Qi,Yi,tn)}an?rn=!0:Dt(e)}function Ft(e,t,i){switch(i.name){case f.noResponse:He(m.failure);break;case f.doesNotExist:t?(F(Qi,0,tn),Yi=0,Jt()):(nn[e]=!0,an?rn=!0:Dt(e))}}function zt(e){return e===Xi?Ri:e===Qi?Fi:Ni[e.key]}function Ht(e){return e===Ri?Xi:e===Fi?Qi:en[e.key]}function Nt(e){O(e),e.next.mergedForRefresh=!0}function Wt(e,t){R(t,e.key),t.itemNew=e.item}function Vt(e,t,i){var n=E();Wt(e,n),L(n,t,i,!i);var s=e.index;return+s!==s&&(s=i?n.prev.index+1:t.next.index-1),F(n,s,Wi),n}function Ut(e,t,i){e?(ot(e,t,e.bindingMap),at(e,t,i.item)):(Wt(i,t),t.indexRequested&&nt(t))}function jt(e,t,i){return t.key?!1:(e?(i.mergeWithPrev=!t.firstInSequence,i.mergeWithNext=!t.lastInSequence):i.stationary=!0,Ut(e,t,i),!0)}function qt(e){var t;if(e.indexRequested)t=e.index;else{var i=Ht(e);i&&(t=i.index)}return t}function Jt(){_n=0,mn=new Array(100),pn=-1,Ei=!0,$i={};var e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v=[],y=[];for(m=0,a=Xi;a;a=a.next)a.sequenceNumber=m,a.firstInSequence&&(h=a),a.lastInSequence&&(y[m]={first:h,last:a,matchingItems:0},m++);for(Ui=null,Vi=0,i=Ri.next;i!==zi;)a=en[i.key],s=i.next,i!==Fi&&(te(i)?i.key&&!a?ve(i,!1):0===Yi||i.indexRequested&&i.index>=Yi?ve(i,!0):i.item||i.keyRequested?i.itemNew=a.item:i.key&&(i.keyRequested||(delete Ni[i.key],delete i.key),i.itemNew=null):ie(i)),i=s;for(i=Ri.next;i!==Fi;)s=i.next,i.indexRequested&&(a=tn[i.index],a&&Ut(zt(a),i,a)),i=s;var C,w,b,I,S,x=0,E=[];for(d=0,i=Ri;i!==zi;i=i.next){if(i.firstInSequence)for(h=i,b=null,e=0;m>e;e++)E[e]=0;if(i.indexRequested&&(b=i),a=Ht(i),a&&E[a.sequenceNumber]++,i.lastInSequence){for(w=0,e=x;m>e;e++)w<E[e]&&(w=E[e],C=e);u={first:h,last:i,sequenceNew:w>0?y[C]:void 0,matchingItems:w},b&&(u.indexRequested=!0,u.stationarySlot=b),v[d]=u,i===Fi&&(I=d,S=u),d++,void 0!==y[C].first.index&&(x=C)}}v[0].sequenceNew!==y[0]&&(B(Ri),v[0].first=Ri.next,v.unshift({first:Ri,last:Ri,sequenceNew:y[0],matchingItems:1}),I++,d++);var P=!Fi.firstInSequence;for(S.sequenceNew!==y[m-1]&&(B(Fi.prev),S.last=Fi.prev,I++,v.splice(I,0,{first:Fi,last:Fi,sequenceNew:y[m-1],matchingItems:1}),d++,S=v[I]),e=0;d>e;e++)p=v[e].sequenceNew,p&&p.matchingItems<v[e].matchingItems&&(p.matchingItems=v[e].matchingItems,p.sequenceOld=v[e]);for(y[m-1].sequenceOld=S,S.stationarySlot=Fi,y[0].sequenceOld=v[0],v[0].stationarySlot=Ri,e=0;I>=e;e++)u=v[e],u.sequenceNew&&(_=u.sequenceNew.sequenceOld)===c&&c.last!==Fi?(Nt(_.last),_.last=u.last,delete v[e]):c=u;for(c=null,e=I;e>=0;e--)u=v[e],u&&(u.sequenceNew&&(_=u.sequenceNew.sequenceOld)===c&&u.last!==Fi?(Nt(u.last),_.first=u.first,delete v[e]):c=u);P&&delete Fi.mergedForRefresh;var M=[];for(e=I+1;d>e;e++)if(u=v[e],u&&(!u.sequenceNew||u.sequenceNew.sequenceOld!==u)){var T=!0,k=null,L=null,R=0;for(a=Ht(u.first),a&&(k=L=a,R=1),i=u.first;i!==u.last;i=i.next){var F=Ht(i.next);if(a&&F&&(a.lastInSequence||a.next!==F)){T=!1;break}a&&!k&&(k=L=a),F&&k&&(L=F,R++),a=F}if(T&&k&&void 0!==k.index){var z;k.firstInSequence||(o=zt(k.prev),o&&(z=o.index));var H;if(L.lastInSequence||(r=zt(L.next),r&&(H=r.index)),(!r||r.lastInSequence||r.mergedForRefresh)&&(void 0===z||void 0===H||H-z-1>=R)){for(u.locationJustDetermined=!0,a=k;a.locationJustDetermined=!0,a!==L;a=a.next);var h=zt(k),N=zt(L);M.push({slotBeforeSequence:h.firstInSequence?null:h.prev,slotFirstInSequence:h,slotLastInSequence:N,slotAfterSequence:N.lastInSequence?null:N.next})}}}for(e=0;d>e;e++)if(u=v[e],!(!u||u.indexRequested||u.locationJustDetermined||u.sequenceNew&&u.sequenceNew.sequenceOld===u)){u.sequenceNew=null,i=u.first;var W;do{if(W=i===u.last,s=i.next,i!==Ri&&i!==Fi&&i!==zi&&!i.item&&!i.keyRequested)if(ve(i,!0),u.first===i){if(u.last===i){delete v[e];break}u.first=i.next}else u.last===i&&(u.last=i.prev);i=s}while(!W)}for(e=0;m>e;e++){for(p=y[e],a=p.first;!zt(a)&&!a.lastInSequence;a=a.next);if(a.lastInSequence&&!zt(a))p.firstInner=p.lastInner=null;else{for(p.firstInner=a,a=p.last;!zt(a);a=a.prev);p.lastInner=a}}for(e=0;m>e;e++)if(p=y[e],p&&p.firstInner&&(u=p.sequenceOld)){var V=0;for(i=u.first;a=Ht(i),a&&a.sequenceNumber===p.firstInner.sequenceNumber&&(a.ordinal=V),!i.lastInSequence;i=i.next,V++);var U=[];for(a=p.firstInner;!0;a=a.next){if(V=a.ordinal,void 0!==V){for(var j=0,q=U.length-1;q>=j;){var J=Math.floor(.5*(j+q));U[J].ordinal<V?j=J+1:q=J-1}U[j]=a,j>0&&(a.predecessor=U[j-1])}if(a===p.lastInner)break}var G=[],Z=U.length;for(a=U[Z-1],t=Z;t--;)a.stationary=!0,G[t]=a,a=a.predecessor;u.stationarySlot=zt(G[0]),a=G[0],i=zt(a),n=i.prev;for(var Y=i.firstInSequence;!a.firstInSequence;)if(a=a.prev,l=zt(a),!l||a.locationJustDetermined)for(;!Y&&n!==Ri&&(i=n,n=i.prev,Y=i.firstInSequence,!jt(l,i,a)););for(t=0;Z-1>t;t++){a=G[t],i=zt(a);var l,X=G[t+1],$=null,ee=zt(X);for(s=i.next,a=a.next;a!==X&&!$&&i!==ee;a=a.next)if(l=zt(a),!l||a.locationJustDetermined)for(;s!==ee;){if(s.mergedForRefresh){$=a.prev;break}if(i=s,s=i.next,jt(l,i,a))break}if($)for(n=ee.prev,a=X.prev;a!==$&&ee!==i;a=a.prev)if(l=zt(a),!l||a.locationJustDetermined)for(;n!==i&&(ee=n,n=ee.prev,!jt(l,ee,a)););for(;s!==ee;)i=s,s=i.next,i!==Ri&&K(i)&&!i.keyRequested&&ve(i)}for(a=G[Z-1],i=zt(a),s=i.next,Y=i.lastInSequence;!a.lastInSequence;)if(a=a.next,l=zt(a),!l||a.locationJustDetermined)for(;!Y&&s!==Fi&&(i=s,s=i.next,Y=i.lastInSequence,!jt(l,i,a)););}for(e=0;m>e;e++)if(p=y[e],p.firstInner)for(n=null,a=p.firstInner;!0;a=a.next){if(i=zt(a)){if(!a.stationary){var ne,se=!1,oe=!1;if(n)ne=n.next,se=!0;else{var re;for(re=p.firstInner;!re.stationary&&re!==p.lastInner;re=re.next);if(re.stationary)ne=zt(re),oe=!0;else if(f=a.index,0===f)ne=Ri.next,se=!0;else if(void 0===f)ne=zi;else{ne=Ri.next;for(var ae=null;ne.firstInSequence&&(ae=ne),!(f<ne.index&&ae||ne===Fi);)ne=ne.next;!ne.firstInSequence&&ae&&(ne=ae)}}i.mergedForRefresh&&(delete i.mergedForRefresh,i.lastInSequence||(i.next.mergedForRefresh=!0)),se=se||a.mergeWithPrev,oe=oe||a.mergeWithNext;var he=a.locationJustDetermined;ge(i,ne,se,oe,he),he&&oe&&(ne.mergedForRefresh=!0)}n=i}if(a===p.lastInner)break}for(e=0;m>e;e++)if(p=y[e],p.firstInner)for(n=null,a=p.firstInner;!0;a=a.next){if(i=zt(a),!i){var de;if(n)de=n.next;else{var ce;for(ce=p.firstInner;!zt(ce);ce=ce.next);de=zt(ce)}i=Vt(a,de,!!n);var F=Ht(de);de.mergedForRefresh||F&&F.locationJustDetermined||(Q(i),pe(i))}if(n=i,a===p.lastInner)break}Wi=[];var me=-1;for(i=Ri,g=0;i!==zi;g++){var s=i.next;if(i.firstInSequence&&(h=i,g=0),void 0===me){var fe=qt(i);void 0!==fe&&(me=fe-g)}if(void 0!==me&&!i.lastInSequence){var ye=qt(i.next);if(void 0!==ye&&ye!==me+g+1){B(i);for(var Ce=!0,we=i.next,be=!1;!be&&we!==Fi;){var Ie=we.next;be=we.lastInSequence,ge(we,Ie,!Ce,!1),Ce=!1,we=Ie}}}if(i.lastInSequence){f=me;for(var Se=h;Se!==s;){var xe=Se.next;if(f>=Yi&&Se!==Fi)ve(Se,!0);else{var Ee=Wi[f];f!==Se.index?(delete Wi[f],_e(Se,f)):+f===f&&Wi[f]!==Se&&(Wi[f]=Se),Se.itemNew&&nt(Se),Ee&&(Se.key?(ot(Se,Ee,Se.bindingMap),rt(Se,Ee),+f===f&&(Wi[f]=Se)):(ot(Ee,Se,Ee.bindingMap),rt(Ee,Se),+f===f&&(Wi[f]=Ee))),+f===f&&f++}Se=xe}me=void 0}i=s}var Pe,Te=-2;for(i=Ri,g=0;i!==zi;g++){var s=i.next;if(i.firstInSequence&&(h=i,g=0),delete i.mergedForRefresh,i.lastInSequence)if(void 0===h.index){o=h.prev;var ke;o&&(ke=Ht(o))&&!ke.lastInSequence&&(a=Ht(i))&&a.prev===ke?(A(o,h,i),O(o)):i===Fi||Pe||D(zi,h,i)}else{if(Te<i.index&&!Pe)Te=i.index;else{for(r=Ri.next;r.index<i.index;r=r.next);for(var we=h;we!==s;){var Ie=we.next;a=Ht(we),ge(we,r,r.prev.index===we.index-1,r.index===we.index+1,a&&a.locationJustDetermined),we=Ie}}o=h.prev,o&&o.index===h.index-1&&O(o)}i===Fi&&(Pe=!0),i=s}Ei=!1,mt(M),void 0!==Yi&&Yi!==Li&&ue(Yi),le();var De=[];for(e=0;m>e;e++){p=y[e];var Ae=[];i=null,g=0;var Oe;for(a=p.first;a===Xi?Ae.push(Oi):a===Qi?Ae.push(Bi):(Ae.push(a.item),i||(i=zt(a),Oe=g)),!a.lastInSequence;a=a.next,g++);i&&De.push({slot:i,results:Ae,offset:Oe})}for(wt(),Ji=!1,Me(),e=0;e<De.length;e++){var Be=De[e];ft(Be.slot,Be.results,Be.offset,Li,Be.slot.index)}if(Ki){var Le=Ki;Ki=null,Le.complete()}et()}function Kt(e,t,i,n,s,o,r){var a=Ci.prev,l={prev:a,next:Ci,applyEdit:e,editType:t,complete:i,error:n,keyUpdate:s};a.next=l,Ci.prev=l,wi=!0,(qi||Ji)&&(Mi++,Ji=!1,qi=!0),Ci.next===l&&Xt(),l.failed||(o(),l.undo=r),vi||Qt()}function Gt(){yi=!1;var e=Ci.next.next;Ci.next=e,e.prev=Ci;

}function Zt(){for(;Ci.prev!==Ci;){var e=Ci.prev;e.error&&e.error(new s(g.canceled)),e.undo&&!qi&&e.undo(),Ci.prev=e.prev}Ci.next=Ci,vi=!1,Qt()}function Yt(t){function i(){Ii||(o?bi=!0:Xt())}function n(e){if(e){var n;if(r&&r.key!==e.key){var s=e.key;if(t.undo){if(n=r.slot){var a=n.key;a&&delete Ni[a],R(n,s),n.itemNew=e,n.item?(fe(n),le()):Pe(n)}}else r.key=s}else t.editType===vn.change&&(n.itemNew=e,o||it(n))}Gt(),t.complete&&t.complete(e),i()}function s(e){switch(e.Name){case g.noResponse:return He(m.failure),Ii=!0,void(yi=!1);case g.notPermitted:break;case g.noLongerMeaningful:bt()}t.failed=!0,Gt(),Zt(),t.error&&t.error(e),i()}if(!yi){var o=!0,r=t.keyUpdate;e.beginEdits&&!gi&&(gi=!0,e.beginEdits()),yi=!0,t.applyEdit().then(n,s),o=!1}}function Xt(){for(;Ci.next!==Ci;)if(bi=!1,Yt(Ci.next),!bi)return;$t()}function Qt(){Se(),le(),Me(),Ci.next===Ci&&$t()}function $t(){wi=!1,e.endEdits&&gi&&!vi&&(gi=!1,e.endEdits()),qi?(qi=!1,bt()):et()}function ei(e){return Be(e),Ni[e]||Le(e)}function ti(e,t,i,n,s){var o=E();return L(o,i,n,s),e&&R(o,e),o.itemNew=t,be(o,1),vi||Si||(o.firstInSequence||"number"!=typeof o.prev.index?o.lastInSequence||"number"!=typeof o.next.index||F(o,o.next.index-1,Wi):F(o,o.prev.index+1,Wi)),Q(o),pe(o),o}function ii(e,t,i,n,s){var o={key:e};return new h(function(e,r){Kt(s,vn.insert,e,r,o,function(){if(i){var e={key:o.key,data:t};o.slot=ti(o.key,e,i,n,!n)}},function(){var e=o.slot;e&&(be(e,-1),ve(e,!1))})})}function ni(e,t,i,n){return new h(function(s,o){var r,a,l,h;Kt(n,vn.move,s,o,null,function(){a=e.next,l=e.firstInSequence,h=e.lastInSequence;var n=e.prev;r=!("number"==typeof e.index||!l&&n.item||!h&&a.item),be(e,-1),ge(e,t,i,!i),be(e,1),r&&(B(n),l||ct(n,e),h||_t(a,e))},function(){r?bt():(be(e,-1),ge(e,a,!l,!h),be(e,1))})})}function si(){function e(){Si||(Se(),le(),Me())}this.invalidateAll=function(){return 0===Li?(this.reload(),h.wrap()):It()},this.reload=function(){pi&&pi.cancel(),Ki&&Ki.cancel();for(var e=Ri.next;e!==zi;e=e.next){var t=e.fetchListeners;for(var i in t)t[i].promise.cancel();var n=e.directFetchListeners;for(var i in n)n[i].promise.cancel()}oi(),oe(function(e){e.notificationHandler&&e.notificationHandler.reload()})},this.beginNotifications=function(){Si=!0},this.inserted=function(t,i,n,s){if(wi)bt();else{var o=t.key,r=Ni[i],a=Ni[n],l="string"==typeof i,h="string"==typeof n;if(l?a&&!a.firstInSequence&&(r=a.prev):h&&r&&!r.lastInSequence&&(a=r.next),(l||h)&&!r&&!a&&Ri.next===Fi)return void bt();if(Ni[o])return void bt();if(r&&a&&(r.next!==a||r.lastInSequence||a.firstInSequence))return void bt();if(r&&(r.keyRequested||r.indexRequested)||a&&(a.keyRequested||a.indexRequested))return void bt();if(r||a)ti(o,t,a?a:r.next,!!r,!!a);else if(Ri.next===Fi)ti(o,t,Ri.next,!0,!0);else{if(void 0===s)return void bt();Ie(s,1)}e()}},this.changed=function(t){if(wi)bt();else{var i=t.key,n=Ni[i];n&&(n.keyRequested?bt():(n.itemNew=t,n.item&&(fe(n),e())))}},this.moved=function(t,i,n,s,o){if(wi)bt();else{var r=t.key,a=Ni[r],l=Ni[i],h=Ni[n];a&&a.keyRequested||l&&l.keyRequested||h&&h.keyRequested?bt():a?l&&h&&(l.next!==h||l.lastInSequence||h.firstInSequence)?bt():l||h?(be(a,-1),ge(a,h?h:l.next,!!l,!!h),be(a,1),e()):(be(a,-1),ve(a,!1),void 0!==s&&(o>s&&o--,Ie(o,1)),e()):l||h?(void 0!==s&&(Ie(s,-1),o>s&&o--),this.inserted(t,i,n,o)):void 0!==s&&(Ie(s,-1),o>s&&o--,Ie(o,1),e())}},this.removed=function(t,i){if(wi)bt();else{var n;n="string"==typeof t?Ni[t]:Wi[i],n?n.keyRequested?bt():(be(n,-1),ve(n,!1),e()):void 0!==i&&(Ie(i,-1),e())}},this.endNotifications=function(){Si=!1,e()}}function oi(){He(m.ready),pi=null,gi=!1,vi=!1,yi=!1,Ci={},Ci.next=Ci,Ci.prev=Ci,wi=!1,Ii=!1,xi=0,Ei=!1,Pi=0,Di={},Ai=[],Li=p.unknown,Ri={firstInSequence:!0,lastInSequence:!0,index:-1},Fi={firstInSequence:!0,lastInSequence:!0},zi={firstInSequence:!0,lastInSequence:!0},Ri.next=Fi,Fi.prev=Ri,Fi.next=zi,zi.prev=Fi,Hi={},Ni={},Wi={},Wi[-1]=Ri,Vi=0,Ui=null,ji=!1,qi=!1,Ji=!1,Ki=null}var ri,ai,li,hi,di,ui,ci,_i,mi,pi,fi,gi,vi,yi,Ci,wi,bi,Ii,Si,xi,Ei,Pi,Mi,Ti,ki,Di,Ai,Oi,Bi,Li,Ri,Fi,zi,Hi,Ni,Wi,Vi,Ui,ji,qi,Ji,Ki,Gi,Zi,Yi,Xi,Qi,$i,en,tn,nn,sn,on,rn,an,ln,hn,dn,un,cn,_n=0,mn=new Array(100),pn=-1;e.itemsFromKey&&(ln=function(t,i,n,s,r){var a="fetchItemsFromKey id="+t+" key="+i+" countBefore="+n+" countAfter="+s;o(a),mn[++pn%mn.length]={kind:"itemsFromKey",key:i,countBefore:n,countAfter:s};var l=e.itemsFromKey(i,n,s,r);return C(a),l}),e.itemsFromIndex&&(hn=function(t,i,n,s){var r="fetchItemsFromIndex id="+t+" index="+i+" countBefore="+n+" countAfter="+s;o(r),mn[++pn%mn.length]={kind:"itemsFromIndex",index:i,countBefore:n,countAfter:s};var a=e.itemsFromIndex(i,n,s);return C(r),a}),e.itemsFromStart&&(dn=function(t,i){var n="fetchItemsFromStart id="+t+" count="+i;o(n),mn[++pn%mn.length]={kind:"itemsFromStart",count:i};var s=e.itemsFromStart(i);return C(n),s}),e.itemsFromEnd&&(un=function(t,i){var n="fetchItemsFromEnd id="+t+" count="+i;o(n),mn[++pn%mn.length]={kind:"itemsFromEnd",count:i};var s=e.itemsFromEnd(i);return C(n),s}),e.itemsFromDescription&&(cn=function(t,i,n,s){var r="fetchItemsFromDescription id="+t+" desc="+i+" countBefore="+n+" countAfter="+s;o(r),mn[++pn%mn.length]={kind:"itemsFromDescription",description:i,countBefore:n,countAfter:s};var a=e.itemsFromDescription(i,n,s);return C(r),a});var fn=++_,gn=this,vn={insert:"insert",change:"change",move:"move",remove:"remove"};if(!e)throw new s("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",v.listDataAdapterIsInvalid);ai=e.compareByIdentity?0:200,i&&"number"==typeof i.cacheSize&&(ai=i.cacheSize),e.setNotificationHandler&&(ri=new si,e.setNotificationHandler(ri)),li=m.ready,di=!1,ui={},ci=0,_i=1,mi=0,Mi=0,Ti=!1,ki=1,Oi={},Bi={},oi(),this.createListBinding=function(e){function t(e){e&&e.cursorCount++}function i(e){e&&0===--e.cursorCount&&se(e)}function n(e){t(e),i(c),c=e}function s(e,t){e===c&&(t||(t=!c||c.lastInSequence||c.next===Fi?null:c.next),n(t))}function o(e){var t=e.bindingMap,i=t[u].handle;delete e.bindingMap[u];var n=!0,s=!0;for(var o in t)if(n=!1,i&&t[o].handle===i){s=!1;break}i&&s&&delete Hi[i],n&&(e.bindingMap=null,se(e))}function r(e,t){e.bindingMap||(e.bindingMap={});var i=e.bindingMap[u];if(i?i.count++:e.bindingMap[u]={bindingRecord:ui[u],count:1},e.fetchListeners){var n=e.fetchListeners[t];n&&(n.retained=!0)}}function a(e){var t=Hi[e];if(t){var i=t.bindingMap[u];if(0===--i.count){var n=t.fetchListeners;for(var s in n){var r=n[s];r.listBindingID===u&&(r.retained=!1)}o(t)}}}function l(t){var i=he(t,u),n=(mi++).toString(),s=xe(t,"fetchListeners",n,u,function(e,t){e(de(t,i))});return Z(s,t,i),e&&(s.retain=function(){return m._retainItem(t,n),s},s.release=function(){m._releaseItem(i)}),s}function d(t){var i;return!_&&t?i=l(t):(_?(i=new h(function(){}),i.cancel()):i=h.wrap(null),G(i,null),e&&(i.retain=function(){return i},i.release=function(){})),n(t),i}var u=(ci++).toString(),c=null,_=!1;ui[u]={notificationHandler:e,notificationsSent:!1,adjustCurrentSlot:s,itemPromiseFromKnownSlot:l};var m={_retainItem:function(e,t){r(e,t)},_releaseItem:function(e){a(e)},jumpToItem:function(e){return d(e?Hi[e.handle]:null)},current:function(){return d(c)},previous:function(){return d(c?De(c):null)},next:function(){return d(c?Ae(c):null)},releaseItem:function(e){this._releaseItem(e.handle)},release:function(){_=!0,i(c),c=null;for(var e=Ri.next;e!==zi;){var t=e.next,n=e.fetchListeners;for(var s in n){var r=n[s];r.listBindingID===u&&(r.promise.cancel(),delete n[s])}e.bindingMap&&e.bindingMap[u]&&o(e),e=t}delete ui[u]}};return(dn||hn)&&(m.first=function(){return d(Ae(Ri))}),un&&(m.last=function(){return d(De(Fi))}),ln&&(m.fromKey=function(e,t){return d(Re(e,t))}),(hn||dn&&ln)&&(m.fromIndex=function(e){return d(Fe(e))}),cn&&(m.fromDescription=function(e){return d(ze(e))}),m},this.invalidateAll=function(){return It()};var yn=function(e,t){var i=new u;e.then(function(e){i.complete(e)},function(e){i.error(e)});var n=i.promise.then(null,function(i){return"WinJS.UI.VirtualizedDataSource.resetCount"===i.name?(pi=null,e=t.getCount()):h.wrapError(i)}),o=0,r={get:function(){return o++,new h(function(e,t){n.then(e,t)},function(){0===--o&&(i.promise.cancel(),e.cancel(),r===pi&&(pi=null))})},reset:function(){i.error(new s("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){i.promise.cancel(),e.cancel(),r===pi&&(pi=null)}};return r};this.getCount=function(){if(e.getCount){var t=this;return h.wrap().then(function(){if(vi||wi)return Li;var i;if(!pi){var n;i=e.getCount();var s;i.then(function(){pi===n&&(pi=null),s=!0},function(){pi===n&&(pi=null),s=!0}),xi=0,s||(n=pi=yn(i,t))}return pi?pi.get():i}).then(function(e){if(!b(e)&&void 0!==e)throw new s("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",v.invalidRequestedCountReturned);return e!==Li&&(Li===p.unknown?Li=e:(ue(e),le())),0===e&&(Ri.next!==Fi||Fi.next!==zi?bt():Ri.lastInSequence&&(O(Ri),Fi.index=0)),e}).then(null,function(e){return e.name===c.CountError.noResponse?(He(m.failure),Li):h.wrapError(e)})}return h.wrap(Li)},ln&&(this.itemFromKey=function(e,t){return Oe(Re(e,t))}),(hn||dn&&ln)&&(this.itemFromIndex=function(e){return Oe(Fe(e))}),cn&&(this.itemFromDescription=function(e){return Oe(ze(e))}),this.beginEdits=function(){vi=!0},e.insertAtStart&&(this.insertAtStart=function(t,i){return ii(t,i,Ri.lastInSequence?null:Ri.next,!0,function(){return e.insertAtStart(t,i)})}),e.insertBefore&&(this.insertBefore=function(t,i,n){var s=ei(n);return ii(t,i,s,!1,function(){return e.insertBefore(t,i,n,Ce(s))})}),e.insertAfter&&(this.insertAfter=function(t,i,n){var s=ei(n);return ii(t,i,s?s.next:null,!0,function(){return e.insertAfter(t,i,n,Ce(s))})}),e.insertAtEnd&&(this.insertAtEnd=function(t,i){return ii(t,i,Fi.firstInSequence?null:Fi,!1,function(){return e.insertAtEnd(t,i)})}),e.change&&(this.change=function(t,i){var n=ei(t);return new h(function(s,o){var r;Kt(function(){return e.change(t,i,Ce(n))},vn.change,s,o,null,function(){r=n.item,n.itemNew={key:t,data:i},r?fe(n):Pe(n)},function(){r?(n.itemNew=r,fe(n)):bt()})})}),e.moveToStart&&(this.moveToStart=function(t){var i=ei(t);return ni(i,Ri.next,!0,function(){return e.moveToStart(t,Ce(i))})}),e.moveBefore&&(this.moveBefore=function(t,i){var n=ei(t),s=ei(i);return ni(n,s,!1,function(){return e.moveBefore(t,i,Ce(n),Ce(s))})}),e.moveAfter&&(this.moveAfter=function(t,i){var n=ei(t),s=ei(i);return ni(n,s.next,!0,function(){return e.moveAfter(t,i,Ce(n),Ce(s))})}),e.moveToEnd&&(this.moveToEnd=function(t){var i=ei(t);return ni(i,Fi,!1,function(){return e.moveToEnd(t,Ce(i))})}),e.remove&&(this.remove=function(t){Be(t);var i=Ni[t];return new h(function(n,s){var o,r,a;Kt(function(){return e.remove(t,Ce(i))},vn.remove,n,s,null,function(){i&&(o=i.next,r=i.firstInSequence,a=i.lastInSequence,be(i,-1),ve(i,!1))},function(){i&&(U(i,o,!r,!a),be(i,1),pe(i))})})}),this.endEdits=function(){vi=!1,Qt()}}var a=100,_=1,m=c.DataSourceStatus,p=c.CountResult,f=c.FetchError,g=c.EditError,v={get listDataAdapterIsInvalid(){return"Invalid argument: listDataAdapter must be an object or an array."},get indexIsInvalid(){return"Invalid argument: index must be a non-negative integer."},get keyIsInvalid(){return"Invalid argument: key must be a string."},get invalidItemReturned(){return"Error: data adapter returned item that is not an object."},get invalidKeyReturned(){return"Error: data adapter returned item with undefined or null key."},get invalidIndexReturned(){return"Error: data adapter should return undefined, null or a non-negative integer for the index."},get invalidCountReturned(){return"Error: data adapter should return undefined, null, CountResult.unknown, or a non-negative integer for the count."},get invalidRequestedCountReturned(){return"Error: data adapter should return CountResult.unknown, CountResult.failure, or a non-negative integer for the count."},get refreshCycleIdentified(){return"refresh cycle found, likely data inconsistency"}},y="statuschanged",C=i.Class.define(function(){},{_baseDataSourceConstructor:e,_isVirtualizedDataSource:!0},{supportedForProcessing:!1});return i.Class.mix(C,o.eventMixin),C})})}),n("WinJS/VirtualizedDataSource/_GroupDataSource",["exports","../Core/_Base","../Core/_ErrorFromName","../Promise","../Scheduler","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(e,t,i,n,s,o,r){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupDataSource:t.Namespace._lazy(function(){function e(){return new i(o.FetchError.doesNotExist)}function a(e){return e&&e.firstReached&&e.lastReached}var l=101,h=t.Class.define(function(e){this._groupDataAdapter=e},{beginNotifications:function(){},inserted:function(e,t,i){this._groupDataAdapter._inserted(e,t,i)},changed:function(e,t){this._groupDataAdapter._changed(e,t)},moved:function(e,t,i){this._groupDataAdapter._moved(e,t,i)},removed:function(e,t){this._groupDataAdapter._removed(e,t)},countChanged:function(e,t){0===e&&0!==t&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(e,t,i){this._groupDataAdapter._indexChanged(e,t,i)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),d=t.Class.define(function(e,t,i,n){this._listBinding=e.createListBinding(new h(this)),this._groupKey=t,this._groupData=i,this._initializeState(),this._batchSize=l,this._count=null,n&&("number"==typeof n.groupCountEstimate&&(this._count=n.groupCountEstimate<0?null:Math.max(n.groupCountEstimate,1)),"number"==typeof n.batchSize&&(this._batchSize=n.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(e){var t=this;return this._fetchItems(function(){return t._lastGroup},function(e){if(e)return!1;var i=t._count;return+i!==i?!0:i>0?!0:void 0},function(){t._fetchBatch(t._listBinding.last(),t._batchSize-1,0)},e-1,0)})},{setNotificationHandler:function(e){this._listDataNotificationHandler=e},compareByIdentity:!0,itemsFromKey:function(e,t,i,n){var s=this;return this._fetchItems(function(){return s._keyMap[e]},function(){var e=s._lastGroup;return e?+e.index!==e.index?!0:void 0:!0},function(){n=n||{};var e="string"==typeof n.groupMemberKey&&s._listBinding.fromKey?s._listBinding.fromKey(n.groupMemberKey):"number"==typeof n.groupMemberIndex&&s._listBinding.fromIndex?s._listBinding.fromIndex(n.groupMemberIndex):void 0!==n.groupMemberDescription&&s._listBinding.fromDescription?s._listBinding.fromDescription(n.groupMemberDescription):s._listBinding.first(),t=Math.floor(.5*(s._batchSize-1));s._fetchBatch(e,t,s._batchSize-1-t)},t,i)},itemsFromIndex:function(e,t,i){var n=this;return this._fetchItems(function(){return n._indexMap[e]},function(){var t=n._lastGroup;return t?+t.index!==t.index?!0:e<=t.index?!0:void 0:!0},function(){n._fetchNextIndex()},t,i)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return n.wrap(this._count);var e=this,t=new n(function(t){var i={initialBatch:function(){e._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(i){i&&(e._count=0);var n=e._count;return"number"==typeof n?(t(n),!0):!1}};e._fetchQueue.push(i),e._itemBatch||e._continueFetch(i)});return"number"==typeof this._count?n.wrap(this._count):t},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(e){delete this._handleMap[e.handle],this._listBinding.releaseItem(e)},_processBatch:function(){for(var e=null,t=null,i=null,n=0,o=!0,r=0;r<this._batchSize;r++){var a=this._itemBatch[r],l=a?this._groupKey(a):null;if(a&&(o=!1),t&&null!==l&&l===t.key)n++,t.lastItem===e?(t.lastItem.handle!==t.firstItem.handle&&this._releaseItem(t.lastItem),t.lastItem=a,this._handleMap[a.handle]=t,t.size++):t.firstItem===a&&(t.firstItem.handle!==t.lastItem.handle&&this._releaseItem(t.firstItem),t.firstItem=i,this._handleMap[i.handle]=t,t.size+=n);else{var h=null;if(t&&(t.lastReached=!0,"number"==typeof t.index&&(h=t.index+1)),a){var d=this._keyMap[l];if(d||(d={key:l,data:this._groupData(a),firstItem:a,lastItem:a,size:1},this._keyMap[d.key]=d,this._handleMap[a.handle]=d),r>0&&(d.firstReached=!0,t||(h=0)),"number"!=typeof d.index&&"number"==typeof h){for(var u=d;u;u=this._nextGroup(u))u.index=h,this._indexMap[h]=u,h++;this._indexMax=h,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}i=a,n=0,t=d}else t&&(this._lastGroup=t,"number"==typeof t.index&&(this._count=t.index+1),this._listDataNotificationHandler.invalidateAll(),t=null)}e=a}var c;for(c=this._fetchQueue[0];c&&c.complete(o);c=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(c){var _=this;s.schedule(function(){_._continueFetch(c)},s.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(e,t){e.retain(),this._itemBatch[t]=e;var i=this;e.then(function(e){i._itemBatch[t]=e,0===--i._itemsToFetch&&i._processBatch()})},_fetchBatch:function(e,t){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(e,t);var i;for(this._listBinding.jumpToItem(e),i=t-1;i>=0;i--)this._processPromise(this._listBinding.previous(),i);for(this._listBinding.jumpToItem(e),i=t+1;i<this._batchSize;i++)this._processPromise(this._listBinding.next(),i)},_fetchAdjacent:function(e,t){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(e.key):this._listBinding.fromIndex(e.index),t?0:this._batchSize-1,t?this._batchSize-1:0)},_fetchNextIndex:function(){var e=this._indexMap[this._indexMax-1];e?this._fetchAdjacent(e.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(e){if(e.initialBatch)e.initialBatch(),e.initialBatch=null;else{var t=e.getGroup();if(t){var i,n;t.firstReached?t.lastReached?e.countBefore>0&&0!==t.index&&!a(i=this._previousGroup(t))?this._fetchAdjacent(i&&i.lastReached?i.firstItem:t.firstItem,!1):(n=this._nextGroup(t),this._fetchAdjacent(n&&n.firstReached?n.lastItem:t.lastItem,!0)):this._fetchAdjacent(t.lastItem,!0):this._fetchAdjacent(t.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(e,t,i,n,s){if(a(e)){var r=this._previousGroup(e);if(n||a(r)||0===e.index||0===t){var l=this._nextGroup(e);if(n||a(l)||this._lastGroup===e||0===i){for(var h=0,d=e;t>h&&(r=this._previousGroup(d),a(r));)d=r,h++;for(var u=0,c=e;i>u&&(l=this._nextGroup(c),a(l));)c=l,u++;for(var _=h+1+u,m=new Array(_),p=0;_>p;p++){var f={key:d.key,data:d.data,firstItemKey:d.firstItem.key,groupSize:d.size},g=d.firstItem.index;"number"==typeof g&&(f.firstItemIndexHint=g),m[p]=f,d=this._nextGroup(d)}var v={items:m,offset:h};return v.totalCount="number"==typeof this._count?this._count:o.CountResult.unknown,"number"==typeof e.index&&(v.absoluteIndex=e.index),c===this._lastGroup&&(v.atEnd=!0),s(v),!0}}}return!1},_fetchItems:function(t,i,s,o,r){var a=this;return new n(function(n,l){function h(s){var h=t();return h?a._fetchComplete(h,o,r,u,n,l):u&&!i(s)?(l(e()),!0):c>2?(l(e()),!0):(s?c++:c=0,!1)}var d=t(),u=!d,c=0;if(!h()){var _={initialBatch:u?s:null,getGroup:t,countBefore:o,countAfter:r,complete:h};a._fetchQueue.push(_),a._itemBatch||a._continueFetch(_)}})},_previousGroup:function(e){return e&&e.firstReached?(this._listBinding.jumpToItem(e.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(e){return e&&e.lastReached?(this._listBinding.jumpToItem(e.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(e){this._count=null,this._lastGroup=null,"number"==typeof e.index&&(this._indexMax=e.index>0?e.index:null);for(var t=e;t&&"number"==typeof t.index;t=this._nextGroup(t))delete this._indexMap[t.index],t.index=null},_releaseGroup:function(e){this._invalidateIndices(e),delete this._keyMap[e.key],this._lastGroup===e&&(this._lastGroup=null),e.firstItem!==e.lastItem&&this._releaseItem(e.firstItem),this._releaseItem(e.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var e=0;e<this._batchSize;e++){var t=this._itemBatch[e];t&&(t.cancel&&t.cancel(),this._listBinding.releaseItem(t))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(e,t,i){var n=this._handleMap[t],s=this._handleMap[i],o=null;n&&(n.lastReached&&t===n.lastItem.handle&&(o=this._groupKey(e))!==n.key?this._lastGroup===n&&(this._lastGroup=null,this._count=null):this._releaseGroup(n),this._beginRefresh()),s&&s!==n&&(this._invalidateIndices(s),s.firstReached&&i===s.firstItem.handle&&(null!==o?o:this._groupKey(e))!==s.key||this._releaseGroup(s),this._beginRefresh())},_processRemoval:function(e){var t=this._handleMap[e];if(!t||e!==t.firstItem.handle&&e!==t.lastItem.handle){if(this._itemBatch)for(var i=0;i<this._batchSize;i++){var n=this._itemBatch[i];if(n&&n.handle===e){this._beginRefresh();break}}}else this._releaseGroup(t),this._beginRefresh()},_inserted:function(e,t,i){var n=this;e.then(function(e){n._processInsertion(e,t,i)})},_changed:function(e,t){var i=this._handleMap[e.handle];if(i&&e.handle===i.firstItem.handle&&(this._releaseGroup(i),this._beginRefresh()),this._groupKey(e)!==this._groupKey(t)){this._listBinding.jumpToItem(e);var n=this._listBinding.previous().handle;this._listBinding.jumpToItem(e);var s=this._listBinding.next().handle;this._processRemoval(e.handle),this._processInsertion(e,n,s)}},_moved:function(e,t,i){this._processRemoval(e.handle);var n=this;e.then(function(e){n._processInsertion(e,t,i)})},_removed:function(e,t){t||this._processRemoval(e)},_indexChanged:function(e,t,i){"number"==typeof i&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var e in this._keyMap){var t=this._keyMap[e];if(t.firstReached&&t.lastReached){var i=t.lastItem.index+1-t.firstItem.index;isNaN(i)||(t.size=i)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return t.Class.derive(r.VirtualizedDataSource,function(e,t,i,n){var s=new d(e,t,i,n);this._baseDataSourceConstructor(s),this.extensions={invalidateGroups:function(){s.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}),n("WinJS/VirtualizedDataSource/_GroupedItemDataSource",["../Core/_Base","./_GroupDataSource"],function(e,t){"use strict";e.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(e,i,n,s){function o(e){if(e){var t=Object.create(e);return t.groupKey=i(e),n&&(t.groupData=n(e)),t}return null}function r(e){var t=Object.create(e);return t.then=function(t,i,n){return e.then(function(e){return t(o(e))},i,n)},t}var a=Object.create(e);a.createListBinding=function(t){var i;t?(i=Object.create(t),i.inserted=function(e,i,n){return t.inserted(r(e),i,n)},i.changed=function(e,i){return t.changed(o(e),o(i))},i.moved=function(e,i,n){return t.moved(r(e),i,n)}):i=null;for(var n=e.createListBinding(i),s=Object.create(n),a=["first","last","fromDescription","jumpToItem","current"],l=0,h=a.length;h>l;l++)!function(e){n[e]&&(s[e]=function(){return r(n[e].apply(n,arguments))})}(a[l]);return n.fromKey&&(s.fromKey=function(e){return r(n.fromKey(e))}),n.fromIndex&&(s.fromIndex=function(e){return r(n.fromIndex(e))}),s.prev=function(){return r(n.prev())},s.next=function(){return r(n.next())},s};for(var l=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],h=0,d=l.length;d>h;h++)!function(t){e[t]&&(a[t]=function(){return r(e[t].apply(e,arguments))})}(l[h]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){e[t]&&(a[t]=function(){return e[t].apply(e,arguments)})});var u=null;return Object.defineProperty(a,"groups",{get:function(){return u||(u=new t._GroupDataSource(e,i,n,s)),u},enumerable:!0,configurable:!0}),a}})}),n("WinJS/VirtualizedDataSource/_StorageDataSource",["exports","../Core/_WinRT","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_WriteProfilerMark","../Animations","../Promise","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(e,t,i,n,s,o,r,a,l,h){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{StorageDataSource:n.Namespace._lazy(function(){var e=n.Class.define(function(e,i){o("WinJS.UI.StorageDataSource:constructor,StartTM");var n,s=t.Windows.Storage.FileProperties.ThumbnailMode.singleItem,r=256,a=t.Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,l=!0;if("Pictures"===e?(s=t.Windows.Storage.FileProperties.ThumbnailMode.picturesView,n=t.Windows.Storage.KnownFolders.picturesLibrary,r=190):"Music"===e?(s=t.Windows.Storage.FileProperties.ThumbnailMode.musicView,n=t.Windows.Storage.KnownFolders.musicLibrary,r=256):"Documents"===e?(s=t.Windows.Storage.FileProperties.ThumbnailMode.documentsView,n=t.Windows.Storage.KnownFolders.documentsLibrary,r=40):"Videos"===e&&(s=t.Windows.Storage.FileProperties.ThumbnailMode.videosView,n=t.Windows.Storage.KnownFolders.videosLibrary,r=190),n){var h=new t.Windows.Storage.Search.QueryOptions;h.folderDepth=t.Windows.Storage.Search.FolderDepth.deep,h.indexerOption=t.Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=n.createFileQueryWithOptions(h)}else this._query=e;if(i){if("number"==typeof i.mode&&(s=i.mode),"number"==typeof i.requestedThumbnailSize)r=Math.max(1,Math.min(i.requestedThumbnailSize,1024));else switch(s){case t.Windows.Storage.FileProperties.ThumbnailMode.picturesView:case t.Windows.Storage.FileProperties.ThumbnailMode.videosView:r=190;break;case t.Windows.Storage.FileProperties.ThumbnailMode.documentsView:case t.Windows.Storage.FileProperties.ThumbnailMode.listView:r=40;break;case t.Windows.Storage.FileProperties.ThumbnailMode.musicView:case t.Windows.Storage.FileProperties.ThumbnailMode.singleItem:r=256}"number"==typeof i.thumbnailOptions&&(a=i.thumbnailOptions),"boolean"==typeof i.waitForFileLoad&&(l=!i.waitForFileLoad)}this._loader=new t.Windows.Storage.BulkAccess.FileInformationFactory(this._query,s,r,a,l),this.compareByIdentity=!1,this.firstDataRequest=!0,o("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(e){this._notificationHandler=e,this._query.addEventListener("contentschanged",function(){e.invalidateAll()}),this._query.addEventListener("optionschanged",function(){e.invalidateAll()})},itemsFromEnd:function(e){var t=this;return o("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(i){return 0===i?a.wrapError(new s(l.FetchError.doesNotExist)):t.itemsFromIndex(i-1,Math.min(i-1,e-1),1)})},itemsFromIndex:function(e,t,i){function n(e){d._notificationHandler.changed(d._item(e.target))}t+i>64&&(t=Math.min(t,32),i=64-(t+1));var r=e-t,h=t+1+i,d=this;d.firstDataRequest&&(d.firstDataRequest=!1,h=Math.max(h,32));var u="WinJS.UI.StorageDataSource:itemsFromIndex("+r+"-"+(r+h-1)+")";return o(u+",StartTM"),this._loader.getItemsAsync(r,h).then(function(i){var c=i.size;if(t>=c)return a.wrapError(new s(l.FetchError.doesNotExist));var _=new Array(c),m=new Array(c);i.getMany(0,m);for(var p=0;c>p;p++)_[p]=d._item(m[p]),m[p].addEventListener("propertiesupdated",n);var f={items:_,offset:t,absoluteIndex:e};return h>c&&(f.totalCount=r+c),o(u+",StopTM"),f})},itemsFromDescription:function(e,t,i){var n=this;return o("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(e).then(function(e){return n.itemsFromIndex(e,t,i)})},getCount:function(){return o("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(e){return e.folderRelativeId},_item:function(e){return{key:e.path||e.folderRelativeId,data:e}}},{supportedForProcessing:!1});return n.Class.derive(h.VirtualizedDataSource,function(t,i){this._baseDataSourceConstructor(new e(t,i))},{},{loadThumbnail:function(e,n){var s,l,h=!1;return new a(function(d){var u=n?!0:!1,c=function(c){if(c){var _=i.URL.createObjectURL(c,{oneTimeOnly:!0});l=l?l.then(function(t){return e.loadImage(_,t)}):e.loadImage(_,n).then(function(t){return e.isOnScreen().then(function(e){var i;return e&&u?i=r.fadeIn(t).then(function(){return t}):(t.style.opacity=1,i=a.wrap(t)),i})}),c.type===t.Windows.Storage.FileProperties.ThumbnailType.icon||c.returnedSmallerCachedSize||(o("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),e.data.removeEventListener("thumbnailupdated",s),h=!1,l=l.then(function(e){s=null,l=null,d(e)}))}};s=function(e){h&&c(e.target.thumbnail)},e.data.addEventListener("thumbnailupdated",s),h=!0,c(e.data.thumbnail)},function(){e.data.removeEventListener("thumbnailupdated",s),h=!1,s=null,l&&(l.cancel(),l=null)})},supportedForProcessing:!1})})})}),n("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_VirtualizedDataSourceImpl","./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource","./VirtualizedDataSource/_StorageDataSource"],function(){}),n("WinJS/_Accents",["require","exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils"],function(e,t,i,n,s,o){function r(e,t){v.push({selector:e,props:t}),a()}function a(){0!==v.length&&-1===y&&(y=o._setImmediate(function(){y=-1,u();var e=g?_.lightThemeSelector:_.darkThemeSelector,t=_.hoverSelector+" "+e,n=i.document.createElement("style");n.id=_.accentStyleId,n.textContent=v.map(function(i){var n="  "+i.props.map(function(e){return e.name+": "+f[e.value]+";"}).join("\n  "),s=i.selector.split(",").map(function(e){return d(e)}),o=s.join(",\n"),r=o+" {\n"+n+"\n}",a=i.props.some(function(e){return 0!==e.value});if(a){var l="  "+i.props.map(function(e){return e.name+": "+f[e.value?e.value+3:e.value]+";"}).join("\n  "),h=[];s.forEach(function(i){if(-1!==i.indexOf(_.hoverSelector)&&-1===i.indexOf(t)){h.push(i.replace(_.hoverSelector,t));var n=i.replace(_.hoverSelector,"").trim();-1!==m.indexOf(n[0])&&h.push(i.replace(_.hoverSelector+" ",t))}else h.push(e+" "+i),-1!==m.indexOf(i[0])&&h.push(e+i);r+="\n"+h.join(",\n")+" {\n"+l+"\n}"})}return r}).join("\n"),i.document.head.appendChild(n)}))}function l(){var e=(n.Windows.UI.ViewManagement.UIColorType,p.getColorValue(n.Windows.UI.ViewManagement.UIColorType.accent)),t=h(e,1);f[0]!==t&&(f.length=0,f.push(t,h(e,g?.6:.4),h(e,g?.8:.6),h(e,g?.9:.7),h(e,g?.4:.6),h(e,g?.6:.8),h(e,g?.7:.9)),a())}function h(e,t){return"rgba("+e.r+","+e.g+","+e.b+","+t+")"}function d(e){return e.replace(/  /g," ").replace(/  /g," ").trim()}function u(){var e=i.document.head.querySelector("#"+_.accentStyleId);e&&e.parentNode.removeChild(e)}function c(){v.length=0,u()}var _={accentStyleId:"WinJSAccentsStyle",themeDetectionTag:"winjs-themedetection-tag",hoverSelector:"html.win-hoverable",lightThemeSelector:".win-ui-light",darkThemeSelector:".win-ui-dark"},m=[".","#",":"],p=null,f=[],g=!1,v=[],y=-1;!function(e){e[e.accent=0]="accent",e[e.listSelectRest=1]="listSelectRest",e[e.listSelectHover=2]="listSelectHover",e[e.listSelectPress=3]="listSelectPress",e[e._listSelectRestInverse=4]="_listSelectRestInverse",e[e._listSelectHoverInverse=5]="_listSelectHoverInverse",e[e._listSelectPressInverse=6]="_listSelectPressInverse"}(t.ColorTypes||(t.ColorTypes={}));var C=t.ColorTypes;t.createAccentRule=r;var w=i.document.createElement(_.themeDetectionTag);i.document.head.appendChild(w);var b=i.getComputedStyle(w);g=b&&"0"===b.opacity,w.parentElement.removeChild(w);try{p=new n.Windows.UI.ViewManagement.UISettings,p.addEventListener("colorvalueschanged",l),l()}catch(I){f.push("rgb(0, 120, 215)","rgba(0, 120, 215, "+(g?"0.6":"0.4")+")","rgba(0, 120, 215, "+(g?"0.8":"0.6")+")","rgba(0, 120, 215, "+(g?"0.9":"0.7")+")","rgba(0, 120, 215, "+(g?"0.4":"0.6")+")","rgba(0, 120, 215, "+(g?"0.6":"0.8")+")","rgba(0, 120, 215, "+(g?"0.7":"0.9")+")")}var S={ColorTypes:C,createAccentRule:r,_colors:f,_reset:c,_isDarkTheme:g};s.Namespace.define("WinJS.UI._Accents",S)}),n("require-style",{load:function(e){throw new Error("Dynamic load not allowed: "+e);

}}),n("require-style!less/styles-intrinsic",[],function(){}),n("require-style!less/colors-intrinsic",[],function(){}),n("WinJS/Controls/IntrinsicControls",["../Utilities/_Hoverable","../_Accents","require-style!less/styles-intrinsic","require-style!less/colors-intrinsic"],function(e,t){"use strict";t.createAccentRule(".win-link,         .win-progress-bar,         .win-progress-ring,         .win-ring",[{name:"color",value:t.ColorTypes.accent}]),t.createAccentRule("::selection,         .win-button.win-button-primary,         .win-dropdown option:checked,         select[multiple].win-dropdown option:checked",[{name:"background-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-textbox:focus,         .win-textarea:focus,         .win-textbox:focus:hover,         .win-textarea:focus:hover",[{name:"border-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-textbox::-ms-clear:hover:not(:active),         .win-textbox::-ms-reveal:hover:not(:active)",[{name:"color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-checkbox:checked::-ms-check,         .win-textbox::-ms-clear:active,         .win-textbox::-ms-reveal:active",[{name:"background-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-progress-bar::-webkit-progress-value,         .win-progress-ring::-webkit-progress-value,         .win-ring::-webkit-progress-value",[{name:"background-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-progress-bar:not(:indeterminate)::-moz-progress-bar,         .win-progress-ring:not(:indeterminate)::-moz-progress-bar,         .win-ring:not(:indeterminate)::-moz-progress-bar",[{name:"background-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-checkbox:indeterminate::-ms-check,         .win-checkbox:hover:indeterminate::-ms-check,         .win-radio:checked::-ms-check",[{name:"border-color",value:t.ColorTypes.accent}]),t.createAccentRule(".win-slider::-ms-thumb,         .win-slider::-ms-fill-lower",[{name:"background",value:t.ColorTypes.accent}]),t.createAccentRule(".win-slider::-webkit-slider-thumb",[{name:"background",value:t.ColorTypes.accent}]),t.createAccentRule(".win-slider::-moz-range-thumb",[{name:"background",value:t.ColorTypes.accent}])}),n("WinJS/Controls/ItemContainer/_Constants",["exports","../../Core/_Base"],function(e,t){"use strict";var i={};i._listViewClass="win-listview",i._viewportClass="win-viewport",i._rtlListViewClass="win-rtl",i._horizontalClass="win-horizontal",i._verticalClass="win-vertical",i._scrollableClass="win-surface",i._itemsContainerClass="win-itemscontainer",i._listHeaderContainerClass="win-headercontainer",i._listFooterContainerClass="win-footercontainer",i._padderClass="win-itemscontainer-padder",i._proxyClass="_win-proxy",i._itemClass="win-item",i._itemBoxClass="win-itembox",i._itemsBlockClass="win-itemsblock",i._containerClass="win-container",i._containerEvenClass="win-container-even",i._containerOddClass="win-container-odd",i._backdropClass="win-backdrop",i._footprintClass="win-footprint",i._groupsClass="win-groups",i._selectedClass="win-selected",i._selectionBorderClass="win-selectionborder",i._selectionBackgroundClass="win-selectionbackground",i._selectionCheckmarkClass="win-selectioncheckmark",i._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",i._pressedClass="win-pressed",i._headerClass="win-groupheader",i._headerContainerClass="win-groupheadercontainer",i._groupLeaderClass="win-groupleader",i._progressClass="win-progress",i._revealedClass="win-revealed",i._itemFocusClass="win-focused",i._itemFocusOutlineClass="win-focusedoutline",i._zoomingXClass="win-zooming-x",i._zoomingYClass="win-zooming-y",i._listLayoutClass="win-listlayout",i._gridLayoutClass="win-gridlayout",i._headerPositionTopClass="win-headerpositiontop",i._headerPositionLeftClass="win-headerpositionleft",i._structuralNodesClass="win-structuralnodes",i._singleItemsBlockClass="win-single-itemsblock",i._uniformGridLayoutClass="win-uniformgridlayout",i._uniformListLayoutClass="win-uniformlistlayout",i._cellSpanningGridLayoutClass="win-cellspanninggridlayout",i._laidOutClass="win-laidout",i._nonDraggableClass="win-nondraggable",i._nonSelectableClass="win-nonselectable",i._dragOverClass="win-dragover",i._dragSourceClass="win-dragsource",i._clipClass="win-clip",i._selectionModeClass="win-selectionmode",i._noCSSGrid="win-nocssgrid",i._hidingSelectionMode="win-hidingselectionmode",i._hidingSelectionModeAnimationTimeout=250,i._INVALID_INDEX=-1,i._UNINITIALIZED=-1,i._LEFT_MSPOINTER_BUTTON=0,i._RIGHT_MSPOINTER_BUTTON=2,i._TAP_END_THRESHOLD=10,i._DEFAULT_PAGES_TO_LOAD=5,i._DEFAULT_PAGE_LOAD_THRESHOLD=2,i._MIN_AUTOSCROLL_RATE=150,i._MAX_AUTOSCROLL_RATE=1500,i._AUTOSCROLL_THRESHOLD=100,i._AUTOSCROLL_DELAY=50,i._DEFERRED_ACTION=250,i._DEFERRED_SCROLL_END=250,i._SELECTION_CHECKMARK="",i._LISTVIEW_PROGRESS_DELAY=2e3;var n={uninitialized:0,low:1,medium:2,high:3},s={rebuild:0,remeasure:1,relayout:2,realize:3};i._ScrollToPriority=n,i._ViewChange=s,t.Namespace._moduleDefine(e,"WinJS.UI",i)}),n("WinJS/Controls/ItemContainer/_ItemEventsHandler",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(e,t,i,n,s,o,r,a,l,h,d,u){"use strict";function c(e,t,i){var n=44,s=750,o=2,r=9,a=2.11,l=13,d=s-n,u=i.width/2,c=i.height/2,_=h._clamp(i.width,n,s),m=h._clamp(i.height,n,s),p=r-(m-n)/d*(r-o),f=l-(_-n)/d*(l-a),g=(e-i.left-u)/u,v=(t-i.top-c)/c,y=p*v,C=f*g,w=.97+.03*(Math.abs(g)+Math.abs(v))/2,b="perspective(800px) scale("+w+") rotateX("+-y+"deg) rotateY("+C+"deg)";return b}var _=s._browserStyleEquivalents.transform;n.Namespace._moduleDefine(e,"WinJS.UI",{_tiltTransform:c,_ItemEventsHandler:n.Namespace._lazy(function(){function e(e,i){var n=t.document.createElement("div");return n.className=e,i||n.setAttribute("aria-hidden",!0),n}var r=h._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",m=n.Class.define(function(e){this._site=e,this._work=[],this._animations={}},{dispose:function(){this._disposed||(this._disposed=!0,h._removeEventListener(t,"pointerup",this._resetPointerDownStateBound),h._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound))},onPointerDown:function(e){o("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var n,a,l=this._site,c=e.pointerType===r;if(l.pressedElement=e.target,i.Windows.UI.Input.PointerPoint){var _=this._getCurrentPoint(e),m=_.properties;c||m.isInverted||m.isEraser||m.isMiddleButtonPressed?n=a=!1:(a=m.isRightButtonPressed,n=!a&&m.isLeftButtonPressed)}else n=e.button===u._LEFT_MSPOINTER_BUTTON,a=e.button===u._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this);var p=this._isInteractive(e.target),f=l.indexForItemElement(e.target),g=l.indexForHeaderElement(e.target),v=!p&&f!==u._INVALID_INDEX;if((c||n)&&this._site.pressedEntity.index===u._INVALID_INDEX&&!p&&(this._site.pressedEntity=g===u._INVALID_INDEX?{type:d.ObjectType.item,index:f}:{type:d.ObjectType.groupHeader,index:g},this._site.pressedEntity.index!==u._INVALID_INDEX)){this._site.pressedPosition=h._getCursorPos(e);var y=l.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=y.canSelect,this._canTapSelect=y.canTapSelect,this._site.pressedEntity.type===d.ObjectType.item?(this._site.pressedItemBox=l.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=l.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,!1,e),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),c||(h._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),h._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(e.target),s.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,!1,e)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),c||(h._addEventListener(t,"pointerup",this._resetPointerDownStateBound,!1),h._addEventListener(t,"pointercancel",this._resetPointerDownStateBound,!1)),this._pointerId=e.pointerId,this._pointerRightButton=a}if(v&&c)try{h._setPointerCapture(l.canvasProxy,e.pointerId)}catch(C){return void o("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type===d.ObjectType.item&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==u._INVALID_INDEX&&l.selection._getFocused().index!==u._INVALID_INDEX&&l.selection._pivot===u._INVALID_INDEX&&(l.selection._pivot=l.selection._getFocused().index),o("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(e){this._site.pressedContainer&&this._pointerId===e.pointerId&&this._togglePressed(!0,!1,e)},onPointerLeave:function(e){this._site.pressedContainer&&this._pointerId===e.pointerId&&this._togglePressed(!1,!0,e)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.style[_.scriptName]="",this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),h._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),h._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(e){if(!this._skipClick){var t={type:d.ObjectType.item,index:this._site.indexForItemElement(e.target)};if(t.index===u._INVALID_INDEX&&(t.index=this._site.indexForHeaderElement(e.target),t.index!==u._INVALID_INDEX&&(t.type=d.ObjectType.groupHeader)),t.index!==u._INVALID_INDEX&&(h.hasClass(e.target,this._site.accessibleItemClass)||h.hasClass(e.target,u._headerClass))){var i=this._site.verifySelectionAllowed(t);i.canTapSelect&&this.handleTap(t),this._site.fireInvokeEvent(t,e.target)}}},onPointerUp:function(e){o("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var t=this._site;this._skipClick=!0;var i=this;s._yieldForEvents(function(){i._skipClick=!1});try{h._releasePointerCapture(t.canvasProxy,e.pointerId)}catch(n){}var a=e.pointerType===r,l=this._releasedElement(e),c=t.indexForItemElement(l),_=t.indexForHeaderElement(l&&h.hasClass(l,u._headerContainerClass)?t.pressedHeader:l);if(this._pointerId===e.pointerId){var m;if(m=_===u._INVALID_INDEX?{type:d.ObjectType.item,index:c}:{type:d.ObjectType.groupHeader,index:_},this._resetPressedContainer(),this._site.pressedEntity.type===d.ObjectType.item&&m.type===d.ObjectType.item&&this._site.pressedContainer&&this._site.pressedEntity.index===m.index)if(e.shiftKey||(t.selection._pivot=u._INVALID_INDEX),e.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&t.selection._pivot!==u._INVALID_INDEX){var p=Math.min(this._site.pressedEntity.index,t.selection._pivot),f=Math.max(this._site.pressedEntity.index,t.selection._pivot),g=this._pointerRightButton||e.ctrlKey||t.tapBehavior===d.TapBehavior.toggleSelect;t.selectRange(p,f,g)}}else e.ctrlKey&&this.toggleSelectionIfAllowed(this._site.pressedEntity.index);if(this._site.pressedHeader||this._site.pressedContainer){var v=h._getCursorPos(e),y=Math.abs(v.left-this._site.pressedPosition.left)<=u._TAP_END_THRESHOLD&&Math.abs(v.top-this._site.pressedPosition.top)<=u._TAP_END_THRESHOLD;this._pointerRightButton||e.ctrlKey||e.shiftKey||!(a&&y||!a&&this._site.pressedEntity.index===m.index&&this._site.pressedEntity.type===m.type)||(m.type===d.ObjectType.groupHeader?(this._site.pressedHeader=t.headerAtIndex(m.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=t.itemBoxAtIndex(m.index),this._site.pressedContainer=t.containerAtIndex(m.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==u._INVALID_INDEX&&t.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}o("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(e){this._pointerId===e.pointerId&&(o("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(e){this._pointerId===e.pointerId&&(o("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(e){this._shouldSuppressContextMenu(e.target)&&e.preventDefault()},onMSHoldVisual:function(e){this._shouldSuppressContextMenu(e.target)&&e.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},toggleSelectionIfAllowed:function(e){this._selectionAllowed(e)&&this._toggleItemSelection(e)},handleTap:function(e){if(e.type!==d.ObjectType.groupHeader){var t=this._site,i=t.selection;this._selectionAllowed(e.index)&&this._selectOnTap()&&(t.tapBehavior===d.TapBehavior.toggleSelect?this._toggleItemSelection(e.index):t.selectionMode!==d.SelectionMode.multi&&i._isIncluded(e.index)||i.set(e.index))}},_toggleItemSelection:function(e){var t=this._site,i=t.selection,n=i._isIncluded(e);t.selectionMode===d.SelectionMode.single?n?i.clear():i.set(e):n?i.remove(e):i.add(e)},_getCurrentPoint:function(e){return i.Windows.UI.Input.PointerPoint.getCurrentPoint(e.pointerId)},_containedInElementWithClass:function(e,t){if(e.parentNode)for(var i=e.parentNode.querySelectorAll("."+t+", ."+t+" *"),n=0,s=i.length;s>n;n++)if(i[n]===e)return!0;return!1},_isSelected:function(e){return this._site.selection._isIncluded(e)},_isInteractive:function(e){return this._containedInElementWithClass(e,"win-interactive")},_shouldSuppressContextMenu:function(e){var t=this._site.containerFromElement(e);return this._selectionAllowed()&&t&&!this._isInteractive(e)},_togglePressed:function(e,t,i){function n(e){m._site.disablePressAnimation()||(""===m._site.animatedElement.style[_.scriptName]?(m._site.animatedElement.style[_.scriptName]=e,m._site.animatedElementScaleTransform=m._site.animatedElement.style[_.scriptName]):m._site.animatedElementScaleTransform="")}function r(e,t){o("WinJS.UI._ItemEventsHandler:removePressedUI,info"),h.removeClass(e,u._pressedClass),m._containsTransform(e,t)&&a.executeTransition(e,{property:_.cssName,delay:150,duration:350,timing:"cubic-bezier(0.17,0.17,0.2,1)",to:e.style[_.scriptName].replace(t,"")})}var m=this,p=this._site.pressedEntity.type===d.ObjectType.groupHeader;if(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),(p||!h.hasClass(this._site.pressedItemBox,u._nonSelectableClass))&&!this._staticMode(p))if(e){if(!h.hasClass(this._site.animatedElement,u._pressedClass)){o("WinJS.UI._ItemEventsHandler:applyPressedUI,info"),h.addClass(this._site.animatedElement,u._pressedClass);var f=p?m._site.pressedHeader:m._site.pressedContainer,g=c(i.clientX,i.clientY,f.getBoundingClientRect());this._site.animatedDownPromise=l.timeout(50).then(function(){n(g)})}}else if(h.hasClass(this._site.animatedElement,u._pressedClass)){var v=this._site.animatedElement,y=this._site.animatedElementScaleTransform;t?r(v,y):s._setImmediate(function(){h.hasClass(v,u._pressedClass)&&r(v,y)})}},_containsTransform:function(e,t){return t&&-1!==e.style[_.scriptName].indexOf(t)},_resetPointerDownStateForPointerId:function(e){this._pointerId===e.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._site.pressedElement=null,h._removeEventListener(t,"pointerup",this._resetPointerDownStateBound),h._removeEventListener(t,"pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._site.pressedEntity={type:d.ObjectType.item,index:u._INVALID_INDEX},this._pointerId=null},_releasedElement:function(e){return t.document.elementFromPoint(e.clientX,e.clientY)},_applyUIInBatches:function(e){function t(){i._work.length>0?(i._flushUIBatches(),i._paintedThisFrame=s._requestAnimationFrame(t.bind(i))):i._paintedThisFrame=null}var i=this;this._work.push(e),this._paintedThisFrame||t()},_flushUIBatches:function(){if(this._work.length>0){var e=this._work;this._work=[];for(var t=0;t<e.length;t++)e[t]()}},_selectionAllowed:function(e){var t=void 0!==e?this._site.itemAtIndex(e):null,i=!(t&&h.hasClass(t,u._nonSelectableClass));return i&&this._site.selectionMode!==d.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===d.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===d.TapBehavior.toggleSelect||this._site.tapBehavior===d.TapBehavior.directSelect},_staticMode:function(e){return e?this._site.headerTapBehavior===d.GroupHeaderTapBehavior.none:this._site.tapBehavior===d.TapBehavior.none&&this._site.selectionMode===d.SelectionMode.none}},{setAriaSelected:function(e,t){var i="true"===e.getAttribute("aria-selected");t!==i&&e.setAttribute("aria-selected",t)},renderSelection:function(t,i,n,s,o){if(!m._selectionTemplate){m._selectionTemplate=[],m._selectionTemplate.push(e(u._selectionBackgroundClass)),m._selectionTemplate.push(e(u._selectionBorderClass)),m._selectionTemplate.push(e(u._selectionCheckmarkBackgroundClass));var r=e(u._selectionCheckmarkClass);r.textContent=u._SELECTION_CHECKMARK,m._selectionTemplate.push(r)}if(n!==h._isSelectionRendered(t)){if(n){t.insertBefore(m._selectionTemplate[0].cloneNode(!0),t.firstElementChild);for(var a=1,l=m._selectionTemplate.length;l>a;a++)t.appendChild(m._selectionTemplate[a].cloneNode(!0))}else for(var d=t.querySelectorAll(h._selectionPartsSelector),a=0,l=d.length;l>a;a++)t.removeChild(d[a]);h[n?"addClass":"removeClass"](t,u._selectedClass),o&&h[n?"addClass":"removeClass"](o,u._selectedClass)}s&&m.setAriaSelected(i,n)}});return m})})}),n("WinJS/Controls/ListView/_SelectionManager",["exports","../../Core/_Global","../../Core/_Base","../../Promise","../../_Signal","../../Utilities/_UI","../ItemContainer/_Constants"],function(e,t,i,n,s,o,r){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_ItemSet:i.Namespace._lazy(function(){var t=i.Class.define(function(e,t,i){this._listView=e,this._ranges=t,this._itemsCount=i});return t.prototype={getRanges:function(){for(var e=[],t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];e.push({firstIndex:n.firstIndex,lastIndex:n.lastIndex,firstKey:n.firstKey,lastKey:n.lastKey})}return e},getItems:function(){return e.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var e=0,t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];e+=n.lastIndex-n.firstIndex+1}return e},getIndices:function(){for(var e=[],t=0,i=this._ranges.length;i>t;t++)for(var n=this._ranges[t],s=n.firstIndex;s<=n.lastIndex;s++)e.push(s);return e}},t}),getItemsFromRanges:function(e,t){function i(){for(var e=[],i=0,s=t.length;s>i;i++)for(var o=t[i],r=o.firstIndex;r<=o.lastIndex;r++)e.push(r);return n.wrap(e)}var s=e.createListBinding(),o=[];return i().then(function(e){for(var t=0;t<e.length;t++)o.push(s.fromIndex(e[t]));return n.join(o).then(function(e){return s.release(),e})})},_Selection:i.Namespace._lazy(function(){function t(e){return e&&0===e.firstIndex&&e.lastIndex===Number.MAX_VALUE}return i.Class.derive(e._ItemSet,function(e,t){this._listView=e,this._itemsCount=-1,this._ranges=[],t&&this.set(t)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],n.wrap()},set:function(e){if(t(e))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var i=this;return this._execute("_set",e).then(function(){return i._ranges.sort(function(e,t){return e.firstIndex-t.firstIndex}),i._ensureKeys()}).then(function(){return i._ensureCount()})},add:function(e){if(t(e))return this.selectAll();var i=this;return this._execute("_add",e).then(function(){return i._ensureKeys()}).then(function(){return i._ensureCount()})},remove:function(e){var t=this;return this._execute("_remove",e).then(function(){return t._ensureKeys()})},selectAll:function(){var e=this;return e._ensureCount().then(function(){if(e._itemsCount){var t={firstIndex:0,lastIndex:e._itemsCount-1};return e._retainRange(t),e._releaseRanges(e._ranges),e._ranges=[t],e._ensureKeys()}})},_execute:function(e,t){function i(e,t,i){var n={};return n["first"+e]=t,n["last"+e]=i,n}function s(t){var i=o._getListBinding(),s=n.join([i.fromKey(t.firstKey),i.fromKey(t.lastKey)]).then(function(i){return i[0]&&i[1]&&(t.firstIndex=i[0].index,t.lastIndex=i[1].index,o[e](t)),t});l.push(s)}for(var o=this,r=!!o._getListBinding().fromKey,a=Array.isArray(t)?t:[t],l=[n.wrap()],h=0,d=a.length;d>h;h++){var u=a[h];"number"==typeof u?this[e](i("Index",u,u)):u&&(r&&void 0!==u.key?s(i("Key",u.key,u.key)):r&&void 0!==u.firstKey&&void 0!==u.lastKey?s(i("Key",u.firstKey,u.lastKey)):void 0!==u.index&&"number"==typeof u.index?this[e](i("Index",u.index,u.index)):void 0!==u.firstIndex&&void 0!==u.lastIndex&&"number"==typeof u.firstIndex&&"number"==typeof u.lastIndex&&this[e](i("Index",u.firstIndex,u.lastIndex)))}return n.join(l)},_set:function(e){this._retainRange(e),this._ranges.push(e)},_add:function(e){for(var t,i,n,s=this,o=null,r=function(e,t){t.lastIndex>e.lastIndex&&(e.lastIndex=t.lastIndex,e.lastKey=t.lastKey,e.lastPromise&&e.lastPromise.release(),e.lastPromise=s._getListBinding().fromIndex(e.lastIndex).retain())},a=0,l=this._ranges.length;l>a;a++){if(t=this._ranges[a],e.firstIndex<t.firstIndex){n=o&&e.firstIndex<o.lastIndex+1,n?(i=a-1,r(o,e)):(this._insertRange(a,e),i=a);break}if(e.firstIndex===t.firstIndex){r(t,e),i=a;break}o=t}if(void 0===i){var h=this._ranges.length?this._ranges[this._ranges.length-1]:null,d=h&&e.firstIndex<h.lastIndex+1;d?r(h,e):(this._retainRange(e),this._ranges.push(e))}else{for(o=null,a=i+1,l=this._ranges.length;l>a;a++){if(t=this._ranges[a],e.lastIndex<t.firstIndex){n=o&&o.lastIndex>e.lastIndex,n&&r(this._ranges[i],o),this._removeRanges(i+1,a-i-1);break}if(e.lastIndex===t.firstIndex){r(this._ranges[i],t),this._removeRanges(i+1,a-i);break}o=t}a>=l&&(r(this._ranges[i],this._ranges[l-1]),this._removeRanges(i+1,l-i-1))}},_remove:function(e){function t(e){return i._getListBinding().fromIndex(e).retain()}for(var i=this,n=[],s=0,o=this._ranges.length;o>s;s++){var r=this._ranges[s];r.lastIndex<e.firstIndex||r.firstIndex>e.lastIndex?n.push(r):r.firstIndex<e.firstIndex&&r.lastIndex>=e.firstIndex&&r.lastIndex<=e.lastIndex?(n.push({firstIndex:r.firstIndex,firstKey:r.firstKey,firstPromise:r.firstPromise,lastIndex:e.firstIndex-1,lastPromise:t(e.firstIndex-1)}),r.lastPromise.release()):r.lastIndex>e.lastIndex&&r.firstIndex>=e.firstIndex&&r.firstIndex<=e.lastIndex?(n.push({firstIndex:e.lastIndex+1,firstPromise:t(e.lastIndex+1),lastIndex:r.lastIndex,lastKey:r.lastKey,lastPromise:r.lastPromise}),r.firstPromise.release()):r.firstIndex<e.firstIndex&&r.lastIndex>e.lastIndex?(n.push({firstIndex:r.firstIndex,firstKey:r.firstKey,firstPromise:r.firstPromise,lastIndex:e.firstIndex-1,lastPromise:t(e.firstIndex-1)}),n.push({firstIndex:e.lastIndex+1,firstPromise:t(e.lastIndex+1),lastIndex:r.lastIndex,lastKey:r.lastKey,lastPromise:r.lastPromise})):(r.firstPromise.release(),r.lastPromise.release())}this._ranges=n},_ensureKeys:function(){for(var e=[n.wrap()],t=this,i=function(e,t){var i=e+"Key";if(t[i])return n.wrap();var s=t[e+"Promise"];return s.then(function(e){e&&(t[i]=e.key)}),s},s=0,o=this._ranges.length;o>s;s++){var r=this._ranges[s];e.push(i("first",r)),e.push(i("last",r))}return n.join(e).then(function(){t._ranges=t._ranges.filter(function(e){return e.firstKey&&e.lastKey})}),n.join(e)},_mergeRanges:function(e,t){e.lastIndex=t.lastIndex,e.lastKey=t.lastKey},_isIncluded:function(e){if(this.isEverything())return!0;for(var t=0,i=this._ranges.length;i>t;t++){var n=this._ranges[t];if(n.firstIndex<=e&&e<=n.lastIndex)return!0}return!1},_ensureCount:function(){var e=this;return this._listView._itemsCount().then(function(t){e._itemsCount=t})},_insertRange:function(e,t){this._retainRange(t),this._ranges.splice(e,0,t)},_removeRanges:function(e,t){for(var i=0;t>i;i++)this._releaseRange(this._ranges[e+i]);this._ranges.splice(e,t)},_retainRange:function(e){e.firstPromise||(e.firstPromise=this._getListBinding().fromIndex(e.firstIndex).retain()),e.lastPromise||(e.lastPromise=this._getListBinding().fromIndex(e.lastIndex).retain())},_retainRanges:function(){for(var e=0,t=this._ranges.length;t>e;e++)this._retainRange(this._ranges[e])},_releaseRange:function(e){e.firstPromise.release(),e.lastPromise.release()},_releaseRanges:function(e){for(var t=0,i=e.length;i>t;++t)this._releaseRange(e[t])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:i.Namespace._lazy(function(){var i=function(t){this._listView=t,this._selected=new e._Selection(this._listView),this._pivot=r._INVALID_INDEX,this._focused={type:o.ObjectType.item,index:0},this._pendingChange=n.wrap()};return i.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(t){var i=this,o=new s;return this._synchronize(o).then(function(){var s=new e._Selection(i._listView);return s.set(t).then(function(){i._set(s),o.complete()},function(e){return s.clear(),o.complete(),n.wrapError(e)})})},clear:function(){var t=this,i=new s;return this._synchronize(i).then(function(){var s=new e._Selection(t._listView);return s.clear().then(function(){t._set(s),i.complete()},function(e){return s.clear(),i.complete(),n.wrapError(e)})})},add:function(e){var t=this,i=new s;return this._synchronize(i).then(function(){var s=t._cloneSelection();return s.add(e).then(function(){t._set(s),i.complete()},function(e){return s.clear(),i.complete(),n.wrapError(e)})})},remove:function(e){var t=this,i=new s;return this._synchronize(i).then(function(){var s=t._cloneSelection();return s.remove(e).then(function(){t._set(s),i.complete()},function(e){return s.clear(),i.complete(),n.wrapError(e)})})},selectAll:function(){var t=this,i=new s;return this._synchronize(i).then(function(){var s=new e._Selection(t._listView);return s.selectAll().then(function(){t._set(s),i.complete()},function(e){return s.clear(),i.complete(),n.wrapError(e)})})},_synchronize:function(e){var t=this;return this._listView._versionManager.unlocked.then(function(){var i=t._pendingChange;return t._pendingChange=n.join([i,e.promise]).then(function(){}),i})},_reset:function(){this._pivot=r._INVALID_INDEX,this._setFocused({type:o.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=n.wrap(),this._selected.clear(),this._selected=new e._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(e){var t=this;return this._fireSelectionChanging(e).then(function(i){return i?(t._selected.clear(),t._selected=e,t._listView._updateSelection(),t._fireSelectionChanged()):e.clear(),i})},_fireSelectionChanging:function(e){var i=t.document.createEvent("CustomEvent"),s=n.wrap();i.initCustomEvent("selectionchanging",!0,!0,{newSelection:e,preventTapBehavior:function(){},setPromise:function(e){s=e}});var o=this._listView._element.dispatchEvent(i);return s.then(function(){return o})},_fireSelectionChanged:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(e)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(e,t){this._focused={type:e.type,index:e.index},this._focusedByKeyboard=t},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(e){this._selected._itemsCount=e},_isIncluded:function(e){return this._selected._isIncluded(e)},_cloneSelection:function(){var t=new e._Selection(this._listView);return t._ranges=this._selected.getRanges(),t._itemsCount=this._selected._itemsCount,t._retainRanges(),t}},i.supportedForProcessing=!1,i})})}),n("WinJS/Controls/ListView/_BrowseMode",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Animations","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_SelectionManager"],function(e,t,i,n,s,o,r,a,l,h,d){"use strict";var u=n._browserStyleEquivalents.transform.scriptName;i.Namespace._moduleDefine(e,"WinJS.UI",{_SelectionMode:i.Namespace._lazy(function(){function e(e,t,i){return Math.max(e,Math.min(t,i))}function s(e,i,n){var s=t.document.createEvent("CustomEvent");return s.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:i.index,oldFocusType:i.type,newFocus:n.index,newFocusType:n.type}),e.dispatchEvent(s)}var c=i.Class.define(function(e){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:a.ObjectType.item,index:l._INVALID_INDEX},this._pressedPosition=null,this.initialize(e)},{_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(e){function t(t,i){var n=function(i){return e._view.getAdjacent(i,t)};return n.clampToBounds=i,n}this.site=e,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var i=this.site,n=this;this._itemEventsHandler=new h._ItemEventsHandler(Object.create({containerFromElement:function(e){return i._view.items.containerFrom(e)},indexForItemElement:function(e){return i._view.items.index(e)},indexForHeaderElement:function(e){return i._groups.index(e)},itemBoxAtIndex:function(e){return i._view.items.itemBoxAt(e)},itemAtIndex:function(e){return i._view.items.itemAt(e)},headerAtIndex:function(e){return i._groups.group(e).header},headerFromElement:function(e){return i._groups.headerFrom(e)},containerAtIndex:function(e){return i._view.items.containerAt(e)},isZombie:function(){return i._isZombie()},getItemPosition:function(e){return i._getItemPosition(e)},rtl:function(){return i._rtl()},fireInvokeEvent:function(e,t){return n._fireInvokeEvent(e,t)},verifySelectionAllowed:function(e){return n._verifySelectionAllowed(e)},changeFocus:function(e,t,n,s,o){return i._changeFocus(e,t,n,s,o)},selectRange:function(e,t,i){return n._selectRange(e,t,i)},disablePressAnimation:function(){return i._isInSelectionMode()}},{pressedEntity:{enumerable:!0,get:function(){return n._pressedEntity},set:function(e){n._pressedEntity=e}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return n._pressedContainerScaleTransform},set:function(e){n._pressedContainerScaleTransform=e}},pressedContainer:{enumerable:!0,get:function(){return n._pressedContainer},set:function(e){n._pressedContainer=e}},pressedItemBox:{enumerable:!0,get:function(){return n._pressedItemBox},set:function(e){n._pressedItemBox=e}},pressedHeader:{enumerable:!0,get:function(){return n._pressedHeader},set:function(e){return n._pressedHeader=e}},pressedPosition:{enumerable:!0,get:function(){return n._pressedPosition},set:function(e){n._pressedPosition=e}},pressedElement:{enumerable:!0,set:function(e){n._pressedElement=e}},eventHandlerRoot:{enumerable:!0,get:function(){return i._viewport}},selectionMode:{enumerable:!0,
get:function(){return i._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return l._itemClass}},canvasProxy:{enumerable:!0,get:function(){return i._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return i._tap}},headerTapBehavior:{enumerable:!0,get:function(){return i._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return i.itemsDraggable||i.itemsReorderable}},selection:{enumerable:!0,get:function(){return i._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var s=r.Key;this._keyboardNavigationHandlers[s.upArrow]=t(s.upArrow),this._keyboardNavigationHandlers[s.downArrow]=t(s.downArrow),this._keyboardNavigationHandlers[s.leftArrow]=t(s.leftArrow),this._keyboardNavigationHandlers[s.rightArrow]=t(s.rightArrow),this._keyboardNavigationHandlers[s.pageUp]=t(s.pageUp,!0),this._keyboardNavigationHandlers[s.pageDown]=t(s.pageDown,!0),this._keyboardNavigationHandlers[s.home]=function(e){return o.wrap(!n.site._header||e.type!==a.ObjectType.groupHeader&&e.type!==a.ObjectType.footer?{type:e.type!==a.ObjectType.footer?e.type:a.ObjectType.groupHeader,index:0}:{type:a.ObjectType.header,index:0})},this._keyboardNavigationHandlers[s.end]=function(e){if(!n.site._footer||e.type!==a.ObjectType.groupHeader&&e.type!==a.ObjectType.header){if(e.type===a.ObjectType.groupHeader||e.type===a.ObjectType.header)return o.wrap({type:a.ObjectType.groupHeader,index:i._groups.length()-1});var t=n.site._view.lastItemIndex();return t>=0?o.wrap({type:e.type,index:t}):o.cancel}return o.wrap({type:a.ObjectType.footer,index:0})},this._keyboardAcceleratorHandlers[s.a]=function(){n.site._multiSelection()&&n._selectAll()}},staticMode:function(){return this.site._tap===a.TapBehavior.none&&this.site._selectionMode===a.SelectionMode.none},itemUnrealized:function(e,t){if(this._pressedEntity.type!==a.ObjectType.groupHeader&&(this._pressedEntity.index===e&&this._resetPointerDownState(),this._itemBeingDragged(e)))for(var i=this._draggedItemBoxes.length-1;i>=0;i--)this._draggedItemBoxes[i]===t&&(r.removeClass(t,l._dragSourceClass),this._draggedItemBoxes.splice(i,1))},_fireInvokeEvent:function(e,i){function n(n,o){var r=n.createListBinding(),a=r.fromIndex(e.index),l=o?"groupheaderinvoked":"iteminvoked";a.done(function(){r.release()});var h=t.document.createEvent("CustomEvent");h.initCustomEvent(l,!0,!0,o?{groupHeaderPromise:a,groupHeaderIndex:e.index}:{itemPromise:a,itemIndex:e.index}),i.dispatchEvent(h)&&s.site._defaultInvoke(e)}if(i){var s=this;e.type===a.ObjectType.groupHeader?this.site._groupHeaderTap===a.GroupHeaderTapBehavior.invoke&&e.index!==l._INVALID_INDEX&&n(this.site.groupDataSource,!0):this.site._tap===a.TapBehavior.none||e.index===l._INVALID_INDEX||this.site._isInSelectionMode()||n(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(e){if(e.type===a.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var i=e.index,n=this.site,s=this.site._view.items.itemAt(i);if(!n._selectionAllowed()||!n._selectOnTap()||s&&r.hasClass(s,l._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var h=n._selection._isIncluded(i),d=!n._multiSelection(),u=n._selection._cloneSelection();h?d?u.clear():u.remove(i):d?u.set(i):u.add(i);var c,_=t.document.createEvent("CustomEvent"),m=o.wrap(),p=!1,f=!1;_.initCustomEvent("selectionchanging",!0,!0,{newSelection:u,preventTapBehavior:function(){f=!0},setPromise:function(e){m=e}});var g=n._element.dispatchEvent(_);m.then(function(){p=!0,c=u._isIncluded(i),u.clear()});var v=g&&p&&(h||c);return{canSelect:v,canTapSelect:v&&!f}},_containedInElementWithClass:function(e,t){if(e.parentNode)for(var i=e.parentNode.querySelectorAll("."+t+", ."+t+" *"),n=0,s=i.length;s>n;n++)if(i[n]===e)return!0;return!1},_isDraggable:function(e){return!this._containedInElementWithClass(e,l._nonDraggableClass)},_isInteractive:function(e){return this._containedInElementWithClass(e,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onPointerDown:function(e){this._itemEventsHandler.onPointerDown(e)},onclick:function(e){this._itemEventsHandler.onClick(e)},onPointerUp:function(e){this._itemEventsHandler.onPointerUp(e)},onPointerCancel:function(e){this._itemEventsHandler.onPointerCancel(e)},onLostPointerCapture:function(e){this._itemEventsHandler.onLostPointerCapture(e)},onContextMenu:function(e){this._itemEventsHandler.onContextMenu(e)},onMSHoldVisual:function(e){this._itemEventsHandler.onMSHoldVisual(e)},onDataChanged:function(e){this._itemEventsHandler.onDataChanged(e)},_removeTransform:function(e,t){t&&-1!==e.style[u].indexOf(t)&&(e.style[u]=e.style[u].replace(t,""))},_selectAll:function(){var e=[];this.site._view.items.each(function(t,i){i&&r.hasClass(i,l._nonSelectableClass)&&e.push(t)}),this.site._selection.selectAll(),e.length>0&&this.site._selection.remove(e)},_selectRange:function(e,t,i){for(var n=[],s=-1,o=e;t>=o;o++){var a=this.site._view.items.itemAt(o);a&&r.hasClass(a,l._nonSelectableClass)?-1!==s&&(n.push({firstIndex:s,lastIndex:o-1}),s=-1):-1===s&&(s=o)}-1!==s&&n.push({firstIndex:s,lastIndex:t}),n.length>0&&this.site._selection[i?"add":"set"](n)},onDragStart:function(e){if(this._pressedEntity={type:a.ObjectType.item,index:this.site._view.items.index(e.target)},this.site._selection._pivot=l._INVALID_INDEX,this._pressedEntity.index===l._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(e.target)||this._pressedElement&&this._isInteractive(this._pressedElement))e.preventDefault();else{this._dragging=!0,this._dragDataTransfer=e.dataTransfer,this._pressedPosition=r._getCursorPos(e),this._dragInfo=null,this._lastEnteredElement=e.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new d._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var i=this.site.itemsReorderable,s=t.document.createEvent("CustomEvent");if(s.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:e.dataTransfer,dragInfo:this._dragInfo}),e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage){var o=this.site._view.items.itemDataAt(this._pressedEntity.index);if(o&&o.container){var h=o.container.getBoundingClientRect();e.dataTransfer.setDragImage(o.container,e.clientX-h.left,e.clientY-h.top)}}this.site.element.dispatchEvent(s),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(e.dataTransfer)&&(i=!0,this._dragUnderstood=!0)),i&&(this._addedDragOverClass=!0,r.addClass(this.site._element,l._dragOverClass)),this._draggedItemBoxes=[];var u=this,c=e.target;c.addEventListener("dragend",function _(e){c.removeEventListener("dragend",_),u.onDragEnd(e)}),n._yieldForDomModification(function(){if(u._dragging)for(var e=u._dragInfo.getIndices(),t=0,i=e.length;i>t;t++){var n=u.site._view.items.itemDataAt(e[t]);n&&n.itemBox&&u._addDragSourceClass(n.itemBox)}})}},onDragEnter:function(e){var i=this._dragUnderstood;this._lastEnteredElement=e.target,this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(e.dataTransfer)&&(i=!0),(i||this._dragging&&this.site.itemsReorderable)&&(e.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,r.addClass(this.site._element,l._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(e){e.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(e)},_fireDragEnterEvent:function(e){var i=t.document.createEvent("CustomEvent");i.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:e});var n=!this.site.element.dispatchEvent(i);return this._firedDragEnter=!0,n},_fireDragBetweenEvent:function(e,i,n){var s=t.document.createEvent("CustomEvent");return s.initCustomEvent("itemdragbetween",!0,!0,{index:e,insertAfterIndex:i,dataTransfer:n}),this.site.element.dispatchEvent(s)},_fireDropEvent:function(e,i,n){var s=t.document.createEvent("CustomEvent");return s.initCustomEvent("itemdragdrop",!0,!0,{index:e,insertAfterIndex:i,dataTransfer:n}),this.site.element.dispatchEvent(s)},_handleExitEvent:function(){this._exitEventTimer&&(t.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var e=this;this._exitEventTimer=t.setTimeout(function(){if(!e.site._disposed&&e._pointerLeftRegion){if(e.site._layout.dragLeave&&e.site._layout.dragLeave(),e._pointerLeftRegion=!1,e._dragUnderstood=!1,e._lastEnteredElement=null,e._lastInsertPoint=null,e._dragBetweenDisabled=!1,e._firedDragEnter){var i=t.document.createEvent("CustomEvent");i.initCustomEvent("itemdragleave",!0,!1,{}),e.site.element.dispatchEvent(i),e._firedDragEnter=!1}e._addedDragOverClass&&(e._addedDragOverClass=!1,r.removeClass(e.site._element,l._dragOverClass)),e._exitEventTimer=0,e._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(e,i){var n={left:0,top:0};try{n=e.getBoundingClientRect()}catch(s){}var o=t.getComputedStyle(e,null),r=parseInt(o.paddingLeft),a=parseInt(o.paddingTop),l=parseInt(o.borderLeftWidth),h=parseInt(o.borderTopWidth),d=i.clientX,u=i.clientY,c={x:+d===d?d-n.left-r-l:0,y:+u===u?u-n.top-a-h:0};return this.site._rtl()&&(c.x=n.right-n.left-c.x),c},_getPositionInCanvasSpace:function(e){var t=this.site._horizontal()?this.site.scrollPosition:0,i=this.site._horizontal()?0:this.site.scrollPosition,n=this._getEventPositionInElementSpace(this.site.element,e);return{x:n.x+t,y:n.y+i}},_itemBeingDragged:function(e){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(e)||!this._draggingUnselectedItem&&this.site._isSelected(e):!1},_addDragSourceClass:function(e){this._draggedItemBoxes.push(e),r.addClass(e,l._dragSourceClass),e.parentNode&&r.addClass(e.parentNode,l._footprintClass)},renderDragSourceOnRealizedItem:function(e,t){this._itemBeingDragged(e)&&this._addDragSourceClass(t)},onDragOver:function(t){if(this._dragUnderstood){this._pointerLeftRegion=!1,t.preventDefault();var i=this._getPositionInCanvasSpace(t),n=this._getEventPositionInElementSpace(this.site.element,t);if(this._checkAutoScroll(n.x,n.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var s=this.site._view.hitTest(i.x,i.y);s.insertAfterIndex=e(-1,this.site._cachedCount-1,s.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===s.insertAfterIndex&&this._lastInsertPoint.index===s.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(s.index,s.insertAfterIndex,t.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(i.x,i.y,this._dragInfo)),this._lastInsertPoint=s}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,r.removeClass(this.site._element,l._dragOverClass)),this._draggedItemBoxes){for(var e=0,t=this._draggedItemBoxes.length;t>e;e++)r.removeClass(this._draggedItemBoxes[e],l._dragSourceClass),this._draggedItemBoxes[e].parentNode&&r.removeClass(this._draggedItemBoxes[e].parentNode,l._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(e),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(e,t,i){for(var n=e.getIndices(),s=-1,o=this.site._cachedCount,r=n.length,a=-1,l=t,h=0;r>h;h++)if(n[h]===l){s=h,a=h;break}for(;s>=0&&l>=0;)i?(l++,r>s&&n[s+1]===l&&o>l?s++:l>=o?(i=!1,l=t,s=a):s=-1):(l--,s>0&&n[s-1]===l?s--:s=-1);return l},_reorderItems:function(e,t,i,n,s){var o=this.site,r=function(e){i?o._selection.remove({key:e[0].key}):o._selection.set({firstKey:e[0].key,lastKey:e[e.length-1].key}),s&&o.ensureVisible(o._selection._getFocused())};t.getItems().then(function(t){var i=o.itemDataSource;if(-1===e){i.beginEdits();for(var s=t.length-1;s>=0;s--)i.moveToStart(t[s].key);i.endEdits(),r(t)}else{var a=i.createListBinding();a.fromIndex(e).then(function(e){if(a.release(),i.beginEdits(),n)for(var s=0,o=t.length;o>s;s++)i.moveBefore(t[s].key,e.key);else for(var s=t.length-1;s>=0;s--)i.moveAfter(t[s].key,e.key);i.endEdits(),r(t)})}})},onDrop:function(t){if(this._draggedItemBoxes)for(var i=0,n=this._draggedItemBoxes.length;n>i;i++)this._draggedItemBoxes[i].parentNode&&r.removeClass(this._draggedItemBoxes[i].parentNode,l._footprintClass);if(!this._dragBetweenDisabled){var s=this._getPositionInCanvasSpace(t),o=this.site._view.hitTest(s.x,s.y),a=e(-1,this.site._cachedCount-1,o.insertAfterIndex),h=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===a&&this._lastInsertPoint.index===o.index||(h=this._fireDragBetweenEvent(o.index,a,t.dataTransfer)),h&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(o.index,a,t.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;a=this._findFirstAvailableInsertPoint(this._dragInfo,a,!1),this._reorderItems(a,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),t.preventDefault()},_checkAutoScroll:function(e,i){var s=this.site._getViewportLength(),o=this.site._horizontal(),a=o?e:i,h=this.site._viewport[o?"scrollWidth":"scrollHeight"],d=Math.floor(this.site.scrollPosition),u=0;if(a<l._AUTOSCROLL_THRESHOLD?u=a-l._AUTOSCROLL_THRESHOLD:a>s-l._AUTOSCROLL_THRESHOLD&&(u=a-(s-l._AUTOSCROLL_THRESHOLD)),u=Math.round(u/l._AUTOSCROLL_THRESHOLD*(l._MAX_AUTOSCROLL_RATE-l._MIN_AUTOSCROLL_RATE)),(0===d&&0>u||d>=h-s&&u>0)&&(u=0),0===u)this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var c=this;this._autoScrollDelay=t.setTimeout(function(){if(c._autoScrollRate){c._lastDragTimeout=n._now();var e=function(){if(!c._autoScrollRate&&c._autoScrollFrame||c.site._disposed)c._stopAutoScroll();else{var t=n._now(),i=c._autoScrollRate*((t-c._lastDragTimeout)/1e3);i=0>i?Math.min(-1,i):Math.max(1,i);var s={};s[c.site._scrollProperty]=c.site._viewportScrollPosition+i,r.setScrollPosition(c.site._viewport,s),c._lastDragTimeout=t,c._autoScrollFrame=n._requestAnimationFrame(e)}};c._autoScrollFrame=n._requestAnimationFrame(e)}},l._AUTOSCROLL_DELAY)}this._autoScrollRate=u},_stopAutoScroll:function(){this._autoScrollDelay&&(t.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(e){function t(e,t,r){function d(h){var d=!0,c=!1;if(r?e.index=Math.max(0,Math.min(h,e.index)):(e.index<0||e.index>h)&&(c=!0),!c&&(u.index!==e.index||u.type!==e.type)){var m=s(n._element,u,e);m&&(d=!1,i._setNewFocusItemOffsetPromise&&i._setNewFocusItemOffsetPromise.cancel(),n._batchViewUpdates(l._ViewChange.realize,l._ScrollToPriority.high,function(){return i._setNewFocusItemOffsetPromise=n._getItemOffset(u,!0).then(function(s){s=n._convertFromCanvasCoordinates(s);var r=s.end<=n.scrollPosition||s.begin>=n.scrollPosition+n._getViewportLength()-1;return i._setNewFocusItemOffsetPromise=n._getItemOffset(e).then(function(s){i._setNewFocusItemOffsetPromise=null;var a={position:n.scrollPosition,direction:"right"};return r&&(n._selection._setFocused(e,!0),s=n._convertFromCanvasCoordinates(s),e.index>u.index?(a.direction="right",a.position=s.end-n._getViewportLength()):(a.direction="left",a.position=s.begin)),n._changeFocus(e,t,_,r,!0),r?a:o.cancel},function(i){return n._changeFocus(e,t,_,!0,!0),o.wrapError(i)}),i._setNewFocusItemOffsetPromise},function(i){return n._changeFocus(e,t,_,!0,!0),o.wrapError(i)}),i._setNewFocusItemOffsetPromise},!0))}return d&&(n._selection._setFocused(u,!0),n.ensureVisible(u)),c?{type:a.ObjectType.item,index:l._INVALID_INDEX}:e}return e.type===a.ObjectType.item?o.wrap(h.lastItemIndex()).then(d):e.type===a.ObjectType.groupHeader?o.wrap(n._groups.length()-1).then(d):o.wrap(0).then(d)}var i=this,n=this.site,h=n._view,u=n._selection._getFocused(),c=!0,_=e.ctrlKey,m=r.Key,p=e.keyCode,f=n._rtl();if(!this._isInteractive(e.target)){if(e.ctrlKey&&!e.altKey&&!e.shiftKey&&this._keyboardAcceleratorHandlers[p]&&this._keyboardAcceleratorHandlers[p](),n.itemsReorderable&&!e.ctrlKey&&e.altKey&&e.shiftKey&&u.type===a.ObjectType.item&&(p===m.leftArrow||p===m.rightArrow||p===m.upArrow||p===m.downArrow)){var g=n._selection,v=u.index,y=!1,C=!0;if(!g.isEverything()){if(!g._isIncluded(v)){var w=n._view.items.itemAt(v);w&&r.hasClass(w,l._nonDraggableClass)?C=!1:(y=!0,g=new d._Selection(this.site,[{firstIndex:v,lastIndex:v}]))}if(C){var b=v;p===m.rightArrow?b+=f?-1:1:p===m.leftArrow?b+=f?1:-1:p===m.upArrow?b--:b++;var I=b>v,S=I;I&&b>=this.site._cachedCount&&(S=!1,b=this.site._cachedCount-1),b=this._findFirstAvailableInsertPoint(g,b,S),b=Math.min(Math.max(-1,b),this.site._cachedCount-1);var x=b-(I||-1===b?0:1),E=b,P=this.site._groupsEnabled();if(P){var M=this.site._groups,T=b>-1?M.groupFromItem(b):0;I?M.group(T).startIndex===b&&x--:T<M.length()-1&&b===M.group(T+1).startIndex-1&&x++}if(this._fireDragBetweenEvent(E,x,null)&&this._fireDropEvent(E,x,null)){if(P)return;this._reorderItems(b,g,y,!I,!0)}}}}else if(e.altKey)c=!1;else if(this._keyboardNavigationHandlers[p])this._keyboardNavigationHandlers[p](u).then(function(s){if(s.index!==u.index||s.type!==u.type){var o=i._keyboardNavigationHandlers[p].clampToBounds;s.type!==a.ObjectType.groupHeader&&e.shiftKey&&n._selectionAllowed()&&n._multiSelection()?(n._selection._pivot===l._INVALID_INDEX&&(n._selection._pivot=u.index),t(s,!0,o).then(function(t){if(t.index!==l._INVALID_INDEX){var s=Math.min(t.index,n._selection._pivot),o=Math.max(t.index,n._selection._pivot),r=e.ctrlKey||n._tap===a.TapBehavior.toggleSelect;i._selectRange(s,o,r)}})):(n._selection._pivot=l._INVALID_INDEX,t(s,!1,o))}else c=!1});else if(e.ctrlKey||p!==m.enter)u.type!==a.ObjectType.groupHeader&&(e.ctrlKey&&p===m.enter||p===m.space)?(this._itemEventsHandler.toggleSelectionIfAllowed(u.index),n._changeFocus(u,!0,_,!1,!0)):p===m.escape&&n._selection.count()>0?(n._selection._pivot=l._INVALID_INDEX,n._selection.clear()):c=!1;else{var k=u.type===a.ObjectType.groupHeader?n._groups.group(u.index).header:n._view.items.itemBoxAt(u.index);if(k){u.type===a.ObjectType.groupHeader?(this._pressedHeader=k,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=k,this._pressedContainer=n._view.items.containerAt(u.index),this._pressedHeader=null);var D=this._verifySelectionAllowed(u);D.canTapSelect&&this._itemEventsHandler.handleTap(u),this._fireInvokeEvent(u,k)}}this._keyDownHandled=c,c&&(e.stopPropagation(),e.preventDefault())}p===m.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(e){this._keyDownHandled&&(e.stopPropagation(),e.preventDefault())},onTabEntered:function(e){if(0!==this.site._groups.length()||this.site._hasHeaderOrFooter){var t=this.site,i=t._selection._getFocused(),n=e.detail,o=!t._hasKeyboardFocus||e.target===t._viewport;if(o)if(this.inboundFocusHandled=!0,i.index=i.index===l._INVALID_INDEX?0:i.index,n||!this.site._supportsGroupHeaderKeyboarding&&!this.site._hasHeaderOrFooter){var r={type:a.ObjectType.item};i.type===a.ObjectType.groupHeader?(r.index=t._groupFocusCache.getIndexForGroup(i.index),s(t._element,i,r)?t._changeFocus(r,!0,!1,!1,!0):t._changeFocus(i,!0,!1,!1,!0)):(r.index=i.type!==a.ObjectType.item?t._groupFocusCache.getLastFocusedItemIndex():i.index,t._changeFocus(r,!0,!1,!1,!0)),e.preventDefault()}else{var r={type:a.ObjectType.groupHeader};this.site._hasHeaderOrFooter?this.site._lastFocusedElementInGroupTrack.type===a.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(r.index=t._groups.groupFromItem(i.index),s(t._element,i,r)?t._changeFocus(r,!0,!1,!1,!0):t._changeFocus(i,!0,!1,!1,!0)):(r.type=this.site._lastFocusedElementInGroupTrack.type,r.index=0,t._changeFocus(r,!0,!1,!1,!0)):i.type!==a.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(r.index=t._groups.groupFromItem(i.index),s(t._element,i,r)?t._changeFocus(r,!0,!1,!1,!0):t._changeFocus(i,!0,!1,!1,!0)):(r.index=i.index,t._changeFocus(r,!0,!1,!1,!0)),e.preventDefault()}}},onTabExiting:function(e){if(this.site._hasHeaderOrFooter||this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var t=this.site,i=t._selection._getFocused(),n=e.detail;if(n){var o=null;if(i.type===a.ObjectType.item){var r=this.site._lastFocusedElementInGroupTrack.type;if(r!==a.ObjectType.header&&r!==a.ObjectType.footer&&this.site._supportsGroupHeaderKeyboarding)var o={type:a.ObjectType.groupHeader,index:t._groups.groupFromItem(i.index)};else var o={type:r===a.ObjectType.item?a.ObjectType.header:r,index:0}}o&&s(t._element,i,o)&&(t._changeFocus(o,!0,!1,!1,!0),e.preventDefault())}else if(!n&&i.type!==a.ObjectType.item){var l=0;l=i.type===a.ObjectType.groupHeader?t._groupFocusCache.getIndexForGroup(i.index):i.type===a.ObjectType.header?0:t._view.lastItemIndex();var o={type:a.ObjectType.item,index:l};s(t._element,i,o)&&(t._changeFocus(o,!0,!1,!1,!0),e.preventDefault())}}}});return c})})}),n("WinJS/Controls/ListView/_ErrorMessages",["exports","../../Core/_Base","../../Core/_Resources"],function(e,t){"use strict";t.Namespace._moduleDefine(e,null,{modeIsInvalid:{get:function(){return"Invalid argument: mode must be one of following values: 'none', 'single' or 'multi'."}},loadingBehaviorIsDeprecated:{get:function(){return"Invalid configuration: loadingBehavior is deprecated. The control will default this property to 'randomAccess'. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoad is deprecated. The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadThresholdIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoadThreshold is deprecated.  The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},automaticallyLoadPagesIsDeprecated:{get:function(){return"Invalid configuration: automaticallyLoadPages is deprecated. The control will default this property to false. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},invalidTemplate:{get:function(){return"Invalid template: Templates must be created before being passed to the ListView, and must contain a valid tree of elements."}},loadMorePagesIsDeprecated:{get:function(){return"loadMorePages is deprecated. Invoking this function will not have any effect. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},disableBackdropIsDeprecated:{get:function(){return"Invalid configuration: disableBackdrop is deprecated. Style: .win-listview .win-container.win-backdrop { background-color:transparent; } instead."}},backdropColorIsDeprecated:{get:function(){return"Invalid configuration: backdropColor is deprecated. Style: .win-listview .win-container.win-backdrop { rgba(155,155,155,0.23); } instead."}},itemInfoIsDeprecated:{get:function(){return"GridLayout.itemInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},groupInfoIsDeprecated:{get:function(){return"GridLayout.groupInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},resetItemIsDeprecated:{get:function(){return"resetItem may be altered or unavailable in future versions. Instead, mark the element as disposable using WinJS.Utilities.markDisposable."}},resetGroupHeaderIsDeprecated:{get:function(){return"resetGroupHeader may be altered or unavailable in future versions. Instead, mark the header element as disposable using WinJS.Utilities.markDisposable."}},maxRowsIsDeprecated:{get:function(){return"GridLayout.maxRows may be altered or unavailable in future versions. Instead, use the maximumRowsOrColumns property."}},swipeOrientationDeprecated:{get:function(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"}},swipeBehaviorDeprecated:{get:function(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}}})}),n("WinJS/Controls/ListView/_GroupFocusCache",["exports","../../Core/_Base"],function(e,t){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(function(e){this._listView=e,this.clear()},{updateCache:function(e,t,i){this._lastFocusedItemKey=t,this._lastFocusedItemIndex=i,i=""+i,this._itemToIndex[t]=i,this._groupToItem[e]=t},deleteItem:function(e){if(e===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0),this._itemToIndex[e])for(var t=this,i=Object.keys(this._groupToItem),n=0,s=i.length;s>n;n++){var o=i[n];if(t._groupToItem[o]===e){t.deleteGroup(o);break}}},deleteGroup:function(e){var t=this._groupToItem[e];t&&delete this._itemToIndex[t],delete this._groupToItem[e]},updateItemIndex:function(e,t){e===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=t),this._itemToIndex[e]&&(this._itemToIndex[e]=""+t)},getIndexForGroup:function(e){var t=this._listView._groups.group(e).key,i=this._groupToItem[t];return i&&this._itemToIndex[i]?+this._itemToIndex[i]:this._listView._groups.fromKey(t).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={},this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})}),_UnsupportedGroupFocusCache:t.Namespace._lazy(function(){return t.Class.define(null,{updateCache:function(e,t,i){this._lastFocusedItemKey=t,this._lastFocusedItemIndex=i},deleteItem:function(e){e===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0)},deleteGroup:function(){},updateItemIndex:function(e,t){e===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=t)},getIndexForGroup:function(){return 0},clear:function(){this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})})})}),n("WinJS/Controls/ListView/_GroupsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_ItemsManager","../../Utilities/_UI","../ItemContainer/_Constants"],function(e,t,i,n,s,o,r,a){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_GroupsContainerBase:t.Namespace._lazy(function(){return t.Class.define(function(){},{index:function(e){var t=this.headerFrom(e);if(t)for(var i=0,n=this.groups.length;n>i;i++)if(t===this.groups[i].header)return i;return a._INVALID_INDEX},headerFrom:function(e){for(;e&&!s.hasClass(e,a._headerClass);)e=e.parentNode;return e},requestHeader:function(e){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[e]||(this._waitingHeaderRequests[e]=[]);var t=this;return new i(function(i){var n=t.groups[e];n&&n.header?i(n.header):t._waitingHeaderRequests[e].push(i)})},notify:function(e,t){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[e]){for(var i=this._waitingHeaderRequests[e],n=0,s=i.length;s>n;n++)i[n](t);this._waitingHeaderRequests[e]=[]}},groupFromImpl:function(e,t,i){if(e>t)return null;var n=e+Math.floor((t-e)/2),s=this.groups[n];return i(s,n)?this.groupFromImpl(e,n-1,i):t>n&&!i(this.groups[n+1],n+1)?this.groupFromImpl(n+1,t,i):n},groupFrom:function(e){if(this.groups.length>0){var t=this.groups.length-1,i=this.groups[t];return e(i,t)?this.groupFromImpl(0,this.groups.length-1,e):t}return null},groupFromItem:function(e){return this.groupFrom(function(t){return e<t.startIndex})},groupFromOffset:function(e){return this.groupFrom(function(t){return e<t.offset})},group:function(e){return this.groups[e]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var e=0,t=this.groups.length;t>e;e++){var i=this.groups[e];i.userData&&this.listBinding.releaseItem(i.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var e=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return i.join(e.pendingChanges)}).then(function(){return e._listView._ifZombieDispose()?i.cancel:void 0}).then(function(){e.ignoreChanges=!1},function(t){return e.ignoreChanges=!1,i.wrapError(t)})},fromKey:function(e){for(var t=0,i=this.groups.length;i>t;t++){var n=this.groups[t];if(n.key===e)return{group:n,index:t}}return null},fromHandle:function(e){for(var t=0,i=this.groups.length;i>t;t++){var n=this.groups[t];if(n.handle===e)return{group:n,index:t}}return null}})}),_UnvirtualizedGroupsContainer:t.Namespace._lazy(function(){return t.Class.derive(e._GroupsContainerBase,function(e,t){this._listView=e,this.groupDataSource=t,this.groups=[],this.pendingChanges=[],this.dirty=!0;var i=this,o={beginNotifications:function(){i._listView._versionManager.beginNotifications()},endNotifications:function(){i._listView._versionManager.endNotifications(),i._listView._ifZombieDispose()||!i.ignoreChanges&&i._listView._groupsChanged&&i._listView._scheduleUpdate()},indexChanged:function(){i._listView._versionManager.receivedNotification(),i._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(e){i._listView._versionManager.receivedNotification(),i._listView._writeProfilerMark("groupCountChanged("+e+"),info"),i._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(e){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){var t=i.fromKey(e.key);t&&(i._listView._writeProfilerMark("groupChanged("+t.index+"),info"),t.group.userData=e,t.group.startIndex=e.firstItemIndexHint,this.markToRemove(t.group)),this.scheduleUpdate()}},removed:function(e){if(i._listView._versionManager.receivedNotification(),i._listView._groupRemoved(e),!i._listView._ifZombieDispose()){var t=i.fromHandle(e);if(t){i._listView._writeProfilerMark("groupRemoved("+t.index+"),info"),i.groups.splice(t.index,1);var n=i.groups.indexOf(t.group,t.index);n>-1&&i.groups.splice(n,1),this.markToRemove(t.group)}this.scheduleUpdate()}},inserted:function(e,t,n){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupInserted,info");var s=this;e.retain().then(function(o){var r;if(r=t||n||i.groups.length?s.findIndex(t,n):0,-1!==r){var a={key:o.key,startIndex:o.firstItemIndexHint,userData:o,handle:e.handle};i.groups.splice(r,0,a)}s.scheduleUpdate()}),i.pendingChanges.push(e)}},moved:function(e,t,n){if(i._listView._versionManager.receivedNotification(),!i._listView._ifZombieDispose()){i._listView._writeProfilerMark("groupMoved,info");var s=this;e.then(function(o){var r=s.findIndex(t,n),a=i.fromKey(o.key);if(a)i.groups.splice(a.index,1),-1!==r&&(a.index<r&&r--,a.group.key=o.key,a.group.userData=o,a.group.startIndex=o.firstItemIndexHint,i.groups.splice(r,0,a.group));else if(-1!==r){var l={key:o.key,startIndex:o.firstItemIndexHint,userData:o,handle:e.handle};i.groups.splice(r,0,l),e.retain()}s.scheduleUpdate()}),i.pendingChanges.push(e)}},reload:function(){i._listView._versionManager.receivedNotification(),i._listView._ifZombieDispose()||i._listView._processReload();

},markToRemove:function(e){if(e.header){var t=e.header;e.header=null,e.left=-1,e.width=-1,e.decorator=null,e.tabIndex=-1,t.tabIndex=-1,i._listView._groupsToRemove[s._uniqueID(t)]={group:e,header:t}}},scheduleUpdate:function(){i.dirty=!0,i.ignoreChanges||(i._listView._groupsChanged=!0)},findIndex:function(e,t){var n,s=-1;return e&&(n=i.fromHandle(e),n&&(s=n.index+1)),-1===s&&t&&(n=i.fromHandle(t),n&&(s=n.index)),s},removeElements:function(e){if(e.header){var t=e.header.parentNode;t&&(n.disposeSubTree(e.header),t.removeChild(e.header)),e.header=null,e.left=-1,e.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(o)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var e=this;return this.initializePromise=this.groupDataSource.getCount().then(function(t){for(var n=[],s=0;t>s;s++)n.push(e.listBinding.fromIndex(s).retain());return i.join(n)}).then(function(t){e.groups=[];for(var i=0,n=t.length;n>i;i++){var s=t[i];e.groups.push({key:s.key,startIndex:s.firstItemIndexHint,handle:s.handle,userData:s})}e._listView._writeProfilerMark("GroupsContainer_initialize groups("+t.length+"),info"),e._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(t){return e._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),i.wrapError(t)}),this.initializePromise},renderGroup:function(e){if(this._listView.groupHeaderTemplate){var t=this.groups[e];return i.wrap(this._listView._groupHeaderRenderer(i.wrap(t.userData))).then(o._normalizeRendererReturn)}return i.wrap(null)},setDomElement:function(e,t){this.groups[e].header=t,this.notify(e,t)},removeElements:function(){for(var e=this._listView._groupsToRemove||{},t=Object.keys(e),i=!1,s=this._listView._selection._getFocused(),o=0,a=t.length;a>o;o++){var l=e[t[o]],h=l.header,d=l.group;if(i||s.type!==r.ObjectType.groupHeader||d.userData.index!==s.index||(this._listView._unsetFocusOnItem(),i=!0),h){var u=h.parentNode;u&&(n._disposeElement(h),u.removeChild(h))}}i&&this._listView._setFocusOnItem(s),this._listView._groupsToRemove={}},resetGroups:function(){for(var e=this.groups.slice(0),t=0,i=e.length;i>t;t++){var n=e[t];this.listBinding&&n.userData&&this.listBinding.releaseItem(n.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:t.Namespace._lazy(function(){return t.Class.derive(e._GroupsContainerBase,function(e){this._listView=e,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return i.wrap()},addItem:function(){return i.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return i.wrap(null)},ensureFirstGroup:function(){return i.wrap(this.groups[0])},groupOf:function(){return i.wrap(this.groups[0])},removeElements:function(){}})})})}),n("WinJS/Controls/ListView/_Helpers",["exports","../../Core/_Base","../ItemContainer/_Constants"],function(e,t,i){"use strict";function n(e){return Array.prototype.slice.call(e)}function s(e,t){if("string"==typeof e)return s([e],t);var i=new Array(Math.floor(t/e.length)+1).join(e.join(""));return i+=e.slice(0,t%e.length).join("")}function o(e,t){var n,o=i._containerEvenClass,r=i._containerOddClass,a=t%2===0?[o,r]:[r,o],l=["<div class='win-container "+a[0]+" win-backdrop'></div>","<div class='win-container "+a[1]+" win-backdrop'></div>"];return n=s(l,e)}t.Namespace._moduleDefine(e,"WinJS.UI",{_nodeListToArray:n,_repeat:s,_stripedContainers:o})}),n("WinJS/Controls/ListView/_ItemsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_ElementUtilities","../ItemContainer/_Constants"],function(e,t,i,n,s){"use strict";t.Namespace._moduleDefine(e,"WinJS.UI",{_ItemsContainer:t.Namespace._lazy(function(){var e=function(e){this.site=e,this._itemData={},this.waitingItemRequests={}};return e.prototype={requestItem:function(e){this.waitingItemRequests[e]||(this.waitingItemRequests[e]=[]);var t=this,n=new i(function(i){var n=t._itemData[e];n&&!n.detached&&n.element?i(n.element):t.waitingItemRequests[e].push(i)});return n},removeItem:function(e){delete this._itemData[e]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(e,t){this._itemData[e]=t,t.detached||this.notify(e,t)},notify:function(e,t){if(this.waitingItemRequests[e]){for(var i=this.waitingItemRequests[e],n=0;n<i.length;n++)i[n](t.element);this.waitingItemRequests[e]=[]}},elementAvailable:function(e){var t=this._itemData[e];t.detached=!1,this.notify(e,t)},itemAt:function(e){var t=this._itemData[e];return t?t.element:null},itemDataAt:function(e){return this._itemData[e]},containerAt:function(e){var t=this._itemData[e];return t?t.container:null},itemBoxAt:function(e){var t=this._itemData[e];return t?t.itemBox:null},itemBoxFrom:function(e){for(;e&&!n.hasClass(e,s._itemBoxClass);)e=e.parentNode;return e},containerFrom:function(e){for(;e&&!n.hasClass(e,s._containerClass);)e=e.parentNode;return e},index:function(e){var t=this.containerFrom(e);if(t)for(var i in this._itemData)if(this._itemData[i].container===t)return parseInt(i,10);return s._INVALID_INDEX},each:function(e){for(var t in this._itemData)if(this._itemData.hasOwnProperty(t)){var i=this._itemData[t];e(parseInt(t,10),i.element,i)}},eachIndex:function(e){for(var t in this._itemData)if(e(parseInt(t,10)))break},count:function(){return Object.keys(this._itemData).length}},e})})}),n("WinJS/Controls/ListView/_Layouts",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations/_TransitionAnimation","../../Promise","../../Scheduler","../../_Signal","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","./_ErrorMessages"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f){"use strict";function g(e){return"_win-dynamic-"+e+"-"+F++}function v(){var e,t,i,n=R.sheet.cssRules,s=z.length;for(e=0;s>e;e++)for(i="."+z[e]+" ",t=n.length-1;t>=0;t--)-1!==n[t].selectorText.indexOf(i)&&R.sheet.deleteRule(t);z=[]}function y(e,t,i,n){v();var s="."+p._listViewClass+" ."+e+" "+i+" { "+n+"}",o="_addDynamicCssRule:"+e+",info";t?t._writeProfilerMark(o):r("WinJS.UI.ListView:Layout"+o),R.sheet.insertRule(s,0)}function C(e){z.push(e)}function w(e,t,i){return Math.max(e,Math.min(t,i))}function b(e,i){return c.convertToPixels(e,t.getComputedStyle(e,null)[i])}function I(e,t){return b(t,"margin"+e)+b(t,"border"+e+"Width")+b(t,"padding"+e)}function S(e){return I("Top",e)+I("Bottom",e)}function x(e){return I("Left",e)+I("Right",e)}function E(e,t){if(e.items)for(var i=0,n=e.items.length;n>i;i++)t(e.items[i],i);else for(var s=0,o=0;s<e.itemsBlocks.length;s++)for(var r=e.itemsBlocks[s],i=0,n=r.items.length;n>i;i++)t(r.items[i],o++)}function P(e,t){if(0>t)return null;if(e.items)return t<e.items.length?e.items[t]:null;var i=e.itemsBlocks[0].items.length,n=Math.floor(t/i),s=t%i;return n<e.itemsBlocks.length&&s<e.itemsBlocks[n].items.length?e.itemsBlocks[n].items[s]:null}function M(e,t){for(var i,n=0,s=t.length;s>n;n++)if(t[n].itemsContainer.element===e){i=t[n].itemsContainer;break}return i}function T(e){var t,i;return e.itemsBlocks?(t=e.itemsBlocks.length,i=t>0?e.itemsBlocks[0].items.length*(t-1)+e.itemsBlocks[t-1].items.length:0):i=e.items.length,i}function k(e){if(!j){var i=t.document.createElement("div");i.style.width="500px",i.style.visibility="hidden";var n=t.document.createElement("div");n.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",_.setInnerHTMLUnsafe(n,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>"),i.appendChild(n),e.viewport.insertBefore(i,e.viewport.firstChild);var s=i.offsetWidth>0,o=200;s&&(j={supportsCSSGrid:!!("-ms-grid-row"in t.document.documentElement.style),nestedFlexTooLarge:n.firstElementChild.offsetWidth>o,nestedFlexTooSmall:n.firstElementChild.offsetWidth<o}),e.readyToMeasure(),e.viewport.removeChild(i)}return j}function D(e){return l.is(e)?{realizedRangeComplete:e,layoutComplete:e}:"object"==typeof e&&e&&e.layoutComplete?e:{realizedRangeComplete:l.wrap(),layoutComplete:l.wrap()}}function A(e){return{left:b(e,"marginLeft"),right:b(e,"marginRight"),top:b(e,"marginTop"),bottom:b(e,"marginBottom")}}var O=c.Key,B=c._uniqueID,L={get itemInfoIsInvalid(){return"Invalid argument: An itemInfo function must be provided which returns an object with numeric width and height properties."},get groupInfoResultIsInvalid(){return"Invalid result: groupInfo result for cell spanning groups must include the following numeric properties: cellWidth and cellHeight."}},R=t.document.createElement("style");t.document.head.appendChild(R);var F=0,z=[],H=n._browserStyleEquivalents,N=H.transform,W=n._browserStyleEquivalents.transition.scriptName,V=N.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",U=12,j=null;i.Namespace._moduleDefine(e,"WinJS.UI",{Layout:i.Class.define(function(){}),_LayoutCommon:i.Namespace._lazy(function(){return i.Class.derive(e.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(e){this._groupHeaderPosition=e,this._invalidateLayout()}},initialize:function(e,t){e._writeProfilerMark("Layout:initialize,info"),this._inListMode||c.addClass(e.surface,p._gridLayoutClass),this._backdropColorClassName&&c.addClass(e.surface,this._backdropColorClassName),this._disableBackdropClassName&&c.addClass(e.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=e,this._groupsEnabled=t,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(e){this._orientation=e,this._horizontal="horizontal"===e,this._invalidateLayout()}},uninitialize:function(){function e(e){var t,i=e.length;for(t=0;i>t;t++)e[t].cleanUp(!0)}var t="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(t),c.removeClass(this._site.surface,p._gridLayoutClass),c.removeClass(this._site.surface,p._headerPositionTopClass),c.removeClass(this._site.surface,p._headerPositionLeftClass),c.removeClass(this._site.surface,p._structuralNodesClass),c.removeClass(this._site.surface,p._singleItemsBlockClass),c.removeClass(this._site.surface,p._noCSSGrid),this._site.surface.style.cssText="",this._groups&&(e(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._envInfo=null,this._backdropColorClassName&&(c.removeClass(this._site.surface,this._backdropColorClassName),C(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(c.removeClass(this._site.surface,this._disableBackdropClassName),C(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):r("WinJS.UI.ListView:"+t)},numberOfItemsPerItemsBlock:{get:function(){function t(){var e,t=i._site.groupCount;for(e=0;t>e;e++)if(i._isCellSpanning(e))return!1;return!0}var i=this;return i._measureItem(0).then(function(){return i._sizes.viewportContentSize!==i._getViewportCrossSize()&&i._viewportSizeChanged(i._getViewportCrossSize()),t()?i._envInfo.nestedFlexTooLarge||i._envInfo.nestedFlexTooSmall?(i._usingStructuralNodes=!0,Number.MAX_VALUE):(i._usingStructuralNodes=e._LayoutCommon._barsPerItemsBlock>0,e._LayoutCommon._barsPerItemsBlock*i._itemsPerBar):(i._usingStructuralNodes=!1,null)})}},layout:function(e,t,i,n){function s(e){function t(e){if(u._usingStructuralNodes){var t=[];return e.itemsBlocks.forEach(function(e){t=t.concat(e.items.slice(0))}),t}return e.items.slice(0)}return{element:e.element,items:t(e)}}function o(){function i(e,t){var i=e.enableCellSpanning?q.CellSpanningGroup:q.UniformGroup;return new i(u,t)}var n,o=u._groups.length>0?u._getRealizationRange():null,r=[],a=[],h={},d={},c=0,_=e.length;for(n=0;_>n;n++){var m=null,p=u._getGroupInfo(n),f=u._site.groupFromIndex(n).key,g=u._groupMap[f],v=g instanceof q.CellSpanningGroup,y=p.enableCellSpanning;if(g)if(v!==y)h[f]=!0;else{var C=Math.max(0,t.firstIndex-g.startIndex),w=u._rangeForGroup(g,o);w&&C<=w.lastIndex&&(m={firstIndex:Math.max(C,w.firstIndex),lastIndex:w.lastIndex})}var b,I=i(p,e[n].itemsContainer.element);b=I.prepareLayoutWithCopyOfTree?I.prepareLayoutWithCopyOfTree(s(e[n].itemsContainer),m,g,{groupInfo:p,startIndex:c}):I.prepareLayout(T(e[n].itemsContainer),m,g,{groupInfo:p,startIndex:c}),a.push(b),c+=I.count,r.push(I),d[f]=I}return l.join(a).then(function(){for(var e=0,t=0,i=r.length;i>t;t++){var n=r[t];n.offset=e,e+=u._getGroupSize(n)}Object.keys(u._groupMap).forEach(function(e){var t=!h[e];u._groupMap[e].cleanUp(t)}),u._groups=r,u._groupMap=d})}function r(e,i,n){var s,o=u._groups[e],r=Math.max(0,t.firstIndex-o.startIndex),a=u._rangeForGroup(o,i);return n?void o.layoutRealizedRange(r,a):(a||(s=o.startIndex+o.count-1<i.firstIndex),o.layoutUnrealizedRange(r,a,s))}function a(){if(0!==u._groups.length){var i,n=u._getRealizationRange(),s=e.length,o=_.groupIndexFromItemIndex(t.firstIndex);for(i=o;s>i;i++)r(i,n,!0),u._layoutGroup(i)}}function h(){if(0===u._groups.length)return l.wrap();var e=u._getRealizationRange(),i=_.groupIndexFromItemIndex(e.firstIndex-1),n=_.groupIndexFromItemIndex(e.lastIndex+1),s=_.groupIndexFromItemIndex(t.firstIndex),o=[],a=u._groups.length,h=!1,d=i,c=Math.max(s,n);for(c=Math.max(d+1,c);!h;)h=!0,d>=s&&(o.push(r(d,e,!1)),h=!1,d--),a>c&&(o.push(r(c,e,!1)),h=!1,c++);return l.join(o)}var d,u=this,_=u._site,m="Layout.layout",f=m+":realizedRange";return u._site._writeProfilerMark(m+",StartTM"),u._site._writeProfilerMark(f+",StartTM"),d=u._measureItem(0).then(function(){return c[u._usingStructuralNodes?"addClass":"removeClass"](u._site.surface,p._structuralNodesClass),c[u._envInfo.nestedFlexTooLarge||u._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](u._site.surface,p._singleItemsBlockClass),u._sizes.viewportContentSize!==u._getViewportCrossSize()&&u._viewportSizeChanged(u._getViewportCrossSize()),u._cacheRemovedElements(i,u._cachedItemRecords,u._cachedInsertedItemRecords,u._cachedRemovedItems,!1),u._cacheRemovedElements(n,u._cachedHeaderRecords,u._cachedInsertedHeaderRecords,u._cachedRemovedHeaders,!0),o()}).then(function(){u._syncDomWithGroupHeaderPosition(e);var t=0;if(u._groups.length>0){var s=u._groups[u._groups.length-1];t=s.offset+u._getGroupSize(s)}u._horizontal?(u._groupsEnabled&&u._groupHeaderPosition===J.left?_.surface.style.cssText+=";height:"+u._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+u._sizes.headerContainerWidth+"px auto)["+e.length+"]":_.surface.style.height=u._sizes.surfaceContentSize+"px",(u._envInfo.nestedFlexTooLarge||u._envInfo.nestedFlexTooSmall)&&(_.surface.style.width=t+"px")):(u._groupsEnabled&&u._groupHeaderPosition===J.top?_.surface.style.cssText+=";width:"+u._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+u._sizes.headerContainerHeight+"px auto)["+e.length+"]":_.surface.style.width=u._sizes.surfaceContentSize+"px",(u._envInfo.nestedFlexTooLarge||u._envInfo.nestedFlexTooSmall)&&(_.surface.style.height=t+"px")),a(),u._layoutAnimations(i,n),u._site._writeProfilerMark(f+":complete,info"),u._site._writeProfilerMark(f+",StopTM")},function(e){return u._site._writeProfilerMark(f+":canceled,info"),u._site._writeProfilerMark(f+",StopTM"),l.wrapError(e)}),u._layoutPromise=d.then(function(){return h().then(function(){u._site._writeProfilerMark(m+":complete,info"),u._site._writeProfilerMark(m+",StopTM")},function(e){return u._site._writeProfilerMark(m+":canceled,info"),u._site._writeProfilerMark(m+",StopTM"),l.wrapError(e)})}),{realizedRangeComplete:d,layoutComplete:u._layoutPromise}},itemsFromRange:function(e,t){return this._rangeContainsItems(e,t)?{firstIndex:this._firstItemFromRange(e),lastIndex:this._lastItemFromRange(t)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(t,i){function n(){var e={type:t.type,index:t.index-r.startIndex},i=r.getAdjacent(e,a);if("boundary"===i){var n=s._groups[o-1],l=s._groups[o+1],h=s._groups.length-1;if(a===O.leftArrow){if(0===o)return t;if(n instanceof q.UniformGroup&&r instanceof q.UniformGroup){var d=s._indexToCoordinate(e.index),u=s._horizontal?d.row:d.column,c=Math.floor((n.count-1)/s._itemsPerBar),_=c*s._itemsPerBar;return{type:m.ObjectType.item,index:n.startIndex+Math.min(n.count-1,_+u)}}return{type:m.ObjectType.item,index:r.startIndex-1}}if(a===O.rightArrow){if(o===h)return t;if(r instanceof q.UniformGroup&&l instanceof q.UniformGroup){var d=s._indexToCoordinate(e.index),u=s._horizontal?d.row:d.column;return{type:m.ObjectType.item,index:l.startIndex+Math.min(l.count-1,u)}}return{type:m.ObjectType.item,index:l.startIndex}}return t}return i.index+=r.startIndex,i}var s=this,o=s._site.groupIndexFromItemIndex(t.index),r=s._groups[o],a=s._adjustedKeyForOrientationAndBars(s._adjustedKeyForRTL(i),r instanceof q.CellSpanningGroup);if(t.type||(t.type=m.ObjectType.item),t.type===m.ObjectType.item||i!==O.pageUp&&i!==O.pageDown){if(t.type===m.ObjectType.header&&a===O.rightArrow)return{type:s._groupsEnabled?m.ObjectType.groupHeader:m.ObjectType.footer,index:0};if(t.type===m.ObjectType.footer&&a===O.leftArrow)return{type:s._groupsEnabled?m.ObjectType.groupHeader:m.ObjectType.header,index:0};if(t.type===m.ObjectType.groupHeader){if(a===O.leftArrow){var l=t.index-1;return l=s._site.header?l:Math.max(0,l),{type:l>-1?m.ObjectType.groupHeader:m.ObjectType.header,index:l>-1?l:0}}if(a===O.rightArrow){var l=t.index+1;return l=s._site.header?l:Math.min(s._groups.length-1,t.index+1),{type:l>=s._groups.length?m.ObjectType.header:m.ObjectType.groupHeader,index:l>=s._groups.length?0:l}}return t}}else{var h=0;h=t.type===m.ObjectType.groupHeader?s._groups[t.index].startIndex:t.type===m.ObjectType.header?0:s._groups[s._groups.length-1].count-1,t={type:m.ObjectType.item,index:h}}switch(s._adjustedKeyForRTL(i)){case O.upArrow:case O.leftArrow:case O.downArrow:case O.rightArrow:return n();default:return e._LayoutCommon.prototype._getAdjacentForPageKeys.call(s,t,i)}},hitTest:function(e,t){var i,n=this._sizes;e-=n.layoutOriginX,t-=n.layoutOriginY;var s=this._groupFromOffset(this._horizontal?e:t),o=this._groups[s];return this._horizontal?e-=o.offset:t-=o.offset,this._groupsEnabled&&(this._groupHeaderPosition===J.left?e-=n.headerContainerWidth:t-=n.headerContainerHeight),i=o.hitTest(e,t),i.index+=o.startIndex,i.insertAfterIndex+=o.startIndex,i},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var e=this._getRealizationRange(),t=this._site.tree,i=0,n="horizontal"===this.orientation,s=0,o=t.length;o>s;s++){var r=t[s],a=!1,l=this._groups[s],h=l instanceof q.CellSpanningGroup,d=l?l.offset:0;if(E(r.itemsContainer,function(t,n){if(e.firstIndex<=i&&e.lastIndex>=i&&(a=!0,!this._cachedItemRecords[i])){var o=this._getItemPositionForAnimations(i,s,n),r=o.row,l=o.column,d=o.left,u=o.top;this._cachedItemRecords[i]={oldRow:r,oldColumn:l,oldLeft:d,oldTop:u,width:o.width,height:o.height,element:t,inCellSpanningGroup:h}}i++}.bind(this)),a){var u=s;if(!this._cachedHeaderRecords[u]){var c=this._getHeaderPositionForAnimations(u);this._cachedHeaderRecords[u]={oldLeft:c.left,oldTop:c.top,width:c.width,height:c.height,element:r.header}}this._cachedGroupRecords[B(r.itemsContainer.element)]||(this._cachedGroupRecords[B(r.itemsContainer.element)]={oldLeft:n?d:0,left:n?d:0,oldTop:n?0:d,top:n?0:d,element:r.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(e,t){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(e,t);for(var i=this._getRealizationRange(),n=this._site.tree,s=0,o="horizontal"===this.orientation,r=0,a=n.length;a>r;r++){var l=n[r],h=this._groups[r],d=h instanceof q.CellSpanningGroup,u=h?h.offset:0,_=0,m=0,f=this._cachedGroupRecords[B(l.itemsContainer.element)];f&&(o?_=f.oldLeft-u:m=f.oldTop-u),E(l.itemsContainer,function(e,t){if(i.firstIndex<=s&&i.lastIndex>=s){var n=this._cachedItemRecords[s];if(n){var o=this._getItemPositionForAnimations(s,r,t),a=o.row,l=o.column,h=o.left,u=o.top;if(n.inCellSpanningGroup=n.inCellSpanningGroup||d,n.oldRow!==a||n.oldColumn!==l||n.oldTop!==u||n.oldLeft!==h){n.row=a,n.column=l,n.left=h,n.top=u;var f=n.oldLeft-n.left-_,g=n.oldTop-n.top-m;if(f=(this._site.rtl?-1:1)*f,n.xOffset=f,n.yOffset=g,0!==f||0!==g){var v=n.element;n.needsToResetTransform=!0,v.style[W]="",v.style[N.scriptName]="translate("+f+"px,"+g+"px)"}var y=e.parentNode;c.hasClass(y,p._itemsBlockClass)&&(this._animatingItemsBlocks[B(y)]=y)}}else this._cachedInsertedItemRecords[s]=e,e.style[W]="",e.style.opacity=0}s++}.bind(this));var g=r,v=this._cachedHeaderRecords[g];if(v){var y=this._getHeaderPositionForAnimations(g);if(v.height=y.height,v.width=y.width,v.oldLeft!==y.left||v.oldTop!==y.top){v.left=y.left,v.top=y.top;var C=v.oldLeft-v.left,w=v.oldTop-v.top;if(C=(this._site.rtl?-1:1)*C,0!==C||0!==w){v.needsToResetTransform=!0;var b=v.element;b.style[W]="",b.style[N.scriptName]="translate("+C+"px,"+w+"px)"}}}if(f&&(o&&f.left!==u||!o&&f.top!==u)){var I=f.element;if(0===_&&0===m)f.needsToResetTransform&&(f.needsToResetTransform=!1,I.style[N.scriptName]="");else{var S=(this._site.rtl?-1:1)*_,x=m;f.needsToResetTransform=!0,I.style[W]="",I.style[N.scriptName]="translate("+S+"px, "+x+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var P=Object.keys(this._animatingItemsBlocks),M=0,T=P.length;T>M;M++)this._animatingItemsBlocks[P[M]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function t(){if(s(),O)o();else{if(te._itemsPerBar>1)for(var e=te._itemsPerBar*te._sizes.containerCrossSize+te._getHeaderSizeContentAdjustment()+te._sizes.containerMargins[J?"top":w.rtl?"right":"left"]+(J?te._sizes.layoutOriginY:te._sizes.layoutOriginX),t=0,i=S.length;i>t;t++){var n=S[t];n[K]>n[G]?(H=Math.max(H,n[Z]+n[J?"height":"width"]),U=Math.max(U,e-n[Y]),L=!0,q.push(n)):n[K]<n[G]&&(V=Math.max(V,e-n[Z]),j=Math.max(j,n[Y]+n[J?"height":"width"]),q.push(n),L=!0)}w.rtl&&!J&&(H*=-1,U*=-1,V*=-1,j*=-1),L?h(te._itemsPerBar):f()}}function i(t){D=l.join(A),D.done(function(){A=[],y&&(e.Layout._debugAnimations?n._requestAnimationFrame(function(){t()}):t())})}function s(){if(I.length){w._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),P+=60,k+=60;var e=120;C&&(e*=10),A.push(a.executeTransition(I,[{property:"opacity",delay:E,duration:e,timing:"linear",to:0,skipStylesReset:!0}])),w._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function o(){w._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var e=[],t=0,n=S.length;n>t;t++){var s=S[t],o=s.element;e.push(o)}for(var t=0,n=x.length;n>t;t++){var s=x[t],o=s.element;e.push(o)}var l=120;C&&(l*=10),A.push(a.executeTransition(e,{property:"opacity",delay:E,duration:l,timing:"linear",to:0})),i(r),w._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function r(){w._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),k=0;for(var e=[],t=0,i=S.length;i>t;t++){var n=S[t],s=n.element;s.style[N.scriptName]="",e.push(s)}for(var t=0,i=x.length;i>t;t++){var n=x[t],s=n.element;s.style[N.scriptName]="",e.push(s)}var o=120;C&&(o*=10),A.push(a.executeTransition(e,{property:"opacity",delay:k,duration:o,timing:"linear",to:1})),w._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),g()}function h(e){w._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var t={},n=0,s=q.length;s>n;n++){var o=q[n],r=o.xOffset,l=o.yOffset;o[K]>o[G]?J?l-=H:r-=H:o[K]<o[G]&&(J?l+=V:r+=V);var h=o.element;R=Math.min(R,J?r:l),F=Math.max(F,J?r:l);var d=h.parentNode;c.hasClass(d,"win-itemscontainer")||(d=d.parentNode);var u=t[B(d)];if(!u){var _=T(M(d,w.tree));t[B(d)]=u=Math.ceil(_/e)-1}q[n][J?"column":"row"]===u&&(z[B(d)]=d);var f=80;C&&(f*=10),A.push(a.executeTransition(h,{property:N.cssName,delay:P,duration:f,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+r+"px,"+l+"px)"}))}for(var g=Object.keys(z),n=0,s=g.length;s>n;n++){var v=z[g[n]];w.rtl&&J?(v.style.paddingLeft=-1*R+"px",v.style.marginLeft=R+"px"):(v.style[J?"paddingRight":"paddingBottom"]=F+"px",v.style[J?"marginRight":"marginBottom"]="-"+F+"px")}for(var y=Object.keys(X),n=0,s=y.length;s>n;n++)X[y[n]].classList.add(p._clipClass);i(m),w._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function _(){for(var e=Object.keys(z),t=0,i=e.length;i>t;t++){var n=z[e[t]];w.rtl&&J?(n.style.paddingLeft="",n.style.marginLeft=""):(n.style[J?"paddingRight":"paddingBottom"]="",n.style[J?"marginRight":"marginBottom"]="")}z={};for(var s=Object.keys(X),t=0,i=s.length;i>t;t++){var o=X[s[t]];o.style.overflow="",o.classList.remove(p._clipClass)}}function m(){w._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var t=0,i=q.length;i>t;t++){var s=q[t],o=0,r=0;s[K]>s[G]?J?r=U:o=U:s[K]<s[G]&&(J?r=-1*j:o=-1*j),s.element.style[W]="",s.element.style[N.scriptName]="translate("+o+"px,"+r+"px)"}w._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),e.Layout._debugAnimations?n._requestAnimationFrame(function(){f(!0)}):f(!0)}function f(e){var t=200;if(e&&(t=150,P=0,k=0),C&&(t*=10),S.length>0||x.length>0){w._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var i=[],n=0,s=x.length;s>n;n++){var o=x[n].element;i.push(o)}for(var n=0,s=S.length;s>n;n++){var o=S[n].element;i.push(o)}A.push(a.executeTransition(i,{property:N.cssName,delay:P,duration:t,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),k+=80,w._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}g()}function g(){if(b.length>0){w._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var e=120;C&&(e*=10),A.push(a.executeTransition(b,[{property:"opacity",delay:k,duration:e,timing:"linear",to:1}])),w._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}i(v)}function v(){w._writeProfilerMark("Animation:cleanupAnimations,StartTM"),_();for(var e=0,t=I.length;t>e;e++){var i=I[e];i.parentNode&&(u._disposeElement(i),i.parentNode.removeChild(i))}w._writeProfilerMark("Animation:cleanupAnimations,StopTM"),te._animationsRunning=null,y.complete()}var y=new d;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),y.complete(),y.promise;this._animationsRunning=y.promise;for(var C=e.Layout._debugAnimations||e.Layout._slowAnimations,w=this._site,b=this._insertedElements,I=this._removedElements,S=this._itemMoveRecords,x=this._moveRecords,E=0,P=0,k=0,D=null,A=[],O=!1,L=!1,R=0,F=0,z={},H=0,V=0,U=0,j=0,q=[],J="horizontal"===this.orientation,K=J?"oldColumn":"oldRow",G=J?"column":"row",Z=J?"oldTop":"oldLeft",Y=J?"top":"left",X=this._animatingItemsBlocks,Q=0,$=S.length;$>Q;Q++){var ee=S[Q];if(ee.inCellSpanningGroup){O=!0;break}}var te=this;return e.Layout._debugAnimations?n._requestAnimationFrame(function(){t()}):t(),this._resetAnimationCaches(!0),y.promise.then(null,function(){_();for(var e=0,t=x.length;t>e;e++){var i=x[e].element;i.style[N.scriptName]="",i.style.opacity=1}for(var e=0,t=S.length;t>e;e++){var i=S[e].element;i.style[N.scriptName]="",i.style.opacity=1}for(var e=0,t=b.length;t>e;e++)b[e].style.opacity=1;for(var e=0,t=I.length;t>e;e++){var i=I[e];i.parentNode&&(u._disposeElement(i),i.parentNode.removeChild(i))}this._animationsRunning=null,y=null,D&&D.cancel()}.bind(this)),y.promise},dragOver:function(e,t,i){var n=this.hitTest(e,t),s=this._groups?this._site.groupIndexFromItemIndex(n.index):0,o=this._site.tree[s].itemsContainer,r=T(o),a=this._groups?this._groups[s].startIndex:0,l=this._getVisibleRange();n.index-=a,n.insertAfterIndex-=a,l.firstIndex=Math.max(l.firstIndex-a-1,0),l.lastIndex=Math.min(l.lastIndex-a+1,r);var h=Math.max(Math.min(r-1,n.insertAfterIndex),-1),d=Math.min(h+1,r);if(i){for(var u=h;u>=l.firstIndex;u--){if(!i._isIncluded(u+a)){h=u;break}u===l.firstIndex&&(h=-1)}for(var u=d;u<l.lastIndex;u++){if(!i._isIncluded(u+a)){d=u;break}u===l.lastIndex-1&&(d=r)}}var c=P(o,d),_=P(o,h);if(this._animatedDragItems)for(var u=0,m=this._animatedDragItems.length;m>u;u++){var p=this._animatedDragItems[u];p&&(p.style[W]=this._site.animationsDisabled?"":V,p.style[N.scriptName]="")}this._animatedDragItems=[];var f="horizontal"===this.orientation,g=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[s]instanceof q.CellSpanningGroup&&(g=1===this._groups[s]._slotsPerColumn);var v=0,y=0;!f&&!g||f&&g?v=this._site.rtl?-U:U:y=U,c&&(c.style[W]=this._site.animationsDisabled?"":V,c.style[N.scriptName]="translate("+v+"px, "+y+"px)",this._animatedDragItems.push(c)),_&&(_.style[W]=this._site.animationsDisabled?"":V,_.style[N.scriptName]="translate("+-v+"px, -"+y+"px)",this._animatedDragItems.push(_))},dragLeave:function(){if(this._animatedDragItems)for(var e=0,t=this._animatedDragItems.length;t>e;e++)this._animatedDragItems[e].style[W]=this._site.animationsDisabled?"":V,this._animatedDragItems[e].style[N.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(e){e===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),e&&(this._itemsPerBar=Math.min(this._itemsPerBar,e)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=e,this._invalidateLayout())},_getItemPosition:function(e){if(this._groupsEnabled){var t=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(e)),i=this._groups[t],n=e-i.startIndex;return this._getItemPositionForAnimations(e,t,n)}return this._getItemPositionForAnimations(e,0,e)},_getRealizationRange:function(){var e=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(e.firstPixel),lastIndex:this._lastItemFromRange(e.lastPixel)}},_getVisibleRange:function(){var e=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(e.firstPixel),lastIndex:this._lastItemFromRange(e.lastPixel)}},_resetAnimationCaches:function(e){if(!e){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var t=Object.keys(this._animatingItemsBlocks),i=0,n=t.length;n>i;i++){var s=this._animatingItemsBlocks[t[i]];s.style.overflow="",s.classList.remove(p._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(e,t,i,n,s){var o="left";this._site.rtl&&(o="right");var r,a;s?(r=this._sizes.headerContainerOuterX,a=this._sizes.headerContainerOuterY):(r=this._sizes.containerMargins[o],a=this._sizes.containerMargins.top);

for(var l=0,h=e.length;h>l;l++){var d=e[l];if(-1===d.newIndex){var u=d.element,c=t[d.oldIndex];c&&(c.element=u,delete t[d.oldIndex],u.style.position="absolute",u.style[W]="",u.style.top=c.oldTop-a+"px",u.style[o]=c.oldLeft-r+"px",u.style.width=c.width+"px",u.style.height=c.height+"px",u.style[N.scriptName]="",this._site.surface.appendChild(u),n.push(c)),i[d.oldIndex]&&delete i[d.oldIndex]}}},_cacheInsertedElements:function(e,t,i){for(var n={},s=0,o=e.length;o>s;s++){var r=e[s],a=t[r.oldIndex];if(a&&delete t[r.oldIndex],a||-1===r.oldIndex||r.moved){var l=i[r.newIndex];l&&delete i[r.newIndex];var h=r.element;n[r.newIndex]=h,h.style[W]="",h.style[N.scriptName]="",h.style.opacity=0}}for(var d=Object.keys(t),s=0,o=d.length;o>s;s++)n[d[s]]=t[d[s]];return n},_resetStylesForRecords:function(e){for(var t=Object.keys(e),i=0,n=t.length;n>i;i++){var s=e[t[i]];s.needsToResetTransform&&(s.element.style[N.scriptName]="",s.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(e){for(var t=Object.keys(e),i=0,n=t.length;n>i;i++){var s=e[t[i]];s.style.opacity=1}},_resetStylesForRemovedRecords:function(e){for(var t=0,i=e.length;i>t;t++){var n=e[t].element;n.parentNode&&(u._disposeElement(n),n.parentNode.removeChild(n))}},_updateAnimationCache:function(e,t){function i(e,t){for(var i={},s=0,o=e.length;o>s;s++){var r=e[s],a=t[r.oldIndex];a&&(i[r.newIndex]=a,a.element=r.element,delete t[r.oldIndex])}for(var l=Object.keys(t),s=0,o=l.length;o>s;s++){var h=l[s],d=t[h];(!d.element||n[B(d.element)])&&(i[h]=d)}return i}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var n={},s=this._getRealizationRange(),o=this._site.tree,r=0,a=0,l=o.length;l>r;r++)E(o[r].itemsContainer,function(e){s.firstIndex<=a&&s.lastIndex>=a&&(n[B(e)]=!0),a++});this._cachedItemRecords=i(e,this._cachedItemRecords),this._cachedHeaderRecords=i(t,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(e,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(t,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function e(e,r){for(var a=0,l=e.length;l>a;a++){var h=e[a],d=h.element;h[i]+h[n]-1<s||h[i]>o||!t._site.viewport.contains(d)?d.parentNode&&(u._disposeElement(d),d.parentNode.removeChild(d)):r.push(d)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var t=this,i="horizontal"===this.orientation?"oldLeft":"oldTop",n="horizontal"===this.orientation?"width":"height",s=this._site.scrollbarPos,o=s+this._site.viewportSize[n]-1;e(this._cachedRemovedItems,this._removedElements),e(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function e(e,n){for(var s=Object.keys(e),o=0,r=s.length;r>o;o++){var a=s[o],l=e[a];a<i.firstIndex||a>i.lastIndex||t._site.viewport.contains(l.element)?l.style.opacity=1:n.push(l)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var t=this,i=this._getVisibleRange();e(this._cachedInsertedItemRecords,this._insertedElements),e(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var e=this,t="horizontal"===this.orientation?"oldLeft":"oldTop",i="horizontal"===this.orientation?"left":"top",n="horizontal"===this.orientation?"width":"height",s=this._getRealizationRange(),o=this._site.scrollbarPos,r=o+this._site.viewportSize[n]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var a=this._site.tree,l=0,h=0,d=a.length;d>h;h++){var u=a[h],c=!1;E(u.itemsContainer,function(){if(s.firstIndex<=l&&s.lastIndex>=l){var a=this._cachedItemRecords[l];if(a){var h=(a[t]+a[n]-1>=o&&a[t]<=r||a[i]+a[n]-1>=o&&a[i]<=r)&&e._site.viewport.contains(a.element);h&&(c=!0,a.needsToResetTransform&&(this._itemMoveRecords.push(a),delete this._cachedItemRecords[l]))}}l++}.bind(this));var _=h,m=this._cachedHeaderRecords[_];m&&c&&m.needsToResetTransform&&(this._moveRecords.push(m),delete this._cachedHeaderRecords[_]);var p=this._cachedGroupRecords[B(u.itemsContainer.element)];p&&c&&p.needsToResetTransform&&(this._moveRecords.push(p),delete this._cachedGroupRecords[B(u.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(e,t,i){var n=this._groups[t],s=n.getItemPositionForAnimations(i),o=this._groups[t]?this._groups[t].offset:0,r=this._groupsEnabled&&this._groupHeaderPosition===J.left?this._sizes.headerContainerWidth:0,a=this._groupsEnabled&&this._groupHeaderPosition===J.top?this._sizes.headerContainerHeight:0;return s.left+=this._sizes.layoutOriginX+r+this._sizes.itemsContainerOuterX,s.top+=this._sizes.layoutOriginY+a+this._sizes.itemsContainerOuterY,s[this._horizontal?"left":"top"]+=o,s},_getHeaderPositionForAnimations:function(e){var t;if(this._groupsEnabled){var i=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,n=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==J.left||this._horizontal?this._groupHeaderPosition===J.top&&this._horizontal&&(i=this._groups[e].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):n=this._groups[e].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var s=this._horizontal?this._groups[e].offset:0,o=this._horizontal?0:this._groups[e].offset;t={top:this._sizes.layoutOriginY+o+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+s+this._sizes.headerContainerOuterX,height:n,width:i}}else t={top:0,left:0,height:0,width:0};return t},_rangeContainsItems:function(e,t){if(0===this._groups.length)return!1;var i=this._groups[this._groups.length-1],n=this._sizes.layoutOrigin+i.offset+this._getGroupSize(i)-1;return t>=0&&n>=e},_itemFromOffset:function(e,t){function i(e){if(!t.wholeItem){var i=s._horizontal?s._site.rtl?"right":"left":"top",n=s._horizontal?s._site.rtl?"left":"right":"bottom";return t.last?e-s._sizes.containerMargins[i]:e+s._sizes.containerMargins[n]}return e}function n(e){return t.last?e-s._getHeaderSizeGroupAdjustment()-s._sizes.itemsContainerOuterStart:e}var s=this;if(0===this._groups.length)return 0;t=t||{},e-=this._sizes.layoutOrigin,e=i(e);var o=this._groupFromOffset(n(e)),r=this._groups[o];return e-=r.offset,e-=this._getHeaderSizeGroupAdjustment(),r.startIndex+r.itemFromOffset(e,t)},_firstItemFromRange:function(e,t){return t=t||{},t.last=0,this._itemFromOffset(e,t)},_lastItemFromRange:function(e,t){return t=t||{},t.last=1,this._itemFromOffset(e,t)},_adjustedKeyForRTL:function(e){return this._site.rtl&&(e===O.leftArrow?e=O.rightArrow:e===O.rightArrow&&(e=O.leftArrow)),e},_adjustedKeyForOrientationAndBars:function(e,t){var i=e;if(t)return e;if(!this._horizontal)switch(i){case O.leftArrow:i=O.upArrow;break;case O.rightArrow:i=O.downArrow;break;case O.upArrow:i=O.leftArrow;break;case O.downArrow:i=O.rightArrow}return 1===this._itemsPerBar&&(i===O.upArrow?i=O.leftArrow:i===O.downArrow&&(i=O.rightArrow)),i},_getAdjacentForPageKeys:function(e,t){var i,n=this._sizes.containerMargins,s="horizontal"===this.orientation?n.left+n.right:n.top+n.bottom,o=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],r=this._site.scrollbarPos,a=r+o-1-n["horizontal"===this.orientation?"right":"bottom"],l=this._firstItemFromRange(r,{wholeItem:!0}),h=this._lastItemFromRange(a,{wholeItem:!1}),d=this._getItemPosition(e.index),u=!1;if((e.index<l||e.index>h)&&(u=!0,r="horizontal"===this.orientation?d.left-s:d.top-s,a=r+o-1,l=this._firstItemFromRange(r,{wholeItem:!0}),h=this._lastItemFromRange(a,{wholeItem:!1})),t===O.pageUp){if(!u&&l!==e.index)return{type:m.ObjectType.item,index:l};var c;c="horizontal"===this.orientation?d.left+d.width+s+n.left:d.top+d.height+s+n.bottom;var _=this._firstItemFromRange(c-o,{wholeItem:!0});i=e.index===_?Math.max(0,e.index-this._itemsPerBar):_}else{if(!u&&h!==e.index)return{type:m.ObjectType.item,index:h};var p;p="horizontal"===this.orientation?d.left-s-n.right:d.top-s-n.bottom;var f=Math.max(0,this._lastItemFromRange(p+o-1,{wholeItem:!0}));i=e.index===f?e.index+this._itemsPerBar:f}return{type:m.ObjectType.item,index:i}},_isCellSpanning:function(e){var t=this._site.groupFromIndex(e),i=this._groupInfo;return i?!!("function"==typeof i?i(t):i).enableCellSpanning:!1},_getGroupInfo:function(e){var t=this._site.groupFromIndex(e),i=this._groupInfo,n=this._sizes.containerMargins,o={enableCellSpanning:!1};if(i="function"==typeof i?i(t):i){if(i.enableCellSpanning&&(+i.cellWidth!==i.cellWidth||+i.cellHeight!==i.cellHeight))throw new s("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",L.groupInfoResultIsInvalid);o={enableCellSpanning:!!i.enableCellSpanning,cellWidth:i.cellWidth+n.left+n.right,cellHeight:i.cellHeight+n.top+n.bottom}}return o},_getItemInfo:function(e){var t;if(this._itemInfo&&"function"==typeof this._itemInfo)t=this._itemInfo(e);else{if(!this._useDefaultItemInfo)throw new s("WinJS.UI.GridLayout.ItemInfoIsInvalid",L.itemInfoIsInvalid);t=this._defaultItemInfo(e)}return l.as(t).then(function(e){if(!e||+e.width!==e.width||+e.height!==e.height)throw new s("WinJS.UI.GridLayout.ItemInfoIsInvalid",L.itemInfoIsInvalid);return e})},_defaultItemInfo:function(e){var t=this;return this._site.renderItem(this._site.itemFromIndex(e)).then(function(i){return t._elementsToMeasure[e]={element:i},t._measureElements()}).then(function(){var i=t._elementsToMeasure[e],n={width:i.width,height:i.height};return delete t._elementsToMeasure[e],n},function(i){return delete t._elementsToMeasure[e],l.wrapError(i)})},_getGroupSize:function(e){var t=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===J.top?t=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==J.left||(t=this._sizes.headerContainerMinHeight)),Math.max(t,e.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(e){return e<this._groups[0].offset?0:this._groupFrom(function(t){return e<t.offset})},_groupFromImpl:function(e,t,i){if(e>t)return null;var n=e+Math.floor((t-e)/2),s=this._groups[n];return i(s,n)?this._groupFromImpl(e,n-1,i):t>n&&!i(this._groups[n+1],n+1)?this._groupFromImpl(n+1,t,i):n},_groupFrom:function(e){if(this._groups.length>0){var t=this._groups.length-1,i=this._groups[t];return e(i,t)?this._groupFromImpl(0,this._groups.length-1,e):t}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(c.removeClass(this._site.surface,this._containerSizeClassName),C(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var e=this;e._measuringElements=h.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){e._site._writeProfilerMark("_measureElements,StartTM");var i=e._createMeasuringSurface(),n=t.document.createElement("div"),s=e._site,o=e._measuringElements,r=e._elementsToMeasure,a=!1;n.className=p._itemsContainerClass+" "+p._laidOutClass,n.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var l,h,d=Object.keys(r);for(h=0,l=d.length;l>h;h++){var u=r[d[h]].element;u.style["-ms-grid-column"]=h+1,u.style["-ms-grid-row"]=h+1,n.appendChild(u)}for(i.appendChild(n),s.viewport.insertBefore(i,s.viewport.firstChild),o.then(null,function(){a=!0}),h=0,l=d.length;l>h&&!a;h++){var _=r[d[h]],m=_.element.querySelector("."+p._itemClass);_.width=c.getTotalWidth(m),_.height=c.getTotalHeight(m)}i.parentNode&&i.parentNode.removeChild(i),o===e._measuringElements&&(e._measuringElements=null),s._writeProfilerMark("_measureElements,StopTM")},function(t){return e._measuringElements=null,l.wrapError(t)})}return this._measuringElements},_ensureEnvInfo:function(){return this._envInfo||(this._envInfo=k(this._site),this._envInfo&&!this._envInfo.supportsCSSGrid&&c.addClass(this._site.surface,p._noCSSGrid)),!!this._envInfo},_createMeasuringSurface:function(){var e=t.document.createElement("div");return e.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto;-ms-flex-align: start;-webkit-align-items: flex-start;align-items: flex-start",e.className=p._scrollableClass+" "+(this._inListMode?p._listLayoutClass:p._gridLayoutClass),this._envInfo.supportsCSSGrid||c.addClass(e,p._noCSSGrid),this._groupsEnabled&&(this._groupHeaderPosition===J.top?c.addClass(e,p._headerPositionTopClass):c.addClass(e,p._headerPositionLeftClass)),e},_measureItem:function(e){function i(e,s){var s,a=!!s,h={},d=o.rtl?"right":"left";return o.itemCount.then(function(t){return!t||n._groupsEnabled&&!o.groupCount?l.cancel:(s=s||o.itemFromIndex(e),h.container=o.renderItem(s),n._groupsEnabled&&(h.headerContainer=o.renderHeader(n._site.groupFromIndex(o.groupIndexFromItemIndex(e)))),l.join(h))}).then(function(h){function u(){var e=n._horizontal,t=n._groupsEnabled,i=!1;r.then(null,function(){i=!0});var s=A(M),a=o.rtl?o.viewport.offsetWidth-(M.offsetLeft+M.offsetWidth):M.offsetLeft,l=M.offsetTop,u={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:S(m),surfaceOuterWidth:x(m),layoutOriginX:a-s[d],layoutOriginY:l-s.top,itemsContainerOuterHeight:S(f),itemsContainerOuterWidth:x(f),itemsContainerOuterX:I(o.rtl?"Right":"Left",f),itemsContainerOuterY:I("Top",f),itemsContainerMargins:A(f),itemBoxOuterHeight:S(v),itemBoxOuterWidth:x(v),containerOuterHeight:S(h.container),containerOuterWidth:x(h.container),emptyContainerContentHeight:c.getContentHeight(g),emptyContainerContentWidth:c.getContentWidth(g),containerMargins:A(h.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};o.header&&(u[e?"layoutOriginX":"layoutOriginY"]+=c[e?"getTotalWidth":"getTotalHeight"](o.header)),t&&(u.headerContainerOuterX=I(o.rtl?"Right":"Left",h.headerContainer),u.headerContainerOuterY=I("Top",h.headerContainer),u.headerContainerOuterWidth=x(h.headerContainer),u.headerContainerOuterHeight=S(h.headerContainer),u.headerContainerWidth=c.getTotalWidth(h.headerContainer),u.headerContainerHeight=c.getTotalHeight(h.headerContainer),u.headerContainerMinWidth=b(h.headerContainer,"minWidth")+u.headerContainerOuterWidth,u.headerContainerMinHeight=b(h.headerContainer,"minHeight")+u.headerContainerOuterHeight);var _={sizes:u,viewportContentWidth:c.getContentWidth(o.viewport),viewportContentHeight:c.getContentHeight(o.viewport),containerContentWidth:c.getContentWidth(h.container),containerContentHeight:c.getContentHeight(h.container),containerWidth:c.getTotalWidth(h.container),containerHeight:c.getTotalHeight(h.container)};return _.viewportCrossSize=_[e?"viewportContentHeight":"viewportContentWidth"],o.readyToMeasure(),i?null:_}function _(){m.parentNode&&m.parentNode.removeChild(m)}var m=n._createMeasuringSurface(),f=t.document.createElement("div"),g=t.document.createElement("div"),v=h.container.querySelector("."+p._itemBoxClass),y=o.groupIndexFromItemIndex(e);g.className=p._containerClass,f.className=p._itemsContainerClass+" "+p._laidOutClass;var C=1,w=1,E=2,P=2,M=f,T=!1;n._inListMode&&n._groupsEnabled&&(n._horizontal&&n._groupHeaderPosition===J.top?(C=2,P=1,E=1,M=h.headerContainer,T=!0):n._horizontal||n._groupHeaderPosition!==J.left||(w=2,P=1,E=1,M=h.headerContainer,T=!0)),f.style.cssText+=";display: "+(n._inListMode?(n._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+w+";-ms-grid-row: "+C,n._inListMode||(h.container.style.display="inline-block"),n._groupsEnabled&&(h.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+P+";-ms-grid-row: "+E,c.addClass(h.headerContainer,p._laidOutClass+" "+p._groupLeaderClass),(n._groupHeaderPosition===J.top&&n._horizontal||n._groupHeaderPosition===J.left&&!n._horizontal)&&c.addClass(f,p._groupLeaderClass)),T&&m.appendChild(h.headerContainer),f.appendChild(h.container),f.appendChild(g),m.appendChild(f),!T&&n._groupsEnabled&&m.appendChild(h.headerContainer),o.viewport.insertBefore(m,o.viewport.firstChild);var k=u();if(!k)return _(),l.cancel;if(n._horizontal&&0===k.viewportContentHeight||!n._horizontal&&0===k.viewportContentWidth)return _(),l.cancel;if(!(a||n._isCellSpanning(y)||0!==k.containerContentWidth&&0!==k.containerContentHeight))return _(),s.then(function(){return i(e,s)});var D=n._sizes=k.sizes;if(Object.defineProperties(D,{surfaceOuterCrossSize:{get:function(){return n._horizontal?D.surfaceOuterHeight:D.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return n._horizontal?D.layoutOriginX:D.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return n._horizontal?D.itemsContainerOuterWidth:D.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return n._horizontal?D.itemsContainerOuterHeight:D.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return n._horizontal?D.itemsContainerOuterX:D.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return n._horizontal?D.itemsContainerOuterY:D.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return n._horizontal?D.containerHeight:D.containerWidth},enumerable:!0},containerSize:{get:function(){return n._horizontal?D.containerWidth:D.containerHeight},enumerable:!0}}),!n._isCellSpanning(y)){if(n._inListMode){var O=k.viewportCrossSize-D.surfaceOuterCrossSize-n._getHeaderSizeContentAdjustment()-D.itemsContainerOuterCrossSize;n._horizontal?(D.containerHeight=O,D.containerWidth=k.containerWidth):(D.containerHeight=k.containerHeight,D.containerWidth=O)}else D.containerWidth=k.containerWidth,D.containerHeight=k.containerHeight;D.containerSizeLoaded=!0}n._createContainerStyleRule(),n._viewportSizeChanged(k.viewportCrossSize),_()})}var n=this,s="Layout:measureItem",o=n._site,r=n._measuringPromise;if(!r){o._writeProfilerMark(s+",StartTM");var a=new d;n._measuringPromise=r=a.promise.then(function(){return n._ensureEnvInfo()?i(e):l.cancel}).then(function(){o._writeProfilerMark(s+":complete,info"),o._writeProfilerMark(s+",StopTM")},function(e){return n._measuringPromise=null,o._writeProfilerMark(s+":canceled,info"),o._writeProfilerMark(s+",StopTM"),l.wrapError(e)}),a.complete()}return r},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===J.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===J.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===J.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===J.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(e){var t=this._sizes;t.viewportContentSize=e,t.surfaceContentSize=e-t.surfaceOuterCrossSize,t.maxItemsContainerContentSize=t.surfaceContentSize-t.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),t.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(t.maxItemsContainerContentSize/t.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(t[this._horizontal?"containerHeight":"containerWidth"]=t.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var e=this._sizes;if(!this._containerSizeClassName&&e.containerSizeLoaded&&(0===e.emptyContainerContentHeight||0===e.emptyContainerContentWidth)){var t=e.containerWidth-e.containerOuterWidth+"px",i=e.containerHeight-e.containerOuterHeight+"px";this._inListMode&&(this._horizontal?i="calc(100% - "+(e.containerMargins.top+e.containerMargins.bottom)+"px)":t="auto"),this._containerSizeClassName||(this._containerSizeClassName=g("containersize"),c.addClass(this._site.surface,this._containerSizeClassName));var n="."+p._containerClass,s="width:"+t+";height:"+i+";";y(this._containerSizeClassName,this._site,n,s)}},_ensureContainerSize:function(e){var t=this._sizes;if(t.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:l.wrap();var i;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)i=this._getItemInfo();else{var n=t.containerMargins;i=l.wrap({width:e.groupInfo.cellWidth-n.left-n.right,height:e.groupInfo.cellHeight-n.top-n.bottom})}var s=this;return this._ensuringContainerSize=i.then(function(e){t.containerSizeLoaded=!0,t.containerWidth=e.width+t.itemBoxOuterWidth+t.containerOuterWidth,t.containerHeight=e.height+t.itemBoxOuterHeight+t.containerOuterHeight,s._inListMode?s._itemsPerBar=1:(s._itemsPerBar=Math.floor(t.maxItemsContainerContentSize/t.containerCrossSize),s.maximumRowsOrColumns&&(s._itemsPerBar=Math.min(s._itemsPerBar,s.maximumRowsOrColumns)),s._itemsPerBar=Math.max(1,s._itemsPerBar)),s._createContainerStyleRule()}),i.done(function(){s._ensuringContainerSize=null},function(){s._ensuringContainerSize=null}),i},_indexToCoordinate:function(e,t){t=t||this._itemsPerBar;var i=Math.floor(e/t);return this._horizontal?{column:i,row:e-i*t}:{row:i,column:e-i*t}},_rangeForGroup:function(e,t){var i=e.startIndex,n=i+e.count-1;return!t||t.firstIndex>n||t.lastIndex<i?null:{firstIndex:Math.max(0,t.firstIndex-i),lastIndex:Math.min(e.count-1,t.lastIndex-i)}},_syncDomWithGroupHeaderPosition:function(e){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var t,i=e.length;if(this._oldGroupHeaderPosition===J.top)if(c.removeClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)e[t].header.style.maxWidth="",c.removeClass(e[t].itemsContainer.element,p._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===J.left){if(c.removeClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)e[t].header.style.maxHeight="",c.removeClass(e[t].itemsContainer.element,p._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===J.top){if(c.addClass(this._site.surface,p._headerPositionTopClass),this._horizontal)for(t=0;i>t;t++)c.addClass(e[t].itemsContainer.element,p._groupLeaderClass)}else if(c.addClass(this._site.surface,p._headerPositionLeftClass),!this._horizontal)for(t=0;i>t;t++)c.addClass(e[t].itemsContainer.element,p._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(e){var t=this._groups[e],i=this._site.tree[e],n=i.header,s=i.itemsContainer.element,o=this._sizes,r=t.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===J.top){var a=o.headerContainerMinWidth-o.headerContainerOuterWidth,l=t.getItemsContainerSize()-o.headerContainerOuterWidth;n.style.maxWidth=Math.max(a,l)+"px",this._envInfo.supportsCSSGrid?(n.style.msGridColumn=e+1,s.style.msGridColumn=e+1):(n.style.height=o.headerContainerHeight-o.headerContainerOuterHeight+"px",s.style.height=r-o.itemsContainerOuterHeight+"px",s.style.marginBottom=o.itemsContainerMargins.bottom+(o.maxItemsContainerContentSize-r+o.itemsContainerOuterHeight)+"px"),c.addClass(s,p._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(n.style.msGridColumn=2*e+1,s.style.msGridColumn=2*e+2):(n.style.width=o.headerContainerWidth-o.headerContainerOuterWidth+"px",n.style.height=r-o.headerContainerOuterHeight+"px",s.style.height=r-o.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===J.left){var h=o.headerContainerMinHeight-o.headerContainerOuterHeight,d=t.getItemsContainerSize()-o.headerContainerOuterHeight;n.style.maxHeight=Math.max(h,d)+"px",this._envInfo.supportsCSSGrid?(n.style.msGridRow=e+1,s.style.msGridRow=e+1):(n.style.width=o.headerContainerWidth-o.headerContainerOuterWidth+"px",s.style.width=r-o.itemsContainerOuterWidth+"px",s.style["margin"+(this._site.rtl?"Left":"Right")]=o.itemsContainerMargins[this._site.rtl?"left":"right"]+(o.maxItemsContainerContentSize-r+o.itemsContainerOuterWidth)+"px"),c.addClass(s,p._groupLeaderClass)}else n.style.msGridRow=2*e+1,this._inListMode?n.style.height=o.headerContainerHeight-o.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?s.style.msGridRow=2*e+2:(n.style.height=o.headerContainerHeight-o.headerContainerOuterHeight+"px",n.style.width=r-o.headerContainerOuterWidth+"px",s.style.width=r-o.itemsContainerOuterWidth+"px");c.addClass(n,p._laidOutClass+" "+p._groupLeaderClass)}c.addClass(s,p._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(e){if(c._deprecated(f.disableBackdropIsDeprecated),e=!!e,this._backdropDisabled!==e&&(this._backdropDisabled=e,this._disableBackdropClassName&&(C(this._disableBackdropClassName),this._site&&c.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=g("disablebackdrop"),this._site&&c.addClass(this._site.surface,this._disableBackdropClassName),e)){var t=".win-container.win-backdrop",i="background-color:transparent;";y(this._disableBackdropClassName,this._site,t,i)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(e){if(c._deprecated(f.backdropColorIsDeprecated),e&&this._backdropColor!==e){this._backdropColor=e,this._backdropColorClassName&&(C(this._backdropColorClassName),this._site&&c.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=g("backdropcolor"),this._site&&c.addClass(this._site.surface,this._backdropColorClassName);var t=".win-container.win-backdrop",i="background-color:"+e+";";y(this._backdropColorClassName,this._site,t,i)}}}})}),GridLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LegacyLayout,function(e){e=e||{},this.itemInfo=e.itemInfo,this.groupInfo=e.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=e.groupHeaderPosition||J.top,this.orientation=e.orientation||"horizontal",e.maxRows&&(this.maxRows=+e.maxRows),e.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+e.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(e){this._setMaxRowsOrColumns(e)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(e){c._deprecated(f.maxRowsIsDeprecated),this.maximumRowsOrColumns=e}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(e){e&&c._deprecated(f.itemInfoIsDeprecated),this._itemInfo=e,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(e){e&&c._deprecated(f.groupInfoIsDeprecated),this._groupInfo=e,this._invalidateLayout()}}})})});var q=i.Namespace.defineWithParent(null,null,{UniformGroupBase:i.Namespace._lazy(function(){return i.Class.define(null,{cleanUp:function(){},itemFromOffset:function(e,t){t=t||{};var i=this._layout._sizes;e-=i.itemsContainerOuterStart,t.wholeItem&&(e+=(t.last?-1:1)*(i.containerSize-1));var n=this.count-1,s=Math.floor(n/this._layout._itemsPerBar),o=w(0,s,Math.floor(e/i.containerSize)),r=(o+t.last)*this._layout._itemsPerBar-t.last;return w(0,this.count-1,r)},hitTest:function(e,t){var i=this._layout._horizontal,n=this._layout._itemsPerBar,s=this._layout._inListMode||1===n,o=i?e:t,r=i?t:e,a=this._layout._sizes;o-=a.itemsContainerOuterStart,r-=a.itemsContainerOuterCrossStart;var l,h=Math.floor(o/a.containerSize),d=w(0,n-1,Math.floor(r/a.containerCrossSize)),u=Math.max(-1,h*n+d);if(l=!i&&s||i&&!s?(t-a.containerHeight/2)/a.containerHeight:(e-a.containerWidth/2)/a.containerWidth,s)return l=Math.floor(l),{index:u,insertAfterIndex:l>=0&&u>=0?l:-1};l=w(-1,n-1,l);var c;return c=0>l?h*n-1:h*n+Math.floor(l),{index:w(-1,this.count-1,u),insertAfterIndex:w(-1,this.count-1,c)}},getAdjacent:function(e,t){var i,n=e.index,s=Math.floor(n/this._layout._itemsPerBar),o=n%this._layout._itemsPerBar;switch(t){case O.upArrow:i=0===o?"boundary":n-1;break;case O.downArrow:var r=n===this.count-1,a=this._layout._itemsPerBar>1&&o===this._layout._itemsPerBar-1;i=r||a?"boundary":n+1;break;case O.leftArrow:i=0===s&&this._layout._itemsPerBar>1?"boundary":n-this._layout._itemsPerBar;break;case O.rightArrow:var l=this.count-1,h=Math.floor(l/this._layout._itemsPerBar);i=s===h?"boundary":Math.min(n+this._layout._itemsPerBar,this.count-1)}return"boundary"===i?i:{type:m.ObjectType.item,index:i}},getItemsContainerSize:function(){var e=this._layout._sizes,t=Math.ceil(this.count/this._layout._itemsPerBar);return t*e.containerSize+e.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var e=this._layout._sizes;return this._layout._itemsPerBar*e.containerCrossSize+e.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(e){var t=this._layout._sizes,i=this._layout._site.rtl?"right":"left",n=this._layout._sizes.containerMargins,s=this._layout._indexToCoordinate(e),o={row:s.row,column:s.column,top:n.top+s.row*t.containerHeight,left:n[i]+s.column*t.containerWidth,height:t.containerHeight-t.containerMargins.top-t.containerMargins.bottom,width:t.containerWidth-t.containerMargins.left-t.containerMargins.right};return o}})}),UniformGroup:i.Namespace._lazy(function(){return i.Class.derive(q.UniformGroupBase,function(e,t){this._layout=e,this._itemsContainer=t,c.addClass(this._itemsContainer,e._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(e){e||(c.removeClass(this._itemsContainer,p._uniformGridLayoutClass),c.removeClass(this._itemsContainer,p._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(e,t,i,n){return this.groupInfo=n.groupInfo,this.startIndex=n.startIndex,this.count=e,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var e=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-e.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?e.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*e.containerCrossSize+"px"},layoutUnrealizedRange:function(){return l.wrap()}})}),UniformFlowGroup:i.Namespace._lazy(function(){return i.Class.derive(q.UniformGroupBase,function(e,t){this._layout=e,this._itemsContainer=t.element,c.addClass(this._itemsContainer,e._inListMode?p._uniformListLayoutClass:p._uniformGridLayoutClass)},{cleanUp:function(e){e||(c.removeClass(this._itemsContainer,p._uniformListLayoutClass),c.removeClass(this._itemsContainer,p._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:i.Namespace._lazy(function(){return i.Class.define(function(e,t){
this._layout=e,this._itemsContainer=t,c.addClass(this._itemsContainer,p._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(e){e||(this._cleanContainers(),c.removeClass(this._itemsContainer,p._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(e,t,i,n){var s,o=this;if(this._containersToHide={},t)for(s=t.firstIndex;s<=t.lastIndex;s++)this._containersToHide[B(i._items[s])]=i._items[s];this.groupInfo=n.groupInfo,this.startIndex=n.startIndex,this.count=e.items.length,this._items=e.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var r=new Array(this.count);for(s=0;s<this.count;s++)r[s]=this._layout._getItemInfo(this.startIndex+s);return l.join(r).then(function(e){e.forEach(function(e,t){o.addItemToMap(t,e)})})},layoutRealizedRange:function(e,t){if(t){var i,n=Math.max(e,t.firstIndex);for(i=n;i<=t.lastIndex;i++)this._layoutItem(i),delete this._containersToHide[B(this._items[i])]}Object.keys(this._containersToHide).forEach(function(e){c.removeClass(this._containersToHide[e],p._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(e,t,i){var n,s=this;return s._layoutPromise=new l(function(o){function r(){n=null,o()}function a(e){return h.schedule(e,h.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(t){var l=!1,d=t.firstIndex-1,u=Math.max(e,t.lastIndex+1);u=Math.max(d+1,u),n=a(function _(t){for(;!l;){if(t.shouldYield)return void t.setWork(_);l=!0,d>=e&&(s._layoutItem(d),d--,l=!1),u<s.count&&(s._layoutItem(u),u++,l=!1)}r()})}else if(i){var c=s.count-1;n=a(function m(t){for(;c>=e;c--){if(t.shouldYield)return void t.setWork(m);s._layoutItem(c)}r()})}else{var c=e;n=a(function p(e){for(;c<s.count;c++){if(e.shouldYield)return void e.setWork(p);s._layoutItem(c)}r()})}},function(){n&&n.cancel(),n=null}),s._layoutPromise},itemFromOffset:function(e,t){t=t||{};var i=this._layout._sizes,n=i.containerMargins;e-=i.itemsContainerOuterX,e-=(t.last?1:-1)*n[t.last?"left":"right"];var s=this.indexFromOffset(e,t.wholeItem,t.last).item;return w(0,this.count-1,s)},getAdjacent:function(e,t){var i,n;i=n=e.index;var s,o,r;r=this.lastAdjacent===i?this.lastInMapIndex:this.findItem(i);do{var a=Math.floor(r/this._slotsPerColumn),l=r-a*this._slotsPerColumn,h=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(t){case O.upArrow:if(!(l>0))return{type:m.ObjectType.item,index:n};r--;break;case O.downArrow:if(!(l+1<this._slotsPerColumn))return{type:m.ObjectType.item,index:n};r++;break;case O.leftArrow:r=a>0?r-this._slotsPerColumn:-1;break;case O.rightArrow:r=h>a?r+this._slotsPerColumn:this.occupancyMap.length}o=r>=0&&r<this.occupancyMap.length,o&&(s=this.occupancyMap[r]?this.occupancyMap[r].index:void 0)}while(o&&(i===s||void 0===s));return this.lastAdjacent=s,this.lastInMapIndex=r,o?{type:m.ObjectType.item,index:s}:"boundary"},hitTest:function(e,t){var i=this._layout._sizes,n=0;if(e-=i.itemsContainerOuterX,t-=i.itemsContainerOuterY,this.occupancyMap.length>0){for(var s=this.indexFromOffset(e,!1,0),o=Math.min(this._slotsPerColumn-1,Math.floor(t/this.groupInfo.cellHeight)),r=s.index,a=r;o-->0;)r++,this.occupancyMap[r]&&(a=r);this.occupancyMap[a]||a--,n=this.occupancyMap[a].index}var l=this.getItemSize(n),h=l.column*this.groupInfo.cellWidth,d=l.row*this.groupInfo.cellHeight,u=1===this._slotsPerColumn,c=n;return(u&&e<h+l.contentWidth/2||!u&&t<d+l.contentHeight/2)&&c--,{type:m.ObjectType.item,index:w(0,this.count-1,n),insertAfterIndex:w(-1,this.count-1,c)}},getItemsContainerSize:function(){var e=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+e.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var e=this._layout._sizes;return e.maxItemsContainerContentSize+e.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(e){var t=this._layout._site.rtl?"right":"left",i=this._layout._sizes.containerMargins,n=this.getItemSize(e),s=this.groupInfo,o={row:n.row,column:n.column,top:i.top+n.row*s.cellHeight,left:i[t]+n.column*s.cellWidth,height:n.contentHeight,width:n.contentWidth};return o},_layoutItem:function(e){var t=this.getItemSize(e);return this._items[e].style.cssText+=";-ms-grid-row:"+(t.row+1)+";-ms-grid-column:"+(t.column+1)+";-ms-grid-row-span:"+t.rows+";-ms-grid-column-span:"+t.columns+";height:"+t.contentHeight+"px;width:"+t.contentWidth+"px",c.addClass(this._items[e],p._laidOutClass),this._items[e]},_cleanContainers:function(){var e,t=this._items,i=t.length;for(e=0;i>e;e++)t[e].style.cssText="",c.removeClass(t[e],p._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var e=-1;return this.occupancyMap.forEach(function(t){t.index>e&&(e=t.index)}),e+1},coordinateToIndex:function(e,t){return e*this._slotsPerColumn+t},markSlotAsFull:function(e,t){for(var i=this._layout._indexToCoordinate(e,this._slotsPerColumn),n=i.row+t.rows,s=i.row;n>s&&s<this._slotsPerColumn;s++)for(var o=i.column,r=i.column+t.columns;r>o;o++)this.occupancyMap[this.coordinateToIndex(o,s)]=t;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,n-this._slotsPerColumn)},isSlotEmpty:function(e,t,i){for(var n=t,s=t+e.rows;s>n;n++)for(var o=i,r=i+e.columns;r>o;o++)if(n>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(o,n)])return!1;return!0},findEmptySlot:function(e,t,i){var n=this._layout._indexToCoordinate(e,this._slotsPerColumn),s=n.row,o=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(i){for(var r=n.column+1;o>=r;r++)if(this.isSlotEmpty(t,0,r))return this.coordinateToIndex(r,0)}else for(var r=n.column;o>=r;r++){for(var a=s;a<this._slotsPerColumn;a++)if(this.isSlotEmpty(t,a,r))return this.coordinateToIndex(r,a);s=0}return(o+1)*this._slotsPerColumn},findItem:function(e){for(var t=e,i=this.occupancyMap.length;i>t;t++){var n=this.occupancyMap[t];if(n&&n.index===e)return t}return t},getItemSize:function(e){var t=this.findItem(e),i=this.occupancyMap[t],n=this._layout._indexToCoordinate(t,this._slotsPerColumn);return e===i.index?{row:n.row,column:n.column,contentWidth:i.contentWidth,contentHeight:i.contentHeight,columns:i.columns,rows:i.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(e,t){function i(e,t){var i=n.findEmptySlot(n.lastAdded,e,t);n.lastAdded=i,n.markSlotAsFull(i,e)}var n=this,s=n.groupInfo,o=n._layout._sizes.containerMargins,r={index:e,contentWidth:t.width,contentHeight:t.height,columns:Math.max(1,Math.ceil((t.width+o.left+o.right)/s.cellWidth)),rows:Math.max(1,Math.ceil((t.height+o.top+o.bottom)/s.cellHeight))};i(r,t.newColumn)},indexFromOffset:function(e,t,i){var n=0,s=0,o=this.groupInfo,r=0;if(this.occupancyMap.length>0){if(s=this.getOccupancyMapItemCount()-1,n=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*o.cellWidth,n>e){for(var a=this._slotsPerColumn,r=(Math.max(0,Math.floor(e/o.cellWidth))+i)*this._slotsPerColumn-i;!this.occupancyMap[r]&&a-->0;)r+=i>0?-1:1;return{index:r,item:this.occupancyMap[r].index}}r=this.occupancyMap.length-1}return{index:r,item:s+(Math.max(0,Math.floor((e-n)/o.cellWidth))+i)*this._slotsPerColumn-i}}})})});i.Namespace._moduleDefine(e,"WinJS.UI",{ListLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LegacyLayout,function(e){e=e||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=e.groupHeaderPosition||J.top,this._inListMode=!0,this.orientation=e.orientation||"vertical"},{initialize:function(t,i){c.addClass(t.surface,p._listLayoutClass),e._LegacyLayout.prototype.initialize.call(this,t,i)},uninitialize:function(){this._site&&c.removeClass(this._site.surface,p._listLayoutClass),e._LegacyLayout.prototype.uninitialize.call(this)},layout:function(t,i,n,s){return this._groupsEnabled||this._horizontal?e._LegacyLayout.prototype.layout.call(this,t,i,n,s):this._layoutNonGroupedVerticalList(t,i,n,s)},_layoutNonGroupedVerticalList:function(e,t,i,n){var s=this,o="Layout:_layoutNonGroupedVerticalList";return s._site._writeProfilerMark(o+",StartTM"),this._layoutPromise=s._measureItem(0).then(function(){c[s._usingStructuralNodes?"addClass":"removeClass"](s._site.surface,p._structuralNodesClass),c[s._envInfo.nestedFlexTooLarge||s._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](s._site.surface,p._singleItemsBlockClass),s._sizes.viewportContentSize!==s._getViewportCrossSize()&&s._viewportSizeChanged(s._getViewportCrossSize()),s._cacheRemovedElements(i,s._cachedItemRecords,s._cachedInsertedItemRecords,s._cachedRemovedItems,!1),s._cacheRemovedElements(n,s._cachedHeaderRecords,s._cachedInsertedHeaderRecords,s._cachedRemovedHeaders,!0);var t=e[0].itemsContainer,r=new q.UniformFlowGroup(s,t);s._groups=[r],r.groupInfo={enableCellSpanning:!1},r.startIndex=0,r.count=T(t),r.offset=0,r.layout(),s._site._writeProfilerMark(o+":setSurfaceWidth,info"),s._site.surface.style.width=s._sizes.surfaceContentSize+"px",s._layoutAnimations(i,n),s._site._writeProfilerMark(o+":complete,info"),s._site._writeProfilerMark(o+",StopTM")},function(e){return s._site._writeProfilerMark(o+":canceled,info"),s._site._writeProfilerMark(o+",StopTM"),l.wrapError(e)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){var t=this;return this._measureItem(0).then(function(){return t._envInfo.nestedFlexTooLarge||t._envInfo.nestedFlexTooSmall?(t._usingStructuralNodes=!0,Number.MAX_VALUE):(t._usingStructuralNodes=e.ListLayout._numberOfItemsPerItemsBlock>0,e.ListLayout._numberOfItemsPerItemsBlock)})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:i.Namespace._lazy(function(){return i.Class.derive(e._LayoutCommon,function(e){e=e||{},this._itemInfo=e.itemInfo,this._groupInfo=e.groupInfo,this._groupHeaderPosition=e.groupHeaderPosition||J.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(e){this._setMaxRowsOrColumns(e)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(e){this._itemInfo=e,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(e){this._groupInfo=e,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:i.Namespace._lazy(function(){return i.Class.define(function(e){this.defaultAnimations=!0,this.initialize=function(t,i){e.initialize(t,i)},this.hitTest=function(t,i){return e.hitTest(t,i)},e.uninitialize&&(this.uninitialize=function(){e.uninitialize()}),"numberOfItemsPerItemsBlock"in e&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return e.numberOfItemsPerItemsBlock}}),e._getItemPosition&&(this._getItemPosition=function(t){return e._getItemPosition(t)}),e.itemsFromRange&&(this.itemsFromRange=function(t,i){return e.itemsFromRange(t,i)}),e.getAdjacent&&(this.getAdjacent=function(t,i){return e.getAdjacent(t,i)}),e.dragOver&&(this.dragOver=function(t,i,n){return e.dragOver(t,i,n)}),e.dragLeave&&(this.dragLeave=function(){return e.dragLeave()});var t={enumerable:!0,get:function(){return"vertical"}};if(void 0!==e.orientation&&(t.get=function(){return e.orientation},t.set=function(t){e.orientation=t}),Object.defineProperty(this,"orientation",t),(e.setupAnimations||e.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return e.setupAnimations()},this.executeAnimations=function(){return e.executeAnimations()}),e.layout)if(this.defaultAnimations){var i=this;this.layout=function(t,n,s,o){var r,a=D(e.layout(t,n,[],[]));return a.realizedRangeComplete.then(function(){r=!0}),r&&i._layoutAnimations(s,o),a}}else this.layout=function(t,i,n,s){return D(e.layout(t,i,n,s))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(e,t,i,n){return this.defaultAnimations&&this._layoutAnimations(i,n),D()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(e,t){switch(t){case O.pageUp:case O.upArrow:case O.leftArrow:return{type:e.type,index:e.index-1};case O.downArrow:case O.rightArrow:case O.pageDown:return{type:e.type,index:e.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})});var J={left:"left",top:"top"};i.Namespace._moduleDefine(e,"WinJS.UI",{HeaderPosition:J,_getMargins:A})}),n("WinJS/Controls/ListView/_VirtualizeContentsView",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_Helpers","./_ItemsContainer"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m){"use strict";function p(e,t){l._setAttribute(e,"aria-flowto",t.id),l._setAttribute(t,"x-ms-aria-flowfrom",e.id)}i.Namespace._moduleDefine(e,"WinJS.UI",{_VirtualizeContentsView:i.Namespace._lazy(function(){function e(t){for(var i,n=t.job._workItems;n.length&&!t.shouldYield;)(i=n.shift())();t.setWork(e),n.length||t.job.pause()}function f(t,i){var n=r.schedule(e,t,null,i);return n._workItems=[],n.addWork=function(e,t){t?this._workItems.unshift(e):this._workItems.push(e),this.resume()},n.clearWork=function(){this._workItems.length=0},n.dispose=function(){this.cancel(),this._workItems.length=0},n}function g(e){return e._zooming||e._pinching}function v(e,t){return e._isZombie()?s.wrap():g(e)?(+t!==t&&(t=w._waitForSeZoTimeoutDuration),s.timeout(w._waitForSeZoIntervalDuration).then(function(){return t-=w._waitForSeZoIntervalDuration,0>=t?!0:v(e,t)})):s.wrap()}function y(e){if("number"==typeof e){var t=e;e=function(){return{position:t,direction:"right"}}}return e}function C(){}var w=i.Class.define(function(e){this._listView=e,this._forceRelayout=!1,this.maxLeadingPages=n._isiOS?w._iOSMaxLeadingPages:w._defaultPagesToPrefetch,this.maxTrailingPages=n._isiOS?w._iOSMaxTrailingPages:w._defaultPagesToPrefetch,this.items=new m._ItemsContainer(e),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=s.wrap(),this._state=new b(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=f(r.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=f(r.Priority.normal,"front off-screen items"),this._backOffscreenJob=f(r.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=y(0)},{_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(e,t,i,n){this._listView._writeProfilerMark("createItem("+e+") "+this._getBoundingRectString(e)+",info");var o=this;o._listView._itemsManager._itemFromItemPromiseThrottled(t).done(function(t){t?i(e,t,o._listView._itemsManager._recordFromElement(t)):n(e)},function(t){return n(e),s.wrapError(t)})},_addItem:function(e,t,i,n){if(this._realizePass===n){var s=this._listView._itemsManager._recordFromElement(i);delete this._pendingItemPromises[s.itemPromise.handle],this.items.setItemAt(t,{itemBox:null,container:null,element:i,detached:!0,itemsManagerRecord:s})}},lastItemIndex:function(){return this.containers?this.containers.length-1:-1},_setSkipRealizationForChange:function(e){e?this._realizationLevel!==w._realizationLevel.realize&&(this._realizationLevel=w._realizationLevel.skip):this._realizationLevel=w._realizationLevel.realize},_realizeItems:function(e,t,i,n,a,h,d,_,m,p){function f(e,t){M.push(s._cancelBlocker(t.renderComplete)),C(e)}function g(e,t){function i(e,t){e.updatedDraggableAttribute||!A._listView.itemsDraggable&&!A._listView.itemsReorderable||e.itemsManagerRecord.renderComplete.done(function(){A._realizePass===a&&(l.hasClass(t,u._nonDraggableClass)||(e.itemBox.draggable=!0),e.updatedDraggableAttribute=!0)})}if(A._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!A._listView._isZombie()){var n,s=0,o=-1,r=-1;for(n=e;t>=n;n++){var h=A.items.itemDataAt(n);if(h){var _=h.element,m=h.itemBox;m||(m=A._listView._itemBoxTemplate.cloneNode(!0),h.itemBox=m,m.appendChild(_),l.addClass(_,u._itemClass),A._listView._setupAriaSelectionObserver(_),A._listView._isSelected(n)&&c._ItemEventsHandler.renderSelection(m,_,!0,!0),A._listView._currentMode().renderDragSourceOnRealizedItem(n,m)),i(h,_);var p=A.getContainer(n);m.parentNode!==p&&(h.container=p,A._appendAndRestoreFocus(p,m),s++,0>o&&(o=n),r=n,A._listView._isSelected(n)&&l.addClass(p,u._selectedClass),l.removeClass(p,u._backdropClass),A.items.elementAvailable(n))}}A._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),s>0&&(A._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+s+" ("+o+"-"+r+"),info"),A._reportElementsLevel(d))}}function v(e,t,i,n){function s(e,t){var i=A.items.itemDataAt(e);if(i){var n=i.itemBox;return n&&n.parentNode?t?(l.addClass(n.parentNode,u._backdropClass),n.parentNode.removeChild(n),!0):!1:!0}return!0}if(!p){for(var o=!1;e>=i;)o=s(e,o),e--;for(o=!1;n>=t;)o=s(t,o),t++}}function y(e,t,i,n,o){function r(e){var t=A.items.itemDataAt(e);if(t){var n=t.itemsManagerRecord;n.readyComplete||A._realizePass!==a||i.addWork(function(){A._listView._isZombie()||n.pendingReady&&A._realizePass===a&&(A._listView._writeProfilerMark("pendingReady("+e+"),info"),n.pendingReady())},o)}}for(var l=[],h=e;t>=h;h++){var d=A.items.itemDataAt(h);d&&l.push(d.itemsManagerRecord.itemPromise)}s.join(l).then(function(){if("right"===n)for(var i=e;t>=i;i++)r(i);else for(var i=t;i>=e;i--)r(i)})}function C(e){if(A._realizePass===a){if(e>=_&&m>=e){if(0===--x){if(g(_,m),v(_,m,t,i),A._firstLayoutPass){y(_,m,A._frontOffscreenJob,"right"===d?"left":"right",!0);var n=r.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!A._listView._isZombie()){A._listView._writeProfilerMark("entranceAnimation,StartTM");var e=A._listView._animateListEntrance(!A._firstEntranceAnimated);return A._firstEntranceAnimated=!0,e}});A._runningAnimations=s.join([A._runningAnimations,n]),A._runningAnimations.done(function(){A._listView._writeProfilerMark("entranceAnimation,StopTM"),A._realizePass===a&&(A._runningAnimations=null,T.complete())}),A._firstLayoutPass=!1,A._listView._isCurrentZoomView&&r.requestDrain(A._onscreenJob.priority)}else y(_,m,A._frontOffscreenJob,d),T.complete();A._updateHeaders(A._listView._canvas,_,m+1).done(function(){k.complete()})}}else _>e?(--P,P%S===0&&g(t,_-1),P||(A._updateHeaders(A._listView._canvas,t,_).done(function(){"right"!==d&&D.complete()}),y(t,_-1,"right"!==d?A._frontOffscreenJob:A._backOffscreenJob,"left"))):e>m&&(--E,E%S===0&&g(m+1,i-1),E||(A._updateHeaders(A._listView._canvas,m+1,i).then(function(){"right"===d&&D.complete()}),y(m+1,i-1,"right"===d?A._frontOffscreenJob:A._backOffscreenJob,"right")));I--,0===I&&(A._renderCompletePromise=s.join(M).then(null,function(e){var t=Array.isArray(e)&&e.some(function(e){return e&&!(e instanceof Error&&"Canceled"===e.name)});return t?s.wrapError(e):void 0}),(A._headerRenderPromises||s.wrap()).done(function(){r.schedule(function(){A._listView._isZombie()?F.cancel():F.complete()},Math.min(A._onscreenJob.priority,A._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function w(t,i,n){if(A._realizePass===a){var i=n.element;A._addItem(e,t,i,a),f(t,n)}}var b="_realizeItems("+t+"-"+(i-1)+") visible("+_+"-"+m+")";this._listView._writeProfilerMark(b+",StartTM"),d=d||"right";var I=i-t,S=m-_+1,x=S,E=i-m-1,P=_-t,M=[],T=new o,k=new o,D=new o,A=this;if(I>0){var O=0,B=0,L=0;A.firstIndexDisplayed=_,A.lastIndexDisplayed=m;var R=A._listView._isCurrentZoomView;A._highPriorityRealize&&(A._firstLayoutPass||A._hasAnimationInViewportPending)?(A._highPriorityRealize=!1,A._onscreenJob.priority=r.Priority.high,A._frontOffscreenJob.priority=r.Priority.normal,A._backOffscreenJob.priority=r.Priority.belowNormal):A._highPriorityRealize?(A._highPriorityRealize=!1,A._onscreenJob.priority=r.Priority.high,A._frontOffscreenJob.priority=r.Priority.high-1,A._backOffscreenJob.priority=r.Priority.high-1):R?(A._onscreenJob.priority=r.Priority.aboveNormal,A._frontOffscreenJob.priority=r.Priority.normal,A._backOffscreenJob.priority=r.Priority.belowNormal):(A._onscreenJob.priority=r.Priority.belowNormal,A._frontOffscreenJob.priority=r.Priority.idle,A._backOffscreenJob.priority=r.Priority.idle);var F=new o,z=A._listView._versionManager.cancelOnNotification(F.promise),H=function(e,t){t.startStage1&&t.stage0.then(function(){A._realizePass===a&&t.startStage1&&e.addWork(t.startStage1)})},N=function(e,t){var i=A.items.itemDataAt(t);if(!i){var n=A._listView._itemsManager._itemPromiseAtIndex(t);A._pendingItemPromises[n.handle]=n,delete A._previousRealizationPendingItemPromises[n.handle],e.addWork(function(){if(!A._listView._isZombie()&&(O++,A._createItem(t,n,w,C),!A._listView._isZombie()&&A._realizePass===a&&n.handle)){var i=A._listView._itemsManager._recordFromHandle(n.handle);H(e,i)}})}},W=function(e,t,i){for(var n=t;i>=n;n++)N(e,n)},V=function(e,t,i){for(var n=i;n>=t;n--)N(e,n)},U=function(e,t,i){for(var n=t;i>=n;n++){var s=A.items.itemDataAt(n);if(s){var o=s.itemsManagerRecord;f(n,o),B++,H(e,o)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var j;"left"===d?(V(A._onscreenJob,_,m),V(A._frontOffscreenJob,t,_-1),j=t>_-1):(W(A._onscreenJob,_,m),W(A._frontOffscreenJob,m+1,i-1),j=m+1>i-1);for(var q=0,J=Object.keys(this._previousRealizationPendingItemPromises),K=J.length;K>q;q++){var G=J[q];A._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[G])}this._previousRealizationPendingItemPromises={},U(A._onscreenJob,_,m),"left"===d?U(A._frontOffscreenJob,t,_-1):U(A._frontOffscreenJob,m+1,i-1);var Z=x===m-_+1;return A._firstLayoutPass?A._listView._canvas.style.opacity=0:Z?A._listView._showProgressBar(A._listView._element,"50%","50%"):A._listView._hideProgressBar(),A._frontOffscreenJob.pause(),A._backOffscreenJob.pause(),k.promise.done(function(){A._frontOffscreenJob.resume(),j&&D.complete()},function(){F.cancel()}),D.promise.done(function(){A._listView._writeProfilerMark("frontItemsRealized,info"),"left"===d?(W(A._backOffscreenJob,m+1,i-1),U(A._backOffscreenJob,m+1,i-1)):(V(A._backOffscreenJob,t,_-1),U(A._backOffscreenJob,t,_-1)),A._backOffscreenJob.resume()}),F.promise.done(function(){A._listView._versionManager.clearCancelOnNotification(z),A._listView._writeProfilerMark(b+" complete(created:"+O+" updated:"+B+"),info")},function(e){return A._listView._versionManager.clearCancelOnNotification(z),A._onscreenJob.clearWork(),A._frontOffscreenJob.clearWork(),A._backOffscreenJob.clearWork(),T.cancel(),k.cancel(),A._listView._writeProfilerMark(b+" canceled(created:"+O+" updated:"+B+" clean:"+L+"),info"),s.wrapError(e)}),A._listView._writeProfilerMark(b+",StopTM"),{viewportItemsRealized:k.promise,allItemsRealized:F.promise,loadingCompleted:s.join([F.promise,T.promise]).then(function(){for(var e=[],n=t;i>n;n++){var o=A.items.itemDataAt(n);o&&e.push(o.itemsManagerRecord.itemReadyPromise)}return s._cancelBlocker(s.join(e))})}}return A._listView._writeProfilerMark(b+",StopTM"),{viewportItemsRealized:s.wrap(),allItemsRealized:s.wrap(),loadingCompleted:s.wrap()}},_setAnimationInViewportState:function(e){if(this._hasAnimationInViewportPending=!1,e&&e.length>0)for(var t=this._listView._getViewportLength(),i=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+t-1),n=0,s=e.length;s>n;n++){var o=e[n];if(o.newIndex>=i.firstIndex&&o.newIndex<=i.lastIndex&&o.newIndex!==o.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(e,t){var i=this;return this._listView._groups.renderGroup(t).then(function(e){if(e){e.element.tabIndex=0;var n=i._getHeaderContainer(t);e.element.parentNode!==n&&(n.appendChild(e.element),l.addClass(e.element,u._headerClass)),i._listView._groups.setDomElement(t,e.element)}})},_updateHeaders:function(e,t,i){function n(t){var i=r._listView._groups.group(t);if(i&&!i.header){var n=i.headerPromise;return n||(n=i.headerPromise=r._addHeader(e,t),n.done(function(){i.headerPromise=null},function(){i.headerPromise=null})),n}return s.wrap()}function o(){r._headerRenderPromises=null}var r=this;this._listView._groups.removeElements();var a=this._listView._groups.groupFromItem(t),l=a,h=this._listView._groups.groupFromItem(i-1),d=[];if(null!==l)for(;h>=l;l++)d.push(n(l));return this._headerRenderPromises=s.join(d,this._headerRenderPromises).then(o,o),this._headerRenderPromises||s.wrap()},_unrealizeItem:function(e){var t,i=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+e+"),info");var n=i._selection._getFocused();n.type===d.ObjectType.item&&n.index===e&&(i._unsetFocusOnItem(),t=!0);var s=this.items.itemDataAt(e),o=s.element,r=s.itemBox;r&&r.parentNode&&(l.removeClass(r.parentNode,u._selectedClass),l.removeClass(r.parentNode,u._footprintClass),l.addClass(r.parentNode,u._backdropClass),r.parentNode.removeChild(r)),s.container=null,i._currentMode().itemUnrealized&&i._currentMode().itemUnrealized(e,r),this.items.removeItem(e),s.removed||i._itemsManager.releaseItem(o),a._disposeElement(o),t&&i._setFocusOnItem(i._selection._getFocused())},_unrealizeGroup:function(e){var t,i=e.header,n=this._listView._selection._getFocused();n.type===d.ObjectType.groupHeader&&this._listView._groups.group(n.index)===e&&(this._listView._unsetFocusOnItem(),t=!0),i.parentNode&&i.parentNode.removeChild(i),a._disposeElement(i),e.header=null,e.left=-1,e.top=-1,t&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(e){var t=this,i=0;this.items.eachIndex(function(n){return n<t.begin||n>=t.end?(t._unrealizeItem(n),e&&++i>=e):void 0});var n=this._listView._groups,s=n.groupFromItem(this.begin);if(null!==s)for(var o=n.groupFromItem(this.end-1),r=0,a=n.length();a>r;r++){var l=n.group(r);(s>r||r>o)&&l.header&&this._unrealizeGroup(l)}},_unrealizeExcessiveItems:function(){var e=this.items.count(),t=this.end-this.begin,i=t+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+e+") approved("+i+"),info"),e>i&&this._unrealizeItems(e-i)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var e=this;return v(this._listView).then(function(){function t(){e._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(e._listView._isZombie())return void t();var i=[];e.items.eachIndex(function(t){(t<e.begin||t>=e.end)&&i.push(t)}),e._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+i.length+"),info");var n=[],o=e._listView._groups,a=o.groupFromItem(e.begin);if(null!==a)for(var l=o.groupFromItem(e.end-1),h=0,d=o.length();d>h;h++){var u=o.group(h);(a>h||h>l)&&u.header&&n.push(u)}if(i.length||n.length){var c,_=new s(function(t){function s(o){if(!e._listView._isZombie()){for(var r=-1,a=-1,l=0,h=g(e._listView);i.length&&!h&&!o.shouldYield;){var d=i.shift();e._unrealizeItem(d),l++,0>r&&(r=d),a=d}for(e._listView._writeProfilerMark("unrealizeWorker removeItems:"+l+" ("+r+"-"+a+"),info");n.length&&!h&&!o.shouldYield;)e._unrealizeGroup(n.shift());i.length||n.length?h?o.setPromise(v(e._listView).then(function(){return s})):o.setWork(s):t()}}c=r.schedule(s,r.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return _.then(t,function(t){return c.cancel(),e._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),e._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),s.wrapError(t)})}return t(),s.wrap()})},_getBoundingRectString:function(e){var t;if(e>=0&&e<this.containers.length){var i=this._listView._layout._getItemPosition(e);i&&(t="["+i.left+"; "+i.top+"; "+i.width+"; "+i.height+" ]")}return t||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(e){function t(){n._listView._writeProfilerMark("aria work,StopTM")}function i(e){var t=n._listView._groups,i=t.group(e+1);return i?Math.min(i.startIndex-1,n.end-1):n.end-1}if(!this._listView._isZombie()){var n=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(o){if(!(o>0&&-1!==n.firstIndexDisplayed&&-1!==n.lastIndexDisplayed))return s.wrap();n._listView._writeProfilerMark("aria work,StartTM");var a,h,d,u,c,_,m=n._listView._ariaStartMarker,f=n._listView._ariaEndMarker,y=n.begin,C=n.items.itemAt(n.begin);return C?(l._ensureId(C),n._listView._groupsEnabled()?(h=n._listView._groups,d=u=h.groupFromItem(n.begin),c=h.group(u),_=i(u),l._ensureId(c.header),l._setAttribute(c.header,"role",n._listView._headerRole),l._setAttribute(c.header,"x-ms-aria-flowfrom",m.id),p(c.header,C),l._setAttribute(c.header,"tabindex",n._listView._tabIndex)):l._setAttribute(C,"x-ms-aria-flowfrom",m.id),new s(function(s){var m=e;a=r.schedule(function w(e){if(n._listView._isZombie())return void t();for(;y<n.end;y++){if(!m&&g(n._listView))return void e.setPromise(v(n._listView).then(function(e){return m=e,w}));if(e.shouldYield)return void e.setWork(w);C=n.items.itemAt(y);var r=n.items.itemAt(y+1);if(r&&l._ensureId(r),l._setAttribute(C,"role",n._listView._itemRole),l._setAttribute(C,"aria-setsize",o),l._setAttribute(C,"aria-posinset",y+1),l._setAttribute(C,"tabindex",n._listView._tabIndex),n._listView._groupsEnabled())if(y!==_&&r)p(C,r);else{var a=h.group(u+1);a&&a.header&&r?(l._setAttribute(a.header,"tabindex",n._listView._tabIndex),l._setAttribute(a.header,"role",n._listView._headerRole),l._ensureId(a.header),p(C,a.header),p(a.header,r)):l._setAttribute(C,"aria-flowto",f.id),u++,c=a,_=i(u)}else r?p(C,r):l._setAttribute(C,"aria-flowto",f.id);if(!r)break}n._listView._fireAccessibilityAnnotationCompleteEvent(n.begin,y,d,u-1),t(),s()},r.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){a.cancel(),t()})):void t()})}},_setupDeferredActions:function(){function e(){t._listView._isZombie()||(t.deferTimeout=null,t._listView._versionManager.clearCancelOnNotification(t.deferredActionCancelToken),t.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var t=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return s.timeout(u._DEFERRED_ACTION)}).then(function(){return v(t._listView)}).then(function(e){return t._setupAria(e)}).then(e,function(t){return e(),s.wrapError(t)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),
this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(e,t,i){function n(){return o.items.itemAt(t)}function s(){for(var e=i;e>=t;e--)if(o.items.itemAt(e))return o.items.itemAt(e);return null}var o=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var r,a,h=this._listView._ariaStartMarker,d=this._listView._ariaEndMarker;if(-1!==t&&-1!==i&&i>=t&&(r=n(),a=s()),!e&&r&&a){if(l._ensureId(r),l._ensureId(a),this._listView._groupsEnabled()){var u=this._listView._groups,c=u.group(u.groupFromItem(t));c.header&&(l._ensureId(c.header),t===c.startIndex?l._setAttribute(h,"aria-flowto",c.header.id):l._setAttribute(h,"aria-flowto",r.id))}else l._setAttribute(h,"aria-flowto",r.id);l._setAttribute(d,"x-ms-aria-flowfrom",a.id)}else p(h,d),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(e,t){if(e!==this._listView.header&&e!==this._listView.footer){var i=-1,n=d.ObjectType.item;l.hasClass(e,u._headerClass)?(i=this._listView._groups.index(e),n=d.ObjectType.groupHeader,l._setAttribute(e,"role",this._listView._headerRole),l._setAttribute(e,"tabindex",this._listView._tabIndex)):(i=this.items.index(e),l._setAttribute(e,"aria-setsize",t),l._setAttribute(e,"aria-posinset",i+1),l._setAttribute(e,"role",this._listView._itemRole),l._setAttribute(e,"tabindex",this._listView._tabIndex)),n===d.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,i,i):this._listView._fireAccessibilityAnnotationCompleteEvent(i,i,-1,-1)}},_reportElementsLevel:function(e){function t(e,t){for(var i=0,s=e;t>=s;s++){var o=n.itemDataAt(s);o&&o.container&&i++}return i}var i,n=this.items;i=Math.floor("right"===e?100*t(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed):100*t(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+i+"),info")},_createHeaderContainer:function(e){return this._createSurfaceChild(u._headerContainerClass,e)},_createItemsContainer:function(e){var i=this._createSurfaceChild(u._itemsContainerClass,e),n=t.document.createElement("div");return n.className=u._padderClass,i.appendChild(n),i},_ensureContainerInDOM:function(e){var t=this.containers[e];return t&&!this._listView._canvas.contains(t)?(this._forceItemsBlocksInDOM(e,e+1),!0):!1},_ensureItemsBlocksInDOM:function(e,t){if(this._expandedRange){var i=this._expandedRange.first.index,n=this._expandedRange.last.index+1;i>=e&&t>i?t=Math.max(t,n):n>e&&t>=n&&(e=Math.min(e,i))}this._forceItemsBlocksInDOM(e,t)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var e=this;return v(this._listView).then(function(){function t(){e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(e._listView._isZombie())return void t();if(e._expandedRange&&-1!==e.begin&&-1!==e.end&&(e._expandedRange.first.index<e.begin||e._expandedRange.last.index+1>e.end)){var i,n=new s(function(t){function n(i){if(!e._listView._isZombie()){for(var s=g(e._listView);e._expandedRange.first.index<e.begin&&!s&&!i.shouldYield;){var o=Math.min(e.begin,e._expandedRange.first.index+e._blockSize*w._blocksToRelease);e._forceItemsBlocksInDOM(o,e.end)}for(;e._expandedRange.last.index+1>e.end&&!s&&!i.shouldYield;){var r=Math.max(e.end,e._expandedRange.last.index-e._blockSize*w._blocksToRelease);e._forceItemsBlocksInDOM(e.begin,r)}e._expandedRange.first.index<e.begin||e._expandedRange.last.index+1>e.end?s?i.setPromise(v(e._listView).then(function(){return n})):i.setWork(n):t()}}i=r.schedule(n,r.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return n.then(t,function(t){return i.cancel(),e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),e._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),s.wrapError(t)})}return t(),s.wrap()})},_forceItemsBlocksInDOM:function(e,t){function i(e,t){var i=e.element.firstElementChild;i.style[f]=t}function n(e){for(var t=0;t<_.tree.length;t++)for(var i=_.tree[t].itemsContainer,n=0,s=i.itemsBlocks.length;s>n;n++)if(e(i,i.itemsBlocks[n]))return}function s(e){_._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),_._listView._itemsBlockExtent=l[_._listView._horizontal()?"getTotalWidth":"getTotalHeight"](e.element),_._listView._writeProfilerMark("_itemsBlockExtent("+_._listView._itemsBlockExtent+"),info"),_._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function o(){return-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize&&t.element.parentNode===e.element?(s(t),!0):!1}),-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize?(e.element.appendChild(t.element),s(t),e.element.removeChild(t.element),!0):!1}),_._listView._itemsBlockExtent}function r(e,t,i){function n(t){var i=e.itemsBlocks[t];i&&i.element.parentNode===e.element&&(e.element.removeChild(i.element),p++)}if(Array.isArray(t))t.forEach(n);else for(var s=t;i>s;s++)n(s)}function a(e,t,i){for(var n=e.element.firstElementChild,s=n,o=t;i>o;o++){var r=e.itemsBlocks[o];r&&(r.element.parentNode!==e.element&&(e.element.insertBefore(r.element,s.nextElementSibling),m++),s=r.element)}}function h(e){if(e<_.tree.length){_._listView._writeProfilerMark("collapseGroup("+e+"),info");var t=_.tree[e].itemsContainer;r(t,0,t.itemsBlocks.length),i(t,"")}}function d(e){if(e<_.tree.length){_._listView._writeProfilerMark("expandGroup("+e+"),info");var t=_.tree[e].itemsContainer;a(t,0,t.itemsBlocks.length),i(t,"")}}function u(e,t){function i(e,t){for(var i=[],n=e;t>=n;n++)i.push(n);return i}var n=t[0],s=t[1],o=e[0],r=e[1];return o>s||n>r?i(o,r):n>o&&r>s?i(o,n-1).concat(i(s+1,r)):n>o?i(o,n-1):r>s?i(s+1,r):null}if(this._blockSize){var c="_forceItemsBlocksInDOM begin("+e+") end("+t+"),";this._listView._writeProfilerMark(c+"StartTM");var _=this,m=0,p=0,f="padding"+(this._listView._horizontal()?"Left":"Top"),g=this._listView._groups.groupFromItem(e),v=this._listView._groups.groupFromItem(t-1),y=this._listView._groups.group(g),C=_.tree[g].itemsContainer,w=Math.floor((e-y.startIndex)/this._blockSize),b=this._listView._groups.group(v),I=_.tree[v].itemsContainer,S=Math.floor((t-1-b.startIndex)/this._blockSize);w&&-1===_._listView._itemsBlockExtent&&n(function(e,t){return t.items.length===_._blockSize&&t.element.parentNode===e.element?(s(t),!0):!1});var x=this._expandedRange?u([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[g,v]):null;if(x&&x.forEach(h),this._expandedRange&&this._expandedRange.first.groupKey===y.key){var E=u([this._expandedRange.first.block,Number.MAX_VALUE],[w,Number.MAX_VALUE]);E&&r(C,E)}else this._expandedRange&&g>=this._expandedRange.first.groupIndex&&g<=this._expandedRange.last.groupIndex&&r(C,0,w);if(g!==v?(a(C,w,C.itemsBlocks.length),a(I,0,S+1)):a(C,w,S+1),this._expandedRange&&this._expandedRange.last.groupKey===b.key){var E=u([0,this._expandedRange.last.block],[0,S]);E&&r(I,E)}else this._expandedRange&&v>=this._expandedRange.first.groupIndex&&v<=this._expandedRange.last.groupIndex&&r(I,S+1,I.itemsBlocks.length);i(C,w?w*o()+"px":""),g!==v&&i(I,"");for(var P=g+1;v>P;P++)d(P);this._expandedRange={first:{index:e,groupIndex:g,groupKey:y.key,block:w},last:{index:t-1,groupIndex:v,groupKey:b.key,block:S}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+g+"-"+v+") blocks("+w+"-"+S+") added("+m+") removed("+p+"),info"),this._listView._writeProfilerMark(c+"StopTM")}},_realizePageImpl:function(){var e=this,t="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(t+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){e._listView._isZombie()||e._listView._batchViewUpdates(u._ViewChange.realize,u._ScrollToPriority.low,e._listView.scrollPosition)}),this._listView._writeProfilerMark(t+",StopTM"),s.cancel):new s(function(i){function n(){i(),d.complete()}function r(){e._listView._hideProgressBar(),e._state.setLoadingState(e._listView._LoadingState.viewPortLoaded),e._executeAnimations&&e._setState(D,d.promise)}function a(t){e._updateAriaMarkers(0===t,e.firstIndexDisplayed,e.lastIndexDisplayed),e._state.setLoadingState&&e._state.setLoadingState(e._listView._LoadingState.itemsLoaded)}function h(t){e._listView._clearInsertedItems(),e._listView._groups.removeElements(),r(),a(t),n()}var d=new o;e._state.setLoadingState(e._listView._LoadingState.itemsLoading),e._firstLayoutPass&&e._listView._showProgressBar(e._listView._element,"50%","50%");var u=e.containers.length;if(u){var c,_,m=e.maxLeadingPages,p=e.maxTrailingPages,f=e._listView._getViewportLength();if(e._listView._zooming)c=_=0;else if(w._disableCustomPagesPrefetch)c=_=w._defaultPagesToPrefetch;else{c="left"===e._direction?m:p;var g=Math.max(0,c-e._scrollbarPos/f);_=Math.min(m,g+("right"===e._direction?m:p))}var v=Math.max(0,e._scrollbarPos-c*f),y=e._scrollbarPos+(1+_)*f,C=e._listView._layout.itemsFromRange(v,y-1);if((C.firstIndex<0||C.firstIndex>=u)&&(C.lastIndex<0||C.lastIndex>=u))e.begin=-1,e.end=-1,e.firstIndexDisplayed=-1,e.lastIndexDisplayed=-1,h(u);else{var b=l._clamp(C.firstIndex,0,u-1),I=l._clamp(C.lastIndex+1,0,u),S=e._listView._layout.itemsFromRange(e._scrollbarPos,e._scrollbarPos+f-1),x=l._clamp(S.firstIndex,0,u-1),E=l._clamp(S.lastIndex,0,u-1);if(e._realizationLevel!==w._realizationLevel.skip||e.lastRealizePass||x!==e.firstIndexDisplayed||E!==e.lastIndexDisplayed)if((e._forceRelayout||b!==e.begin||I!==e.end||x!==e.firstIndexDisplayed||E!==e.lastIndexDisplayed)&&I>b&&y>v){e._listView._writeProfilerMark("realizePage currentInView("+x+"-"+E+") previousInView("+e.firstIndexDisplayed+"-"+e.lastIndexDisplayed+") change("+(x-e.firstIndexDisplayed)+"),info"),e._cancelRealize();var P=e._realizePass;e.begin=b,e.end=I,e.firstIndexDisplayed=x,e.lastIndexDisplayed=E,e.deletesWithoutRealize=0,e._ensureItemsBlocksInDOM(e.begin,e.end);var M=e._realizeItems(e._listView._itemCanvas,e.begin,e.end,u,P,e._scrollbarPos,e._direction,x,E,e._forceRelayout);e._forceRelayout=!1;var T=M.viewportItemsRealized.then(function(){return r(),M.allItemsRealized}).then(function(){return e._realizePass===P?e._updateHeaders(e._listView._canvas,e.begin,e.end).then(function(){a(u)}):void 0}).then(function(){return M.loadingCompleted}).then(function(){e._unrealizeExcessiveItems(),e.lastRealizePass=null,n()},function(t){return e._realizePass===P&&(e.lastRealizePass=null,e.begin=-1,e.end=-1),s.wrapError(t)});e.lastRealizePass=s.join([M.viewportItemsRealized,M.allItemsRealized,M.loadingCompleted,T]),e._unrealizeExcessiveItems()}else e.lastRealizePass?e.lastRealizePass.then(n):h(u);else e.begin=b,e.end=b+Object.keys(e.items._itemData).length,e._updateHeaders(e._listView._canvas,e.begin,e.end).done(function(){e.lastRealizePass=null,h(u)})}}else e.begin=-1,e.end=-1,e.firstIndexDisplayed=-1,e.lastIndexDisplayed=-1,h(u);e._reportElementsLevel(e._direction),e._listView._writeProfilerMark(t+",StopTM")})},realizePage:function(e,t,i,n){this._scrollToFunctor=y(e),this._forceRelayout=this._forceRelayout||t,this._scrollEndPromise=i,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(n||E)},onScroll:function(e,t){this.realizePage(e,!1,t,M)},reload:function(e,t){this._listView._isZombie()||(this._scrollToFunctor=y(e),this._forceRelayout=!0,this._highPriorityRealize=!!t,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(e){this._listView._isZombie()||(this._scrollToFunctor=y(e),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(e){var t=this,i=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return e>i?t._listView._itemsCount().then(function(i){return t.containers.length<i?s._cancelBlocker(t._creatingContainersWork&&t._creatingContainersWork.promise).then(function(){return t._getLayoutCompleted()}).then(function(){return e}):e}):s.wrap(e)},waitForEntityPosition:function(e){var t=this;return e.type===d.ObjectType.header||e.type===d.ObjectType.footer?s.wrap():(this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+e.type+": "+e.index+"),info"),s._cancelBlocker(this._state.waitForEntityPosition(e).then(function(){return e.type!==d.ObjectType.groupHeader&&e.index>=t.containers.length||e.type===d.ObjectType.groupHeader&&t._listView._groups.group(e.index).startIndex>=t.containers.length?t._creatingContainersWork&&t._creatingContainersWork.promise:void 0}).then(function(){return t._getLayoutCompleted()})))},stopWork:function(e){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(e),this._layoutWork&&this._layoutWork.cancel(),e&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),e&&(this._state=new b(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var e=this.lastRealizePass;e&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,e.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(e){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var t=this._listView;this._firstLayoutPass=!0,t._unsetFocusOnItem(),t._currentMode().onDataChanged&&t._currentMode().onDataChanged(),this.items.each(function(i,n){e&&n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.removeChild(n.parentNode),t._itemsManager.releaseItem(n),a._disposeElement(n)}),this.items.removeItems(),this._deferredReparenting=[],e&&t._groups.removeElements(),t._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new b(this),this.resetItems(),!this._listView._isZombie()){var e=this._listView;e._groups.resetGroups(),e._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var e=this._listView._itemsManager;this.items.each(function(t,i){e.releaseItem(i),a._disposeElement(i)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(e){return this.containers[e]},_getHeaderContainer:function(e){return this.tree[e].header},_getGroups:function(e){if(this._listView._groupDataSource){var t=this._listView._groups.groups,i=[];if(e)for(var n=0,s=t.length;s>n;n++){var o=t[n],r=s>n+1?t[n+1].startIndex:e;i.push({key:o.key,size:r-o.startIndex})}return i}return[{key:"-1",size:e}]},_createChunk:function(e,t,i){function n(e,t){var n=e.element.children,s=n.length,r=Math.min(t-e.items.length,i);h.insertAdjacentHTMLUnsafe(e.element,"beforeend",_._repeat("<div class='win-container win-backdrop'></div>",r));for(var a=0;r>a;a++){var l=n[s+a];e.items.push(l),o.containers.push(l)}}function s(e){var t={header:o._listView._groupDataSource?o._createHeaderContainer():null,itemsContainer:{element:o._createItemsContainer(),items:[]}};o.tree.push(t),o.keyToGroupIndex[e.key]=o.tree.length-1,n(t.itemsContainer,e.size)}var o=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=e.length){var r=this.tree[this.tree.length-1],a=e[this.tree.length-1].size;if(r.itemsContainer.items.length<a)return n(r.itemsContainer,a),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<e.length&&s(e[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(e,i,n,s){function o(e,i){var o,r=e.itemsBlocks.length?e.itemsBlocks[e.itemsBlocks.length-1]:null;if(i=Math.min(i,s),r&&r.items.length<n){var l=Math.min(i,n-r.items.length),d=r.items.length,o=(e.itemsBlocks.length-1)*n+d,u=_._stripedContainers(l,o);h.insertAdjacentHTMLUnsafe(r.element,"beforeend",u),b=r.element.children;for(var c=0;l>c;c++){var m=b[d+c];r.items.push(m),a.containers.push(m)}i-=l}o=e.itemsBlocks.length*n;var p=Math.floor(i/n),f="",g=o,v=o+n;if(p>0){var y=["<div class='win-itemsblock'>"+_._stripedContainers(n,g)+"</div>","<div class='win-itemsblock'>"+_._stripedContainers(n,v)+"</div>"];f=_._repeat(y,p),o+=p*n}var C=i%n;C>0&&(f+="<div class='win-itemsblock'>"+_._stripedContainers(C,o)+"</div>",o+=C,p++);var w=t.document.createElement("div");h.setInnerHTMLUnsafe(w,f);for(var b=w.children,I=0;p>I;I++){var S=b[I],x={element:S,items:_._nodeListToArray(S.children)};e.itemsBlocks.push(x);for(var E=0;E<x.items.length;E++)a.containers.push(x.items[E])}}function r(e){var t={header:a._listView._groupDataSource?a._createHeaderContainer():null,itemsContainer:{element:a._createItemsContainer(),itemsBlocks:[]}};a.tree.push(t),a.keyToGroupIndex[e.key]=a.tree.length-1,o(t.itemsContainer,e.size)}var a=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=e.length){var l=this.tree[this.tree.length-1].itemsContainer,d=e[this.tree.length-1].size,u=0;if(l.itemsBlocks.length&&(u=(l.itemsBlocks.length-1)*n+l.itemsBlocks[l.itemsBlocks.length-1].items.length),d>u)return o(l,d-u),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<e.length&&r(e[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var e=this,t=0,i=!1;return function s(o){e._listView._versionManager.locked?o.setPromise(e._listView._versionManager.unlocked.then(function(){return s})):e._listView._itemsCount().then(function(r){var a=!i&&g(e._listView);if(a)o.setPromise(v(e._listView).then(function(e){return i=e,s}));else{if(e._listView._isZombie())return;i=!1;var l=n._now()+w._createContainersJobTimeslice,h=e._getGroups(r),d=e.containers.length,u=e.end===e.containers.length,c=w._chunkSize;do e._blockSize?e._createChunkWithBlocks(h,r,e._blockSize,c):e._createChunk(h,r,c),t++;while(e.containers.length<r&&n._now()<l);e._listView._writeProfilerMark("createContainers yields containers("+e.containers.length+"),info"),e._listView._affectedRange.add({start:d,end:e.containers.length},r),u?(e.stopWork(),e._listView._writeProfilerMark(e._state.name+"_relayout,info"),e._state.relayout()):(e._listView._writeProfilerMark(e._state.name+"_layoutNewContainers,info"),e._state.layoutNewContainers()),e.containers.length<r?o.setWork(s):(e._listView._writeProfilerMark("createContainers completed steps("+t+"),info"),e._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return r.schedule(this._generateCreateContainersWorker(),r.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var e,t=this;return this._listView._itemsCount().then(function(i){return 0===i&&t._listView._hideProgressBar(),e=i,t._listView._writeProfilerMark("createContainers("+e+"),StartTM"),t._listView._groupDataSource?t._listView._groups.initialize():void 0}).then(function(){return t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),e&&t._listView._groups.length()?t._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(i){t._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+i+"),info"),t._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),t._listView._resetCanvas(),t.tree=[],t.keyToGroupIndex={},t.containers=[],t._blockSize=i;var s,o=t._getGroups(e),r=n._now()+w._maxTimePerCreateContainers,a=Math.min(w._startupChunkSize,w._chunkSize);do s=i?t._createChunkWithBlocks(o,e,i,a):t._createChunk(o,e,a);while(n._now()<r&&t.containers.length<e&&!s);if(t._listView._writeProfilerMark("createContainers created("+t.containers.length+"),info"),t._listView._affectedRange.add({start:0,end:t.containers.length},e),t.containers.length<e){var l=t._scheduleLazyTreeCreation();t._creatingContainersWork.promise.done(null,function(){l.cancel()})}else t._listView._writeProfilerMark("createContainers completed synchronously,info"),t._creatingContainersWork.complete();t._listView._writeProfilerMark("createContainers("+e+"),StopTM")})},_updateItemsBlocks:function(e){function i(){var e=t.document.createElement("div");return e.className=u._itemsBlockClass,e}function n(t,n){function r(){t.itemsBlocks=null,t.items=[];for(var e=0;d>e;e++){var i=s.containers[n+e];t.element.appendChild(i),t.items.push(i)}}function a(){t.itemsBlocks=[{element:h.length?h.shift():i(),items:[]}];for(var o=t.itemsBlocks[0],r=0;d>r;r++){if(o.items.length===e){var a=h.length?h.shift():i();t.itemsBlocks.push({element:a,items:[]}),o=t.itemsBlocks[t.itemsBlocks.length-1]}var l=s.containers[n+r];o.element.appendChild(l),o.items.push(l)}t.items=null}var l,h=[],d=0,u=t.itemsBlocks;if(u)for(l=0;l<u.length;l++)d+=u[l].items.length,h.push(u[l].element);else d=t.items.length;for(o?a():r(),l=0;l<h.length;l++){var c=h[l];c.parentNode===t.element&&t.element.removeChild(c)}return d}for(var s=this,o=!!e,r=0,a=0;r<this.tree.length;r++)a+=n(this.tree[r].itemsContainer,a);s._blockSize=e},_layoutItems:function(){var e=this;return this._listView._itemsCount().then(function(){return s.as(e._listView._layout.numberOfItemsPerItemsBlock).then(function(t){e._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+t+"),info"),t!==e._blockSize&&(e._updateItemsBlocks(t),e._listView._itemsBlockExtent=-1);var i,n=e._listView._affectedRange.get();return n&&(i={firstIndex:Math.max(n.start-1,0),lastIndex:Math.min(e.containers.length-1,n.end)},i.firstIndex<e.containers.length||0===e.containers.length)?e._listView._layout.layout(e.tree,i,e._modifiedElements||[],e._modifiedGroups||[]):(e._listView._affectedRange.clear(),{realizedRangeComplete:s.wrap(),layoutComplete:s.wrap()})})})},updateTree:function(e,t,i){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(e,t,i)},_updateTreeImpl:function(e,i,n,s){function o(e){for(var t=0,i=e.length;i>t;t++){var n=e[t];n.parentNode.removeChild(n)}}if(this._executeAnimations=!0,this._modifiedElements=n,!n.handled){n.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var r,a=this;s||this._unrealizeItems();for(var r=0,h=n.length;h>r;r++)n[r]._itemBox&&n[r]._itemBox.parentNode&&l.removeClass(n[r]._itemBox.parentNode,u._selectedClass);this.items.each(function(e,t,i){i.container&&l.removeClass(i.container,u._selectedClass),i.container&&l.addClass(i.container,u._backdropClass)});var d=this._listView._updateContainers(this._getGroups(e),e,i,n);o(d.removedHeaders),o(d.removedItemsContainers);for(var r=0,h=n.length;h>r;r++){var _=n[r];if(-1!==_.newIndex){if(_.element=this.getContainer(_.newIndex),!_.element)throw"Container missing after updateContainers."}else l.removeClass(_.element,u._backdropClass)}var m=t.document.activeElement;this._listView._canvas.contains(m)&&(this._requireFocusRestore=m),this._deferredReparenting=[],this.items.each(function(e,t,i){var n=a.getContainer(e),s=i.itemBox;s&&n&&(i.container=n,s.parentNode!==n&&(e>=a.firstIndexDisplayed&&e<=a.lastIndexDisplayed?a._appendAndRestoreFocus(n,s):a._deferredReparenting.push({itemBox:s,container:n})),l.removeClass(n,u._backdropClass),l[a._listView.selection._isIncluded(e)?"addClass":"removeClass"](n,u._selectedClass),!a._listView.selection._isIncluded(e)&&l.hasClass(s,u._selectedClass)&&c._ItemEventsHandler.renderSelection(s,i.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var e=this._deferredReparenting.length;if(e>0){var t="_completeReparenting("+e+")";this._listView._writeProfilerMark(t+",StartTM");for(var i,n=0;e>n;n++)i=this._deferredReparenting[n],this._appendAndRestoreFocus(i.container,i.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(t+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(e,i){if(i.parentNode!==e){var n;if(this._requireFocusRestore&&(n=t.document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===n&&(e.contains(n)||i.contains(n))&&(this._listView._unsetFocusOnItem(),n=t.document.activeElement),l.empty(e),e.appendChild(i),this._requireFocusRestore&&n===this._listView._keyboardEventsHelper){var s=this._listView._selection._getFocused();s.type===d.ObjectType.item&&this.items.itemBoxAt(s.index)===i&&(l._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var e=this;this._hasAnimationInViewportPending=!1;var t=s.as(this._listView._layout.executeAnimations()).then(function(){e._listView._writeProfilerMark("startAnimations,StopTM")});return t},_setState:function(e,t){if(!this._listView._isZombie()){var i=this._state.name;this._state=new e(this,t),this._listView._writeProfilerMark(this._state.name+"_enter from("+i+"),info"),this._state.enter()}},getAdjacent:function(e,t){var i=this;return this.waitForEntityPosition(e).then(function(){return i._listView._layout.getAdjacent(e,t)})},hitTest:function(e,t){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var i=this._listView._layout.hitTest(e,t);return i.index=l._clamp(i.index,-1,this._listView._cachedCount-1,0),i.insertAfterIndex=l._clamp(i.insertAfterIndex,-1,this._listView._cachedCount-1,0),i},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new o;var e=this;this._creatingContainersWork.promise.done(function(){e._creatingContainersWork=null},function(){e._creatingContainersWork=null})}},_createLayoutSignal:function(){var e=this;this._layoutCompleted||(this._layoutCompleted=new o,this._layoutCompleted.promise.done(function(){e._layoutCompleted=null},function(){e._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new o,this._realizedRangeLaidOut.promise.done(function(){e._realizedRangeLaidOut=null},function(){e._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?s._cancelBlocker(this._layoutCompleted.promise):s.wrap()},_createSurfaceChild:function(e,i){var n=t.document.createElement("div");return n.className=e,this._listView._canvas.insertBefore(n,i?i.nextElementSibling:null),n},_executeScrollToFunctor:function(){var e=this;return s.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(t){e._scrollToFunctor=null,t=t||{},+t.position===t.position&&(e._scrollbarPos=t.position),e._direction=t.direction||"right"})}},{_defaultPagesToPrefetch:2,_iOSMaxLeadingPages:6,_iOSMaxTrailingPages:2,_disableCustomPagesPrefetch:!1,_waitForSeZoIntervalDuration:100,_waitForSeZoTimeoutDuration:500,_chunkSize:500,_startupChunkSize:100,_maxTimePerCreateContainers:5,_createContainersJobTimeslice:15,_blocksToRelease:10,_realizationLevel:{skip:"skip",realize:"realize",normal:"normal"}}),b=i.Class.define(function(e){this.view=e,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:C,realizePage:C,rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(I)},layoutNewContainers:C,waitForEntityPosition:function(){return this.view._setState(I),this.view._getLayoutCompleted()},updateTree:C}),I=i.Class.define(function(e){this.view=e},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var e=this,t=new o;this.promise=t.promise.then(function(){return e.view._createContainers()}).then(function(){e.view._setState(S)},function(t){return e.canceling||(e.view._setState(b),e.view._listView._raiseViewComplete()),s.wrapError(t)}),t.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(b)},realizePage:C,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:C,layoutNewContainers:C,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:C}),S=i.Class.define(function(e,t){this.view=e,this.nextStateType=t||E},{name:"LayingoutState",enter:function(){var e=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var t=new o;this.promise=t.promise.then(function(){return e.view._layoutItems()}).then(function(t){return e.view._layoutWork=t.layoutComplete,t.realizedRangeComplete}).then(function(){e.view._listView._writeProfilerMark(e.name+"_enter_layoutItems,StopTM"),e.view._listView._clearInsertedItems(),e.view._setAnimationInViewportState(e.view._modifiedElements),e.view._modifiedElements=[],e.view._modifiedGroups=[],e.view._realizedRangeLaidOut.complete(),e.view._layoutWork.then(function(){e.view._listView._writeProfilerMark(e.name+"_enter_layoutCompleted,info"),e.view._listView._affectedRange.clear(),e.view._layoutCompleted.complete()}),e.canceling||e.view._setState(e.nextStateType)},function(t){return e.view._listView._writeProfilerMark(e.name+"_enter_layoutCanceled,info"),e.canceling||(e.view.firstIndexDisplayed=e.view.lastIndexDisplayed=-1,e.view._updateAriaMarkers(!0,e.view.firstIndexDisplayed,e.view.lastIndexDisplayed),e.view._setState(A)),s.wrapError(t)}),t.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(e){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),e&&this.view._setState(x)},stop:function(){this.cancelLayout(!0)},realizePage:C,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(I)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),x=i.Class.define(function(e){this.view=e},{name:"LayoutCanceledState",enter:C,stop:C,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(S)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),E=i.Class.define(function(e){this.view=e,this.nextState=k,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var e=this,t=new o;this.promise=t.promise.then(function(){return e.view._executeScrollToFunctor()}).then(function(){return e.relayoutNewContainers=!1,s._cancelBlocker(e.view._realizePageImpl())}).then(function(){e.view._state===e&&(e.view._completeUpdateTree(),e.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),e.view._setState(e.nextState))},function(t){return e.view._state!==e||e.canceling||(e.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),e.view._setState(P)),s.wrapError(t)}),t.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(P)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(I)},relayout:function(){this.stop(),this.view._setState(S)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),
this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)},setLoadingState:function(e){this.view._listView._setViewState(e)}}),P=i.Class.define(function(e){this.view=e},{name:"CanceledState",enter:C,stop:function(){this.view._cancelRealize()},realizePage:function(e){this.stop(),this.view._setState(e)},rebuildTree:function(){this.stop(),this.view._setState(I)},relayout:function(e){this.stop(),this.view._setState(S,e)},layoutNewContainers:function(){this.relayout(P)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),M=i.Class.derive(E,function(e){this.view=e,this.nextState=T,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),T=i.Class.derive(P,function(e){this.view=e},{name:"ScrollingPausedState",enter:function(){var e=this;this.promise=s._cancelBlocker(this.view._scrollEndPromise).then(function(){e.view._setState(k)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),k=i.Class.define(function(e){this.view=e},{name:"UnrealizingState",enter:function(){var e=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return e.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),e.view._renderCompletePromise}).then(function(){e.view._setState(A)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(P)},realizePage:function(e){this.promise.cancel(),this.view._setState(e)},rebuildTree:function(){this.view._setState(I)},relayout:function(){this.view._setState(S)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i)}}),D=i.Class.define(function(e,t){this.view=e,this.realizePromise=t,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var e=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new o,this.view._executeAnimations=!1,this.animatePromise.done(function(){e.animating=!1,e.modifiedElements?(e.view._updateTreeImpl(e.count,e.delta,e.modifiedElements),e.modifiedElements=null,e.view._setState(P)):e.animateSignal.complete()},function(t){return e.animating=!1,s.wrapError(t)}),this._waitForRealize()},_waitForRealize:function(){var e=this;this.realizing=!0,this.realizePromise.done(function(){e.realizing=!1});var t=++this.realizeId;s.join([this.realizePromise,this.animateSignal.promise]).done(function(){t===e.realizeId&&(e.view._completeUpdateTree(),e.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),e.view._setState(k))})},stop:function(e){this.realizePromise.cancel(),this.view._cancelRealize(),e&&(this.animatePromise.cancel(),this.view._setState(P))},realizePage:function(){if(!this.modifiedElements){var e=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return s._cancelBlocker(e.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(I)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(S)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(e,t,i){if(this.animating){var n=this.modifiedElements;return this.count=e,this.delta=t,this.modifiedElements=i,n?s.cancel:this.animatePromise}return this.view._updateTreeImpl(e,t,i)},setLoadingState:function(e){this.view._listView._setViewState(e)}}),A=i.Class.derive(P,function(e){this.view=e},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=w._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(O)},stop:function(){this._stopped=!0,P.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(O)},updateTree:function(e,t,i){return this.view._updateTreeImpl(e,t,i,!0)}}),O=i.Class.derive(P,function(e){this.view=e},{name:"LayingoutNewContainersState",enter:function(){var e=this;this.promise=s.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){e.view._relayoutInComplete=!1,e.relayout(P)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(e){this.stop(),this.view._setState(S,e)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return w})})}),n("require-style!less/styles-listview",[],function(){}),n("require-style!less/colors-listview",[],function(){}),n("WinJS/Controls/ListView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_SafeHtml","../Utilities/_TabContainer","../Utilities/_UI","../Utilities/_VersionManager","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler","./ListView/_BrowseMode","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_Helpers","./ListView/_ItemsContainer","./ListView/_Layouts","./ListView/_SelectionManager","./ListView/_VirtualizeContentsView","require-style!less/styles-listview","require-style!less/colors-listview"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C,w,b,I,S,x,E,P,M,T,k,D,A,O,B){"use strict";function L(){var e=W;W=[],e=e.filter(function(e){return e._isZombie()?(e._dispose(),!1):!0}),W=W.concat(e)}function R(e){W.push(e),z&&z.cancel(),z=c.timeout(N).then(L)}function F(e){return e.offsetParent?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:0}l.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground,         .win-itemcontainer:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground",[{name:"border-color",value:l.ColorTypes.accent},{name:"background-color",value:l.ColorTypes.accent}]),l.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-container.win-selected .win-selectionborder,         .win-itemcontainer:not(.win-selectionstylefilled).win-container.win-selected .win-selectionborder",[{name:"border-color",value:l.ColorTypes.accent}]),l.createAccentRule(".win-listview.win-selectionstylefilled .win-selected .win-selectionbackground,         .win-itemcontainer.win-selectionstylefilled.win-selected .win-selectionbackground",[{name:"background-color",value:l.ColorTypes.accent}]);var z,H=i._browserStyleEquivalents.transform,N=1e3,W=[],V=g._uniqueID,U={get notCompatibleWithSemanticZoom(){return"ListView can only be used with SemanticZoom if randomAccess loading behavior is specified."},get listViewInvalidItem(){return"Item must provide index, key or description of corresponding item."},get listViewViewportAriaLabel(){return r._getWinJSString("ui/listViewViewportAriaLabel").value}},j=i.requireSupportedForProcessing,q={entrance:"entrance",contentTransition:"contentTransition"};t.Namespace.define("WinJS.UI",{ListViewAnimationType:q,ListView:t.Namespace._lazy(function(){var r=t.Class.define(function(){this.clear()},{add:function(e,t){if(e._lastKnownSizeOfData=t,this._range){this._range.start=Math.min(this._range.start,e.start);var i=this._range._lastKnownSizeOfData-this._range.end,n=e._lastKnownSizeOfData-e.end,s=Math.min(i,n);this._range._lastKnownSizeOfData=e._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-s}else this._range=e},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),l=t.Class.define(function(e){this._listView=e},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(e,t,i,n){this._listView._configureForZoom(e,t,i,n)},setCurrentItem:function(e,t){this._listView._setCurrentItem(e,t)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(e,t){return this._listView._positionItem(e,t)},endZoom:function(e){this._listView._endZoom(e)},pinching:{get:function(){return this._listView._pinching},set:function(e){this._listView._pinching=e}}}),v=t.Class.define(function(t,i){if(t=t||e.document.createElement("div"),this._id=t.id||"",this._writeProfilerMark("constructor,StartTM"),i=i||{},t.winControl=this,g.addClass(t,"win-disposable"),this._affectedRange=new r,this._mutationObserver=new g._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=t,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=S._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._lastFocusedElementInGroupTrack={type:b.ObjectType.item,index:-1},this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1},this._viewportWidth=S._UNINITIALIZED,this._viewportHeight=S._UNINITIALIZED,this._manipulationState=g._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new M._UnsupportedGroupFocusCache,this._viewChange=S._ViewChange.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new B._VirtualizeContentsView(this),this._selection=new O._SelectionManager(this),this._createTemplates(),this._groupHeaderRenderer=y._trivialHtmlRenderer,this._itemRenderer=y._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,i.itemDataSource)this._dataSource=i.itemDataSource;else{var n=new u.List;this._dataSource=n.dataSource}this._selectionMode=b.SelectionMode.multi,this._tap=b.TapBehavior.invokeOnly,this._groupHeaderTap=b.GroupHeaderTapBehavior.invoke,this._mode=new E._SelectionMode(this),this._groups=new T._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),i.layout||this._updateLayout(new A.GridLayout),this._attachEvents(),this._runningInit=!0,p.setOptions(this,i),this._runningInit=!1,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(e){this._updateLayout(e),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0,!0))}},maxLeadingPages:{get:function(){return this._view.maxLeadingPages},set:function(e){this._view.maxLeadingPages=Math.max(0,Math.floor(e))}},maxTrailingPages:{get:function(){return this._view.maxTrailingPages},set:function(e){this._view.maxTrailingPages=Math.max(0,Math.floor(e))}},pagesToLoad:{get:function(){return 2*B._VirtualizeContentsView._defaultPagesToPrefetch+1},set:function(){g._deprecated(P.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){g._deprecated(P.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(e){function t(e){e.detail===b.DataSourceStatus.failure&&(i.itemDataSource=null,i.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var i=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",t,!1),this._groupDataSource=e,this._groupFocusCache=e&&this._supportsGroupHeaderKeyboarding?new M._GroupFocusCache(this):new M._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",t,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?g.addClass(this._element,S._groupsClass):g.removeClass(this._element,S._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){g._deprecated(P.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){g._deprecated(P.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(e){if("string"==typeof e&&e.match(/^(none|single|multi)$/)){if(i.isPhone&&e===b.SelectionMode.single)return;return this._selectionMode=e,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),void this._configureSelectionMode()}throw new n("WinJS.UI.ListView.ModeIsInvalid",P.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(e){i.isPhone&&e===b.TapBehavior.directSelect||(this._tap=e,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(e){this._groupHeaderTap=e,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return"none"},set:function(){g._deprecated(P.swipeBehaviorDeprecated)}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(e){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=e||(new u.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(e){this._setRenderer(e,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(e){g._deprecated(P.resetItemIsDeprecated),this._itemRelease=e}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(e){this._setRenderer(e,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(e){g._deprecated(P.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=e}},header:{get:function(){return this._header},set:function(e){g.empty(this._headerContainer),this._header=e,e&&(this._header.tabIndex=this._tabIndex,this._headerContainer.appendChild(e));var t=this._selection._getFocused();if(t.type===b.ObjectType.header){var i=t;e||(i={type:b.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(i,!0,!1,!0):this._changeFocusPassively(i)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},footer:{get:function(){return this._footer},set:function(e){g.empty(this._footerContainer),this._footer=e,e&&(this._footer.tabIndex=this._tabIndex,this._footerContainer.appendChild(e));var t=this._selection._getFocused();if(t.type===b.ObjectType.footer){var i=t;e||(i={type:b.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(i,!0,!1,!0):this._changeFocusPassively(i)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(e){if(!(0>e)){this._writeProfilerMark("set_indexOfFirstVisible("+e+"),info"),this._raiseViewLoading(!0);var t=this;this._batchViewUpdates(S._ViewChange.realize,S._ScrollToPriority.high,function(){var i;return t._entityInRange({type:b.ObjectType.item,index:e}).then(function(e){return e.inRange?t._getItemOffset({type:b.ObjectType.item,index:e.index}).then(function(e){return i=e,t._ensureFirstColumnRange(b.ObjectType.item)}).then(function(){return i=t._correctRangeInFirstColumn(i,b.ObjectType.item),i=t._convertFromCanvasCoordinates(i),t._view.waitForValidScrollPosition(i.begin)}).then(function(e){var i=e<t._lastScrollPosition?"left":"right",n=t._viewport[t._scrollLength]-t._getViewportLength();return e=g._clamp(e,0,n),{position:e,direction:i}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var e=this._selection._getFocused(),t={index:e.index,type:e.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(e.type===b.ObjectType.groupHeader){var i=this._groups.group(e.index);i&&(t.key=i.key,t.showFocus=!(!i.header||!g.hasClass(i.header,S._itemFocusClass)))}else if(e.type===b.ObjectType.item){var n=this._view.items.itemAt(e.index);if(n){var s=this._itemsManager._recordFromElement(n);t.key=s.item&&s.item.key,t.showFocus=!!n.parentNode.querySelector("."+S._itemFocusOutlineClass)}}return t},set:function(e){function t(t,n,s){var o=!!e.showFocus&&i._hasKeyboardFocus;i._unsetFocusOnItem(n),i._selection._setFocused(s,o),i._hasKeyboardFocus?(i._keyboardFocusInbound=o,i._setFocusOnItem(s)):i._tabManager.childFocus=n?t:null,s.type!==b.ObjectType.groupHeader&&(i._updateFocusCache(s.index),i._updater&&(i._updater.newSelectionPivot=s.index,i._updater.oldSelectionPivot=-1),i._selection._pivot=s.index)}this._hasKeyboardFocus=e.hasFocus||this._hasKeyboardFocus,e.type||(e.type=b.ObjectType.item);var i=this;if(e.key&&(e.type===b.ObjectType.item&&this._dataSource.itemFromKey||e.type===b.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var n=e.type===b.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=n.itemFromKey(e.key).then(function(n){if(i.oldCurrentItemKeyFetch=null,n){var s=e.type===b.ObjectType.groupHeader?i._groups.group(n.index).header:i._view.items.itemAt(n.index);t(s,!!s,{type:e.type,index:n.index})}})}else{var s;if(e.type===b.ObjectType.header||e.type===b.ObjectType.footer)s=e.type===b.ObjectType.header?this._header:this._footer,t(s,!!s,{type:e.type,index:e.index});else if(void 0!==e.index){if(e.type===b.ObjectType.groupHeader){var o=i._groups.group(e.index);s=o&&o.header}else s=i._view.items.itemAt(e.index);t(s,!!s,{type:e.type,index:e.index})}}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new l(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(e){i.isPhone||this._dragSource!==e&&(this._dragSource=e,this._setDraggable())}},itemsReorderable:{get:function(){return this._reorderable},set:function(e){i.isPhone||this._reorderable!==e&&(this._reorderable=e,this._setDraggable())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(e){this._maxDeferredItemCleanup=Math.max(0,+e||0)}},dispose:function(){this._dispose()},elementFromIndex:function(e){return this._view.items.itemAt(e)},indexOfElement:function(e){return this._view.items.index(e)},ensureVisible:function(e){var t=b.ObjectType.item,i=e;if(+e!==e&&(t=e.type,i=e.index),this._writeProfilerMark("ensureVisible("+t+": "+i+"),info"),!(0>i)){this._raiseViewLoading(!0);var n=this;this._batchViewUpdates(S._ViewChange.realize,S._ScrollToPriority.high,function(){var e;return n._entityInRange({type:t,index:i}).then(function(i){return i.inRange?n._getItemOffset({type:t,index:i.index}).then(function(i){return e=i,n._ensureFirstColumnRange(t)}).then(function(){e=n._correctRangeInFirstColumn(e,t);var s=n._getViewportLength(),o=n._viewportScrollPosition,r=o+s,a=n._viewportScrollPosition,l=e.end-e.begin;e=n._convertFromCanvasCoordinates(e);var h=!1;if(t===b.ObjectType.groupHeader&&o<=e.begin){var d=n._groups.group(i.index).header;if(d){var u,c=A._getMargins(d);if(n._horizontalLayout){var _=n._rtl(),m=_?F(d)-c.right:d.offsetLeft-c.left;u=m+d.offsetWidth+(_?c.left:c.right)}else u=d.offsetTop+d.offsetHeight+c.top;h=r>=u}}h||(l>=r-o?a=e.begin:e.begin<o?a=e.begin:e.end>r&&(a=e.end-s));var p=a<n._lastScrollPosition?"left":"right",f=n._viewport[n._scrollLength]-s;return a=g._clamp(a,0,f),{position:a,direction:p}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){g._deprecated(P.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(S._ViewChange.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(S._ViewChange.remeasure)},_entityInRange:function(e){if(e.type===b.ObjectType.item)return this._itemsCount().then(function(t){var i=g._clamp(e.index,0,t-1);return{inRange:i>=0&&t>i,index:i}});if(e.type===b.ObjectType.groupHeader){var t=g._clamp(e.index,0,this._groups.length()-1);return c.wrap({inRange:t>=0&&t<this._groups.length(),index:t})}return c.wrap({inRange:!0,index:0})},_forceLayoutImpl:function(e){var t=this;this._versionManager.unlocked.then(function(){t._writeProfilerMark("_forceLayoutImpl viewChange("+e+"),info"),t._cancelAsyncViewWork(),t._pendingLayoutReset=!0,t._resizeViewport(),t._batchViewUpdates(e,S._ScrollToPriority.low,function(){return{position:t._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){var t=S._selectionModeClass,i=S._hidingSelectionMode;if(this._isInSelectionMode())g.addClass(this._canvas,t),g.removeClass(this._canvas,i);else{if(g.hasClass(this._canvas,t)){var n=this;e.setTimeout(function(){e.setTimeout(function(){g.removeClass(n._canvas,i)},S._hidingSelectionModeAnimationTimeout)},50),g.addClass(this._canvas,i)}g.removeClass(this._canvas,t)}},_lastScrollPosition:{get:function(){return this._lastScrollPositionValue},set:function(e){if(0===e)this._lastDirection="right",this._direction="right",this._lastScrollPositionValue=0;else{var t=e<this._lastScrollPositionValue?"left":"right";this._direction=this._scrollDirection(e),this._lastDirection=t,this._lastScrollPositionValue=e}}},_hasHeaderOrFooter:{get:function(){return!(!this._header&&!this._footer)}},_getHeaderOrFooterFromElement:function(e){return this._header&&this._header.contains(e)?this._header:this._footer&&this._footer.contains(e)?this._footer:null},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=g.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(e){var t={};t[this._scrollProperty]=e,g.setScrollPosition(this._viewport,t),this._currentScrollPosition=e}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(e){var t=this._horizontal()?this._rtl()?-e:e:0,i=this._horizontal()?0:e;this._canvas.style[H.scriptName]=0!==e?"translate( "+t+"px, "+i+"px)":"",this._canvasStartValue=e}},scrollPosition:{get:function(){return this._viewportScrollPosition},set:function(e){var t=this;this._batchViewUpdates(S._ViewChange.realize,S._ScrollToPriority.high,function(){return t._view.waitForValidScrollPosition(e).then(function(){var i=t._viewport[t._scrollLength]-t._getViewportLength();e=g._clamp(e,0,i);var n=e<t._lastScrollPosition?"left":"right";return{position:e,direction:n}})},!0)}},_setRenderer:function(e,t){var s;if(e){if("function"==typeof e)s=e;else if("object"==typeof e){if(i.validation&&!e.renderItem)throw new n("WinJS.UI.ListView.invalidTemplate",P.invalidTemplate);s=e.renderItem}}else{if(i.validation)throw new n("WinJS.UI.ListView.invalidTemplate",P.invalidTemplate);s=y.trivialHtmlRenderer}s&&(t?this._groupHeaderRenderer=s:this._itemRenderer=s)},_renderWithoutReuse:function(e,t){t&&f._disposeElement(t);var i=this._itemRenderer(e);if(i.then)return i.then(function(e){return e.tabIndex=0,e});var n=i.element||i;return n.tabIndex=0,i},_isInsertedItem:function(e){return!!this._insertedItems[e.handle]},_clearInsertedItems:function(){for(var e=Object.keys(this._insertedItems),t=0,i=e.length;i>t;t++)this._insertedItems[e[t]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(e){this._view.stopWork(e)},_updateView:function(){function e(){i._itemsBlockExtent=-1,i._firstItemRange=null,i._firstHeaderRange=null,i._itemMargins=null,i._headerMargins=null,i._canvasMargins=null,i._cachedRTL=null,i._rtl()}function t(){i._scrollToPriority=S._ScrollToPriority.uninitialized;var e=i._setScrollbarPosition;i._setScrollbarPosition=!1;var t="number"==typeof i._scrollToFunctor?{position:i._scrollToFunctor}:i._scrollToFunctor();return c.as(t).then(function(t){return t=t||{},e&&+t.position===t.position&&(i._lastScrollPosition=t.position,i._viewportScrollPosition=t.position),t},function(t){return i._setScrollbarPosition|=e,c.wrapError(t)})}if(!this._isZombie()){var i=this,n=this._viewChange;this._viewChange=S._ViewChange.realize,n===S._ViewChange.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),e(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(t,!0),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):n===S._ViewChange.remeasure?(this._view.resetItems(!0),this._resetLayout(),e(),this._view.refresh(t),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):n===S._ViewChange.relayout?(this._pendingLayoutReset&&(this._resetLayout(),e()),this._view.refresh(t)):(this._view.onScroll(t),this._raiseHeaderFooterVisibilityEvent())}},_batchViewUpdates:function(e,t,i,n,s){if(this._viewChange=Math.min(this._viewChange,e),(null===this._scrollToFunctor||t>=this._scrollToPriority)&&(this._scrollToPriority=t,this._scrollToFunctor=i),this._setScrollbarPosition|=!!n,!this._batchingViewUpdates){this._raiseViewLoading();var o=this;this._batchingViewUpdatesSignal=new m,this._batchingViewUpdates=c.any([this._batchingViewUpdatesSignal.promise,_.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){return o._isZombie()?void 0:o._viewChange!==S._ViewChange.rebuild||o._firstTimeDisplayed||0===Object.keys(o._view.items._itemData).length||s?void 0:o._fadeOutViewport()}).then(function(){o._batchingViewUpdates=null,o._batchingViewUpdatesSignal=null,o._updateView(),o._firstTimeDisplayed=!1},function(){o._batchingViewUpdates=null,o._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var t=e.document.createElement("div");t.className=this._canvas.className,this._viewport.replaceChild(t,this._canvas),this._canvas=t,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){g.addClass(this._element,S._listViewClass),g[this._rtl()?"addClass":"removeClass"](this._element,S._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+S._viewportClass+" "+S._horizontalClass+'"><div></div><div class="'+S._scrollableClass+'"><div class="'+S._proxyClass+'"></div></div><div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"></div>',this._viewport=this._element.firstElementChild,this._headerContainer=this._viewport.firstElementChild,g.addClass(this._headerContainer,S._listHeaderContainerClass),this._canvas=this._headerContainer.nextElementSibling,this._footerContainer=this._canvas.nextElementSibling,g.addClass(this._footerContainer,S._listFooterContainerClass),this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling,this._tabIndex=g.getTabIndex(this._element),this._tabIndex<0&&(this._tabIndex=0),this._tabManager=new w.TabContainer(this._viewport),this._tabManager.tabIndex=this._tabIndex,this._progressBar=e.document.createElement("progress"),g.addClass(this._progressBar,S._progressClass),g.addClass(this._progressBar,"win-progress-ring"),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(t){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(t||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,e.document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,g._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(e){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var t=this,i=function(i){t._isZombie()||(t._tabManager.childFocus!==i&&(t._tabManager.childFocus=i),t._focusRequest=null,t._hasKeyboardFocus&&!t._itemFocused&&(t._selection._keyboardFocused()&&t._drawFocusRectangle(i),(e.type===b.ObjectType.groupHeader||e.type===b.ObjectType.item)&&t._view.updateAriaForAnnouncement(i,e.type===b.ObjectType.groupHeader?t._groups.length():t._cachedCount),t._itemFocused=!0,g._setActive(i)))};this._focusRequest=e.type===b.ObjectType.item?this._view.items.requestItem(e.index):e.type===b.ObjectType.groupHeader?this._groups.requestHeader(e.index):c.wrap(e.type===b.ObjectType.header?this._header:this._footer),this._focusRequest.then(i)}},_attachEvents:function(){function t(e,t,i){return{name:t?e:e.toLowerCase(),handler:function(t){s["_on"+e](t)},capture:i}}function i(e,t,i){return{capture:i,name:t?e:e.toLowerCase(),handler:function(t){var i=s._mode,n="on"+e;!s._disposed&&i[n]&&i[n](t)}}}function n(e,t){return{handler:function(t){s["_on"+e](t)},filter:t}}var s=this,o=[n("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,o.forEach(function(e){new g._MutationObserver(e.handler).observe(s._element,{attributes:!0,attributeFilter:e.filter})});var r=[i("PointerDown"),i("click",!1),i("PointerUp"),i("LostPointerCapture"),i("MSHoldVisual",!0),i("PointerCancel",!0),i("DragStart"),i("DragOver"),i("DragEnter"),i("DragLeave"),i("Drop"),i("ContextMenu")];r.forEach(function(e){g._addEventListener(s._viewport,e.name,e.handler,!!e.capture)});var a=[t("FocusIn",!1,!1),t("FocusOut",!1,!1),i("KeyDown"),i("KeyUp"),t("MSElementResize",!1,!1)];a.forEach(function(e){g._addEventListener(s._element,e.name,e.handler,!!e.capture)}),this._onMSElementResizeBound=this._onMSElementResize.bind(this),g._resizeNotifier.subscribe(this._element,this._onMSElementResizeBound);var l=e.document.body.contains(this._element);g._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(e){return l?void(l=!1):void s._onMSElementResizeBound(e)},!1);var h=[t("MSManipulationStateChanged",!0),t("Scroll")];h.forEach(function(e){s._viewport.addEventListener(e.name,e.handler,!1);

}),this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this)),this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this)),this._viewport.addEventListener("onTabEntered",function(e){s._mode.onTabEntered(e)}),this._viewport.addEventListener("onTabExiting",function(e){s._mode.onTabExiting(e)})},_updateItemsManager:function(){function e(e){e.detail===b.DataSourceStatus.failure&&(t.itemDataSource=null,t.groupDataSource=null)}var t=this,i={beginNotifications:function(){},changed:function(e,i){if(!t._ifZombieDispose()){t._createUpdater();var n=t._updater.elements[V(i)];if(n){var s=t.selection._isIncluded(n.index);if(s&&(t._updater.updateDrag=!0),i!==e){if((t._tabManager.childFocus===i||t._updater.newFocusedItem===i)&&(t._updater.newFocusedItem=e,t._tabManager.childFocus=null),n.itemBox){g.addClass(e,S._itemClass),t._setupAriaSelectionObserver(e);var o=i.nextElementSibling;n.itemBox.removeChild(i),n.itemBox.insertBefore(e,o)}t._setAriaSelected(e,s),t._view.items.setItemAt(n.newIndex,{element:e,itemBox:n.itemBox,container:n.container,itemsManagerRecord:n.itemsManagerRecord}),delete t._updater.elements[V(i)],f._disposeElement(i),t._updater.elements[V(e)]={item:e,container:n.container,itemBox:n.itemBox,index:n.index,newIndex:n.newIndex,itemsManagerRecord:n.itemsManagerRecord}}else n.itemBox&&n.container&&(x._ItemEventsHandler.renderSelection(n.itemBox,e,s,!0),g[s?"addClass":"removeClass"](n.container,S._selectedClass));t._updater.changed=!0}for(var r=0,a=t._notificationHandlers.length;a>r;r++)t._notificationHandlers[r].changed(e,i);t._writeProfilerMark("changed,info")}},removed:function(e,i,n){function s(e){t._updater.updateDrag=!0,t._currentMode()._dragging&&t._currentMode()._draggingUnselectedItem&&t._currentMode()._dragInfo._isIncluded(e)&&(t._updater.newDragInfo=new O._Selection(t,[]));var i=t._updater.selectionFirst[e],n=t._updater.selectionLast[e],s=i||n;s&&(delete t._updater.selectionFirst[s.oldFirstIndex],delete t._updater.selectionLast[s.oldLastIndex],t._updater.selectionChanged=!0)}if(!t._ifZombieDispose()){t._createUpdater();var o=t._insertedItems[n];o&&delete t._insertedItems[n];var r;if(e){var a=t._updater.elements[V(e)],l=t._itemsManager.itemObject(e);if(l&&t._groupFocusCache.deleteItem(l.key),a){if(r=a.index,a.itemBox){var h=a.itemBox,d=S._containerOddClass,u=S._containerEvenClass,c=g.hasClass(h.parentElement,u)?u:d;t._updater.removed.push({index:r,itemBox:h,containerStripe:c})}t._updater.deletesCount++;var _=t._view.items.itemDataAt(r);_.removed=!0,delete t._updater.elements[V(e)]}else r=l&&l.index;t._updater.oldFocus.type!==b.ObjectType.groupHeader&&t._updater.oldFocus.index===r&&(t._updater.newFocus.index=r,t._updater.focusedItemRemoved=!0),s(r)}else r=t._updater.selectionHandles[n],r===+r&&s(r);t._writeProfilerMark("removed("+r+"),info"),t._updater.changed=!0}},updateAffectedRange:function(e){t._itemsCount().then(function(i){var n=t._view.containers?t._view.containers.length:0;e.start=Math.min(e.start,n),t._affectedRange.add(e,i)}),t._createUpdater(),t._updater.changed=!0},indexChanged:function(e,i,n){if(!t._ifZombieDispose()){if(t._createUpdater(),e){var s=t._itemsManager.itemObject(e);s&&t._groupFocusCache.updateItemIndex(s.key,i);var o=t._updater.elements[V(e)];o&&(o.newIndex=i,t._updater.changed=!0),t._updater.itemsMoved=!0}t._currentMode()._dragging&&t._currentMode()._draggingUnselectedItem&&t._currentMode()._dragInfo._isIncluded(n)&&(t._updater.newDragInfo=new O._Selection(t,[{firstIndex:i,lastIndex:i}]),t._updater.updateDrag=!0),t._updater.oldFocus.type!==b.ObjectType.groupHeader&&t._updater.oldFocus.index===n&&(t._updater.newFocus.index=i,t._updater.changed=!0),t._updater.oldSelectionPivot===n&&(t._updater.newSelectionPivot=i,t._updater.changed=!0);var r=t._updater.selectionFirst[n];r&&(r.newFirstIndex=i,t._updater.changed=!0,t._updater.selectionChanged=!0,t._updater.updateDrag=!0),r=t._updater.selectionLast[n],r&&(r.newLastIndex=i,t._updater.changed=!0,t._updater.selectionChanged=!0,t._updater.updateDrag=!0)}},endNotifications:function(){t._update()},inserted:function(e){t._ifZombieDispose()||(t._writeProfilerMark("inserted,info"),t._createUpdater(),t._updater.changed=!0,e.retain(),t._updater.insertsCount++,t._insertedItems[e.handle]=e)},moved:function(e,i,n,s){if(!t._ifZombieDispose()){if(t._createUpdater(),t._updater.movesCount++,e){t._updater.itemsMoved=!0;var o=t._updater.elements[V(e)];o&&(o.moved=!0)}var r=t._updater.selectionHandles[s.handle];if(r===+r){t._updater.updateDrag=!0,t._updater.selectionChanged=!0,t._updater.changed=!0;var a=t._updater.selectionFirst[r],l=t._updater.selectionLast[r],h=a||l;h&&h.oldFirstIndex!==h.oldLastIndex&&(delete t._updater.selectionFirst[h.oldFirstIndex],delete t._updater.selectionLast[h.oldLastIndex])}t._writeProfilerMark("moved("+r+"),info")}},countChanged:function(e,i){t._ifZombieDispose()||(t._writeProfilerMark("countChanged("+e+"),info"),t._cachedCount=e,t._createUpdater(),t._view.lastIndexDisplayed+1===i&&(t._updater.changed=!0),t._updater.countDifference+=e-i)},reload:function(){t._ifZombieDispose()||(t._writeProfilerMark("reload,info"),t._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new I._VersionManager,this._updater=null;var n=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",e,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=S._UNINITIALIZED,this._itemsManager=y._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),i,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(e){return e>=t.indexOfFirstVisible&&e<=t.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",e,!1),this._selection._selected.set(n)},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource._isVirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var e={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:b.ObjectType.item,index:S._INVALID_INDEX},newSelectionPivot:{type:b.ObjectType.item,index:S._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:b.ObjectType.item,index:S._INVALID_INDEX},newFocus:{type:b.ObjectType.item,index:S._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(t,i,n){e.elements[V(i)]={item:i,container:n.container,itemBox:n.itemBox,index:t,newIndex:t,itemsManagerRecord:n.itemsManagerRecord,detached:n.detached}});for(var t=this._selection._selected._ranges,i=0,n=t.length;n>i;i++){var s=t[i],o={newFirstIndex:t[i].firstIndex,oldFirstIndex:t[i].firstIndex,newLastIndex:t[i].lastIndex,oldLastIndex:t[i].lastIndex};e.selectionFirst[o.oldFirstIndex]=o,e.selectionLast[o.oldLastIndex]=o,e.selectionHandles[s.firstPromise.handle]=o.oldFirstIndex,e.selectionHandles[s.lastPromise.handle]=o.oldLastIndex}e.oldSelectionPivot=this._selection._pivot,e.newSelectionPivot=e.oldSelectionPivot,e.oldFocus=this._selection._getFocused(),e.newFocus=this._selection._getFocused(),this._updater=e}},_synchronize:function(){var e=this._updater;if(this._updater=null,this._groupsChanged=!1,this._countDifference=this._countDifference||0,e&&e.changed){e.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),e.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(e.removed.map(function(e){return e.itemBox})),(e.itemsMoved||e.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var t=[];for(var i in e.selectionFirst)if(e.selectionFirst.hasOwnProperty(i)){var n=e.selectionFirst[i];e.selectionChanged=e.selectionChanged||n.newLastIndex-n.newFirstIndex!==n.oldLastIndex-n.oldFirstIndex,n.newFirstIndex<=n.newLastIndex&&t.push({firstIndex:n.newFirstIndex,lastIndex:n.newLastIndex})}if(e.selectionChanged){var s=new O._Selection(this,t);this._selection._fireSelectionChanging(s),this._selection._selected.set(t),this._selection._fireSelectionChanged(),s.clear()}else this._selection._selected.set(t);this._selection._updateCount(this._cachedCount),e.newSelectionPivot=Math.min(this._cachedCount-1,e.newSelectionPivot),this._selection._pivot=e.newSelectionPivot>=0?e.newSelectionPivot:S._INVALID_INDEX,e.newFocus.type!==b.ObjectType.groupHeader&&(e.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,e.newFocus.index))),this._selection._setFocused(e.newFocus,this._selection._keyboardFocused());var o=this._modifiedElements||[],r={};for(this._modifiedElements=[],this._countDifference+=e.countDifference,i=0;i<o.length;i++){var a=o[i];-1===a.newIndex?this._modifiedElements.push(a):r[a.newIndex]=a}for(i=0;i<e.removed.length;i++){var l=e.removed[i],a=r[l.index];a?delete r[l.index]:a={oldIndex:l.index},a.newIndex=-1,a._removalHandled||(a._itemBox=l.itemBox,a._containerStripe=l.containerStripe),this._modifiedElements.push(a)}var h=Object.keys(this._insertedItems);for(i=0;i<h.length;i++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[h[i]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var d={};for(i in e.elements)if(e.elements.hasOwnProperty(i)){var u=e.elements[i];d[u.newIndex]={element:u.item,container:u.container,itemBox:u.itemBox,itemsManagerRecord:u.itemsManagerRecord,detached:u.detached};var a=r[u.index];a?(delete r[u.index],a.newIndex=u.newIndex):a={oldIndex:u.index,newIndex:u.newIndex},a.moved=u.moved,this._modifiedElements.push(a)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var c=Object.keys(r);for(i=0;i<c.length;i++){var _=c[i],a=r[_];-1!==a.oldIndex&&this._modifiedElements.push(a)}this._view.items._itemData=d,e.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?e.newDragInfo&&(this._currentMode()._dragInfo=e.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),e.focusedItemRemoved||this._focusRequest&&e.oldFocus.index!==e.newFocus.index||e.oldFocus.type!==e.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):e.newFocusedItem&&(this._hasKeyboardFocus=e.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var m=this;return this._groups.synchronizeGroups().then(function(){return e.newFocus.type===b.ObjectType.groupHeader&&(e.newFocus.index=Math.min(m._groups.length()-1,e.newFocus.index),e.newFocus.index<0&&(e.newFocus={type:b.ObjectType.item,index:0}),m._selection._setFocused(e.newFocus,m._selection._keyboardFocused())),m._versionManager.endUpdating(),e.deletesCount>0&&m._updateDeleteWrapperSize(),m._view.updateTree(m._cachedCount,m._countDifference,m._modifiedElements)}).then(function(){return m._lastScrollPosition})}this._countDifference+=e?e.countDifference:0;var m=this;return this._groups.synchronizeGroups().then(function(){return e&&m._versionManager.endUpdating(),m._view.updateTree(m._cachedCount,m._countDifference,m._modifiedElements)}).then(function(){return m.scrollPosition})},_updateDeleteWrapperSize:function(e){var t=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+t]=(e?0:this.scrollPosition+this._getViewportSize()[t])+"px"},_verifyRealizationNeededForChange:function(){var e=!1,t=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),i=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(i&&this._updater.elements)for(var n=Object.keys(this._updater.elements),s=0,o=n.length;o>s;s++){var r=this._updater.elements[n[s]],a=r.index-r.newIndex;if(0>a||a>this._updater.deletesCount){i=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,i&&this._view.lastIndexDisplayed<this._view.end-t&&this._updater.deletesCount+this._view.deletesWithoutRealize<t?(e=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(e)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var e=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(t){e._writeProfilerMark("update,StopTM"),e._batchViewUpdates(S._ViewChange.relayout,S._ScrollToPriority.low,t).complete()})):this._batchViewUpdates(S._ViewChange.relayout,S._ScrollToPriority.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var e=this;this._updateJob=_.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){e._updateJob&&e._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groups=this._groupDataSource?new T._UnvirtualizedGroupsContainer(this,this._groupDataSource):new T._NoGroups(this)},_createLayoutSite:function(){var t=this;return Object.create({invalidateLayout:function(){t._pendingLayoutReset=!0;var e="horizontal"===t._layout.orientation!==t._horizontalLayout;t._affectedRange.addAll(),t._batchViewUpdates(S._ViewChange.rebuild,S._ScrollToPriority.low,e?0:t.scrollPosition,!1,!0)},itemFromIndex:function(e){return t._itemsManager._itemPromiseAtIndex(e)},groupFromIndex:function(e){return t._groupsEnabled()?e<t._groups.length()?t._groups.group(e).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(e){return e=Math.max(0,e),t._groups.groupFromItem(e)},renderItem:function(i){return c._cancelBlocker(t._itemsManager._itemFromItemPromise(i)).then(function(i){if(i){var n=t._itemsManager._recordFromElement(i);n.pendingReady&&n.pendingReady(),i=i.cloneNode(!0),g.addClass(i,S._itemClass);var s=e.document.createElement("div");g.addClass(s,S._itemBoxClass),s.appendChild(i);var o=e.document.createElement("div");return g.addClass(o,S._containerClass),o.appendChild(s),o}return c.cancel})},renderHeader:function(i){var n=y._normalizeRendererReturn(t.groupHeaderTemplate(c.wrap(i)));return n.then(function(t){g.addClass(t.element,S._headerClass);var i=e.document.createElement("div");return g.addClass(i,S._headerContainerClass),i.appendChild(t.element),i})},readyToMeasure:function(){t._getViewportLength(),t._getCanvasMargins()},_isZombie:function(){return t._isZombie()},_writeProfilerMark:function(e){t._writeProfilerMark(e)}},{_itemsManager:{enumerable:!0,get:function(){return t._itemsManager}},rtl:{enumerable:!0,get:function(){return t._rtl()}},surface:{enumerable:!0,get:function(){return t._canvas}},viewport:{enumerable:!0,get:function(){return t._viewport}},scrollbarPos:{enumerable:!0,get:function(){return t.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return t._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return t.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return t._animationsDisabled()}},tree:{enumerable:!0,get:function(){return t._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,t.scrollPosition-2*t._getViewportLength()),lastPixel:t.scrollPosition+3*t._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:t.scrollPosition,lastPixel:t.scrollPosition+t._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return t._itemsCount()}},groupCount:{enumerable:!0,get:function(){return t._groups.length()}},header:{enumerable:!0,get:function(){return t.header}},footer:{enumerable:!0,get:function(){return t.footer}}})},_initializeLayout:function(){this._affectedRange.addAll();var e=this._createLayoutSite();return this._layout.initialize(e,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(e){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",g.addClass(this._viewport,S._horizontalClass),g.removeClass(this._viewport,S._verticalClass),e&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",g.addClass(this._viewport,S._verticalClass),g.removeClass(this._viewport,S._horizontalClass),e&&g.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(e){var t=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),t=!0);var i;if(e&&"function"==typeof e.type){var n=j(e.type);i=new n(e)}else i=e&&e.initialize?e:new A.GridLayout(e);t&&this._resetCanvas(),this._layoutImpl=i,this._layout=new A._LayoutWrapper(i),t&&this._unsetFocusOnItem(),this._setFocusOnItem({type:b.ObjectType.item,index:0}),this._selection._setFocused({type:b.ObjectType.item,index:0}),this._lastFocusedElementInGroupTrack={type:b.ObjectType.item,index:-1},this._headerContainer.style.opacity=0,this._footerContainer.style.opacity=0,this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(t),t&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setDraggable:function(){var e=this.itemsDraggable||this.itemsReorderable;this._view.items.each(function(t,i,n){n.itemBox&&(n.itemBox.draggable=e&&!g.hasClass(i,S._nonDraggableClass))})},_resizeViewport:function(){this._viewportWidth=S._UNINITIALIZED,this._viewportHeight=S._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info"),_.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==S._UNINITIALIZED&&this._viewportHeight!==S._UNINITIALIZED){var e=this._element.offsetWidth,t=this._element.offsetHeight;if(this._previousWidth!==e||this._previousHeight!==t){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+e+"x"+t+"),info"),this._previousWidth=e,this._previousHeight=t,this._resizeViewport();var i=this;this._affectedRange.addAll(),this._batchViewUpdates(S._ViewChange.relayout,S._ScrollToPriority.low,function(){return{position:i.scrollPosition,direction:"right"}})}}},_.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(e){function t(e){i._changeFocus(i._selection._getFocused(),!0,!1,!1,e)}this._hasKeyboardFocus=!0;var i=this;if(e.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?t(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(e.target===this._element)t();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var n=this._view.items,s={},o=this._getHeaderOrFooterFromElement(e.target),r=null;if(o?(s.index=0,s.type=o===this._header?b.ObjectType.header:b.ObjectType.footer,this._lastFocusedElementInGroupTrack=s):(o=this._groups.headerFrom(e.target),o?(s.type=b.ObjectType.groupHeader,s.index=this._groups.index(o),this._lastFocusedElementInGroupTrack=s):(s.index=n.index(e.target),s.type=b.ObjectType.item,o=n.itemBoxAt(s.index),r=n.itemAt(s.index))),s.index!==S._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(s.type===b.ObjectType.groupHeader&&e.target===o||s.type===b.ObjectType.item&&e.target.parentNode===o)&&this._drawFocusRectangle(o),this._tabManager.childFocus!==o&&this._tabManager.childFocus!==r&&(this._selection._setFocused(s,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,s.type===b.ObjectType.item&&(o=n.itemAt(s.index)),this._tabManager.childFocus=o,i._updater))){var a=i._updater.elements[V(o)],l=s.index;a&&a.newIndex&&(l=a.newIndex),i._updater.oldFocus={type:s.type,index:l},i._updater.newFocus={type:s.type,index:l}}}},_onFocusOut:function(e){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var t=this._view.items.itemBoxFrom(e.target)||this._groups.headerFrom(e.target);t&&this._clearFocusRectangle(t)}},_onMSManipulationStateChanged:function(e){function t(){i._manipulationEndSignal=null}var i=this;this._manipulationState=e.currentState,i._writeProfilerMark("_onMSManipulationStateChanged state("+e.currentState+"),info"),this._manipulationState===g._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new m,this._manipulationEndSignal.promise.done(t,t)),this._manipulationState===g._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var e=this._viewportScrollPosition;if(e!==this._lastScrollPosition){this._pendingScroll=i._requestAnimationFrame(this._checkScroller.bind(this)),e=Math.max(0,e);var t=this._scrollDirection(e);this._lastScrollPosition=e,this._raiseViewLoading(!0),this._raiseHeaderFooterVisibilityEvent();var n=this;this._view.onScroll(function(){return{position:n._lastScrollPosition,direction:t}},this._manipulationEndSignal?this._manipulationEndSignal.promise:c.timeout(S._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_scrollDirection:function(e){var t=e<this._lastScrollPosition?"left":"right";return t===this._lastDirection?t:this._direction},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(e){var t=this;e.forEach(function(e){var i=!1;if("dir"===e.attributeName?i=!0:"style"===e.attributeName&&(i=t._cachedStyleDir!==e.target.style.direction),i&&(t._cachedStyleDir=e.target.style.direction,t._cachedRTL=null,g[t._rtl()?"addClass":"removeClass"](t._element,S._rtlListViewClass),t._lastScrollPosition=0,t._viewportScrollPosition=0,t.forceLayout()),"tabIndex"===e.attributeName){var n=t._element.tabIndex;n>=0&&(t._view.items.each(function(e,t){t.tabIndex=n}),t._header&&(t._header.tabIndex=n),t._footer&&(t._footer.tabIndex=n),t._tabIndex=n,t._tabManager.tabIndex=n,t._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=A._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(e,t){function i(i,n){void 0!==e[i]&&(e[i]=t(e[i],n))}var n;return this._horizontal()?(n=this._getCanvasMargins()[this._rtl()?"right":"left"],i("left",n)):(n=this._getCanvasMargins().top,i("top",n)),i("begin",n),i("end",n),e},_convertFromCanvasCoordinates:function(e){return this._convertCoordinatesByCanvasMargins(e,function(e,t){return e+t})},_convertToCanvasCoordinates:function(e){return this._convertCoordinatesByCanvasMargins(e,function(e,t){return e-t})},_getViewportSize:function(){return(this._viewportWidth===S._UNINITIALIZED||this._viewportHeight===S._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,g.getContentWidth(this._element)),this._viewportHeight=Math.max(0,g.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function e(){t._itemsCountPromise=null}var t=this;if(this._cachedCount!==S._UNINITIALIZED)return c.wrap(this._cachedCount);var i;return this._itemsCountPromise?i=this._itemsCountPromise:(i=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(e){return e===b.CountResult.unknown&&(e=0),t._cachedCount=e,t._selection._updateCount(t._cachedCount),e},function(){return c.cancel}),this._itemsCountPromise.then(e,e)),i},_isSelected:function(e){return this._selection._isIncluded(e)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(e){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!e),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_raiseHeaderFooterVisibilityEvent:function(){var t=this,i=function(e){if(!e)return!1;var i=t._lastScrollPosition,n=e[t._horizontal()?"offsetLeft":"offsetTop"],s=e[t._horizontal()?"offsetWidth":"offsetHeight"];return n+s>i&&n<i+t._getViewportLength()},n=function(i,n){var s=e.document.createEvent("CustomEvent");s.initCustomEvent(i,!0,!0,{visible:n}),t._element.dispatchEvent(s)},s=!!this._header&&i(this._headerContainer),o=!!this._footer&&i(this._footerContainer);this._headerFooterVisibilityStatus.headerVisible!==s&&(this._headerFooterVisibilityStatus.headerVisible=s,n("headervisibilitychanged",s)),this._headerFooterVisibilityStatus.footerVisible!==o&&(this._headerFooterVisibilityStatus.footerVisible=o,n("footervisibilitychanged",o))},_setViewState:function(t){if(t!==this._loadingState){var i={scrolling:!1};switch(t){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(R(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:i={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+t+",info"),this._loadingState=t;var n=e.document.createEvent("CustomEvent");n.initCustomEvent("loadingstatechanged",!0,!1,i),this._element.dispatchEvent(n)}},_createTemplates:function(){function t(t,i){var n=e.document.createElement("div");return n.className=t,i||n.setAttribute("aria-hidden",!0),n}this._itemBoxTemplate=t(S._itemBoxClass,!0)},_updateSelection:function(){var e=this._selection.getIndices(),t=this._selection.isEverything(),i={};if(!t)for(var n=0,s=e.length;s>n;n++){var o=e[n];i[o]=!0}this._view.items.each(function(e,n,s){if(s.itemBox){var o=t||!!i[e];x._ItemEventsHandler.renderSelection(s.itemBox,n,o,!0),s.container&&g[o?"addClass":"removeClass"](s.container,S._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===e.getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(e,t,i){var n=this._progressBar,s=n.style;if(!n.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var o=this;this._progressIndicatorDelayTimer=c.timeout(S._LISTVIEW_PROGRESS_DELAY).then(function(){o._isZombie()||(e.appendChild(n),h.fadeIn(n),o._progressIndicatorDelayTimer=null)})}s[this._rtl()?"right":"left"]=t,s.top=i},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var e=this._progressBar;if(e.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var t=this;h.fadeOut(e).then(function(){e.parentNode&&e.parentNode.removeChild(e),t._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(e,t,s){if(i.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new n("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",U.notCompatibleWithSemanticZoom);this._isZoomedOut=e,this._disableEntranceAnimation=!t,this._isCurrentZoomView=t,this._triggerZoom=s},_setCurrentItem:function(e,t){this._rtl()&&(e=this._viewportWidth-e),this._horizontal()?e+=this.scrollPosition:t+=this.scrollPosition;var i=this._view.hitTest(e,t),n={type:i.type?i.type:b.ObjectType.item,index:i.index};n.index>=0&&(this._hasKeyboardFocus?this._changeFocus(n,!0,!1,!0):this._changeFocusPassively(n))},_getCurrentItem:function(){var e=this._selection._getFocused();e.type===b.ObjectType.groupHeader?e={type:b.ObjectType.item,index:this._groups.group(e.index).startIndex}:e.type!==b.ObjectType.item&&(e={type:b.ObjectType.item,index:e.type===b.ObjectType.header?0:this._cachedCount}),"number"!=typeof e.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),e=this._selection._getFocused());var t=this,i=this._getItemOffsetPosition(e.index).then(function(e){var i=t._canvasStart;return e[t._startProperty]+=i,e});return c.join({item:this._dataSource.itemFromIndex(e.index),position:i})},_animateItemsForPhoneZoom:function(){function e(e,t,i){return function(n){return(t[n]-e)*i}}function t(){for(var e=0,t=i.length;t>e;e++)i[e].style[H.scriptName]=""}for(var i=[],n=[],s=[],o=Number.MAX_VALUE,r=this,a=this._view.firstIndexDisplayed,l=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);l>a;a++)s.push(this._view.waitForEntityPosition({type:b.ObjectType.item,index:a}).then(function(){i.push(r._view.items.containerAt(a));var e=0;if(r.layout._getItemPosition){var t=r.layout._getItemPosition(a);t.row&&(e=t.row)}n.push(e),o=Math.min(e,o)}));return c.join(s).then(function(){return(0===i.length?c.wrap():d.executeTransition(i,{property:H.cssName,delay:e(o,n,30),duration:100,timing:"ease-in-out",from:r._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:r._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(t,t)}).then(t,t)},_beginZoom:function(){this._zooming=!0;var e=null;if(i.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var t=this,n=function(){t._zoomAnimationPromise=null};this._zoomAnimationPromise=e=this._animateItemsForPhoneZoom().then(n,n)}else this._zoomAnimationPromise=new m,e=this._zoomAnimationPromise.promise}else{var s=this._horizontal(),o=-this.scrollPosition;g.addClass(this._viewport,s?S._zoomingXClass:S._zoomingYClass),this._canvasStart=o,g.addClass(this._viewport,s?S._zoomingYClass:S._zoomingXClass)}return e},_positionItem:function(e,t){function s(e){return o._getItemOffsetPosition(e).then(function(n){var s,r=o._horizontal(),a=o._viewport[r?"scrollWidth":"scrollHeight"],l=r?o._viewportWidth:o._viewportHeight,h=r?"headerContainerWidth":"headerContainerHeight",d=o.layout._sizes,u=0;d&&d[h]&&(u=d[h]);var c=i.isPhone?u:t[o._startProperty],_=l-(r?n.width:n.height);c=Math.max(0,Math.min(_,c)),s=n[o._startProperty]-c;var m=Math.max(0,Math.min(a-l,s)),p=m-s;s=m;var f={type:b.ObjectType.item,index:e};if(o._hasKeyboardFocus?o._changeFocus(f,!0):o._changeFocusPassively(f),o._raiseViewLoading(!0),i.isPhone)o._viewportScrollPosition=s;else{var g=-s;o._canvasStart=g}if(o._view.realizePage(s,!0),i.isPhone&&o._isZoomedOut){var v=function(){o._zoomAnimationPromise&&o._zoomAnimationPromise.complete&&o._zoomAnimationPromise.complete(),o._zoomAnimationPromise=null};o._animateItemsForPhoneZoom().then(v,v)}return r?{x:p,y:0}:{x:0,y:p}})}var o=this,r=0;if(e&&(r=this._isZoomedOut?e.groupIndexHint:e.firstItemIndexHint),
"number"==typeof r)return s(r);var a,l=this._isZoomedOut?e.groupKey:e.firstItemKey;if("string"==typeof l&&this._dataSource.itemFromKey)a=this._dataSource.itemFromKey(l,this._isZoomedOut?{groupMemberKey:e.key,groupMemberIndex:e.index}:null);else{var h=this._isZoomedOut?e.groupDescription:e.firstItemDescription;if(i.validation&&void 0===h)throw new n("WinJS.UI.ListView.InvalidItem",U.listViewInvalidItem);a=this._dataSource.itemFromDescription(h)}return a.then(function(e){return s(e.index)})},_endZoom:function(e){if(!this._isZombie()){if(!i.isPhone){var t=this._canvasStart;g.removeClass(this._viewport,S._zoomingYClass),g.removeClass(this._viewport,S._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-t}this._disableEntranceAnimation=!e,this._isCurrentZoomView=e,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(e){var t=this;return this._getItemOffset({type:b.ObjectType.item,index:e}).then(function(e){return t._ensureFirstColumnRange(b.ObjectType.item).then(function(){return e=t._correctRangeInFirstColumn(e,b.ObjectType.item),e=t._convertFromCanvasCoordinates(e),t._horizontal()?(e.left=e.begin,e.width=e.end-e.begin,e.height=e.totalHeight):(e.top=e.begin,e.height=e.end-e.begin,e.width=e.totalWidth),e})})},_groupRemoved:function(e){this._groupFocusCache.deleteGroup(e)},_updateFocusCache:function(e){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var t=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(e).then(function(){t._updateFocusCacheItemRequest=null;var i=t._view.items.itemDataAt(e),n=t._groups.groupFromItem(e),s=t._groups.group(n).key;i.itemsManagerRecord.item&&t._groupFocusCache.updateCache(s,i.itemsManagerRecord.item.key,e)})},_changeFocus:function(e,t,i,n,s){if(!this._isZombie()){var o;if(e.type===b.ObjectType.item)o=this._view.items.itemAt(e.index),!t&&o&&g.hasClass(o,S._nonSelectableClass)&&(t=!0),this._updateFocusCache(e.index);else if(e.type===b.ObjectType.groupHeader){this._lastFocusedElementInGroupTrack=e;var r=this._groups.group(e.index);o=r&&r.header}else this._lastFocusedElementInGroupTrack=e,o=e.type===b.ObjectType.footer?this._footer:this._header;this._unsetFocusOnItem(!!o),this._hasKeyboardFocus=!0,this._selection._setFocused(e,s),n||this.ensureVisible(e),!t&&this._selectFocused(i)&&this._selection.set(e.index),this._setFocusOnItem(e)}},_changeFocusPassively:function(e){var t;switch(e.type){case b.ObjectType.item:t=this._view.items.itemAt(e.index),this._updateFocusCache(e.index);break;case b.ObjectType.groupHeader:this._lastFocusedElementInGroupTrack=e;var i=this._groups.group(e.index);t=i&&i.header;break;case b.ObjectType.header:this._lastFocusedElementInGroupTrack=e,t=this._header;break;case b.ObjectType.footer:this._lastFocusedElementInGroupTrack=e,t=this._footer}this._unsetFocusOnItem(!!t),this._selection._setFocused(e),this._setFocusOnItem(e)},_drawFocusRectangle:function(t){if(t!==this._header&&t!==this._footer)if(g.hasClass(t,S._headerClass))g.addClass(t,S._itemFocusClass);else{var i=this._view.items.itemBoxFrom(t);if(i.querySelector("."+S._itemFocusOutlineClass))return;g.addClass(i,S._itemFocusClass);var n=e.document.createElement("div");n.className=S._itemFocusOutlineClass,i.appendChild(n)}},_clearFocusRectangle:function(e){if(e&&!this._isZombie()&&e!==this._header&&e!==this._footer){var t=this._view.items.itemBoxFrom(e);if(t){g.removeClass(t,S._itemFocusClass);var i=t.querySelector("."+S._itemFocusOutlineClass);i&&i.parentNode.removeChild(i)}else{var n=this._groups.headerFrom(e);n&&g.removeClass(n,S._itemFocusClass)}}},_defaultInvoke:function(e){(this._isZoomedOut||i.isPhone&&this._triggerZoom&&e.type===b.ObjectType.groupHeader)&&(this._changeFocusPassively(e),this._triggerZoom())},_selectionAllowed:function(e){var t=void 0!==e?this.elementFromIndex(e):null,i=!(t&&g.hasClass(t,S._nonSelectableClass));return i&&this._selectionMode!==b.SelectionMode.none},_multiSelection:function(){return this._selectionMode===b.SelectionMode.multi},_isInSelectionMode:function(){return this.tapBehavior===b.TapBehavior.toggleSelect&&this.selectionMode===b.SelectionMode.multi},_selectOnTap:function(){return this._tap===b.TapBehavior.toggleSelect||this._tap===b.TapBehavior.directSelect},_selectFocused:function(e){return this._tap===b.TapBehavior.directSelect&&this._selectionMode===b.SelectionMode.multi&&!e},_dispose:function(){if(!this._disposed){this._disposed=!0;var e=function(e){e&&(e.textContent="")};g._resizeNotifier.unsubscribe(this._element,this._onMSElementResizeBound),this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),e(this._viewport),e(this._canvas),e(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var t=W.indexOf(this);t>=0&&W.splice(t,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&e.document.body.contains(this.element))},_ifZombieDispose:function(){var e=this._isZombie();return e&&!this._disposed&&R(this),e},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!d.isAnimationEnabled()},_fadeOutViewport:function(){var e=this;return new c(function(t){if(e._animationsDisabled())return void t();if(!e._fadingViewportOut){e._waitingEntranceAnimationPromise&&(e._waitingEntranceAnimationPromise.cancel(),e._waitingEntranceAnimationPromise=null);var i=e._fireAnimationEvent(q.contentTransition);e._firedAnimationEvent=!0,i.prevented?(e._disableEntranceAnimation=!0,e._viewport.style.opacity=1,t()):(e._fadingViewportOut=!0,e._viewport.style.overflow="hidden",h.fadeOut(e._viewport).then(function(){e._isZombie()||(e._fadingViewportOut=!1,e._viewport.style.opacity=1,t())}))}})},_animateListEntrance:function(){function e(){n._canvas.style.opacity=1,n._headerContainer.style.opacity=1,n._footerContainer.style.opacity=1,n._viewport.style.overflow="",n._raiseHeaderFooterVisibilityEvent()}var t={prevented:!1,animationPromise:c.wrap()},n=this;return this._raiseHeaderFooterVisibilityEvent(),this._disableEntranceAnimation||this._animationsDisabled()?(e(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),c.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:t=this._fireAnimationEvent(q.entrance),t.prevented||i.isPhone?(e(),c.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,this._viewport.style.overflow="hidden",this._headerContainer.style.opacity=1,this._footerContainer.style.opacity=1,this._waitingEntranceAnimationPromise=t.animationPromise.then(function(){return n._isZombie()?void 0:(n._canvas.style.opacity=1,h.enterContent(n._viewport).then(function(){n._isZombie()||(n._waitingEntranceAnimationPromise=null,n._viewport.style.overflow="")}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(t){var i=e.document.createEvent("CustomEvent"),n=c.wrap();i.initCustomEvent("contentanimating",!0,!0,{type:t}),t===q.entrance&&(i.detail.setPromise=function(e){n=e});var s=!this._element.dispatchEvent(i);return{prevented:s,animationPromise:n}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",U.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=e.document.createElement("div"),this._ariaStartMarker.id=V(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=e.document.createElement("div"),this._ariaEndMarker.id=V(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var e,t,i=this,n=this._element.getAttribute("role");this._currentMode().staticMode()?(e="list",t="listitem"):(e="listbox",t="option"),(n!==e||this._itemRole!==t)&&(this._element.setAttribute("role",e),this._itemRole=t,this._view.items.each(function(e,t){t.setAttribute("role",i._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var e=this.groupHeaderTapBehavior===b.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==e){this._headerRole=e;for(var t=0,i=this._groups.length();i>t;t++){var n=this._groups.group(t).header;n&&n.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(e,t){var i="true"===e.getAttribute("aria-selected");t!==i&&e.setAttribute("aria-selected",t)},_setupAriaSelectionObserver:function(e){e._mutationObserver||(this._mutationObserver.observe(e,{attributes:!0,attributeFilter:["aria-selected"]}),e._mutationObserver=!0)},_itemPropertyChange:function(e){function t(e){e.forEach(function(e){e.item.setAttribute("aria-selected",!e.selected)})}if(!this._isZombie()){for(var i=this,n=i._selectionMode===b.SelectionMode.single,s=[],o=[],r=0,a=e.length;a>r;r++){var l=e[r].target,h=i._view.items.itemBoxFrom(l),d="true"===l.getAttribute("aria-selected");if(h&&d!==g._isSelectionRendered(h)){var u=i._view.items.index(h),c={index:u,item:l,selected:d};(i._selectionAllowed(u)?s:o).push(c)}}if(s.length>0){var _=new m;i.selection._synchronize(_).then(function(){var e=i.selection._cloneSelection();return s.forEach(function(t){t.selected?e[n?"set":"add"](t.index):e.remove(t.index)}),i.selection._set(e)}).then(function(e){i._isZombie()||e||t(s),_.complete()})}t(o)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(e,t){var i=this;return this._view.waitForEntityPosition(e).then(function(){var n,s=i._zooming&&0!==i._canvasStart;switch(e.type){case b.ObjectType.item:n=i._view.getContainer(e.index);break;case b.ObjectType.groupHeader:n=i._view._getHeaderContainer(e.index);break;case b.ObjectType.header:s=!0,n=i._headerContainer;break;case b.ObjectType.footer:s=!0,n=i._footerContainer}if(n){i._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info");var o,r;i._view._expandedRange?(o=i._view._expandedRange.first.index,r=i._view._expandedRange.last.index):t=!1,e.type===b.ObjectType.item?(t=!!t,t&=i._view._ensureContainerInDOM(e.index)):t=!1;var a=i._getItemMargins(e.type),l={left:i._rtl()?F(n)-a.right:n.offsetLeft-a.left,top:n.offsetTop-a.top,totalWidth:g.getTotalWidth(n),totalHeight:g.getTotalHeight(n),contentWidth:g.getContentWidth(n),contentHeight:g.getContentHeight(n)};return t&&i._view._forceItemsBlocksInDOM(o,r+1),s?l:i._convertToCanvasCoordinates(l)}return c.cancel})},_getItemOffset:function(e,t){var i=this;return this._getItemPosition(e,t).then(function(t){var n=i._getItemMargins(e.type);if(i._horizontal()){var s=i._rtl();t.begin=t.left-n[s?"left":"right"],t.end=t.left+t.totalWidth+n[s?"right":"left"]}else t.begin=t.top-n.bottom,t.end=t.top+t.totalHeight+n.top;return t})},_getItemMargins:function(t){t=t||b.ObjectType.item;var i=this,n=function(t){var n,s=i._canvas.querySelector("."+t);s||(s=e.document.createElement("div"),g.addClass(s,t),i._viewport.appendChild(s),n=!0);var o=A._getMargins(s);return n&&i._viewport.removeChild(s),o};return t===b.ObjectType.item?this._itemMargins?this._itemMargins:this._itemMargins=n(S._containerClass):t===b.ObjectType.groupHeader?this._headerMargins?this._headerMargins:this._headerMargins=n(S._headerContainerClass):(this._headerFooterMargins||(this._headerFooterMargins={headerMargins:n(S._listHeaderContainerClass),footerMargins:n(S._listFooterContainerClass)}),this._headerFooterMargins[t===b.ObjectType.header?"headerMargins":"footerMargins"])},_fireAccessibilityAnnotationCompleteEvent:function(t,i,n,s){var o={firstIndex:t,lastIndex:i,firstHeaderIndex:+n||-1,lastHeaderIndex:+s||-1},r=e.document.createEvent("CustomEvent");r.initCustomEvent("accessibilityannotationcomplete",!0,!1,o),this._element.dispatchEvent(r)},_ensureFirstColumnRange:function(e){if(e===b.ObjectType.header||e===b.ObjectType.footer)return c.wrap();var t=e===b.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[t])return c.wrap();var i=this;return this._getItemOffset({type:e,index:0},!0).then(function(e){i[t]=e})},_correctRangeInFirstColumn:function(e,t){if(t===b.ObjectType.header||t===b.ObjectType.footer)return e;var i=t===b.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return i.begin===e.begin&&(e.begin=this._horizontal()?-this._getCanvasMargins()[this._rtl()?"right":"left"]:-this._getCanvasMargins().top),e},_updateContainers:function(t,i,n,s){function o(){var t=e.document.createElement("div");return t.className=S._containerClass,t}function r(t,i,n){i+n>c&&(n=c-i);var s,o=t.itemsContainer,r=o.itemsBlocks,a=_._view._blockSize,l=r.length?r[r.length-1]:null,h=r.length?(r.length-1)*a+l.items.length:0,d=n-h;if(d>0){var u,m=d;if(l&&l.items.length<a){var p=Math.min(m,a-l.items.length);u=l.items.length;var f=k._stripedContainers(p,h);C.insertAdjacentHTMLUnsafe(l.element,"beforeend",f),s=l.element.children;for(var g=0;p>g;g++)l.items.push(s[u+g]);m-=p}h=r.length*a;var v=Math.floor(m/a),y="",w=h,S=h+a;if(v>0){var x=["<div class='win-itemsblock'>"+k._stripedContainers(a,w)+"</div>","<div class='win-itemsblock'>"+k._stripedContainers(a,S)+"</div>"];y=k._repeat(x,v),h+=v*a}var E=m%a;E>0&&(y+="<div class='win-itemsblock'>"+k._stripedContainers(E,h)+"</div>",h+=E,v++);var P=e.document.createElement("div");C.setInnerHTMLUnsafe(P,y);for(var s=P.children,g=0;v>g;g++){var M=s[g],T={element:M,items:k._nodeListToArray(M.children)};r.push(T)}}else if(0>d)for(var D=d;0>D;D++){var A=l.items.pop();!_._view._requireFocusRestore&&A.contains(e.document.activeElement)&&(_._view._requireFocusRestore=e.document.activeElement,_._unsetFocusOnItem()),l.element.removeChild(A),I.push(A),l.items.length||(o.element===l.element.parentNode&&o.element.removeChild(l.element),r.pop(),l=r[r.length-1])}for(var g=0,O=r.length;O>g;g++)for(var M=r[g],D=0;D<M.items.length;D++)b.push(M.items[D])}function a(e,t,i){for(var n=s.filter(function(e){return-1===e.oldIndex&&e.newIndex>=t&&e.newIndex<t+i}).sort(function(e,t){return e.newIndex-t.newIndex}),r=e.itemsContainer,a=0,l=n.length;l>a;a++){var h=n[a],d=h.newIndex-t,u=o(),c=d<r.items.length?r.items[d]:null;r.items.splice(d,0,u),r.element.insertBefore(u,c)}}function l(e,t,i){t+i>c&&(i=c-t);var n=e.itemsContainer,s=i-n.items.length;if(s>0){var o=n.element.children,r=o.length;C.insertAdjacentHTMLUnsafe(n.element,"beforeend",k._repeat("<div class='win-container win-backdrop'></div>",s));for(var a=0;s>a;a++){var l=o[r+a];n.items.push(l)}}for(var a=s;0>a;a++){var l=n.items.pop();n.element.removeChild(l),I.push(l)}for(var a=0,h=n.items.length;h>a;a++)b.push(n.items[a])}function h(e,t){var i=_._view._createHeaderContainer(L),n={header:i,itemsContainer:{element:_._view._createItemsContainer(i)}};return n.itemsContainer[_._view._blockSize?"itemsBlocks":"items"]=[],_._view._blockSize?r(n,t,e.size):l(n,t,e.size),n}function d(e,t,n,o){for(var r,a,l=n+o-1,h=0,d=s.length;d>h;h++){var u=s[h];u.newIndex>=n&&u.newIndex<=l&&-1!==u.oldIndex&&(r!==+r||u.newIndex<r)&&(r=u.newIndex,a=u.newIndex-u.oldIndex)}if(r===+r){var c=0;for(h=0,d=s.length;d>h;h++){var u=s[h];u.newIndex>=n&&u.newIndex<r&&-1===u.oldIndex&&c++}var m=0,p=r-a;for(h=0,d=s.length;d>h;h++){var u=s[h];u.oldIndex>=t&&u.oldIndex<p&&-1===u.newIndex&&m++}a+=m,a-=c,a-=n-t;var f=e.itemsContainer;if(a>0){var g=f.element.children;C.insertAdjacentHTMLUnsafe(f.element,"afterBegin",k._repeat("<div class='win-container win-backdrop'></div>",a));for(var v=0;a>v;v++){var y=g[v];f.items.splice(v,0,y)}}for(var v=a;0>v;v++){var y=f.items.shift();f.element.removeChild(y)}a&&_._affectedRange.add({start:n,end:n+o},i)}}function u(e){for(var t=0,i=0,n=_._view.tree.length;n>i;i++){var s=_._view.tree[i],o=s.itemsContainer.items.length,r=t+o-1;if(e>=t&&r>=e)return{group:i,item:e-t};t+=o}}var c,_=this,m=this._view.containers.length+n,p=i>m;if(p){for(var f=0,v=0;v<s.length;v++)-1===s[v].oldIndex&&f++;c=this._view.containers.length+f}else c=i;var y=[],w={},b=[],I=[],x=[],E=0;if(!_._view._blockSize)for(var v=0,P=this._view.tree.length;P>v;v++)x.push(E),E+=this._view.tree[v].itemsContainer.items.length;if(!_._view._blockSize)for(var M=s.filter(function(e){return-1===e.newIndex&&!e._removalHandled}).sort(function(e,t){return t.oldIndex-e.oldIndex}),v=0,P=M.length;P>v;v++){var T=M[v];T._removalHandled=!0;var D=T._itemBox;T._itemBox=null;var A=u(T.oldIndex),O=this._view.tree[A.group],B=O.itemsContainer.items[A.item];B.parentNode.removeChild(B),g.hasClass(D,S._selectedClass)&&g.addClass(B,S._selectedClass),O.itemsContainer.items.splice(A.item,1),T.element=B}this._view._modifiedGroups=[];var L=this._canvasProxy;E=0;for(var v=0,P=t.length;P>v&&(!this._groupsEnabled()||c>E);v++){var R=t[v],F=this._view.keyToGroupIndex[R.key],z=this._view.tree[F];if(z)_._view._blockSize?r(z,E,R.size):(d(z,x[F],E,R.size),a(z,E,R.size),l(z,E,R.size)),y.push(z),w[R.key]=y.length-1,delete this._view.keyToGroupIndex[R.key],L=z.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:F,newIndex:y.length-1,element:z.header});else{var H=h(R,E);y.push(H),w[R.key]=y.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:y.length-1,element:H.header}),L=H.itemsContainer.element}E+=R.size}for(var N=[],W=[],V=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],v=0,P=V.length;P>v;v++){var A=this._view.keyToGroupIndex[V[v]],U=this._view.tree[A];if(W.push(U.header),N.push(U.itemsContainer.element),this._view._blockSize)for(var j=0;j<U.itemsContainer.itemsBlocks.length;j++)for(var q=U.itemsContainer.itemsBlocks[j],J=0;J<q.items.length;J++)I.push(q.items[J]);else for(var J=0;J<U.itemsContainer.items.length;J++)I.push(U.itemsContainer.items[J]);this._view._modifiedGroups.push({oldIndex:A,newIndex:-1,element:U.header})}for(var v=0,P=s.length;P>v;v++)if(-1===s[v].newIndex&&!s[v]._removalHandled){s[v]._removalHandled=!0;var D=s[v]._itemBox;s[v]._itemBox=null;var B;I.length?(B=I.pop(),g.empty(B)):B=o(),g.hasClass(D,S._selectedClass)&&g.addClass(B,S._selectedClass),s._containerStripe===S._containerEvenClass?(g.addClass(B,S._containerEvenClass),g.removeClass(B,S._containerOddClass)):(g.addClass(B,S._containerOddClass),g.removeClass(B,S._containerEvenClass)),B.appendChild(D),s[v].element=B}return this._view.tree=y,this._view.keyToGroupIndex=w,this._view.containers=b,{removedHeaders:W,removedItemsContainers:N}},_writeProfilerMark:function(e){var t="WinJS.UI.ListView:"+this._id+":"+e;a(t),o.log&&o.log(t,null,"listviewprofiler")}},{triggerDispose:function(){L()}});return t.Class.mix(v,s.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","headervisibilitychanged","footervisibilitychanged","accessibilityannotationcomplete")),t.Class.mix(v,p.DOMEventMixin),v})})}),n("WinJS/Controls/FlipView/_Constants",[],function(){"use strict";var e={};return e.datasourceCountChangedEvent="datasourcecountchanged",e.pageVisibilityChangedEvent="pagevisibilitychanged",e.pageSelectedEvent="pageselected",e.pageCompletedEvent="pagecompleted",e}),n("WinJS/Controls/FlipView/_PageManager",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_TabContainer","./_Constants"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_FlipPageManager:i.Namespace._lazy(function(){function e(e){var t=e.winControl;return t&&t._isFlipView?!0:!1}function r(e){e.forEach(function(e){var i=e.target;i.winControl&&i.tabIndex>=0&&(i.winControl._pageManager._updateTabIndex(i.tabIndex),i.tabIndex=-1);var n=i.winControl;if(n&&n._isFlipView){var s=!1;"dir"===e.attributeName?s=!0:"style"===e.attributeName&&(s=n._cachedStyleDir!==i.style.direction),s&&(n._cachedStyleDir=i.style.direction,n._pageManager._rtl="rtl"===t.getComputedStyle(n._pageManager._flipperDiv,null).direction,n._pageManager.resized())}})}var f=_._uniqueID,g=n._browserStyleEquivalents,v=50,y=250,C={get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"}},w=i.Class.define(function(e,i,s,o,a,l,h){this._visibleElements=[],this._flipperDiv=e,this._panningDiv=i,this._panningDivContainer=s,this._buttonVisibilityHandler=h,this._currentPage=null,this._rtl="rtl"===t.getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=o,this._itemSpacing=a,this._tabIndex=_.getTabIndex(e),this._tabIndex<0&&(this._tabIndex=0),i.tabIndex=-1,e.tabIndex=-1,this._tabManager=new m.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=w.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=l;var d=this;this._panningDiv.addEventListener("keydown",function(e){d._blockTabs&&e.keyCode===_.Key.tab&&(e.stopImmediatePropagation(),e.preventDefault())},!0),_._addEventListener(this._flipperDiv,"focusin",function(e){e.target===d._flipperDiv&&d._currentPage.element&&_._setActive(d._currentPage.element)},!1),new _._MutationObserver(r).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._handleManipulationStateChangedBound=this._handleManipulationStateChanged.bind(this),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(n._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0)},{initialize:function(e,i){var n=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._isHorizontal=i,!this._currentPage){this._bufferAriaStartMarker=t.document.createElement("div"),this._bufferAriaStartMarker.id=f(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),n=this._currentPage,this._panningDiv.appendChild(n.pageRoot);for(var s=2*this._bufferSize,o=0;s>o;o++)n=this._createFlipPage(n,this),this._panningDiv.appendChild(n.pageRoot);this._bufferAriaEndMarker=t.document.createElement("div"),this._bufferAriaEndMarker.id=f(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,e)},dispose:function(){var e=this._currentPage,t=e;do c._disposeElement(t.element),t=t.next;while(t!==e)},setOrientation:function(e){if(this._notificationsEndedSignal){var t=this;return void this._notificationsEndedSignal.promise.done(function(){t._notificationsEndedSignal=null,t.setOrientation(e)})}if(e!==this._isHorizontal){this._isOrientationChanging=!0,this._isHorizontal?_.setScrollPosition(this._panningDivContainer,{scrollLeft:this._getItemStart(this._currentPage),scrollTop:0}):_.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:this._getItemStart(this._currentPage)}),this._isHorizontal=e;var i=this._panningDivContainer.style;i.overflowX="hidden",i.overflowY="hidden";var t=this;n._requestAnimationFrame(function(){t._isOrientationChanging=!1,t._forEachPage(function(e){var t=e.pageRoot.style;t.left="0px",t.top="0px"}),i.overflowX=t._isHorizontal&&t._environmentSupportsTouch?"scroll":"hidden",i.overflowY=t._isHorizontal||!t._environmentSupportsTouch?"hidden":"scroll",t._ensureCentered()})}},resetState:function(e){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==e){var t=this.jumpToIndex(e,!0);if(!t&&n.validation)throw new s("WinJS.UI.FlipView.BadCurrentPage",C.badCurrentPage);return t}c.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var i=this,o=h.wrap(!0);return this._itemsManager&&(o=i._itemsManager._firstItem().then(function(e){return i._currentPage.setElement(e),i._fetchPreviousItems(!0).then(function(){return i._fetchNextItems()}).then(function(){i._setButtonStates()})})),o.then(function(){i._tabManager.childFocus=i._currentPage.element,i._ensureCentered(),i._itemSettledOn()})},setNewItemsManager:function(e,t){this._itemsManager=e;var i=this;return this.resetState(t).then(function(){0!==t&&(i._tabManager.childFocus=i._currentPage.element,i._ensureCentered(),i._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var e=0,t=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return t&&(e=this._getElementIndex(t)),e},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._hasFocus&&(this._hadFocus=!0),this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var e=this._getViewportStart(),t=this._lastScrollPos>e?this._getTailOfBuffer():this._getHeadOfBuffer();if(e!==this._lastScrollPos){for(;this._currentPage.element&&this._getItemStart(this._currentPage)>e&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(t.prev),t=t.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=e&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(t.next),t=t.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=e,this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element),this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(e,t){var i=this;if(this._forEachPage(function(n){return n.element===t?(n===i._currentPage||n===i._currentPage.next?i._changeFlipPage(n,t,e):n.setElement(e,!0),!0):void 0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var n=this._navigationAnimationRecord.elementContainers,s=0,o=n.length;o>s;s++)n[s].element===t&&(i._changeFlipPage(n[s],t,e),n[s].element=e);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var e=this;this._forEachPage(function(t){t.pageRoot.style.width=e._panningDivContainerOffsetWidth+"px",t.pageRoot.style.height=e._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(e,t){if(!t){if(!this._itemsManager||!this._currentPage.element||0>e)return h.wrap(!1);var i=this._getElementIndex(this._currentPage.element),n=Math.abs(e-i);if(0===n)return h.wrap(!1)}var s=h.wrap(!0),o=this;return s=s.then(function(){var i=o._itemsManager._itemPromiseAtIndex(e);return h.join({element:o._itemsManager._itemFromItemPromise(i),item:i}).then(function(e){var i=e.element;return o._resetBuffer(i,t),i?(o._currentPage.setElement(i),o._fetchNextItems().then(function(){return o._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),s=s.then(function(e){return o._setButtonStates(),e})},startAnimatedNavigation:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var n=this._currentPage,s=e?this._currentPage.next:this._currentPage.prev;if(s.element){this._hasFocus&&_._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=e,this._navigationAnimationRecord.cancelAnimationCallback=t,this._navigationAnimationRecord.completionCallback=i,this._navigationAnimationRecord.oldCurrentPage=n,this._navigationAnimationRecord.newCurrentPage=s;var o=n.element,r=s.element;this._navigationAnimationRecord.newCurrentElement=r,n.setElement(null,!0),n.elementUniqueID=f(o),s.setElement(null,!0),s.elementUniqueID=f(r);var a=this._createDiscardablePage(o),l=this._createDiscardablePage(r);return a.pageRoot.itemIndex=this._getElementIndex(o),l.pageRoot.itemIndex=a.pageRoot.itemIndex+(e?1:-1),a.pageRoot.style.position="absolute",l.pageRoot.style.position="absolute",a.pageRoot.style.zIndex=1,l.pageRoot.style.zIndex=2,this._setItemStart(a,0),this._setItemStart(l,0),this._blockTabs=!0,this._visibleElements.push(r),this._announceElementVisible(r),this._navigationAnimationRecord.elementContainers=[a,l],{outgoing:a,incoming:l}}}return null},endAnimatedNavigation:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var n=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,t);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,i),n||this._setViewportStart(this._getItemStart(e?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(e,t,i){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._hasFocus&&(this._hadFocus=!0),this._currentPage.element){var n=this._currentPage.element,s=this._getElementIndex(n),o=this;return o.jumpToIndex(e).then(function(r){if(!r)return null;if(o._navigationAnimationRecord={},o._navigationAnimationRecord.cancelAnimationCallback=t,o._navigationAnimationRecord.completionCallback=i,o._navigationAnimationRecord.oldCurrentPage=null,o._forEachPage(function(e){return e.element===n?(o._navigationAnimationRecord.oldCurrentPage=e,!0):void 0}),o._navigationAnimationRecord.newCurrentPage=o._currentPage,o._navigationAnimationRecord.newCurrentPage===o._navigationAnimationRecord.oldCurrentPage)return null;var a=o._currentPage.element;o._navigationAnimationRecord.newCurrentElement=a,o._currentPage.setElement(null,!0),o._currentPage.elementUniqueID=f(a),o._navigationAnimationRecord.oldCurrentPage&&o._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var l=o._createDiscardablePage(n),h=o._createDiscardablePage(a);return l.pageRoot.itemIndex=s,h.pageRoot.itemIndex=e,l.pageRoot.style.position="absolute",h.pageRoot.style.position="absolute",l.pageRoot.style.zIndex=1,h.pageRoot.style.zIndex=2,o._setItemStart(l,0),o._setItemStart(h,o._itemSize(o._currentPage)),o._visibleElements.push(a),o._announceElementVisible(a),o._navigationAnimationRecord.elementContainers=[l,h],o._blockTabs=!0,{oldPage:l,newPage:h}})}return h.wrap(null)},simulateMouseWheelScroll:function(e){if(!this._environmentSupportsTouch&&!this._waitingForMouseScroll){var i;i="number"==typeof e.deltaY?(e.deltaX||e.deltaY)>0:e.wheelDelta<0;var n=i?this._currentPage.next:this._currentPage.prev;if(n.element){var s={contentX:0,contentY:0,viewportX:0,viewportY:0};s[this._isHorizontal?"contentX":"contentY"]=this._getItemStart(n),_._zoomTo(this._panningDivContainer,s),this._waitingForMouseScroll=!0,t.setTimeout(function(){this._waitingForMouseScroll=!1}.bind(this),_._zoomToDuration+100)}}},endAnimatedJump:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),
this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(e.element,!0):e.element.parentNode&&e.element.parentNode.removeChild(e.element),this._navigationAnimationRecord.newCurrentPage.setElement(t.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(e,t,i,n){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var s=this._prevMarker,o=!1,r=!1;if(n&&(this._createAnimationRecord(f(e),null),this._getAnimationRecord(e).inserted=!0),t){do{if(s===this._currentPage&&(o=!0),s.elementUniqueID===f(t)){r=!0;var a,l=s,h=e,d=f(e);if(o)for(;l.next!==this._prevMarker;)a=l.next.element,d=l.next.elementUniqueID,l.next.setElement(h,!0),!h&&d&&(l.next.elementUniqueID=d),h=a,l=l.next;else for(s.elementUniqueID===s.next.elementUniqueID&&s.elementUniqueID&&(l=s.next);l.next!==this._prevMarker;)a=l.element,d=l.elementUniqueID,l.setElement(h,!0),!h&&d&&(l.elementUniqueID=d),h=a,l=l.prev;if(h){var u=!1;this._forEachPage(function(e){return f(h)===e.elementUniqueID?(u=!0,!0):void 0}),u||this._releaseElementIfNotAnimated(h)}break}s=s.next}while(s!==this._prevMarker)}else if(i){for(;s.next!==this._prevMarker&&s.elementUniqueID!==f(i);)s===this._currentPage&&(o=!0),s=s.next;s.elementUniqueID===f(i)&&s!==this._prevMarker?(s.prev.setElement(e),r=!0):this._releaseElementIfNotAnimated(e)}else this._currentPage.setElement(e);this._getAnimationRecord(e).successfullyMoved=r,this._setButtonStates()},changed:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var i=this;if(this._forEachPage(function(n){if(n.elementUniqueID===f(t)){var s=i._animationRecords[n.elementUniqueID];return s.changed=!0,s.oldElement=t,s.newElement=e,n.element=e,n.elementUniqueID=f(e),i._animationRecords[f(e)]=s,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var n=0,s=this._navigationAnimationRecord.elementContainers.length;s>n;n++){var o=this._navigationAnimationRecord.elementContainers[n];o&&o.elementUniqueID===f(t)&&(o.element=e,o.elementUniqueID=f(e))}var r=this._navigationAnimationRecord.newCurrentElement;r&&f(r)===f(t)&&(this._navigationAnimationRecord.newCurrentElement=e)}},moved:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var n=this._getAnimationRecord(e);n||(n=this._createAnimationRecord(f(e))),n.moved=!0,this.removed(e,!1,!1),t||i?this.inserted(e,t,i,!1):n.successfullyMoved=!1},removed:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var n=this,s=this._prevMarker,o=h.wrap();if(t){var r=!1;return this._forEachPage(function(t){(t.elementUniqueID===f(e)||r)&&(t.setElement(null,!0),r=!0)}),void this._setButtonStates()}if(i){var a=this._getAnimationRecord(e);a&&(a.removed=!0)}if(this._currentPage.elementUniqueID===f(e))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(s.elementUniqueID===f(e))s.next.element?o=this._itemsManager._previousItem(s.next.element).then(function(t){return t===e&&(t=n._itemsManager._previousItem(t)),t}).then(function(e){s.setElement(e,!0)}):s.setElement(null,!0);else if(s.prev.elementUniqueID===f(e))s.prev.prev&&s.prev.prev.element?o=this._itemsManager._nextItem(s.prev.prev.element).then(function(t){return t===e&&(t=n._itemsManager._nextItem(t)),t}).then(function(e){s.prev.setElement(e,!0)}):s.prev.setElement(null,!0);else{for(var l=this._currentPage.prev,d=!1;l!==s&&!d;)l.elementUniqueID===f(e)&&(this._shiftRight(l),d=!0),l=l.prev;for(l=this._currentPage.next;l!==s&&!d;)l.elementUniqueID===f(e)&&(this._shiftLeft(l),d=!0),l=l.next}return o.then(function(){n._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(e){this._itemSpacing=e,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new d,this._temporaryKeys=[],this._animationRecords={};var e=this;this._forEachPage(function(t){e._createAnimationRecord(t.elementUniqueID,t)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var e=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function t(t){var i=null;return e._forEachPage(function(e){return e.element===t?(i=e,!0):void 0}),i}function i(t,i){e._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var n=e._createDiscardablePage(i);e._setItemStart(n,t.originalLocation),o.push(e._deleteFlipPage(n))}function n(i,n){e._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var s,r=i.originalLocation;if(i.successfullyMoved)s=t(n),r=i.newLocation;else{s=e._createDiscardablePage(n);var a=e._getElementIndex(n),l=e._currentPage.element?e._getElementIndex(e._currentPage.element):0;r+=l>a?-100*e._bufferSize:100*e._bufferSize}s&&(e._setItemStart(s,i.originalLocation),o.push(e._moveFlipPage(s,function(){e._setItemStart(s,r)})))}function s(){return 0===o.length&&o.push(h.wrap()),h.join(o)}var o=[];e._forEachPage(function(t){var i=e._getAnimationRecord(t.element);i&&(i.changed&&(i.oldElement.removedFromChange=!0,o.push(e._changeFlipPage(t,i.oldElement,i.newElement))),i.newLocation=t.location,e._setItemStart(t,i.originalLocation),i.inserted&&(t.elementRoot.style.opacity=0))});var r=e._animationRecords.currentPage,a=e._getAnimationRecord(r),l=e._animationRecords.nextPage,d=e._getAnimationRecord(l);a&&a.changed&&(r=a.newElement),d&&d.changed&&(l=d.newElement),(r!==e._currentPage.element||l!==e._currentPage.next.element)&&(a&&a.removed&&i(a,r),d&&d.removed&&i(d,l)),e._blockTabs=!0,s().then(function(){o=[],a&&a.moved&&n(a,r),d&&d.moved&&n(d,l);var t=e._getAnimationRecord(e._currentPage.element),i=e._getAnimationRecord(e._currentPage.next.element);e._forEachPage(function(n){var s=e._getAnimationRecord(n.element);s&&(s.inserted?s!==t&&s!==i&&(n.elementRoot.style.opacity=1):s.originalLocation!==s.newLocation&&(s!==a&&s!==d||s===a&&!a.moved||s===d&&!d.moved)&&o.push(e._moveFlipPage(n,function(){e._setItemStart(n,s.newLocation)})))}),s().then(function(){o=[],t&&t.inserted&&o.push(e._insertFlipPage(e._currentPage)),i&&i.inserted&&o.push(e._insertFlipPage(e._currentPage.next)),s().then(function(){e._checkElementVisibility(!1),e._itemSettledOn(),e._setListEnds(),e._notificationsStarted--,0===e._notificationsStarted&&e._notificationsEndedSignal.complete(),e._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),e._logBuffer(),e._endNotificationsWork=null})})})})},disableTouchFeatures:function(){this._environmentSupportsTouch=!1;var e=this._panningDivContainer.style;this._panningDivContainer.removeEventListener(n._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0),e.overflowX="hidden",e.overflowY="hidden";var t=["scroll-snap-type","scroll-snap-points-x","scroll-snap-points-y","scroll-limit-x-min","scroll-limit-x-max","scroll-limit-y-min","scroll-limit-y-max"];t.forEach(function(t){var i=g[t];i&&(e[i.scriptName]="")})},_hasFocus:{get:function(){return this._flipperDiv.contains(t.document.activeElement)}},_timeoutPageSelection:function(){var e=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=h.timeout(y).then(function(){e._itemSettledOn()})},_updateTabIndex:function(e){this._forEachPage(function(t){t.element&&(t.element.tabIndex=e)}),this._tabIndex=e,this._tabManager.tabIndex=e},_releaseElementIfNotAnimated:function(e){var t=this._getAnimationRecord(e);t&&(t.changed||t.inserted||t.moved||t.removed)||this._itemsManager.releaseItem(e)},_getAnimationRecord:function(e){return e?this._animationRecords[f(e)]:null},_createAnimationRecord:function(e,t){if(e){var i=this._animationRecords[e]={removed:!1,changed:!1,inserted:!1};return t&&(i.originalLocation=t.location),i}},_writeProfilerMark:function(e){a(e),this._flipperDiv.winControl.constructor._enabledDebug&&o.log&&o.log(e,null,"flipviewdebug")},_getElementIndex:function(e){var t=0;try{t=this._itemsManager.itemObject(e).index}catch(i){}return t},_resetBuffer:function(e,t){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var i=this._currentPage,n=i;do n.element&&n.element===e||t?n.setElement(null,!0):n.setElement(null),n=n.next;while(n!==i)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var t=this._createFlipPage(e,this);return this._panningDiv.appendChild(t.pageRoot),t},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var e=h.wrap(this._currentPage),t=this,i=0;i<this._bufferSize;i++)e=e.then(function(e){return e.next===t._prevMarker&&t._insertNewFlipPage(e),e.element?t._itemsManager._nextItem(e.element).then(function(t){return e.next.setElement(t),e.next}):(e.next.setElement(null),e.next)});return e},_fetchOneNext:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var t=e.prev.element;if(this._prevMarker===e&&(this._prevMarker=this._prevMarker.next),!t)return void e.setElement(null);var i=this;return this._itemsManager._nextItem(t).then(function(t){e.setElement(t),i._movePageAhead(e.prev,e)})},_fetchPreviousItems:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var t=this,i=h.wrap(this._currentPage),n=0;n<this._bufferSize;n++)i=i.then(function(e){return e.element?t._itemsManager._previousItem(e.element).then(function(t){return e.prev.setElement(t),e.prev}):(e.prev.setElement(null),e.prev)});return i.then(function(i){e&&(t._prevMarker=i)})},_fetchOnePrevious:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var t=e.next.element;if(this._prevMarker===e.next&&(this._prevMarker=this._prevMarker.prev),!t)return e.setElement(null),h.wrap();var i=this;return this._itemsManager._previousItem(t).then(function(t){e.setElement(t),i._movePageBehind(e.next,e)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._setItemStart(this._currentPage,v*this._viewportSize());for(var t=this._currentPage;t!==this._prevMarker;)this._movePageBehind(t,t.prev),t=t.prev;for(t=this._currentPage;t.next!==this._prevMarker;)this._movePageAhead(t,t.next),t=t.next;var i=!1;this._lastScrollPos&&!e&&(this._setListEnds(),i=!0),this._lastScrollPos=this._getItemStart(this._currentPage),this._setViewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),i||this._setListEnds()},_ensureBufferConsistency:function(){var e=this,t=this._currentPage.element;if(!t)return h.wrap();var i=!1,n={},s={};this._forEachPage(function(e){if(e&&e.elementUniqueID){if(n[e.elementUniqueID])return i=!0,!0;if(n[e.elementUniqueID]=!0,e.location>0){if(s[e.location])return i=!0,!0;s[e.location]=!0}}});var o=Object.keys(this._animationRecords);return o.forEach(function(t){var n=e._animationRecords[t];n&&(n.changed||n.inserted||n.moved||n.removed)&&(i=!0)}),i?(this._resetBuffer(null,!0),this._currentPage.setElement(t),this._fetchNextItems().then(function(){return e._fetchPreviousItems(!0)}).then(function(){e._ensureCentered()})):h.wrap()},_shiftLeft:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var t=e,i=null;t!==this._prevMarker&&t.next!==this._prevMarker;)i=t.next.element,!i&&t.next.elementUniqueID&&(t.elementUniqueID=t.next.elementUniqueID),t.next.setElement(null,!0),t.setElement(i,!0),t=t.next;if(t!==this._prevMarker&&t.prev.element){var n=this;return this._itemsManager._nextItem(t.prev.element).then(function(e){t.setElement(e),n._createAnimationRecord(t.elementUniqueID,t)})}},_logBuffer:function(){if(this._flipperDiv.winControl.constructor._enabledDebug){o.log&&o.log(this._currentPage.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"	"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),o.log&&o.log(this._currentPage.next.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"	"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),o.log&&o.log("> "+this._currentPage.elementUniqueID+"	@:"+this._currentPage.location+(this._currentPage.element?"	"+this._currentPage.element.textContent:""),null,"flipviewdebug"),o.log&&o.log(this._currentPage.next.elementUniqueID+"	@:"+this._currentPage.next.location+(this._currentPage.next.element?"	"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),o.log&&o.log(this._currentPage.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"	"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var e=Object.keys(this._itemsManager._elementMap),t=[];this._forEachPage(function(e){e&&e.elementUniqueID&&t.push(e.elementUniqueID)}),o.log&&o.log("itemsmanager  = ["+e.join(" ")+"] flipview ["+t.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(e){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var t=e,i=null;t!==this._prevMarker;)i=t.prev.element,!i&&t.prev.elementUniqueID&&(t.elementUniqueID=t.prev.elementUniqueID),t.prev.setElement(null,!0),t.setElement(i,!0),t=t.prev;if(t.next.element){var n=this;return this._itemsManager._previousItem(t.next.element).then(function(e){t.setElement(e),n._createAnimationRecord(t.elementUniqueID,t)})}},_checkElementVisibility:function(e){var t,i;if(e){var n=this._currentPage.element;for(t=0,i=this._visibleElements.length;i>t;t++)this._visibleElements[t]!==n&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[],n&&(this._visibleElements.push(n),this._announceElementVisible(n))}else{for(t=0,i=this._visibleElements.length;i>t;t++)(!this._visibleElements[t].parentNode||this._visibleElements[t].removedFromChange)&&this._announceElementInvisible(this._visibleElements[t]);this._visibleElements=[];var s=this;this._forEachPage(function(e){var t=e.element;t&&(s._itemInView(e)?(s._visibleElements.push(t),s._announceElementVisible(t)):s._announceElementInvisible(t))})}},_announceElementVisible:function(e){if(e&&!e.visible){e.visible=!0;var i=t.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),i.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),e.dispatchEvent(i)}},_announceElementInvisible:function(e){if(e&&e.visible){e.visible=!1;var i=!1;e.parentNode||(i=!0,this._panningDivContainer.appendChild(e));var n=t.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),n.initCustomEvent(p.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),e.dispatchEvent(n),i&&this._panningDivContainer.removeChild(e)}},_createDiscardablePage:function(e){var t=this._createPageContainer(),i={pageRoot:t.root,elementRoot:t.elementContainer,discardable:!0,element:e,elementUniqueID:f(e),discard:function(){i.pageRoot.parentNode&&i.pageRoot.parentNode.removeChild(i.pageRoot),i.element.parentNode&&i.element.parentNode.removeChild(i.element)}};return i.pageRoot.style.top="0px",i.elementRoot.appendChild(e),this._panningDiv.appendChild(i.pageRoot),i},_createPageContainer:function(){var e=this._panningDivContainerOffsetWidth,i=this._panningDivContainerOffsetHeight,n=t.document.createElement("div"),s=n.style,o=t.document.createElement("div");return o.className="win-item",s.position="absolute",s.overflow="hidden",s.width=e+"px",s.height=i+"px",n.appendChild(o),{root:n,elementContainer:o}},_createFlipPage:function(t,i){var n={};n.element=null,n.elementUniqueID=null,t?(n.prev=t,n.next=t.next,n.next.prev=n,t.next=n):(n.next=n,n.prev=n);var s=this._createPageContainer();return n.elementRoot=s.elementContainer,n.elementRoot.style.msOverflowStyle="auto",n.pageRoot=s.root,n.setElement=function(t,s){if(void 0===t&&(t=null),t===n.element)return void(t||(n.elementUniqueID=null));if(n.element&&(s||(i._itemsManager.releaseItem(n.element),c._disposeElement(n.element))),n.element=t,n.elementUniqueID=t?f(t):null,_.empty(n.elementRoot),n.element){if(n===i._currentPage&&(i._tabManager.childFocus=t),!e(n.element)){n.element.tabIndex=i._tabIndex,n.element.setAttribute("role","option"),n.element.setAttribute("aria-selected",!1),n.element.id||(n.element.id=f(n.element));var o=function(e,t,i){e.setAttribute(i,t.id)},r=!n.next.element||n===i._prevMarker.prev;r&&(o(n.element,i._bufferAriaEndMarker,"aria-flowto"),o(i._bufferAriaEndMarker,n.element,"x-ms-aria-flowfrom")),n!==i._prevMarker&&n.prev.element&&(o(n.prev.element,n.element,"aria-flowto"),o(n.element,n.prev.element,"x-ms-aria-flowfrom")),n.next!==i._prevMarker&&n.next.element&&(o(n.element,n.next.element,"aria-flowto"),o(n.next.element,n.element,"x-ms-aria-flowfrom")),n.prev.element||o(n.element,i._bufferAriaStartMarker,"x-ms-aria-flowfrom")}n.elementRoot.appendChild(n.element)}},n},_itemInView:function(e){return this._itemEnd(e)>this._getViewportStart()&&this._getItemStart(e)<this._viewportEnd()},_getViewportStart:function(){return this._panningDivContainer.parentNode?this._isHorizontal?_.getScrollPosition(this._panningDivContainer).scrollLeft:_.getScrollPosition(this._panningDivContainer).scrollTop:void 0},_setViewportStart:function(e){this._panningDivContainer.parentNode&&(this._isHorizontal?_.setScrollPosition(this._panningDivContainer,{scrollLeft:e}):_.setScrollPosition(this._panningDivContainer,{scrollTop:e}))},_viewportEnd:function(){var e=this._panningDivContainer;return this._isHorizontal?this._rtl?this._getViewportStart()+this._panningDivContainerOffsetWidth:_.getScrollPosition(e).scrollLeft+this._panningDivContainerOffsetWidth:e.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_getItemStart:function(e){return e.location},_setItemStart:function(e,t){void 0!==t&&(this._isHorizontal?e.pageRoot.style.left=(this._rtl?-t:t)+"px":e.pageRoot.style.top=t+"px",e.location=t)},_itemEnd:function(e){return(this._isHorizontal?e.location+this._panningDivContainerOffsetWidth:e.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(e,t){var i=this._itemSize(e)+this._itemSpacing;this._setItemStart(t,this._getItemStart(e)+i)},_movePageBehind:function(e,t){var i=this._itemSize(e)+this._itemSpacing;this._setItemStart(t,this._getItemStart(e)-i)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var e=this._panningDivContainer.style;e[g["scroll-snap-type"].scriptName]="mandatory";var t=this._viewportSize(),i=t+this._itemSpacing,n="scroll-snap-points",s=0,o=this._getItemStart(this._currentPage);s=o%(t+this._itemSpacing),e[g[this._isHorizontal?n+"-x":n+"-y"].scriptName]="snapInterval("+s+"px, "+i+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var e=this._panningDivContainer.style,t=0,i=0,n=this._getTailOfBuffer(),s=this._getHeadOfBuffer(),o=g["scroll-limit-"+(this._isHorizontal?"x-min":"y-min")].scriptName,r=g["scroll-limit-"+(this._isHorizontal?"x-max":"y-max")].scriptName;!s.element&&(s=s.prev,s!==this._prevMarker.prev););for(;!n.element&&(n=n.next,n!==this._prevMarker););i=this._getItemStart(s),t=this._getItemStart(n),e[o]=t+"px",e[r]=i+"px"}},_viewportOnItemStart:function(){return this._getItemStart(this._currentPage)===this._getViewportStart()},_restoreAnimatedElement:function(e,t){var i=!0;return e.elementUniqueID!==f(t.element)||e.element?this._forEachPage(function(e){e.elementUniqueID!==t.elementUniqueID||e.element||(e.setElement(t.element,!0),i=!1)}):(e.setElement(t.element,!0),i=!1),i},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var i=this;n._setImmediate(function(){i._viewportOnItemStart()&&(i._blockTabs=!1,i._currentPage.element&&i._lastSelectedElement!==i._currentPage.element&&(i._lastSelectedPage&&i._lastSelectedPage.element&&!e(i._lastSelectedPage.element)&&i._lastSelectedPage.element.setAttribute("aria-selected",!1),i._lastSelectedPage=i._currentPage,i._lastSelectedElement=i._currentPage.element,e(i._currentPage.element)||i._currentPage.element.setAttribute("aria-selected",!0),u.schedule(function(){if(i._currentPage.element){(i._hasFocus||i._hadFocus)&&(i._hadFocus=!1,_._setActive(i._currentPage.element),i._tabManager.childFocus=i._currentPage.element);var e=t.document.createEvent("CustomEvent");e.initCustomEvent(p.pageSelectedEvent,!0,!1,{source:i._flipperDiv}),i._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),i._currentPage.element.dispatchEvent(e);var n=i._currentPage.element;if(n){var s=i._itemsManager._recordFromElement(n,!0);s&&s.renderComplete.then(function(){n===i._currentPage.element&&(i._currentPage.element.setAttribute("aria-setsize",i._cachedSize),i._currentPage.element.setAttribute("aria-posinset",i.currentIndex()+1),i._bufferAriaStartMarker.setAttribute("aria-flowto",i._currentPage.element.id),e=t.document.createEvent("CustomEvent"),e.initCustomEvent(p.pageCompletedEvent,!0,!1,{source:i._flipperDiv}),i._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),i._currentPage.element.dispatchEvent(e))})}}},u.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent")))})},_forEachPage:function(e){var t=this._prevMarker;do{if(e(t))break;t=t.next}while(t!==this._prevMarker)},_changeFlipPage:function(e,t,i){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),e.element=null,e.setElement?e.setElement(i,!0):(t.parentNode.removeChild(t),e.elementRoot.appendChild(i));var n=t.style;return n.position="absolute",n.left="0px",n.top="0px",n.opacity=1,e.pageRoot.appendChild(t),t.style.left=Math.max(0,(e.pageRoot.offsetWidth-t.offsetWidth)/2)+"px",t.style.top=Math.max(0,(e.pageRoot.offsetHeight-t.offsetHeight)/2)+"px",l.fadeOut(t).then(function(){t.parentNode&&t.parentNode.removeChild(t)})},_deleteFlipPage:function(e){a("WinJS.UI.FlipView:_deleteFlipPage,info"),e.elementRoot.style.opacity=0;var t=l.createDeleteFromListAnimation([e.elementRoot]),i=this;return t.execute().then(function(){e.discardable&&(e.discard(),i._itemsManager.releaseItem(e.element))})},_insertFlipPage:function(e){a("WinJS.UI.FlipView:_insertFlipPage,info"),e.elementRoot.style.opacity=1;var t=l.createAddToListAnimation([e.elementRoot]);return t.execute().then(function(){e.discardable&&e.discard()})},_moveFlipPage:function(e,t){a("WinJS.UI.FlipView:_moveFlipPage,info");var i=l.createRepositionAnimation(e.pageRoot);t();var n=this;return i.execute().then(function(){if(e.discardable){e.discard();var t=n._getAnimationRecord(e.element);t&&!t.successfullyMoved&&n._itemsManager.releaseItem(e.element)}})},_handleManipulationStateChanged:function(e){this._manipulationState=e.currentState,0===e.currentState&&e.target===this._panningDivContainer&&(this._itemSettledOn(),this._ensureCentered())}},{supportedForProcessing:!1});return w.flipPageBufferCount=2,w})})}),n("require-style!less/styles-flipview",[],function(){}),n("require-style!less/colors-flipview",[],function(){}),n("WinJS/Controls/FlipView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_UI","./FlipView/_Constants","./FlipView/_PageManager","require-style!less/styles-flipview","require-style!less/colors-flipview"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y){"use strict";t.Namespace.define("WinJS.UI",{FlipView:t.Namespace._lazy(function(){function p(t){var i=t[0].target.winControl;i&&i instanceof F&&t.some(function(e){return"dir"===e.attributeName?!0:"style"===e.attributeName?i._cachedStyleDir!==e.target.style.direction:!1})&&(i._cachedStyleDir=i._flipviewDiv.style.direction,i._rtl="rtl"===e.getComputedStyle(i._flipviewDiv,null).direction,i._setupOrientation())}function C(e){var t=e.target&&e.target.winControl;t&&t instanceof F&&(r("WinJS.UI.FlipView:resize,StartTM"),t._resize())}var w="win-navbutton",b="win-flipview",I="win-navleft",S="win-navright",x="win-navtop",E="win-navbottom",P="Previous",M="Next",T=3e3,k=500,D="&#57570;",A="&#57571;",O="&#57572;",B="&#57573;",L=40,R={get badAxis(){return"Invalid argument: orientation must be a string, either 'horizontal' or 'vertical'"},get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"},get noitemsManagerForCount(){return"Invalid operation: can't get count if no dataSource has been set"},get badItemSpacingAmount(){return"Invalid argument: itemSpacing must be a number greater than or equal to zero"},get navigationDuringStateChange(){return"Error: After changing itemDataSource or itemTemplate, any navigation in the FlipView control should be delayed until the pageselected event is fired."},get panningContainerAriaLabel(){return o._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},F=t.Class.define(function(t,i){r("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,t=t||e.document.createElement("div");var n=!0,s=null,o=f._trivialHtmlRenderer,a=0,l=0;if(i){if(i.orientation&&"string"==typeof i.orientation)switch(i.orientation.toLowerCase()){case"horizontal":n=!0;break;case"vertical":n=!1}i.currentPage&&(a=i.currentPage>>0,a=0>a?0:a),i.itemDataSource&&(s=i.itemDataSource),i.itemTemplate&&(o=this._getItemRenderer(i.itemTemplate)),i.itemSpacing&&(l=i.itemSpacing>>0,l=0>l?0:l)}if(!s){var d=new h.List;s=d.dataSource}m.empty(t),this._flipviewDiv=t,t.winControl=this,c._setOptions(this,i,!0),this._initializeFlipView(t,n,s,o,a,l),m.addClass(t,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),m._globalListener.addEventListener(t,"wheel",this._windowWheelHandlerBound),m._globalListener.addEventListener(t,"mousewheel",this._windowWheelHandlerBound),r("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){r("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(m._globalListener.removeEventListener(this._flipviewDiv,"wheel",this._windowWheelHandlerBound),m._globalListener.removeEventListener(this._flipviewDiv,"mousewheel",this._windowWheelHandlerBound),m._resizeNotifier.unsubscribe(this._flipviewDiv,C),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){r("WinJS.UI.FlipView:next,info");var e=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,e)},previous:function(){r("WinJS.UI.FlipView:prev,info");var e=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,e)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(e){if(r("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var t=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){t._pageManager._notificationsEndedSignal=null,t.currentPage=e})}if(!this._animating||this._cancelAnimation())if(e>>=0,e=0>e?0:e,this._refreshTimer)this._indexAfterRefresh=e;else{this._pageManager._cachedSize>0?e=Math.min(this._pageManager._cachedSize-1,e):0===this._pageManager._cachedSize&&(e=0);var t=this;if(this._jumpingToIndex===e)return;var i=function(){t._jumpingToIndex=null};this._jumpingToIndex=e;var n=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),s=this._jumpAnimation?null:this._cancelDefaultAnimation,o=function(){t._completeJump()};this._pageManager.startAnimatedJump(e,s,o).then(function(e){if(e){t._animationsStarted();var s=e.oldPage.pageRoot,a=e.newPage.pageRoot;t._contentDiv.appendChild(s),t._contentDiv.appendChild(a),t._completeJumpPending=!0,n(s,a).then(function(){t._completeJumpPending&&(o(),r("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(i,i)}else i()},i)}}},orientation:{get:function(){return this._axisAsString()},set:function(e){r("WinJS.UI.FlipView:set_orientation,info");var t="horizontal"===e;t!==this._isHorizontal&&(this._isHorizontal=t,this._setupOrientation(),this._pageManager.setOrientation(this._isHorizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(e){r("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=e||(new h.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(e){r("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(e),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(e){r("WinJS.UI.FlipView:set_itemSpacing,info"),e>>=0,e=0>e?0:e,this._pageManager.setItemSpacing(e)}},count:function(){r("WinJS.UI.FlipView:count,info");var e=this;return new d(function(t,i){e._itemsManager?e._pageManager._cachedSize===g.CountResult.unknown||e._pageManager._cachedSize>=0?t(e._pageManager._cachedSize):e._dataSource.getCount().then(function(i){e._pageManager._cachedSize=i,t(i)}):i(F.noitemsManagerForCount)})},setCustomAnimations:function(e){r("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==e.next&&(this._nextAnimation=e.next),void 0!==e.previous&&(this._prevAnimation=e.previous),void 0!==e.jump&&(this._jumpAnimation=e.jump)},forceLayout:function(){r("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(t,n,s,o,r,a){function l(e){e.setAttribute("aria-hidden",!0),e.style.visibility="hidden",e.style.opacity=0,e.tabIndex=-1,e.style.zIndex=1e3}function h(e){if(e.pointerType!==T){if(c._touchInteraction=!1,e.screenX===c._lastMouseX&&e.screenY===c._lastMouseY)return;c._lastMouseX=e.screenX,c._lastMouseY=e.screenY,c._mouseInViewport=!0,c._fadeInButton("prev"),c._fadeInButton("next"),c._fadeOutButtons()}}function d(e){e.pointerType===T?(c._mouseInViewport=!1,c._touchInteraction=!0,c._fadeOutButtons(!0)):(c._touchInteraction=!1,c._isInteractive(e.target)||0!==(4&e.buttons)&&(e.stopPropagation(),e.preventDefault()))}function u(e){e.pointerType!==T&&(c._touchInteraction=!1)}var c=this,_=!1;this._flipviewDiv=t,m.addClass(this._flipviewDiv,b),this._contentDiv=e.document.createElement("div"),this._panningDivContainer=e.document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=e.document.createElement("div"),this._prevButton=e.document.createElement("button"),this._nextButton=e.document.createElement("button"),this._isHorizontal=n,this._dataSource=s,this._itemRenderer=o,this._itemsManager=null,this._pageManager=null;for(var v=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],w=!0,I=i._browserStyleEquivalents,S=0,x=v.length;x>S;S++)w=w&&!!I[v[S]];

w=w&&!!i._browserEventEquivalents.manipulationStateChanged,w=w&&m._supportsSnapPoints,this._environmentSupportsTouch=w;var E=this._flipviewDiv.getAttribute("aria-label");E||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",R.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),l(this._prevButton),l(this._nextButton),this._prevButton.setAttribute("aria-label",P),this._nextButton.setAttribute("aria-label",M),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton),this._itemsManagerCallback={inserted:function(e,t,i){c._itemsManager._itemFromPromise(e).then(function(e){var n=c._itemsManager._elementFromHandle(t),s=c._itemsManager._elementFromHandle(i);c._pageManager.inserted(e,n,s,!0)})},countChanged:function(e,t){c._pageManager._cachedSize=e,t!==g.CountResult.unknown&&c._fireDatasourceCountChangedEvent()},changed:function(e,t){c._pageManager.changed(e,t)},moved:function(e,t,i,n){var s=function(e){c._pageManager.moved(e,t,i)};e?s(e):c._itemsManager._itemFromPromise(n).then(s)},removed:function(e,t){e&&c._pageManager.removed(e,t,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){c._cancelAnimation(),c._pageManager.notificationsStarted()},endNotifications:function(){c._pageManager.notificationsEnded()},itemAvailable:function(e,t){c._pageManager.itemRetrieved(e,t)},reload:function(){c._pageManager.reload()}},this._dataSource&&(this._itemsManager=f._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new y._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,a,this._environmentSupportsTouch,{hidePreviousButton:function(){c._hasPrevContent=!1,c._fadeOutButton("prev"),c._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){c._hasPrevContent=!0,c._fadeInButton("prev"),c._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){c._hasNextContent=!1,c._fadeOutButton("next"),c._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){c._hasNextContent=!0,c._fadeInButton("next"),c._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(r,this._isHorizontal),this._dataSource.getCount().then(function(e){c._pageManager._cachedSize=e}),this._prevButton.addEventListener("click",function(){c.previous()},!1),this._nextButton.addEventListener("click",function(){c.next()},!1),new m._MutationObserver(p).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._flipviewDiv.addEventListener("mselementresize",C),m._resizeNotifier.subscribe(this._flipviewDiv,C),this._contentDiv.addEventListener("mouseleave",function(){c._mouseInViewport=!1},!1);var T=m._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._environmentSupportsTouch&&(m._addEventListener(this._contentDiv,"pointerdown",d,!1),m._addEventListener(this._contentDiv,"pointermove",h,!1),m._addEventListener(this._contentDiv,"pointerup",u,!1)),this._panningDivContainer.addEventListener("scroll",function(){c._scrollPosChanged()},!1),this._panningDiv.addEventListener("blur",function(){c._touchInteraction||c._fadeOutButtons()},!0);var k=e.document.body.contains(this._flipviewDiv);m._addInsertedNotifier(this._flipviewDiv),this._flipviewDiv.addEventListener("WinJSNodeInserted",function(){return k?void(k=!1):void c._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(e){if(!c._disposed){var t=!0;if(!c._isInteractive(e.target)){var i=m.Key,n=!1;if(c._isHorizontal)switch(e.keyCode){case i.leftArrow:!c._rtl&&c.currentPage>0?(c.previous(),n=!0):c._rtl&&c.currentPage<c._pageManager._cachedSize-1&&(c.next(),n=!0);break;case i.pageUp:c.currentPage>0&&(c.previous(),n=!0);break;case i.rightArrow:!c._rtl&&c.currentPage<c._pageManager._cachedSize-1?(c.next(),n=!0):c._rtl&&c.currentPage>0&&(c.previous(),n=!0);break;case i.pageDown:c.currentPage<c._pageManager._cachedSize-1&&(c.next(),n=!0);break;case i.upArrow:case i.downArrow:n=!0,t=!1}else switch(e.keyCode){case i.upArrow:case i.pageUp:c.currentPage>0&&(c.previous(),n=!0);break;case i.downArrow:case i.pageDown:c.currentPage<c._pageManager._cachedSize-1&&(c.next(),n=!0);break;case i.space:n=!0}switch(e.keyCode){case i.home:c.currentPage=0,n=!0;break;case i.end:c._pageManager._cachedSize>0&&(c.currentPage=c._pageManager._cachedSize-1),n=!0}if(n)return e.preventDefault(),t&&e.stopPropagation(),!0}}},!1),_=!0},_windowWheelHandler:function(e){if(!this._disposed){e=e.detail.originalEvent;var t=e.target&&(this._flipviewDiv.contains(e.target)||this._flipviewDiv===e.target),n=this,s=i._now(),o=this._avoidTrappingTime>s;(!t||o)&&(this._avoidTrappingTime=s+k),t&&o?(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",i._yieldForDomModification(function(){n._pageManager._ensureCentered(),n._isHorizontal?(n._panningDivContainer.style.overflowX=n._environmentSupportsTouch?"scroll":"hidden",n._panningDivContainer.style.overflowY="hidden"):(n._panningDivContainer.style.overflowY=n._environmentSupportsTouch?"scroll":"hidden",n._panningDivContainer.style.overflowX="hidden")})):t&&this._pageManager.simulateMouseWheelScroll(e)}},_isInteractive:function(e){if(e.parentNode)for(var t=e.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),i=0,n=t.length;n>i;i++)if(t[i]===e)return!0;return!1},_refreshHandler:function(){var e=this._dataSourceAfterRefresh||this._dataSource,t=this._itemRendererAfterRefresh||this._itemRenderer,i=this._indexAfterRefresh||0;this._setDatasource(e,t,i),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var e=this;this._refreshTimer=!0,u.schedule(function(){e._refreshTimer&&!e._disposed&&e._refreshHandler()},u.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(t){var i=null;if("function"==typeof t){var n=new d(function(){}),s=t(n);i=s.element?"object"==typeof s.element&&"function"==typeof s.element.then?function(i){var n=e.document.createElement("div");return n.className="win-template",_.markDisposable(n),{element:n,renderComplete:t(i).element.then(function(e){n.appendChild(e)})}}:t:function(i){var n=e.document.createElement("div");return n.className="win-template",_.markDisposable(n),{element:n,renderComplete:i.then(function(){return d.as(t(i)).then(function(e){n.appendChild(e)})})}}}else"object"==typeof t&&(i=t.renderItem);return i},_navigate:function(e,t){if(i.validation&&this._refreshTimer)throw new n("WinJS.UI.FlipView.NavigationDuringStateChange",R.navigationDuringStateChange);if(this._animating||(this._animatingForward=e),this._goForward=e,this._animating&&!this._cancelAnimation())return!1;var s=this,o=e?this._nextAnimation:this._prevAnimation,r=o?o:this._defaultAnimation.bind(this),a=function(e){s._completeNavigation(e)},l=this._pageManager.startAnimatedNavigation(e,t,a);if(l){this._animationsStarted();var h=l.outgoing.pageRoot,d=l.incoming.pageRoot;return this._contentDiv.appendChild(h),this._contentDiv.appendChild(d),this._completeNavigationPending=!0,r(h,d).then(function(){s._completeNavigationPending&&a(s._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(e,t){e.style.opacity=0,t.style.animationName="",t.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var e=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(e&&(e=e.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var t=this._pageManager._navigationAnimationRecord.elementContainers[0],i=this._pageManager._navigationAnimationRecord.elementContainers[1],n=t.pageRoot,s=i.pageRoot;return e&&e(n,s),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(e){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var t=this._pageManager._navigationAnimationRecord.elementContainers[0],i=this._pageManager._navigationAnimationRecord.elementContainers[1],n=t.pageRoot,s=i.pageRoot;n.parentNode&&n.parentNode.removeChild(n),s.parentNode&&s.parentNode.removeChild(s),this._pageManager.endAnimatedNavigation(e,t,i),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var e=this._pageManager._navigationAnimationRecord.elementContainers[0],t=this._pageManager._navigationAnimationRecord.elementContainers[1],i=e.pageRoot,n=t.pageRoot;i.parentNode&&i.parentNode.removeChild(i),n.parentNode&&n.parentNode.removeChild(n),this._pageManager.endAnimatedJump(e,t),this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(e){return this._pageManager.jumpToIndex(e)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(e,t,i){this._animating&&this._cancelAnimation();var n=0;void 0!==i&&(n=i),this._dataSource=e,this._itemRenderer=t;var s=this._itemsManager;this._itemsManager=f._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var o=this;this._dataSource.getCount().then(function(e){o._pageManager._cachedSize=e}),this._pageManager.setNewItemsManager(this._itemsManager,n),s&&s.release()},_fireDatasourceCountChangedEvent:function(){var t=this;u.schedule(function(){var i=e.document.createEvent("Event");i.initEvent(F.datasourceCountChangedEvent,!0,!0),r("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),t._flipviewDiv.dispatchEvent(i)},u.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._disposed||this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._isHorizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._isHorizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var t="rtl"===e.getComputedStyle(this._flipviewDiv,null).direction;this._rtl=t,t?(this._prevButton.className=w+" "+S,this._nextButton.className=w+" "+I):(this._prevButton.className=w+" "+I,this._nextButton.className=w+" "+S),this._prevButton.innerHTML=t?A:D,this._nextButton.innerHTML=t?D:A}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=w+" "+x,this._nextButton.className=w+" "+E,this._prevButton.innerHTML=O,this._nextButton.innerHTML=B;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(e,t){(this._mouseInViewport||t||!this._environmentSupportsTouch)&&("next"===e&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===e&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(e){var t=this;return"next"===e?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=a.fadeOut(this._nextButton).then(function(){t._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=a.fadeOut(this._prevButton).then(function(){t._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(e){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var t=this;this._buttonFadePromise=(e?d.wrap():d.timeout(l._animationTimeAdjustment(T))).then(function(){t._fadeOutButton("prev"),t._fadeOutButton("next"),t._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(e,t){var i={};t.style.left="0px",t.style.top="0px",t.style.opacity=0;var n=e.itemIndex>t.itemIndex?-L:L;i.left=(this._isHorizontal?this._rtl?-n:n:0)+"px",i.top=(this._isHorizontal?0:n)+"px";var s=a.fadeOut(e),o=a.enterContent(t,[i],{mechanism:"transition"});return d.join([s,o])},_fadeInFromCurrentValue:function(e){return l.executeTransition(e,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}},v);return t.Class.mix(F,s.createEventProperties(F.datasourceCountChangedEvent,F.pageVisibilityChangedEvent,F.pageSelectedEvent,F.pageCompletedEvent)),t.Class.mix(F,c.DOMEventMixin),F})})}),n("WinJS/Controls/ItemContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v){"use strict";var y=o._createEventProperty,C={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};i.Namespace._moduleDefine(e,"WinJS.UI",{ItemContainer:i.Namespace._lazy(function(){var o={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get swipeOrientationDeprecated(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"},get swipeBehaviorDeprecated(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}},a=i.Class.define(function(i,n){function r(e,t,i){return{name:t?e:e.toLowerCase(),handler:function(t){l["_on"+e](t)},capture:i}}if(i=i||t.document.createElement("DIV"),this._id=i.id||_._uniqueID(i),this._writeProfilerMark("constructor,StartTM"),n=n||{},i.winControl)throw new s("WinJS.UI.ItemContainer.DuplicateConstruction",o.duplicateConstruction);i.winControl=this,this._element=i,_.addClass(i,"win-disposable"),this._selectionMode=f.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:f.ObjectType.item,index:g._INVALID_INDEX},this.tapBehavior=f.TapBehavior.invokeOnly,_.addClass(this.element,a._ClassName.itemContainer+" "+g._containerClass),this._setupInternalTree(),this._selection=new e._SingleItemSelectionManager(i,this._itemBox),this._setTabIndex(),u.setOptions(this,n),this._mutationObserver=new _._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(i,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var l=this;this.selectionDisabled||d.schedule(function(){l._setDirectionClass()},d.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new v._ItemEventsHandler(Object.create({containerFromElement:function(){return l.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return g._INVALID_INDEX},itemBoxAtIndex:function(){return l._itemBox},itemAtIndex:function(){return l.element},headerAtIndex:function(){return null},containerAtIndex:function(){return l.element},isZombie:function(){return this._disposed},getItemPosition:function(){return l._getItemPosition()},rtl:function(){return l._rtl()},fireInvokeEvent:function(){l._fireInvokeEvent()},verifySelectionAllowed:function(){return l._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(e,t){return l._selection.set({firstIndex:e,lastIndex:t})},disablePressAnimation:function(){return!1}},{pressedEntity:{get:function(){return l._pressedEntity},set:function(e){l._pressedEntity=e}},pressedElement:{enumerable:!0,set:function(e){l._pressedElement=e}},eventHandlerRoot:{enumerable:!0,get:function(){return l.element}},selectionMode:{enumerable:!0,get:function(){return l._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return g._containerClass}},canvasProxy:{enumerable:!0,get:function(){return l._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return l._tapBehavior}},draggable:{enumerable:!0,get:function(){return l._draggable}},selection:{enumerable:!0,get:function(){return l._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var h=[r("PointerDown"),r("Click"),r("PointerUp"),r("PointerCancel"),r("LostPointerCapture"),r("ContextMenu"),r("MSHoldVisual",!0),r("FocusIn"),r("FocusOut"),r("DragStart"),r("DragEnd"),r("KeyDown")];h.forEach(function(e){_._addEventListener(l.element,e.name,e.handler,!!e.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(e){n.isPhone||this._draggable!==e&&(this._draggable=e,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(e){this._selection.selected!==e&&(this._selection.selected=e)}},swipeOrientation:{get:function(){return"none"},set:function(){_._deprecated(o.swipeOrientationDeprecated)}},tapBehavior:{get:function(){return this._tapBehavior},set:function(e){n.isPhone&&e===f.TapBehavior.directSelect||(this._tapBehavior=e,this._setAriaRole())}},swipeBehavior:{get:function(){return"none"},set:function(){_._deprecated(o.swipeBehaviorDeprecated)}},selectionDisabled:{get:function(){return this._selectionMode===f.SelectionMode.none},set:function(e){e?this._selectionMode=f.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=f.SelectionMode.single),this._setAriaRole()}},oninvoked:y(C.invoked),onselectionchanging:y(C.selectionchanging),onselectionchanged:y(C.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),c.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(e){this._itemEventsHandler.onMSManipulationStateChanged(e)},_onPointerDown:function(e){this._itemEventsHandler.onPointerDown(e)},_onClick:function(e){this._itemEventsHandler.onClick(e)},_onPointerUp:function(e){_.hasClass(this._itemBox,g._itemFocusClass)&&this._onFocusOut(e),this._itemEventsHandler.onPointerUp(e)},_onPointerCancel:function(e){this._itemEventsHandler.onPointerCancel(e)},_onLostPointerCapture:function(e){this._itemEventsHandler.onLostPointerCapture(e)},_onContextMenu:function(e){this._itemEventsHandler.onContextMenu(e)},_onMSHoldVisual:function(e){this._itemEventsHandler.onMSHoldVisual(e)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+g._itemFocusOutlineClass)&&p._keyboardSeenLast){_.addClass(this._itemBox,g._itemFocusClass);var e=t.document.createElement("div");e.className=g._itemFocusOutlineClass,this._itemBox.appendChild(e)}},_onFocusOut:function(){_.removeClass(this._itemBox,g._itemFocusClass);var e=this._itemBox.querySelector("."+g._itemFocusOutlineClass);e&&e.parentNode.removeChild(e)},_onDragStart:function(e){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))e.preventDefault();else{this._dragging=!0;var t=this;if(e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage){var i=this.element.getBoundingClientRect();e.dataTransfer.setDragImage(this.element,e.clientX-i.left,e.clientY-i.top)}n._yieldForDomModification(function(){t._dragging&&_.addClass(t._itemBox,g._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,_.removeClass(this._itemBox,g._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(e){if(!this._itemEventsHandler._isInteractive(e.target)){var t=_.Key,i=e.keyCode,n=!1;if(e.ctrlKey||i!==t.enter)e.ctrlKey&&i===t.enter||i===t.space?this.selectionDisabled||(this.selected=!this.selected,n=_._setActive(this.element)):i===t.escape&&this.selected&&(this.selected=!1,n=!0);else{var s=this._verifySelectionAllowed();s.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),n=!0}n&&(e.stopPropagation(),e.preventDefault())}},_setTabIndex:function(){var e=this.element.getAttribute("tabindex");e||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){_[this._rtl()?"addClass":"removeClass"](this.element,g._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===t.getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var e=this.element;return e?h.wrap({left:this._rtl()?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:e.offsetLeft,top:e.offsetTop,totalWidth:_.getTotalWidth(e),totalHeight:_.getTotalHeight(e),contentWidth:_.getContentWidth(e),contentHeight:_.getContentHeight(e)}):h.cancel},_itemPropertyChange:function(e){if(!this._disposed){var t=e[0].target,i="true"===t.getAttribute("aria-selected");i!==_._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?_._setAttribute(t,"aria-selected",!i):(this.selected=i,i!==this.selected&&_._setAttribute(t,"aria-selected",!i)))}},_updateDraggableAttribute:function(){this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode!==f.SelectionMode.none&&this._tapBehavior===f.TapBehavior.toggleSelect){var e=this._selection.fireSelectionChanging();return{canSelect:e,canTapSelect:e&&this._tapBehavior===f.TapBehavior.toggleSelect}}return{canSelect:!1,canTapSelect:!1}},_setupInternalTree:function(){var e=t.document.createElement("div");e.className=g._itemClass,this._captureProxy=t.document.createElement("div"),this._itemBox=t.document.createElement("div"),this._itemBox.className=g._itemBoxClass;for(var i=this.element.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}this.element.appendChild(this._itemBox),this._itemBox.appendChild(e),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==f.TapBehavior.none){var e=t.document.createEvent("CustomEvent");e.initCustomEvent(C.invoked,!0,!1,{}),this.element.dispatchEvent(e)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var e;e=this.tapBehavior===f.TapBehavior.none&&this.selectionDisabled?"listitem":"option",_._setAttribute(this.element,"role",e)}},_writeProfilerMark:function(e){var t="WinJS.UI.ItemContainer:"+this._id+":"+e;l(t),r.log&&r.log(t,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return i.Class.mix(a,u.DOMEventMixin),a}),_SingleItemSelectionManager:i.Namespace._lazy(function(){return i.Class.define(function(e,t){this._selected=!1,this._element=e,this._itemBox=t},{selected:{get:function(){return this._selected},set:function(e){e=!!e,this._selected!==e&&this.fireSelectionChanging()&&(this._selected=e,v._ItemEventsHandler.renderSelection(this._itemBox,this._element,e,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var e=t.document.createEvent("CustomEvent");return e.initCustomEvent(C.selectionchanging,!0,!0,{}),this._element.dispatchEvent(e)},fireSelectionChanged:function(){var e=t.document.createEvent("CustomEvent");e.initCustomEvent(C.selectionchanged,!0,!1,{}),this._element.dispatchEvent(e)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:f.ObjectType.item,index:g._INVALID_INDEX}}})})})}),n("WinJS/Controls/Repeater",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable"],function(e,t,i,n,s,o,r,a,l,h,d,u,c){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Repeater:i.Namespace._lazy(function(){function e(e){var i=t.document.createElement("div");return i.textContent=JSON.stringify(e),i}var o="itemsloaded",_="itemchanging",m="itemchanged",p="iteminserting",f="iteminserted",g="itemmoving",v="itemmoved",y="itemremoving",C="itemremoved",w="itemsreloading",b="itemsreloaded",I=s._createEventProperty,S={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get asynchronousRender(){return"Top level items must render synchronously"},get repeaterReentrancy(){return"Cannot modify Repeater data until Repeater has commited previous modification."}},x=i.Class.define(function(e,i){if(e&&e.winControl)throw new n("WinJS.UI.Repeater.DuplicateConstruction",S.duplicateConstruction);this._element=e||t.document.createElement("div"),this._id=this._element.id||c._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),i=i||{},c.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var s=this._extractInlineTemplate();this._initializing=!0,this.template=i.template||s,this.data=i.data,this._initializing=!1,d._setOptions(this,i,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(o,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(e){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=e||new a.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(o,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(t){this._writeProfilerMark("template.set,StartTM"),this._template=t||e,this._render=c._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(o,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(e){return this._repeatedDOM[e]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var e=0,t=this._repeatedDOM.length;t>e;e++)u._disposeElement(this._repeatedDOM[e])}},onitemsloaded:I(o),onitemchanging:I(_),onitemchanged:I(m),oniteminserting:I(p),oniteminserted:I(f),onitemmoving:I(g),onitemmoved:I(v),onitemremoving:I(y),onitemremoved:I(C),onitemsreloading:I(w),onitemsreloaded:I(b),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var e=t.document.createElement(this._element.tagName);this._element.firstElementChild;)e.appendChild(this._element.firstElementChild);return new l.Template(e,{extractChild:!0})}},_renderAllItems:function(){for(var e=t.document.createDocumentFragment(),i=0,s=this._data.length;s>i;i++){var o=this._render(this._data.getAt(i));if(!o)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);e.appendChild(o),this._repeatedDOM.push(o)}this._element.appendChild(e)},_reloadRepeater:function(e){this._unloadRepeatedDOM(e),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(e){for(var t=0,i=this._repeatedDOM.length;i>t;t++){var n=this._repeatedDOM[t];e&&u._disposeElement(n),n.parentElement===this._element&&this._element.removeChild(n)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(e){this._data.addEventListener(e,this._dataListeners[e],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new n("WinJS.UI.Repeater.RepeaterModificationReentrancy",S.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(e){this._data.removeEventListener(e,this._dataListeners[e],!1)}.bind(this))},_dataItemChangedHandler:function(e){this._beginModification();var t,i=this._element,s=e.detail.index,o=this._render(e.detail.newValue);if(!o)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);this._repeatedDOM[s]&&(e.detail.oldElement=this._repeatedDOM[s]),e.detail.newElement=o,e.detail.setPromise=function(e){t=e},this._writeProfilerMark(_+",info"),this.dispatchEvent(_,e.detail);var r=null;s<this._repeatedDOM.length?(r=this._repeatedDOM[s],i.replaceChild(o,r),this._repeatedDOM[s]=o):(i.appendChild(o),this._repeatedDOM.push(o)),this._endModification(),this._writeProfilerMark(m+",info"),this.dispatchEvent(m,e.detail),r&&h.as(t).done(function(){u._disposeElement(r)}.bind(this))},_dataItemInsertedHandler:function(e){this._beginModification();var t=e.detail.index,i=this._render(e.detail.value);if(!i)throw new n("WinJS.UI.Repeater.AsynchronousRender",S.asynchronousRender);var s=this._element;if(e.detail.affectedElement=i,this._writeProfilerMark(p+",info"),this.dispatchEvent(p,e.detail),t<this._repeatedDOM.length){var o=this._repeatedDOM[t];s.insertBefore(i,o)}else s.appendChild(i);this._repeatedDOM.splice(t,0,i),this._endModification(),this._writeProfilerMark(f+",info"),this.dispatchEvent(f,e.detail)},_dataItemMovedHandler:function(e){this._beginModification();var t=this._repeatedDOM[e.detail.oldIndex];if(e.detail.affectedElement=t,this._writeProfilerMark(g+",info"),this.dispatchEvent(g,e.detail),this._repeatedDOM.splice(e.detail.oldIndex,1)[0],t.parentNode.removeChild(t),e.detail.newIndex<this._data.length-1){var i=this._repeatedDOM[e.detail.newIndex];this._element.insertBefore(t,i),this._repeatedDOM.splice(e.detail.newIndex,0,t)}else this._repeatedDOM.push(t),this._element.appendChild(t);this._endModification(),this._writeProfilerMark(v+",info"),this.dispatchEvent(v,e.detail)},_dataItemRemovedHandler:function(e){
this._beginModification();var t,i=this._repeatedDOM[e.detail.index],n={affectedElement:i,index:e.detail.index,item:e.detail.item};n.setPromise=function(e){t=e},this._writeProfilerMark(y+",info"),this.dispatchEvent(y,n),i.parentNode.removeChild(i),this._repeatedDOM.splice(e.detail.index,1),this._endModification(),this._writeProfilerMark(C+",info"),this.dispatchEvent(C,n),h.as(t).done(function(){u._disposeElement(i)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var e,t=this._repeatedDOM.slice(0),i={affectedElements:t};i.setPromise=function(t){e=t},this._writeProfilerMark(w+",info"),this.dispatchEvent(w,i),this._reloadRepeater(!1);var n=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(b+",info"),this.dispatchEvent(b,{affectedElements:n}),h.as(e).done(function(){for(var e=0,i=t.length;i>e;e++)u._disposeElement(t[e])}.bind(this))},_writeProfilerMark:function(e){r("WinJS.UI.Repeater:"+this._id+":"+e)}},{isDeclarativeControlContainer:!0});return i.Class.mix(x,d.DOMEventMixin),x})})}),n("require-style!less/styles-datetimepicker",[],function(){}),n("WinJS/Controls/DatePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(e,t,i,n,s,o,r,a,l,h){"use strict";i.Namespace.define("WinJS.UI",{DatePicker:i.Namespace._lazy(function(){function n(e,i,n){var s=t.Windows.Globalization.DateTimeFormatting;e=e?e:n;var o=new s.DateTimeFormatter(e);return i?new s.DateTimeFormatter(e,o.languages,o.geographicRegion,i,o.clock):o}function l(e,t,i){var s=y[e];s||(s=y[e]={});var o=s[t];o||(o=s[t]={});var r=o[i];return r||(r=o[i]={},r.formatter=n(e,t,i),r.years={}),r}function d(e,t,i,n,s,o){var r=l(e,t,i),a=r.years[o.year+"-"+o.era];return a||(a=r.formatter.format(o.getDateTime()),r.years[o.year+"-"+o.era]=a),a}function u(e,t,i,n){var s=l(e,t,i);return s.formatter.format(n.getDateTime())}function c(e,t,i,n){var s=l(e,t,i);return s.formatter.format(n.getDateTime())}function _(e){var i=t.Windows.Globalization,n=new i.Calendar;return e?new i.Calendar(n.languages,e,n.getClock()):n}function m(e,t){var i=0;if(e.era===t.era)i=t.year-e.year;else for(;e.era!==t.era||e.year!==t.year;)i++,e.addYears(1);return i}var p="day",f="{month.full}",g="year.full",v={get ariaLabel(){return o._getWinJSString("ui/datePicker").value},get selectDay(){return o._getWinJSString("ui/selectDay").value},get selectMonth(){return o._getWinJSString("ui/selectMonth").value},get selectYear(){return o._getWinJSString("ui/selectYear").value}},y={},C=i.Class.define(function(t,i){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},t=t||e.document.createElement("div"),a.addClass(t,"win-disposable"),t.winControl=this;var n=t.getAttribute("aria-label");n||t.setAttribute("aria-label",v.ariaLabel),this._init(t),r.setOptions(this,i)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",v.selectDay),this._monthElement.setAttribute("aria-label",v.selectMonth),this._yearElement.setAttribute("aria-label",v.selectYear)},_addControlsInOrder:function(){var e=this._domElement,t=this,i=0;t._information.order.forEach(function(n){switch(n){case"month":e.appendChild(t._monthElement),a.addClass(t._monthElement,"win-order"+i++);break;case"date":e.appendChild(t._dateElement),a.addClass(t._dateElement,"win-order"+i++);break;case"year":e.appendChild(t._yearElement),a.addClass(t._yearElement,"win-order"+i++)}})},_createControlElements:function(){this._monthElement=e.document.createElement("select"),this._monthElement.className="win-datepicker-month win-dropdown",this._dateElement=e.document.createElement("select"),this._dateElement.className="win-datepicker-date win-dropdown",this._yearElement=e.document.createElement("select"),this._yearElement.className="win-datepicker-year win-dropdown"},_createControls:function(){var e=this._information,t=e.getIndex(this.current);e.forceLanguage&&(this._domElement.setAttribute("lang",e.forceLanguage),this._domElement.setAttribute("dir",e.isRTL?"rtl":"ltr")),this._yearControl=new h._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:t.year}),this._monthControl=new h._Select(this._monthElement,{dataSource:this._information.months(t.year),disabled:this.disabled,index:t.month}),this._dateControl=new h._Select(this._dateElement,{dataSource:this._information.dates(t.year,t.month),disabled:this.disabled,index:t.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(e){this._calendar=e,this._setElement(this._domElement)}},current:{get:function(){var e=this._currentDate,t=e.getFullYear();return new Date(Math.max(Math.min(this.maxYear,t),this.minYear),e.getMonth(),e.getDate(),12,0,0,0)},set:function(e){var t;"string"==typeof e?(t=new Date(Date.parse(e)),t.setHours(12,0,0,0)):t=e;var i=this._currentDate;i!==t&&(this._currentDate=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled!==e&&(this._disabled=e,this._yearControl&&(this._monthControl.setDisabled(e),this._dateControl.setDisabled(e),this._yearControl.setDisabled(e)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(e){this._datePatterns.date!==e&&(this._datePatterns.date=e,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(e){this._domElement=this._domElement||e,this._domElement&&(a.empty(this._domElement),a.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(e){this._minYear!==e&&(this._minYear=e,e>this._maxYear&&(this._maxYear=e),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var e={year:this._information.years.getLength()-1};return e.month=this._information.months(e.year).getLength()-1,e.date=this._information.dates(e.year,e.month).getLength()-1,this._information.getDate(e).getFullYear()},set:function(e){this._maxYear!==e&&(this._maxYear=e,e<this._minYear&&(this._minYear=e),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(e){this._datePatterns.month!==e&&(this._datePatterns.month=e,this._init())}},_updateInformation:function(){var e=new Date(this._minYear,0,1,12,0,0),t=new Date(this._maxYear,11,31,12,0,0);e.setFullYear(this._minYear),t.setFullYear(this._maxYear),this._information=C.getInformation(e,t,this._calendar,this._datePatterns)},_init:function(e){this._setElement(e)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var e=this._information.getIndex(this.current);this._yearControl.index=e.year,this._monthControl.dataSource=this._information.months(e.year),this._monthControl.index=e.month,this._dateControl.dataSource=this._information.dates(e.year,e.month),this._dateControl.index=e.date}},_wireupEvents:function(){function e(){t._currentDate=t._information.getDate({year:t._yearControl.index,month:t._monthControl.index,date:t._dateControl.index},t._currentDate);var e=t._information.getIndex(t._currentDate);t._monthControl.dataSource=t._information.months(e.year),t._monthControl.index=e.month,t._dateControl.dataSource=t._information.dates(e.year,e.month),t._dateControl.index=e.date}var t=this;this._dateElement.addEventListener("change",e,!1),this._monthElement.addEventListener("change",e,!1),this._yearElement.addEventListener("change",e,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(e){this._datePatterns.year!==e&&(this._datePatterns.year=e,this._init())}}},{_getInformationWinRT:function(e,t,i,n){function s(e){return new Date(Math.min(new Date(Math.max(h,e)),v))}n=n||{date:p,month:f,year:g};var o=_(i),r=_(i),a=_(i);o.setToMin();var h=o.getDateTime();o.setToMax();var v=o.getDateTime();o.hour=12,e=s(e),t=s(t),o.setDateTime(t);var y={year:o.year,era:o.era};o.setDateTime(e);var C=0;C=m(o,y)+1;var w=l("day month.full year",i).formatter,b=w.patterns[0],I=8207===b.charCodeAt(0),S=["date","month","year"],x={month:b.indexOf("{month"),date:b.indexOf("{day"),year:b.indexOf("{year")};S.sort(function(e,t){return x[e]<x[t]?-1:x[e]>x[t]?1:0});var E=function(){return{getLength:function(){return C},getValue:function(t){return o.setDateTime(e),o.addYears(t),d(n.year,i,g,n,S,o)}}}(),P=function(t){return r.setDateTime(e),r.addYears(t),{getLength:function(){return r.numberOfMonthsInThisYear},getValue:function(e){return r.month=r.firstMonthInThisYear,r.addMonths(e),u(n.month,i,f,r)}}},M=function(t,s){return a.setDateTime(e),a.addYears(t),a.month=a.firstMonthInThisYear,a.addMonths(s),a.day=a.firstDayInThisMonth,{getLength:function(){return a.numberOfDaysInThisMonth},getValue:function(e){return a.day=a.firstDayInThisMonth,a.addDays(e),c(n.date,i,p,a)}}};return{isRTL:I,forceLanguage:w.resolvedLanguage,order:S,getDate:function(t,i){var n;i&&(o.setDateTime(i),n={year:o.year,month:o.month,day:o.day});var s=o;s.setDateTime(e),s.addYears(t.year);var r;s.firstMonthInThisYear>s.lastMonthInThisYear?(r=t.month+s.firstMonthInThisYear>s.numberOfMonthsInThisYear?t.month+s.firstMonthInThisYear-s.numberOfMonthsInThisYear:t.month+s.firstMonthInThisYear,n&&n.year!==s.year&&(r=Math.max(Math.min(n.month,s.numberOfMonthsInThisYear),1))):r=n&&n.year!==s.year?Math.max(Math.min(n.month,s.firstMonthInThisYear+s.numberOfMonthsInThisYear-1),s.firstMonthInThisYear):Math.max(Math.min(t.month+s.firstMonthInThisYear,s.firstMonthInThisYear+s.numberOfMonthsInThisYear-1),s.firstMonthInThisYear),s.month=r;var a=Math.max(Math.min(t.date+s.firstDayInThisMonth,s.firstDayInThisMonth+s.numberOfDaysInThisMonth-1),s.firstDayInThisMonth);return!n||n.year===s.year&&n.month===s.month||(a=Math.max(Math.min(n.day,s.firstDayInThisMonth+s.numberOfDaysInThisMonth-1),s.firstDayInThisMonth)),s.day=s.firstDayInThisMonth,s.addDays(a-s.firstDayInThisMonth),s.getDateTime()},getIndex:function(t){var i=s(t);o.setDateTime(i);var n={year:o.year,era:o.era},r=0;o.setDateTime(e),o.month=1,r=m(o,n),o.setDateTime(i);var a=o.month-o.firstMonthInThisYear;0>a&&(a=o.month-o.firstMonthInThisYear+o.numberOfMonthsInThisYear);var l=o.day-o.firstDayInThisMonth,h={year:r,month:a,date:l};return h},years:E,months:P,dates:M}},_getInformationJS:function(e,t){var i=e.getFullYear(),n=t.getFullYear(),s={getLength:function(){return Math.max(0,n-i+1)},getValue:function(e){return i+e}},o=["January","February","March","April","May","June","July","August","September","October","November","December"],r=function(){return{getLength:function(){return o.length},getValue:function(e){return o[e]},getMonthNumber:function(e){return Math.min(e,o.length-1)}}},a=function(e,t){var i=new Date,n=s.getValue(e),o=t+1;i.setFullYear(n,o,0);var r=i.getDate();return{getLength:function(){return r},getValue:function(e){return""+(e+1)},getDateNumber:function(e){return Math.min(e+1,r)}}};return{order:["month","date","year"],getDate:function(e){return new Date(s.getValue(e.year),r(e.year).getMonthNumber(e.month),a(e.year,e.month).getDateNumber(e.date),12,0)},getIndex:function(e){var t=0,n=e.getFullYear();t=i>n?0:n>this.maxYear?s.getLength()-1:e.getFullYear()-i;var o=Math.min(e.getMonth(),r(t).getLength()),l=Math.min(e.getDate()-1,a(t,o).getLength());return{year:t,month:o,date:l}},years:s,months:r,dates:a}}});return C.getInformation=t.Windows.Globalization.Calendar&&t.Windows.Globalization.DateTimeFormatting?C._getInformationWinRT:C._getInformationJS,i.Class.mix(C,s.createEventProperties("change")),i.Class.mix(C,r.DOMEventMixin),C})})}),n("WinJS/Controls/TimePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(e,t,i,n,s,o,r,a,l,h){"use strict";i.Namespace.define("WinJS.UI",{TimePicker:i.Namespace._lazy(function(){var n="{minute.integer(2)}",l="{hour.integer(1)}",d="{period.abbreviated(2)}",u={get ariaLabel(){return o._getWinJSString("ui/timePicker").value},get selectHour(){return o._getWinJSString("ui/selectHour").value},get selectMinute(){return o._getWinJSString("ui/selectMinute").value},get selectAMPM(){return o._getWinJSString("ui/selectAMPM").value}},c=function(e,t){return e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()},_=i.Class.define(function(t,i){this._currentTime=_._sentinelDate(),t=t||e.document.createElement("div"),a.addClass(t,"win-disposable"),t.winControl=this;var n=t.getAttribute("aria-label");n||t.setAttribute("aria-label",u.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(t),r.setOptions(this,i)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",u.selectHour),this._minuteElement.setAttribute("aria-label",u.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",u.selectAMPM)},_addControlsInOrder:function(e){var t=this;e.order.forEach(function(e,i){switch(e){case"hour":t._domElement.appendChild(t._hourElement),a.addClass(t._hourElement,"win-order"+i);break;case"minute":t._domElement.appendChild(t._minuteElement),a.addClass(t._minuteElement,"win-order"+i);break;case"period":t._ampmElement&&(t._domElement.appendChild(t._ampmElement),a.addClass(t._ampmElement,"win-order"+i))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(e){this._clock!==e&&(this._clock=e,this._init())}},current:{get:function(){var e=this._currentTime;if(e){var t=_._sentinelDate();return t.setHours(e.getHours()),t.setMinutes(this._getMinutesIndex(e)*this.minuteIncrement),t.setSeconds(0),t.setMilliseconds(0),t}return e},set:function(e){var t;"string"==typeof e?(t=_._sentinelDate(),t.setTime(Date.parse(t.toDateString()+" "+e))):(t=_._sentinelDate(),t.setHours(e.getHours()),t.setMinutes(e.getMinutes()));var i=this._currentTime;c(i,t)||(this._currentTime=t,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled!==e&&(this._disabled=e,this._hourControl&&(this._hourControl.setDisabled(e),this._minuteControl.setDisabled(e)),this._ampmControl&&this._ampmControl.setDisabled(e))}},element:{get:function(){return this._domElement}},_init:function(e){this._setElement(e),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(e){this._timePatterns.hour!==e&&(this._timePatterns.hour=e,this._init())}},_getHoursAmpm:function(e){var t=e.getHours();return this._ampmElement?0===t?{hours:12,ampm:0}:12>t?{hours:t,ampm:0}:{hours:t-12,ampm:1}:{hours:t}},_getHoursIndex:function(e){return this._ampmElement&&12===e?0:e},_getMinutesIndex:function(e){return parseInt(e.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(e){this._minuteIncrement!==e&&(this._minuteIncrement=e,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(e){this._timePatterns.minute!==e&&(this._timePatterns.minute=e,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(e){this._timePatterns.period!==e&&(this._timePatterns.period=e,this._init())}},_setElement:function(t){if(this._domElement=this._domElement||t,this._domElement){var i=_.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=i,i.forceLanguage&&(this._domElement.setAttribute("lang",i.forceLanguage),this._domElement.setAttribute("dir",i.isRTL?"rtl":"ltr")),a.empty(this._domElement),a.addClass(this._domElement,"win-timepicker"),this._hourElement=e.document.createElement("select"),a.addClass(this._hourElement,"win-timepicker-hour win-dropdown"),this._minuteElement=e.document.createElement("select"),a.addClass(this._minuteElement,"win-timepicker-minute win-dropdown"),this._ampmElement=null,"12HourClock"===i.clock&&(this._ampmElement=e.document.createElement("select"),a.addClass(this._ampmElement,"win-timepicker-period win-dropdown")),this._addControlsInOrder(i);var n=this._getHoursAmpm(this.current);this._hourControl=new h._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(n.hours)}),this._minuteControl=new h._Select(this._minuteElement,{dataSource:i.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new h._Select(this._ampmElement,{dataSource:i.periods,disabled:this.disabled,index:n.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var e=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=e.ampm),this._hourControl.index=this._getHoursIndex(e.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var e=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=e.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(e.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var e=this,t=function(){var t=e._hourControl.index;return e._ampmElement&&1===e._ampmControl.index&&12!==t&&(t+=12),t},i=function(){var i=t();e._currentTime.setHours(i),e._currentTime.setMinutes(e._minuteControl.index*e.minuteIncrement)};this._hourElement.addEventListener("change",i,!1),this._minuteElement.addEventListener("change",i,!1),this._ampmElement&&this._ampmElement.addEventListener("change",i,!1)}},{_sentinelDate:function(){var e=new Date;return new Date(2011,6,15,e.getHours(),e.getMinutes())},_getInformationWinRT:function(e,i,s){var o=function(i,n){var s=t.Windows.Globalization.DateTimeFormatting;i=i?i:n;var o=new s.DateTimeFormatter(i);return e&&(o=s.DateTimeFormatter(i,o.languages,o.geographicRegion,o.calendar,e)),o},r=t.Windows.Globalization,a=new r.Calendar;e&&(a=new r.Calendar(a.languages,a.getCalendarSystem(),e)),a.setDateTime(_._sentinelDate());var h=a.getClock(),u=24;u=a.numberOfHoursInThisPeriod;var c=function(){var e=o(s.period,d);return{getLength:function(){return 2},getValue:function(t){var i=_._sentinelDate();if(0===t){i.setHours(1);var n=e.format(i);return n}if(1===t){i.setHours(13);var s=e.format(i);return s}return null}}}(),m=function(){var e=o(s.minute,n),t=_._sentinelDate();return{getLength:function(){return 60/i},getValue:function(n){var s=n*i;return t.setMinutes(s),e.format(t)}}}(),p=function(){var e=o(s.hour,l),t=_._sentinelDate();return{getLength:function(){return u},getValue:function(i){return t.setHours(i),e.format(t)}}}(),f=o("hour minute"),g=f.patterns[0],v=["hour","minute"],y={period:g.indexOf("{period"),hour:g.indexOf("{hour"),minute:g.indexOf("{minute")};y.period>-1&&v.push("period");var C=t.Windows.Globalization.DateTimeFormatting.DateTimeFormatter,w=new C("month.full",t.Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),b=w.patterns[0],I=8207===b.charCodeAt(0);if(I){var S=y.hour;y.hour=y.minute,y.minute=S}return v.sort(function(e,t){return y[e]<y[t]?-1:y[e]>y[t]?1:0}),{minutes:m,hours:p,clock:h,periods:c,order:v,forceLanguage:f.resolvedLanguage,isRTL:I}},_getInformationJS:function(e,t){var i=[12,1,2,3,4,5,6,7,8,9,10,11],n={};n.getLength=function(){return 60/t},n.getValue=function(e){var i=e*t;return 10>i?"0"+i.toString():i.toString()};var s=["hour","minute","period"];return"24HourClock"===e&&(i=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],s=["hour","minute"]),{minutes:n,hours:i,clock:e||"12HourClock",periods:["AM","PM"],order:s}}});return _.getInformation=t.Windows.Globalization.DateTimeFormatting&&t.Windows.Globalization.Calendar&&t.Windows.Globalization.ApplicationLanguages?_._getInformationWinRT:_._getInformationJS,i.Class.mix(_,s.createEventProperties("change")),i.Class.mix(_,r.DOMEventMixin),_})})}),n("require-style!less/styles-backbutton",[],function(){}),n("require-style!less/colors-backbutton",[],function(){}),n("WinJS/Controls/BackButton",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-backbutton","require-style!less/colors-backbutton"],function(e,t,i,n,s,o,r,a){"use strict";var l=a.Key,h="win-navigation-backbutton",d="win-back",u=3,c=function(){function e(){t.addEventListener("keyup",n,!1),a._addEventListener(t,"pointerup",s,!1)}function i(){t.removeEventListener("keyup",n,!1),a._removeEventListener(t,"pointerup",s,!1)}function n(e){(e.keyCode===l.leftArrow&&e.altKey&&!e.shiftKey&&!e.ctrlKey||e.keyCode===l.browserBack)&&(o.back(),e.preventDefault())}function s(e){e.button===u&&o.back()}var r=0;return{addRef:function(){0===r&&e(),r++},release:function(){r>0&&(r--,0===r&&i())},getCount:function(){return r}}}();i.Namespace._moduleDefine(e,"WinJS.UI",{BackButton:i.Namespace._lazy(function(){var e={get ariaLabel(){return s._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},l=i.Class.define(function(i,s){if(i&&i.winControl)throw new n("WinJS.UI.BackButton.DuplicateConstruction",e.duplicateConstruction);this._element=i||t.document.createElement("button"),s=s||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,r.setOptions(this,s),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),o.addEventListener("navigated",this._navigatedHandler,!1),c.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,o.removeEventListener("navigated",this._navigatedHandler,!1),c.release())},refresh:function(){this._element.disabled=o.canGoBack?!1:!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new n("WinJS.UI.BackButton.BadButtonElement",e.badButtonElement);a.addClass(this._element,h),a.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+d+'"></span>',this.refresh(),this._element.setAttribute("aria-label",e.ariaLabel),this._element.setAttribute("title",e.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){o.back()}});return l._getReferenceCount=function(){return c.getCount()},i.Class.mix(l,r.DOMEventMixin),l})})}),n("require-style!less/styles-tooltip",[],function(){}),n("require-style!less/colors-tooltip",[],function(){}),n("WinJS/Controls/Tooltip",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Animations/_TransitionAnimation","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-tooltip","require-style!less/colors-tooltip"],function(e,t,i,n,s,o,r,a,l,h,d){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{Tooltip:n.Namespace._lazy(function(){function e(e,t){return"pointerdown"===e?t===A:e in O}function u(e,t){return"pointerdown"===e?t!==A:e in L}var c=0,_=d.Key,m="top",p=a._animationTimeAdjustment(400),f=a._animationTimeAdjustment(1200),g=a._animationTimeAdjustment(400),v=a._animationTimeAdjustment(5e3),y=a._animationTimeAdjustment(0),C=a._animationTimeAdjustment(600),w=a._animationTimeAdjustment(400),b=a._animationTimeAdjustment(600),I=a._animationTimeAdjustment(200),S=a._animationTimeAdjustment(3e5),x=12,E=20,P=45,M=20,T=12,k=1,D=d._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",A=d._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",O={keyup:"",pointerover:"",pointerdown:""},B={pointermove:""},L={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},R={pointerover:"",pointerout:""},F="win-tooltip",z="win-tooltip-phantom",H=g,N=2*H,W=2.5*H,V=v,U=!1,j=!1,q=o._createEventProperty;return n.Class.define(function(e,n){e=e||t.document.createElement("div");var s=d.data(e).tooltip;if(s)return s;if(!j&&i.Windows.UI.ViewManagement.UISettings){var o=new i.Windows.UI.ViewManagement.UISettings;H=a._animationTimeAdjustment(o.mouseHoverTime),N=2*H,W=2.5*H,V=a._animationTimeAdjustment(1e3*o.messageDuration);var r=o.handPreference;U=r===i.Windows.UI.ViewManagement.HandPreference.leftHanded}j=!0,this._disposed=!1,this._placement=m,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=e,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,e.winControl=this,d.addClass(e,"win-disposable"),e.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),l.setOptions(this,n),this._events(),d.data(e).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(e){if(this._innerHTML=e,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=e,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(e){if(this._contentElement=e,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(e){"top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e&&(e=m),this._placement=e,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(e){this._infotip=!!e}},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass=e}},onbeforeopen:q("beforeopen"),onopened:q("opened"),onbeforeclose:q("beforeclose"),onclosed:q("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,h.disposeSubTree(this.element);for(var e=0,t=this._eventListenerRemoveStack.length;t>e;e++)this._eventListenerRemoveStack[e]();this._onDismiss();var i=d.data(this._anchorElement);i&&delete i.tooltip}},addEventListener:function(e,t,i){if(this._anchorElement){this._anchorElement.addEventListener(e,t,i);var n=this;this._eventListenerRemoveStack.push(function(){n._anchorElement.removeEventListener(e,t,i)})}},removeEventListener:function(e,t,i){this._anchorElement&&this._anchorElement.removeEventListener(e,t,i)},open:function(e){switch(this._triggerByOpen=!0,"touch"!==e&&"mouseover"!==e&&"mousedown"!==e&&"keyboard"!==e&&(e="default"),e){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(h.disposeSubTree(this._domElement),t.document.body.removeChild(this._domElement),this._domElement=null,t.document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=t.document.createElement("div");var e=d._uniqueID(this._domElement);this._domElement.setAttribute("id",e);var i=t.document.defaultView.getComputedStyle(this._anchorElement,null),n=this._domElement.style;n.direction=i.direction,n.writingMode=i["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",e),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,t.document.body.appendChild(this._domElement),d.addClass(this._domElement,F),this._extraClass&&d.addClass(this._domElement,this._extraClass),this._phantomDiv=t.document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),t.document.body.appendChild(this._phantomDiv),d.addClass(this._phantomDiv,z);var s=t.document.defaultView.getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=s},_raiseEvent:function(e,i){if(this._anchorElement){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!1,!1,i),this._anchorElement.dispatchEvent(n)}},_captureLastKeyBlurOrPointerOverEvent:function(e){switch(this._lastKeyOrBlurEvent=this._currentKeyOrBlurEvent,e.type){case"keyup":this._currentKeyOrBlurEvent=e.keyCode===_.shift?null:"keyboard";break;case"focusout":this._currentKeyOrBlurEvent=null}},_registerEventToListener:function(e,t){var i=this,n=function(e){i._captureLastKeyBlurOrPointerOverEvent(e),i._handleEvent(e)};d._addEventListener(e,t,n,!1),this._eventListenerRemoveStack.push(function(){d._removeEventListener(e,t,n,!1)})},_events:function(){for(var e in O)this._registerEventToListener(this._anchorElement,e);for(var e in B)this._registerEventToListener(this._anchorElement,e);for(e in L)this._registerEventToListener(this._anchorElement,e);this._registerEventToListener(this._anchorElement,"contextmenu"),this._registerEventToListener(this._anchorElement,"MSHoldVisual")},_handleEvent:function(t){var i=t._normalizedType||t.type;if(!this._triggerByOpen){if(i in R&&d.eventWithinElement(this._anchorElement,t))return;if(e(i,t.pointerType))if(t.pointerType===A)this._isShown||(this._showTrigger="touch"),this._onInvoke("touch","never",t);else{if(this._skipMouseOver&&t.pointerType===D&&"pointerover"===i)return void(this._skipMouseOver=!1);var n="key"===i.substring(0,3)?"keyboard":"mouse";this._isShown||(this._showTrigger=n),this._onInvoke(n,"auto",t)}else if(i in B)this._contactPoint={x:t.clientX,y:t.clientY};else if(u(i,t.pointerType)){var o;if(t.pointerType===A){if("pointerup"===i){this._skipMouseOver=!0;var r=this;s._yieldForEvents(function(){r._skipMouseOver=!1})}o="touch"}else o="key"===i.substring(0,3)?"keyboard":"mouse";if("focusout"!==i&&o!==this._showTrigger)return;this._onDismiss()}else("contextmenu"===i||"MSHoldVisual"===i)&&t.preventDefault()}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var e=this,t=this._infotip?Math.min(3*V,S):V;this._hideDelayTimer=this._setTimeout(function(){e._onDismiss()},t)}},_onHideAnimationEnd:function(){t.document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),
c=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(e){var t;if(this._useAnimation=!0,"nodelay"===e)t=0,this._useAnimation=!1;else{var i=(new Date).getTime();I>=i-c?(t="touch"===e?this._infotip?w:y:this._infotip?b:C,this._useAnimation=!1):t="touch"===e?this._infotip?f:p:this._infotip?W:N}return t},_getAnchorPositionFromElementWindowCoord:function(){var e=this._anchorElement.getBoundingClientRect();return{x:e.left,y:e.top,width:e.width,height:e.height}},_getAnchorPositionFromPointerWindowCoord:function(e){return{x:e.x,y:e.y,width:1,height:1}},_canPositionOnSide:function(e,t,i,n){var s=0,o=0;switch(e){case"top":s=n.width+this._offset,o=i.y;break;case"bottom":s=n.width+this._offset,o=t.height-i.y-i.height;break;case"left":s=i.x,o=n.height+this._offset;break;case"right":s=t.width-i.x-i.width,o=n.height+this._offset}return s>=n.width+this._offset&&o>=n.height+this._offset},_positionOnSide:function(e,t,i,n){var s=0,o=0;switch(e){case"top":case"bottom":s=i.x+i.width/2-n.width/2,s=Math.min(Math.max(s,0),t.width-n.width-k),o="top"===e?i.y-n.height-this._offset:i.y+i.height+this._offset;break;case"left":case"right":o=i.y+i.height/2-n.height/2,o=Math.min(Math.max(o,0),t.height-n.height-k),s="left"===e?i.x-n.width-this._offset:i.x+i.width+this._offset}this._domElement.style.left=s+"px",this._domElement.style.top=o+"px",this._phantomDiv.style.left=s+"px",this._phantomDiv.style.top=o+"px",this._phantomDiv.style.width=n.width+"px",this._phantomDiv.style.height=n.height+"px"},_position:function(e){var i={width:0,height:0},n={x:0,y:0,width:0,height:0},s={width:0,height:0};i.width=t.document.documentElement.clientWidth,i.height=t.document.documentElement.clientHeight,"tb-rl"===t.document.defaultView.getComputedStyle(t.document.body,null)["writing-mode"]&&(i.width=t.document.documentElement.clientHeight,i.height=t.document.documentElement.clientWidth),n=!this._contactPoint||"touch"!==e&&"mouse"!==e?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),s.width=this._domElement.offsetWidth,s.height=this._domElement.offsetHeight;var o={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};U&&(o.top[2]="right",o.top[3]="left",o.bottom[2]="right",o.bottom[3]="left");for(var r=o[this._placement],a=r.length,l=0;a>l;l++)if(l===a-1||this._canPositionOnSide(r[l],i,n,s)){this._positionOnSide(r[l],i,n,s);break}return r[l]},_showTooltip:function(e){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),t.document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var i=this;this._removeTooltip=function(e){for(var n=i._anchorElement;n;){if(e.target===n){t.document.body.removeEventListener("DOMNodeRemoved",i._removeTooltip,!1),i._cleanUpDOM();break}n=n.parentNode}},t.document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM(),this._position(e),this._useAnimation?r.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(e,t,i){if(this._shouldDismiss=!1,!this._isShown&&(!i||"keyup"!==i.type||"keyboard"!==this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||i.keyCode===_.tab))){this._hideDelay=t,this._contactPoint=null,i?(this._contactPoint={x:i.clientX,y:i.clientY},this._offset="touch"===e?P:"keyboard"===e?x:E):this._offset="touch"===e?M:T,this._clearTimeout(this._delayTimer),this._clearTimeout(this._hideDelayTimer);var n=this._decideOnDelay(e);if(n>0){var s=this;this._delayTimer=this._setTimeout(function(){s._showTooltip(e)},n)}else this._showTooltip(e)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?r.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))},_setTimeout:function(e,i){return t.setTimeout(e,i)},_clearTimeout:function(e){t.clearTimeout(e)}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return p}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return f}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return g}},_DEFAULT_MESSAGE_DURATION:{get:function(){return v}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return y}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return C}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return w}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return b}},_RESHOW_THRESHOLD:{get:function(){return I}},_HIDE_DELAY_MAX:{get:function(){return S}}})})})}),n("require-style!less/styles-rating",[],function(){}),n("require-style!less/colors-rating",[],function(){}),n("WinJS/Controls/Rating",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_SafeHtml","./Tooltip","require-style!less/styles-rating","require-style!less/colors-rating"],function(e,t,i,n,s,o,r,a,l,h,d){"use strict";o.createAccentRule(".win-rating .win-star.win-user.win-full, .win-rating .win-star.win-user.win-full.win-disabled",[{name:"color",value:o.ColorTypes.accent}]),t.Namespace.define("WinJS.UI",{Rating:t.Namespace._lazy(function(){var o=n._createEventProperty,l={get averageRating(){return s._getWinJSString("ui/averageRating").value},get clearYourRating(){return s._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return s._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return"Invalid argument: tooltipStrings must be null or an array of strings."},get unrated(){return s._getWinJSString("ui/unrated").value},get userRating(){return s._getWinJSString("ui/userRating").value}},u=5,c=!1,_="cancel",m="change",p="previewchange",f=0,g=a._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",v=a._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",y=a._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",C="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",w="win-rating",b="win-star win-empty",I="win-star win-average win-empty",S="win-star win-average win-full",x="win-star win-user win-empty",E="win-star win-user win-full",P="win-star win-tentative win-empty",M="win-star win-tentative win-full",T="win-disabled",k="win-average",D="win-user";return t.Class.define(function(t,i){this._disposed=!1,t=t||e.document.createElement("div"),i=i||{},this._element=t,a.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=c,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(i.maxRating),i.tooltipStrings||this._updateTooltips(null),r.setOptions(this,i),this._controlUpdateNeeded=!0,this._forceLayout(),a._addInsertedNotifier(this._element),t.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(e){this._setControlSize(e),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(e){this._userRating=Math.max(0,Math.min(Number(e)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(e){this._averageRating=Number(e)<1?0:Math.min(Number(e)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(e){this._disabled=!!e,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(e){this._enableClear=!!e,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(e){if("object"!=typeof e)throw new i("WinJS.UI.Rating.TooltipStringsIsInvalid",l.tooltipStringsIsInvalid);this._updateTooltips(e),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:o(_),onchange:o(m),onpreviewchange:o(p),dispose:function(){if(!this._disposed){this._disposed=!0;for(var e=0;e<this._toolTips.length;e++)this._toolTips[e].dispose();this._toolTips=null}},addEventListener:function(e,t,i){this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_forceLayout:function(){if(this._controlUpdateNeeded){var e=!1;this._updateControl=function(){e=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,e&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=C)},_createControl:function(){a.addClass(this._element,w);var e="";this._averageRatingHidden=!0;for(var t=0;t<=this._maxRating;t++)e=t===this._maxRating?e+"<div class='"+S+"' style='"+C+"'></div>":e+"<div class='"+x+"'></div>";h.setInnerHTMLUnsafe(this._element,e);for(var i=this._element.firstElementChild,t=0;i;)this._elements[t]=i,t<this._maxRating&&(a.data(i).msStarRating=t+1),i=i.nextElementSibling,t++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()},_getText:function(t){var i=this._tooltipStrings[t];if(i){var n=e.document.createElement("div");return n.innerHTML=i,n.textContent}return t===this._maxRating?l.clearYourRating:t+1},_updateAccessibilityRestState:function(){var e=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),e.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(e.setAttribute("aria-valuenow",this._userRating),e.setAttribute("aria-label",l.userRating),e.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(e.setAttribute("aria-valuenow",this._averageRating),e.setAttribute("aria-label",l.averageRating),e.setAttribute("aria-valuetext",this._averageRating)):(e.setAttribute("aria-valuenow",l.unrated),e.setAttribute("aria-label",l.userRating),e.setAttribute("aria-valuetext",l.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var e=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),e.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(e.setAttribute("aria-label",l.tentativeRating),e.setAttribute("aria-valuenow",this._tentativeRating),e.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(e.setAttribute("aria-valuenow",l.unrated),e.setAttribute("aria-label",l.tentativeRating),e.setAttribute("aria-valuetext",this._getText(this._maxRating))):(e.setAttribute("aria-valuenow",l.unrated),e.setAttribute("aria-label",l.tentativeRating),e.setAttribute("aria-valuetext",l.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var e=0;e<this._maxRating;e++)this._toolTips[e]=new d.Tooltip(this._elements[e])},_decrementRating:function(){this._closeTooltip();var e=!0;0===this._tentativeRating||-1===this._tentativeRating&&0===this._userRating?e=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(this._tentativeRating=0!==this._userRating&&this._userRating>0?this._userRating-1:0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,e=!1)),this._showTentativeRating(e,"keyboard")},_events:function(){function e(e){return{name:e,lowerCaseName:e.toLowerCase(),handler:function(t){var n=i["_on"+e];n&&n.apply(i,[t])}}}var t,i=this,n=[e("KeyDown"),e("FocusOut"),e("FocusIn"),e("PointerCancel"),e("PointerDown"),e("PointerMove"),e("PointerOver"),e("PointerUp"),e("PointerOut")],s=[e("WinJSNodeInserted")];for(t=0;t<n.length;++t)a._addEventListener(this._element,n[t].lowerCaseName,n[t].handler,!1);for(t=0;t<s.length;++t)this._element.addEventListener(s[t].name,s[t].handler,!1);this._ariaValueNowMutationObserver=new a._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onWinJSNodeInserted:function(){this._recalculateStarProperties(),this._updateControl()},_recalculateStarProperties:function(){var t=0;1===this._averageRating&&(t=1);var i=e.getComputedStyle(this._elements[t]);this._elementWidth=i.width,"rtl"===e.getComputedStyle(this._element).direction?(this._elementPadding=i.paddingRight,this._elementBorder=i.borderRight):(this._elementPadding=i.paddingLeft,this._elementBorder=i.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var e=!0;(this._tentativeRating===this._maxRating||-1===this._tentativeRating&&this._userRating===this._maxRating)&&(e=!1),-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:this._tentativeRating=0!==this._userRating?this._userRating<this._maxRating?this._userRating+1:this._maxRating:1,this._showTentativeRating(e,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var e=this._element.getAttributeNode("aria-valuenow");if(null!==e){var t=Number(e.nodeValue);this.userRating!==t&&(this.userRating=t,this._tentativeRating=this._userRating,this._raiseEvent(m,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null),this._captured=!1},_onPointerDown:function(e){(e.pointerType!==y||e.button===f)&&(this._captured||(this._pointerDownAt={x:e.clientX,y:e.clientY},this._pointerDownFocus=!0,this._disabled||(a._setPointerCapture(this._element,e.pointerId),this._captured=!0,e.pointerType===g?(this._tentativeRating=a.data(e.target).msStarRating||0,this._setStarClasses(M,this._tentativeRating,P),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(p,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(t,i){var n,s=this._pointerDownAt||{x:t.clientX,y:t.clientY},o=a._elementsFromPoint(t.clientX,s.y);if(o)for(var r=0,l=o.length;l>r;r++){var h=o[r];if("tooltip"===h.getAttribute("role"))return;if(a.hasClass(h,"win-star")){n=h;break}}var d;if(n&&n.parentElement===this._element)d=a.data(n).msStarRating||0;else{var u=0,c=this.maxRating;"rtl"===e.getComputedStyle(this._element).direction&&(u=c,c=0),d=t.clientX<s.x?u:c}var _=!1,m=Math.min(Math.ceil(d),this._maxRating);0!==m||this._enableClear||(m=1),m!==this._tentativeRating&&(this._closeTooltip(),_=!0),this._tentativeRating=m,this._showTentativeRating(_,i),t.preventDefault()},_onPointerMove:function(e){this._captured&&(e.pointerType===g?this._onCapturedPointerMove(e,"touch"):this._onCapturedPointerMove(e,"mousedown"))},_onPointerOver:function(e){this._disabled||e.pointerType!==v&&e.pointerType!==y||this._onCapturedPointerMove(e,"mouseover")},_onPointerUp:function(e){this._captured&&(a._releasePointerCapture(this._element,e.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(_,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var e=0;e<this._maxRating;e++)this._elements[e].className=P;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(p,this._userRating):this._raiseEvent(p,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(t){var i=a.Key,n=t.keyCode,s=e.getComputedStyle(this._element).direction,o=!0;switch(n){case i.enter:this._onUserRatingChanged();break;case i.tab:this._onUserRatingChanged(),o=!1;break;case i.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null);break;case i.leftArrow:"rtl"===s&&this.userRating<this.maxRating-1?this._incrementRating():"rtl"!==s&&this.userRating>0?this._decrementRating():o=!1;break;case i.upArrow:this.userRating<this.maxRating-1?this._incrementRating():o=!1;break;case i.rightArrow:"rtl"===s&&this.userRating>0?this._decrementRating():"rtl"!==s&&this.userRating<this.maxRating-1?this._incrementRating():o=!1;break;case i.downArrow:this.userRating>0?this._decrementRating():o=!1;break;default:var r=0;if(n>=i.num0&&n<=i.num9?r=i.num0:n>=i.numPad0&&n<=i.numPad9&&(r=i.numPad0),r>0){var l=!1,h=Math.min(n-r,this._maxRating);0!==h||this._enableClear||(h=1),h!==this._tentativeRating&&(this._closeTooltip(),l=!0),this._tentativeRating=h,this._showTentativeRating(l,"keyboard")}else o=!1}o&&(t.stopPropagation(),t.preventDefault())},_onPointerOut:function(e){this._captured||a.eventWithinElement(this._element,e)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(_,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(m,this._userRating)))},_raiseEvent:function(t,i){if(!this._disabled&&(this._lastEventWasChange=t===m,this._lastEventWasCancel=t===_,e.document.createEvent)){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(t,!1,!1,{tentativeRating:i}),this._element.dispatchEvent(n)}},_resetNextElement:function(t){if(null!==this._averageRatingElement.nextSibling){a._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var i=this._averageRatingElement.nextSibling.style,n=e.getComputedStyle(this._element).direction;t&&(n="rtl"===n?"ltr":"rtl"),"rtl"===n?(i.paddingRight=this._elementPadding,i.borderRight=this._elementBorder,i.direction="rtl"):(i.paddingLeft=this._elementPadding,i.borderLeft=this._elementBorder,i.direction="ltr"),i.backgroundPosition="left",i.backgroundSize="100% 100%",i.width=this._resizeStringValue(this._elementWidth,1,i.width)}},_resetAverageStar:function(e){this._resetNextElement(e),this._hideAverageRating()},_resizeStringValue:function(e,t,i){var n=parseFloat(e);if(isNaN(n))return null!==i?i:e;var s=e.substring(n.toString(10).length);return n*=t,n+s},_setControlSize:function(e){var t=(Number(e)||u)>>0;this._maxRating=t>0?t:u},_updateTooltips:function(e){var t,i=0;if(null!==e)for(i=e.length<=this._maxRating+1?e.length:this._maxRating+1,t=0;i>t;t++)this._tooltipStrings[t]=e[t];else{for(t=0;t<this._maxRating;t++)this._tooltipStrings[t]=t+1;this._tooltipStrings[this._maxRating]=l.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(e,t,i){for(var n=0;n<this._maxRating;n++)this._elements[n].className=t>n?e:i},_updateAverageStar:function(){var t=this._averageRatingElement.style,i=this._averageRatingElement.nextSibling.style;"rtl"===e.getComputedStyle(this._element).direction?(t.backgroundPosition="right",t.paddingRight=this._elementPadding,t.borderRight=this._elementBorder,i.paddingRight="0px",i.borderRight="0px",i.direction="ltr"):(t.backgroundPosition="left",i.backgroundPosition="right",t.paddingLeft=this._elementPadding,t.borderLeft=this._elementBorder,i.paddingLeft="0px",i.borderLeft="0px",i.direction="rtl"),a._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue}),t.width=this._resizeStringValue(this._elementWidth,this._floatingValue,t.width),t.backgroundSize=100/this._floatingValue+"% 100%",t.display=e.getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,a._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue}),i.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,i.width),i.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(e,t){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(M,this._tentativeRating,P),this._hideAverageStar()),this._updateAccessibilityHoverState(),e&&(this._openTooltip(t),this._raiseEvent(p,this._tentativeRating))},_openTooltip:function(t){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(t);else if(0===this._tentativeRating){this._clearElement=e.document.createElement("div");var i=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===e.getComputedStyle(this._element).direction&&(i*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+i+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new d.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(t)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var e=0;e<this._maxRating;e++)this._toolTips[e].innerHTML=null},_appendClass:function(e){for(var t=0;t<=this._maxRating;t++)a.addClass(this._elements[t],e)},_setClasses:function(e,t,i){for(var n=0;n<this._maxRating;n++)this._elements[n].className=t>n?e:i},_ensureAverageMSStarRating:function(){a.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(S,this._averageRating-1,I),this._averageRatingElement.className=S;for(var t=0;t<this._maxRating;t++)if(t<this._averageRating&&t+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[t]),this._floatingValue=this._averageRating-t;var i=e.getComputedStyle(this._elements[t]);this._elementWidth=i.width,"rtl"===e.getComputedStyle(this._element).direction?(this._elementPadding=i.paddingRight,this._elementBorder=i.borderRight):(this._elementPadding=i.paddingLeft,this._elementBorder=i.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(E,this._userRating,x),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(b,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(T),this._appendClass(0!==this._averageRating&&0===this._userRating?k:D),this._updateAccessibilityRestState()}}})})})}),n("require-style!less/styles-toggleswitch",[],function(){}),n("require-style!less/colors-toggleswitch",[],function(){}),n("WinJS/Controls/ToggleSwitch",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/styles-toggleswitch","require-style!less/colors-toggleswitch"],function(e,t,i,n,s,o,r,a){"use strict";o.createAccentRule(".win-toggleswitch-on .win-toggleswitch-track",[{name:"background-color",value:o.ColorTypes.accent}]),o.createAccentRule("html.win-hoverable .win-toggleswitch-on:not(.win-toggleswitch-disabled):not(.win-toggleswitch-pressed) .win-toggleswitch-clickregion:hover .win-toggleswitch-track",[{name:"background-color",value:o.ColorTypes.listSelectPress}]),t.Namespace.define("WinJS.UI",{ToggleSwitch:t.Namespace._lazy(function(){var i="win-toggleswitch",o="win-toggleswitch-header",l="win-toggleswitch-clickregion",h="win-toggleswitch-track",d="win-toggleswitch-thumb",u="win-toggleswitch-values",c="win-toggleswitch-value",_="win-toggleswitch-value-on",m="win-toggleswitch-value-off",p="win-toggleswitch-description",f="win-toggleswitch-on",g="win-toggleswitch-off",v="win-toggleswitch-disabled",y="win-toggleswitch-enabled",C="win-toggleswitch-dragging",w="win-toggleswitch-pressed",b={get on(){return s._getWinJSString("ui/on").value},get off(){return s._getWinJSString("ui/off").value}},I=t.Class.define(function(t,n){t=t||e.document.createElement("div"),this._domElement=t,a.addClass(this._domElement,i),this._domElement.innerHTML=['<div class="'+o+'"></div>','<div class="'+l+'">','   <div class="'+h+'">','       <div class="'+d+'"></div>',"   </div>",'   <div class="'+u+'">','      <div class="'+c+" "+_+'"></div>','      <div class="'+c+" "+m+'"></div>',"   </div>","</div>",'<div class="'+p+'"></div>'].join("\n"),this._headerElement=this._domElement.firstElementChild,this._clickElement=this._headerElement.nextElementSibling,this._trackElement=this._clickElement.firstElementChild,this._thumbElement=this._trackElement.firstElementChild,this._labelsElement=this._trackElement.nextElementSibling,this._labelOnElement=this._labelsElement.firstElementChild,this._labelOffElement=this._labelOnElement.nextElementSibling,this._descriptionElement=this._clickElement.nextElementSibling,this._headerElement.setAttribute("aria-hidden",!0),this._labelsElement.setAttribute("aria-hidden",!0),this._headerElement.setAttribute("id",a._uniqueID(this._headerElement)),this._domElement.setAttribute("aria-labelledby",this._headerElement.id),this._domElement.setAttribute("role","checkbox"),this._domElement.winControl=this,a.addClass(this._domElement,"win-disposable"),this._domElement.addEventListener("keydown",this._keyDownHandler.bind(this)),a._addEventListener(this._clickElement,"pointerdown",this._pointerDownHandler.bind(this)),a._addEventListener(this._clickElement,"pointercancel",this._pointerCancelHandler.bind(this)),this._boundPointerMove=this._pointerMoveHandler.bind(this),this._boundPointerUp=this._pointerUpHandler.bind(this),this._mutationObserver=new a._MutationObserver(this._ariaChangedHandler.bind(this)),this._mutationObserver.observe(this._domElement,{attributes:!0,attributeFilter:["aria-checked"]}),this._dragX=0,this._dragging=!1,this.checked=!1,this.disabled=!1,this.labelOn=b.on,this.labelOff=b.off,r.setOptions(this,n)},{element:{get:function(){return this._domElement}},checked:{get:function(){return this._checked},set:function(e){e=!!e,e!==this.checked&&(this._checked=e,this._domElement.setAttribute("aria-checked",e),e?(a.addClass(this._domElement,f),a.removeClass(this._domElement,g)):(a.addClass(this._domElement,g),a.removeClass(this._domElement,f)),this.dispatchEvent("change"))}},disabled:{get:function(){return this._disabled},set:function(e){e=!!e,e!==this._disabled&&(e?(a.addClass(this._domElement,v),a.removeClass(this._domElement,y)):(a.removeClass(this._domElement,v),a.addClass(this._domElement,y)),this._disabled=e,this._domElement.setAttribute("aria-disabled",e),this._domElement.setAttribute("tabIndex",e?-1:0))}},labelOn:{get:function(){return this._labelOnElement.innerHTML},set:function(e){this._labelOnElement.innerHTML=e}},labelOff:{get:function(){return this._labelOffElement.innerHTML},set:function(e){this._labelOffElement.innerHTML=e}},title:{get:function(){return this._headerElement.innerHTML},set:function(e){this._headerElement.innerHTML=e}},onchange:n._createEventProperty("change"),dispose:function(){this._disposed||(this._disposed=!0)},_ariaChangedHandler:function(){var e=this._domElement.getAttribute("aria-checked");e="true"===e?!0:!1,this.checked=e},_keyDownHandler:function(e){this.disabled||(e.keyCode===a.Key.space&&(e.preventDefault(),this.checked=!this.checked),(e.keyCode===a.Key.rightArrow||e.keyCode===a.Key.upArrow)&&(e.preventDefault(),this.checked=!0),(e.keyCode===a.Key.leftArrow||e.keyCode===a.Key.downArrow)&&(e.preventDefault(),this.checked=!1))},_pointerDownHandler:function(e){this.disabled||this._mousedown||(e.preventDefault(),this._mousedown=!0,this._dragXStart=e.pageX-this._trackElement.getBoundingClientRect().left,this._dragX=this._dragXStart,this._dragging=!1,a.addClass(this._domElement,w),a._globalListener.addEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),a._globalListener.addEventListener(this._domElement,"pointerup",this._boundPointerUp,!0),e.pointerType===a._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&a._setPointerCapture(this._domElement,e.pointerId))},_pointerCancelHandler:function(e){this._resetPressedState(),e.pointerType===a._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&a._releasePointerCapture(this._domElement,e.pointerId)},_pointerUpHandler:function(t){if(!this.disabled&&this._mousedown){t=t.detail.originalEvent,t.preventDefault();var i=this._trackElement.getBoundingClientRect(),n=this._thumbElement.getBoundingClientRect(),s="rtl"===e.getComputedStyle(this._domElement).direction;if(this._dragging){var o=i.width-n.width;this.checked=s?this._dragX<o/2:this._dragX>=o/2,this._dragging=!1,a.removeClass(this._domElement,C)}else this.checked=!this.checked;this._resetPressedState()}},_pointerMoveHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var t=this._trackElement.getBoundingClientRect(),i=e.pageX-t.left;if(!(i>t.width)){var n=this._thumbElement.getBoundingClientRect(),s=t.width-n.width-6;this._dragX=Math.min(s,i-n.width/2),this._dragX=Math.max(2,this._dragX),!this._dragging&&Math.abs(i-this._dragXStart)>3&&(this._dragging=!0,a.addClass(this._domElement,C)),this._thumbElement.style.left=this._dragX+"px"}}},_resetPressedState:function(){this._mousedown=!1,this._thumbElement.style.left="",a.removeClass(this._domElement,w),a._globalListener.removeEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),a._globalListener.removeEventListener(this._domElement,"pointerup",this._boundPointerUp,!0)}});return t.Class.mix(I,r.DOMEventMixin),I})})}),n("require-style!less/styles-semanticzoom",[],function(){}),n("require-style!less/colors-semanticzoom",[],function(){}),n("WinJS/Controls/SemanticZoom",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","require-style!less/styles-semanticzoom","require-style!less/colors-semanticzoom"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p){"use strict";t.Namespace.define("WinJS.UI",{SemanticZoom:t.Namespace._lazy(function(){function o(e){return e}function f(e,t,i){return e+" "+l._animationTimeAdjustment(t)+"s "+i+" "+l._libraryDelay+"ms"}function g(){
return f(Z.cssName,V,"ease-in-out")+", "+f("opacity",N,"ease-in-out")}function v(){return f(Z.cssName,U,"ease-in-out")+", "+f("opacity",W,"ease-in-out")}function y(){return f(Z.cssName,J,G)}function C(){return f(Z.cssName,K,G)}function w(e,t){return _.convertToPixels(e,t)}function b(e,t){l.isAnimationEnabled()&&(e.style[Z.scriptName]="scale("+t+")")}function I(e){var t=e.target&&e.target.winControl;t&&!t._resizing&&t._onResize()}function S(e){var t=e[0].target&&e[0].target.winControl;t&&t instanceof ae&&t._onPropertyChanged()}var x=i._browserStyleEquivalents,E={get invalidZoomFactor(){return"Invalid zoomFactor"}},P="win-semanticzoom-button",M="win-semanticzoom-button-location",T=3e3,k=8,D="win-semanticzoom",A="win-semanticzoom-zoomedinview",O="win-semanticzoom-zoomedoutview",B="zoomchanged",L=1.05,R=.65,F=.8,z=.2,H=4096,N=.333,W=.333,V=.333,U=.333,j=1e3*N,q=50,J=.333,K=.333,G="cubic-bezier(0.1,0.9,0.2,1)",Z=x.transform,Y=x.transition.scriptName,X=2,Q=.2,$=.45,ee=1e3,te=50,ie={none:0,zoomedIn:1,zoomedOut:2},ne=_._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",se=_._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",oe=_._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",re={x:0,y:0},ae=t.Class.define(function(t,s){this._disposed=!1;var o=this,r=i.isPhone;this._element=t,this._element.winControl=this,_.addClass(this._element,"win-disposable"),_.addClass(this._element,D),this._element.setAttribute("role","ms-semanticzoomcontainer");var a=this._element.getAttribute("aria-label");if(a||this._element.setAttribute("aria-label",""),s=s||{},this._zoomedOut=!!s.zoomedOut||!!s.initiallyZoomedOut||!1,this._enableButton=!r,r||void 0===s.enableButton||(this._enableButton=!!s.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=_._clamp(s.zoomFactor,z,F,R),this.zoomedInItem=s.zoomedInItem,this.zoomedOutItem=s.zoomedOutItem,i.validation&&s._zoomFactor&&s._zoomFactor!==this._zoomFactor)throw new n("WinJS.UI.SemanticZoom.InvalidZoomFactor",E.invalidZoomFactor);this._locked=!!s.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in e,this._initialize(),this._configure();var l=e.document.body.contains(this._element);_._addInsertedNotifier(this._element),this._element.addEventListener("WinJSNodeInserted",function(e){return l?void(l=!1):void I(e)},!1),this._element.addEventListener("mselementresize",I),_._resizeNotifier.subscribe(this._element,I),new _._MutationObserver(S).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),r||(this._element.addEventListener("wheel",this._onWheel.bind(this),!0),this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),_._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),_._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),_._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),_._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),_._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(i._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),u._setOptions(this,s,!0),o._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(e){var t=!!e;this._enableButton===t||i.isPhone||(this._enableButton=t,t?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(e){this._zoom(!!e,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&i.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(e){var t=this._zoomFactor,i=_._clamp(e,z,F,R);t!==i&&(this._zoomFactor=i,this._onResize())}},locked:{get:function(){return this._locked},set:function(e){this._locked=!!e,e?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(e){this._zoomedInItem=e||o}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(e){this._zoomedOutItem=e||o}},dispose:function(){this._disposed||(this._disposed=!0,_._resizeNotifier.unsubscribe(this._element,I),c._disposeElement(this._elementIn),c._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var t=m.children(this._element);this._elementIn=t[0],this._elementOut=t[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",h.processAll(this._elementIn),h.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=e.document.createElement("div"),this._element.appendChild(this._cropViewport),this._viewportIn=e.document.createElement("div"),this._opticalViewportIn=e.document.createElement("div"),this._viewportOut=e.document.createElement("div"),this._opticalViewportOut=e.document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=e.document.createElement("div"),this._canvasOut=e.document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=e.document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),_.addClass(this._elementIn,A),_.addClass(this._elementOut,O),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=e.document.createElement("button"),this._sezoButton.setAttribute("type","button"),this._sezoButton.className=P+" "+M+" win-button",this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),_._addEventListener(this._element,"pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var e=this._viewIn.getPanAxis(),t=this._viewOut.getPanAxis(),n=i.isPhone;if(this._pansHorizontallyIn="horizontal"===e||"both"===e,this._pansVerticallyIn="vertical"===e||"both"===e,this._pansHorizontallyOut="horizontal"===t||"both"===t,this._pansVerticallyOut="vertical"===t||"both"===t,!this._zoomInProgress){var s=1/this._zoomFactor-1,o=L-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),s),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),o),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,n||(this._zoomedOut?b(this._canvasIn,this._zoomFactor):b(this._canvasOut,1/this._zoomFactor));var r=this._opticalViewportIn.style,a=this._opticalViewportOut.style,h=this._canvasIn.style,d=this._canvasOut.style;h.opacity=this._zoomedOut&&!n?0:1,d.opacity=this._zoomedOut?1:0,n&&(h.zIndex=1,d.zIndex=2),l.isAnimationEnabled()&&!n&&(r[x["transition-property"].scriptName]=Z.cssName,r[x["transition-duration"].scriptName]="0s",r[x["transition-timing-function"].scriptName]="linear",a[x["transition-property"].scriptName]=Z.cssName,a[x["transition-duration"].scriptName]="0s",a[x["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var e=this._element.getAttribute("aria-checked"),t="true"===e;this._zoomedOut!==t&&(this.zoomedOut=t)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var t=function(e,t,i,n,s){var o=e.style;o.left=t+"px",o.top=i+"px",o.width=n+"px",o.height=s+"px"},i=e.getComputedStyle(this._element,null),n=parseFloat(i.width),s=parseFloat(i.height),o=w(this._element,i.paddingLeft),r=w(this._element,i.paddingRight),a=w(this._element,i.paddingTop),l=w(this._element,i.paddingBottom),h=n-o-r,d=s-a-l,u=1/this._zoomFactor;if(this._viewportWidth===h&&this._viewportHeight===d)return;this._sezoClientHeight=s,this._sezoClientWidth=n,this._viewportWidth=h,this._viewportHeight=d,this._configure();var c=2*u-1,_=Math.min(H,(this._pansHorizontallyIn?c:1)*h),m=Math.min(H,(this._pansVerticallyIn?c:1)*d);this._canvasLeftIn=.5*(_-h),this._canvasTopIn=.5*(m-d),t(this._cropViewport,o,a,h,d),t(this._viewportIn,0,0,h,d),t(this._opticalViewportIn,0,0,h,d),t(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,_,m),t(this._elementIn,this._canvasLeftIn,this._canvasTopIn,h,d);var p=2*L-1,f=(this._pansHorizontallyOut?p:1)*h,g=(this._pansVerticallyOut?p:1)*d;this._canvasLeftOut=.5*(f-h),this._canvasTopOut=.5*(g-d),t(this._viewportOut,0,0,h,d),t(this._opticalViewportOut,0,0,h,d),t(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,f,g),t(this._elementOut,this._canvasLeftOut,this._canvasTopOut,h,d)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(e){return this._zooming||!this._lastMouseX&&!this._lastMouseY||e.screenX===this._lastMouseX&&e.screenY===this._lastMouseY?(this._lastMouseX=e.screenX,void(this._lastMouseY=e.screenY)):void(Math.abs(e.screenX-this._lastMouseX)<=k&&Math.abs(e.screenY-this._lastMouseY)<=k||(this._lastMouseX=e.screenX,this._lastMouseY=e.screenY,this._displayButton()))},_displayButton:function(){if(p.isHoverable){e.clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var t=this;this._dismissButtonTimer=e.setTimeout(function(){t._hideSemanticZoomButton()},l._animationTimeAdjustment(T))}},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(a.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(e){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(e)this._sezoButton.style.visibility="hidden";else{var t=this;a.fadeOut(this._sezoButton).then(function(){t._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(e){e.target!==this.element&&this._hideSemanticZoomButton(!0)},_onWheel:function(e){e.ctrlKey&&(this._zoom(e.deltaY>0,this._getPointerLocation(e)),e.stopPropagation(),e.preventDefault())},_onMouseWheel:function(e){e.ctrlKey&&(this._zoom(e.wheelDelta<0,this._getPointerLocation(e)),e.stopPropagation(),e.preventDefault())},_onPenHover:function(e){e.pointerType===se&&0===e.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(e){var t=!1;if(e.ctrlKey){var i=_.Key;switch(e.keyCode){case i.add:case i.equal:case 61:this._zoom(!1),t=!0;break;case i.subtract:case i.dash:case 173:this._zoom(!0),t=!0}}t&&(e.stopPropagation(),e.preventDefault())},_createPointerRecord:function(e,t){var i=this._getPointerLocation(e),n={};return n.startX=n.currentX=i.x,n.startY=n.currentY=i.y,n.fireCancelOnPinch=t,this._pointerRecords[e.pointerId]=n,this._pointerCount=Object.keys(this._pointerRecords).length,n},_deletePointerRecord:function(e){var t=this._pointerRecords[e];return delete this._pointerRecords[e],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),t},_fakeCancelOnPointer:function(t){var i=e.document.createEvent("UIEvent");i.initUIEvent("touchcancel",!0,!0,e,0),i.touches=t.touches,i.targetTouches=t.targetTouches,i.changedTouches=[t._currentTouch],i._fakedBySemanticZoom=!0,t.target.dispatchEvent(i)},_handlePointerDown:function(e){this._createPointerRecord(e,!1);for(var t=Object.keys(this._pointerRecords),i=0,n=t.length;n>i;i++)try{_._setPointerCapture(this._hiddenElement,t[i]||0)}catch(s){return void this._resetPointerRecords()}e.stopImmediatePropagation(),e.preventDefault()},_handleFirstPointerDown:function(e){this._resetPointerRecords(),this._createPointerRecord(e,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(e){e.target!==this._element&&this._isBouncing&&e.stopImmediatePropagation()},_onPointerDown:function(e){e.pointerType===ne&&(0===this._pointerCount?this._handleFirstPointerDown(e):this._handlePointerDown(e))},_onPointerMove:function(e){function t(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function i(e,t){return{x:.5*(e.currentX+t.currentX)|0,y:.5*(e.currentY+t.currentY)|0}}if(e.pointerType===oe||e.pointerType===se)return void this._onMouseMove(e);if(e.pointerType===ne){var n=this._pointerRecords[e.pointerId],s=this._getPointerLocation(e);if(n){if(n.currentX=s.x,n.currentY=s.y,2===this._pointerCount){this._pinching=!0;var o=Object.keys(this._pointerRecords),a=this._pointerRecords[o[0]],l=this._pointerRecords[o[1]];this._currentMidPoint=i(a,l);var h=t(a.currentX,a.currentY,l.currentX,l.currentY),d=this,u=function(e){var t=e?ie.zoomedOut:ie.zoomedIn,n=e?d._pinchedDirection===ie.zoomedIn&&!d._zoomingOut:d._pinchedDirection===ie.zoomedOut&&d._zoomingOut,s=e?!d._zoomedOut:d._zoomedOut;if(d._pinchedDirection===ie.none)s?(d._isBouncingIn=!1,d._zoom(e,i(a,l),!0),d._pinchedDirection=t):d._isBouncingIn||d._playBounce(!0,i(a,l));else if(n){var o=d._lastPinchDistance/d._lastPinchStartDistance,r=d._lastLastPinchDistance/d._lastPinchDistance;(e&&o>Q||!e&&r>$)&&(d._zoom(e,i(a,l),!0),d._pinchedDirection=t)}};this._updatePinchDistanceRecords(h),this._pinchDistanceCount>=X&&(this._zooming||this._isBouncing||(r("WinJS.UI.SemanticZoom:EndPinchDetection,info"),u(this._lastPinchDirection===ie.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(n.fireCancelOnPinch&&(this._fakeCancelOnPointer(e,n),n.fireCancelOnPinch=!1),e.stopImmediatePropagation(),e.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(e){e.pointerType===ne&&e.target===this._element&&this._completePointerUp(e,!1)},_onPointerUp:function(e){this._releasePointerCapture(e),this._completePointerUp(e,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(e){e._fakedBySemanticZoom||(this._releasePointerCapture(e),this._completePointerUp(e,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(e){var t=this._pointerRecords[e.pointerId];t&&(t.dirty=!1)},_onLostPointerCapture:function(e){var t=this._pointerRecords[e.pointerId];if(t){t.dirty=!0;var i=this;d.timeout(te).then(function(){t.dirty&&i._completePointerUp(e,!1)})}},_onMSContentZoom:function(e){var t=e.target;if(t===this._opticalViewportIn||t===this._opticalViewportOut){var i=t.msContentZoomFactor<.995,n=t.msContentZoomFactor>1.005;!i||this._zoomedOut||this._zoomingOut?n&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(e){function t(t){i._lastPinchDirection===t?i._pinchDistanceCount++:(i._pinchGesture++,i._pinchDistanceCount=0,i._lastPinchStartDistance=e),i._lastPinchDirection=t,i._lastPinchDistance=e,i._lastLastPinchDistance=i._lastPinchDistance}var i=this;-1===this._lastPinchDistance?(r("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=e):this._lastPinchDistance!==e&&t(this._lastPinchDistance>e?ie.zoomedOut:ie.zoomedIn)},_zoomFromCurrent:function(e){this._zoom(e,null,!1,!0)},_zoom:function(e,t,n,s,o){if(r("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+e+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!n)return;e!==this._zoomingOut&&this._startAnimations(e)}else if(e!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!n,t&&(e?this._viewIn:this._viewOut).setCurrentItem(t.x,t.y),this._zoomInProgress=!0,(e?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",e&&i.isPhone&&(this._canvasOut.style.opacity=1);var a=this._viewIn.beginZoom(),l=this._viewOut.beginZoom(),h=null;if((a||l)&&i.isPhone&&(h=d.join([a,l])),s&&!o){var u=this;(e?this._viewIn:this._viewOut).getCurrentItem().then(function(t){var i=t.position;u._prepareForZoom(e,{x:u._rtl()?u._sezoClientWidth-i.left-.5*i.width:i.left+.5*i.width,y:i.top+.5*i.height},d.wrap(t),h)})}else this._prepareForZoom(e,t||{},null,h,o)}},_prepareForZoom:function(t,i,n,s,o){function a(e,t){l._canvasIn.style[x["transform-origin"].scriptName]=l._canvasLeftIn+h-e.x+"px "+(l._canvasTopIn+d-e.y)+"px",l._canvasOut.style[x["transform-origin"].scriptName]=l._canvasLeftOut+h-t.x+"px "+(l._canvasTopOut+d-t.y)+"px"}r("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var l=this,h=i.x,d=i.y;"number"==typeof h&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(h=.5*this._sezoClientWidth),"number"==typeof d&&this._pansVerticallyIn&&this._pansVerticallyOut||(d=.5*this._sezoClientHeight),a(re,re),o?this._aligning=!1:this._alignViewsPromise=this._alignViews(t,h,d,n).then(function(){l._aligning=!1,l._gestureEnding=!1,l._alignViewsPromise=null,l._zooming||l._gesturing||l._completeZoom()}),this._zoomingOut=t,e.getComputedStyle(this._canvasIn).opacity,e.getComputedStyle(this._canvasOut).opacity,r("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(t,s)},_alignViews:function(e,t,i,n){var s=1-this._zoomFactor,o=this._rtl(),r=s*(o?this._viewportWidth-t:t),a=s*i,l=this;if(e){var h=n||this._viewIn.getCurrentItem();if(h)return h.then(function(e){var t=e.position,i={left:t.left*l._zoomFactor+r,top:t.top*l._zoomFactor+a,width:t.width*l._zoomFactor,height:t.height*l._zoomFactor};return l._viewOut.positionItem(l._zoomedOutItem(e.item),i)})}else{var u=n||this._viewOut.getCurrentItem();if(u)return u.then(function(e){var t=e.position,i={left:(t.left-r)/l._zoomFactor,top:(t.top-a)/l._zoomFactor,width:t.width/l._zoomFactor,height:t.height/l._zoomFactor};return l._viewIn.positionItem(l._zoomedInItem(e.item),i)})}return new d(function(e){e({x:0,y:0})})},_startAnimations:function(e,t){this._zoomingOut=e;var n=i.isPhone;if(l.isAnimationEnabled()&&!n&&(r("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[Y]=e?g():v(),this._canvasOut.style[Y]=e?v():g()),n||(b(this._canvasIn,e?this._zoomFactor:1),b(this._canvasOut,e?1:1/this._zoomFactor)),this._canvasIn.style.opacity=e&&!n?0:1,(!n||e)&&(this._canvasOut.style.opacity=e?1:0),l.isAnimationEnabled())if(t){var s=this,o=function(){s._canvasIn.style[Z.scriptName]="",s._canvasOut.style[Z.scriptName]="",s._onZoomAnimationComplete()};t.then(o,o)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),l._animationTimeAdjustment(j));else this._zooming=!1,this._canvasIn.style[Z.scriptName]="",this._canvasOut.style[Z.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){r("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(e){return this._disposed?void 0:e.target!==this._canvasOut&&e.target!==this._canvasIn||!this._isBouncing?void(e.target===this._canvasIn&&e.propertyName===Z.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(t){t&&e.clearTimeout(t)},_completePointerUp:function(e,t){if(!this._disposed){var i=e.pointerId,n=this._pointerRecords[i];if(n&&(this._deletePointerRecord(i),this._isBouncingIn&&this._playBounce(!1),t&&this._pinchedDirection!==ie.none&&e.stopImmediatePropagation(),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==ie.none&&this._pinchDistanceCount<X)return this._zoom(this._lastPinchDirection===ie.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==ie.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(t,i){var n=this;n._TTFFTimer=e.setTimeout(function(){this._disposed||(n._TTFFTimer=e.setTimeout(t,i))},q)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var t=this;(this._zoomInProgress||this._isBouncing)&&(t._completeZoomTimer=e.setTimeout(function(){t._completeZoom()},l._animationTimeAdjustment(ee)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){r("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!i.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var t=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),t=!0),this._setVisibility(),t){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(B,!0,!0,this._zoomedOut),this._element.dispatchEvent(n),this._isActive&&_._setActive(this._zoomedOut?this._elementOut:this._elementIn)}r("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var t=e.document.activeElement;return this._element===t||this._element.contains(t)},_setLayout:function(e,t,i){var n=e.style;n.position=t,n.overflow=i},_setupOpticalViewport:function(e){e.style["-ms-overflow-style"]="none",i.isPhone||(e.style["-ms-content-zooming"]="zoom",e.style["-ms-content-zoom-limit-min"]="99%",e.style["-ms-content-zoom-limit-max"]="101%",e.style["-ms-content-zoom-snap-points"]="snapList(100%)",e.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function e(e,t){e.style.visibility=t?"visible":"hidden"}e(this._opticalViewportIn,!this._zoomedOut||i.isPhone),e(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=ie.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(e){var t=e.pointerId;try{_._releasePointerCapture(this._hiddenElement,t)}catch(i){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var e=this;this._recordResetPromise=d.timeout(te).then(function(){0===e._pointerCount&&(e._resetPointerRecords(),e._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=ie.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(t){var i={left:0,top:0};try{i=this._element.getBoundingClientRect()}catch(n){}var s=e.getComputedStyle(this._element,null),o=w(this._element,s.paddingLeft),r=w(this._element,s.paddingTop),a=w(this._element,s.borderLeftWidth);return{x:+t.clientX===t.clientX?t.clientX-i.left-o-a:0,y:+t.clientY===t.clientY?t.clientY-i.top-r-r:0}},_playBounce:function(e,t){if(l.isAnimationEnabled()&&this._isBouncingIn!==e){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=e,e?this._bounceCenter=t:this._aligned=!0;var i=this._zoomedOut?this._canvasOut:this._canvasIn,n=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,s=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;i.style[x["transform-origin"].scriptName]=n+this._bounceCenter.x+"px "+(s+this._bounceCenter.y)+"px",i.style[Y]=e?y():C(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var o=e?this._zoomedOut?2-L:L:1;b(i,o),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),l._animationTimeAdjustment(j))}},_rtl:function(){return"rtl"===e.getComputedStyle(this._element,null).direction},_pinching:{set:function(e){this._viewIn.pinching=e,this._viewOut.pinching=e}}});return t.Class.mix(ae,s.createEventProperties("zoomchanged")),t.Class.mix(ae,u.DOMEventMixin),ae})})}),n("WinJS/Controls/Pivot/_Constants",["require","exports"],function(e,t){t._ClassNames={pivot:"win-pivot",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaderArea:"win-pivot-header-area",pivotHeaderLeftCustom:"win-pivot-header-leftcustom",pivotHeaderRightCustom:"win-pivot-header-rightcustom",pivotHeaderItems:"win-pivot-header-items",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch",pivotDisableContentSwipeNavigation:"win-pivot-disablecontentswipenavigation"}}),n("WinJS/Controls/Pivot/_Item",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(e,t,i,n,s,o,r,a,l,h,d,u,c){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{PivotItem:i.Namespace._lazy(function(){var e={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},o=i.Class.define(function(i,n){if(i=i||t.document.createElement("DIV"),n=n||{},i.winControl)throw new s("WinJS.UI.PivotItem.DuplicateConstruction",e.duplicateConstruction);i.winControl=this,this._element=i,u.addClass(this.element,o._ClassName.pivotItem),u.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=o._ClassName.pivotItemContent,i.appendChild(this._contentElement);for(var a=this.element.firstChild;a!==this._contentElement;){var l=a.nextSibling;this._contentElement.appendChild(a),a=l}this._processors=[r.processAll],h.setOptions(this,n)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(e){this._header=e,this._parentPivot&&this._parentPivot._headersState.handleHeaderChanged(this)}},_parentPivot:{get:function(){for(var e=this._element;e&&!u.hasClass(e,c._ClassNames.pivot);)e=e.parentNode;return e&&e.winControl}},_process:function(){var e=this;return this._processors&&this._processors.push(function(){return l.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(t,i){return t.then(function(){return i(e.contentElement)})},this._processed||a.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,d.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){t!==r.processAll&&(e._processors=e._processors||[],e._processors.push(t),e._processed&&e._process())})});return o})})}),n("require-style!less/styles-pivot",[],function(){}),n("require-style!less/colors-pivot",[],function(){});var s=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};n("WinJS/Controls/Pivot/_Pivot",["require","exports","../../Core/_Global","../../Animations","../../BindingList","../../ControlProcessor","../../Promise","../../Scheduler","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Core/_Resources","../../Utilities/_TabContainer","../../Animations/_TransitionAnimation","../../Core/_WriteProfilerMark","./_Constants","./_Item"],function(e,t,i,n,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C,w,b,I,S){function x(e){var t=i.document.createTextNode("object"==typeof e.header?JSON.stringify(e.header):""+e.header);return t}f.isHoverable,S.PivotItem,e(["require-style!less/styles-pivot"]),e(["require-style!less/colors-pivot"]);var E={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},P={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateItem(){return y._getWinJSString("ui/duplicateItem").value},get invalidContent(){return"Invalid content: Pivot content must be made up of PivotItems."},get pivotAriaLabel(){return y._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return y._getWinJSString("ui/pivotViewportAriaLabel").value}},M=!!(_._supportsSnapPoints&&"inertiaDestinationX"in i.MSManipulationEvent.prototype),T=_._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",k=_._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",D=_.Key,A=250,O=-1,B=function(){function e(e,t){if(void 0===t&&(t={}),this._disposed=!1,this._firstLoad=!0,this._hidePivotItemAnimation=a.wrap(),this._loadPromise=a.wrap(),this._pendingRefresh=!1,this._selectedIndex=0,this._showPivotItemAnimation=a.wrap(),
this._slideHeadersAnimation=a.wrap(),e=e||i.document.createElement("DIV"),e.winControl)throw new m("WinJS.UI.Pivot.DuplicateConstruction",P.duplicateConstruction);this._handleItemChanged=this._handleItemChanged.bind(this),this._handleItemInserted=this._handleItemInserted.bind(this),this._handleItemMoved=this._handleItemMoved.bind(this),this._handleItemRemoved=this._handleItemRemoved.bind(this),this._handleItemReload=this._handleItemReload.bind(this),this._resizeHandler=this._resizeHandler.bind(this),this._updatePointerType=this._updatePointerType.bind(this),this._id=e.id||_._uniqueID(e),this._writeProfilerMark("constructor,StartTM"),e.winControl=this,this._element=e,this._element.setAttribute("role","tablist"),this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",P.pivotAriaLabel),_.addClass(this.element,I._ClassNames.pivot),_.addClass(this.element,"win-disposable"),_._addEventListener(this.element,"pointerenter",this._updatePointerType),_._addEventListener(this.element,"pointerout",this._updatePointerType),this._titleElement=i.document.createElement("DIV"),this._titleElement.style.display="none",_.addClass(this._titleElement,I._ClassNames.pivotTitle),this._element.appendChild(this._titleElement),this._headerAreaElement=i.document.createElement("DIV"),_.addClass(this._headerAreaElement,I._ClassNames.pivotHeaderArea),this._element.appendChild(this._headerAreaElement),this._headerItemsElement=i.document.createElement("DIV"),_.addClass(this._headerItemsElement,I._ClassNames.pivotHeaderItems),this._headerAreaElement.appendChild(this._headerItemsElement),this._headerItemsElWidth=null,this._headersContainerElement=i.document.createElement("DIV"),this._headersContainerElement.tabIndex=0,_.addClass(this._headersContainerElement,I._ClassNames.pivotHeaders),this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this)),_._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this)),_._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this)),this._headerItemsElement.appendChild(this._headersContainerElement),this._element.addEventListener("click",this._elementClickedHandler.bind(this)),this._winKeyboard=new g._WinKeyboard(this._headersContainerElement),this._tabContainer=new C.TabContainer(this._headersContainerElement),this._customLeftHeader=i.document.createElement("DIV"),_.addClass(this._customLeftHeader,I._ClassNames.pivotHeaderLeftCustom),this._headerAreaElement.insertBefore(this._customLeftHeader,this._headerAreaElement.children[0]),this._customRightHeader=i.document.createElement("DIV"),_.addClass(this._customRightHeader,I._ClassNames.pivotHeaderRightCustom),this._headerAreaElement.appendChild(this._customRightHeader),this._viewportElement=i.document.createElement("DIV"),this._viewportElement.className=I._ClassNames.pivotViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",P.pivotViewportAriaLabel),this.element.addEventListener("mselementresize",this._resizeHandler),_._resizeNotifier.subscribe(this.element,this._resizeHandler),this._viewportElWidth=null,this._surfaceElement=i.document.createElement("DIV"),this._surfaceElement.className=I._ClassNames.pivotSurface,this._viewportElement.appendChild(this._surfaceElement),this._headersState=new L(this),M?this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)):(_.addClass(this.element,I._ClassNames.pivotNoSnap),_._addEventListener(this._element,"pointerdown",this._elementPointerDownHandler.bind(this)),_._addEventListener(this._element,"pointerup",this._elementPointerUpHandler.bind(this))),this._parse(),t=d._shallowCopy(t),t.items&&(this.items=t.items,delete t.items),u.setOptions(this,t),this._refresh(),this._writeProfilerMark("constructor,StopTM")}return Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customLeftHeader",{get:function(){return this._customLeftHeader.firstElementChild},set:function(e){_.empty(this._customLeftHeader),e&&this._customLeftHeader.appendChild(e),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customRightHeader",{get:function(){return this._customRightHeader.firstElementChild},set:function(e){_.empty(this._customRightHeader),e&&this._customRightHeader.appendChild(e),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locked",{get:function(){return _.hasClass(this.element,I._ClassNames.pivotLocked)},set:function(e){_[e?"addClass":"removeClass"](this.element,I._ClassNames.pivotLocked),e&&this._hideNavButtons()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(e){this._pendingItems=e,this._refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._titleElement.textContent},set:function(e){e?(this._titleElement.style.display="block",this._titleElement.textContent=e):(this._titleElement.style.display="none",this._titleElement.textContent="")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedIndex",{get:function(){return 0===this.items.length?-1:this._selectedIndex},set:function(e){e>=0&&e<this.items.length&&(this._pendingRefresh?this._selectedIndex=e:this._loadItem(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItem",{get:function(){return this.items.getAt(this.selectedIndex)},set:function(e){var t=this.items.indexOf(e);-1!==t&&(this.selectedIndex=t)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._updateEvents(this._items,null),_._resizeNotifier.unsubscribe(this.element,this._resizeHandler),this._headersState.exit(),c._disposeElement(this._headersContainerElement);for(var e=0,t=this.items.length;t>e;e++)this.items.getAt(e).dispose()}},e.prototype.forceLayout=function(){this._disposed||this._resizeHandler()},e.prototype._applyProperties=function(){function e(e){for(var t=0,i=e.items.length;i>t;t++){var n=e._items.getAt(t);if(n.element.parentNode===e._surfaceElement)throw new m("WinJS.UI.Pivot.DuplicateItem",P.duplicateItem);n.element.style.display="none",e._surfaceElement.appendChild(n.element)}}if(!this._disposed){if(this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;){var t=this.element.firstElementChild;t.parentNode.removeChild(t)}_.empty(this._surfaceElement)}e(this),this._rtl="rtl"===i.getComputedStyle(this._element,null).direction,this._headersState.refreshHeadersState(!0),this._pendingRefresh=!1,this._firstLoad=!0,this.selectedIndex=this._selectedIndex,this._firstLoad=!1,this._recenterViewport()}},e.prototype._parse=function(){for(var e=[],t=this.element.firstElementChild;t!==this._titleElement;){r.processAll(t);var i=t.winControl;if(!i)throw new m("WinJS.UI.Pivot.InvalidContent",P.invalidContent);e.push(i);var n=t.nextElementSibling;t=n}this.items=new o.List(e)},e.prototype._refresh=function(){this._pendingRefresh||(this._pendingRefresh=!0,l.schedule(this._applyProperties.bind(this),l.Priority.high))},e.prototype._resizeHandler=function(){if(!this._disposed&&!this._pendingRefresh){var e=this._getViewportWidth(),t=this._getHeaderItemsWidth();this._invalidateMeasures(),e!==this._getViewportWidth()||t!==this._getHeaderItemsWidth()?(v.log&&v.log("_resizeHandler, viewport from:"+e+" to: "+this._getViewportWidth()),v.log&&v.log("_resizeHandler, headers from:"+t+" to: "+this._getHeaderItemsWidth()),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterViewport(),this._headersState.handleResize()):v.log&&v.log("_resizeHandler worthless resize")}},e.prototype._activateHeader=function(e){if(!this.locked){var t=this._items.indexOf(e._item);t!==this.selectedIndex?this._headersState.activateHeader(e):_._setActiveFirstFocusableElement(this.selectedItem.element)}},e.prototype._goNext=function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},e.prototype._goPrevious=function(){this._animateToPrevious=!0,this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1,this._animateToPrevious=!1},e.prototype._loadItem=function(e){var t=this;this._rtl="rtl"===i.getComputedStyle(this._element,null).direction,this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation.cancel();var n=this._animateToPrevious,s=this._items.getAt(e),o={index:e,direction:n?"backwards":"forward",item:s};this._fireEvent(E.selectionChanged,!0,!1,o);var r=this._firstLoad,l=this._loadPromise=this._loadPromise.then(function(){var i=t._items.getAt(t.selectedIndex);i&&t._hidePivotItem(i.element,n,r);var o=t._selectedIndex;return t._selectedIndex=e,t._headersState.handleNavigation(n,e,o),a.join([s._process(),t._hidePivotItemAnimation,a.timeout()]).then(function(){return t._disposed||t._loadPromise!==l?void 0:(t._recenterViewport(),t._showPivotItem(s.element,n,r).then(function(){t._disposed||t._loadPromise!==l||(t._loadPromise=a.wrap(),t._writeProfilerMark("itemAnimationStop,info"),t._fireEvent(E.itemAnimationEnd,!0,!1,null))}))})})},e.prototype._recenterViewport=function(){_.setScrollPosition(this._viewportElement,{scrollLeft:this._getViewportWidth()}),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._getViewportWidth()+"px")},e.prototype._fireEvent=function(e,t,n,s){var o=i.document.createEvent("CustomEvent");return o.initCustomEvent(e,!!t,!!n,s),this.element.dispatchEvent(o)},e.prototype._getDirectionAccessor=function(){return this._rtl?"right":"left"},e.prototype._getHeaderItemsWidth=function(){return this._headerItemsElWidth||(this._headerItemsElWidth=parseFloat(i.getComputedStyle(this._headerItemsElement).width)),this._headerItemsElWidth||O},e.prototype._getViewportWidth=function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(i.getComputedStyle(this._viewportElement).width),M&&(this._viewportElement.style[d._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||O},e.prototype._invalidateMeasures=function(){this._viewportElWidth=this._headerItemsElWidth=null},e.prototype._updateEvents=function(e,t){e&&(e.removeEventListener("itemchanged",this._handleItemChanged),e.removeEventListener("iteminserted",this._handleItemInserted),e.removeEventListener("itemmoved",this._handleItemMoved),e.removeEventListener("itemremoved",this._handleItemRemoved),e.removeEventListener("reload",this._handleItemReload)),t&&(t.addEventListener("itemchanged",this._handleItemChanged),t.addEventListener("iteminserted",this._handleItemInserted),t.addEventListener("itemmoved",this._handleItemMoved),t.addEventListener("itemremoved",this._handleItemRemoved),t.addEventListener("reload",this._handleItemReload))},e.prototype._writeProfilerMark=function(e){var t="WinJS.UI.Pivot:"+this._id+":"+e;b(t),v.log&&v.log(t,null,"pivotprofiler")},e.prototype._handleItemChanged=function(e){if(!this._pendingItems){var t=e.detail.index,i=e.detail.newValue,n=e.detail.oldValue;if(i.element!==n.element){if(i.element.parentNode===this._surfaceElement)throw new m("WinJS.UI.Pivot.DuplicateItem",P.duplicateItem);i.element.style.display="none",this._surfaceElement.insertBefore(i.element,n.element),this._surfaceElement.removeChild(n.element),t===this.selectedIndex&&(this.selectedIndex=t)}this._headersState.render(),this._headersState.refreshHeadersState(!0)}},e.prototype._handleItemInserted=function(e){if(!this._pendingItems){var t=e.detail.index,i=e.detail.value;if(i.element.parentNode===this._surfaceElement)throw new m("WinJS.UI.Pivot.DuplicateItem",P.duplicateItem);i.element.style.display="none",t<this.items.length-1?this._surfaceElement.insertBefore(i.element,this.items.getAt(t+1).element):this._surfaceElement.appendChild(i.element),t<=this.selectedIndex&&this._selectedIndex++,1===this._items.length&&(this.selectedIndex=0),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},e.prototype._handleItemMoved=function(e){if(!this._pendingItems){var t=e.detail.oldIndex,i=e.detail.newIndex,n=e.detail.value;i<this.items.length-1?this._surfaceElement.insertBefore(n.element,this.items.getAt(i+1).element):this._surfaceElement.appendChild(n.element),t<this.selectedIndex&&i>=this.selectedIndex?this._selectedIndex--:i>this.selectedIndex&&t<=this.selectedIndex?this._selectedIndex++:t===this.selectedIndex&&(this.selectedIndex=this.selectedIndex),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},e.prototype._handleItemReload=function(){this.items=this.items},e.prototype._handleItemRemoved=function(e){if(!this._pendingItems){var t=e.detail.value,i=e.detail.index;this._surfaceElement.removeChild(t.element),i<this.selectedIndex?this._selectedIndex--:i===this._selectedIndex&&(this.selectedIndex=Math.min(this.items.length-1,this._selectedIndex)),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},e.prototype._elementClickedHandler=function(e){if(this.locked||this._navigationHandled)return void(this._navigationHandled=!1);var t,i=e.target;if(_.hasClass(i,I._ClassNames.pivotHeader))t=i;else{var n=!1,s=_._elementsFromPoint(e.clientX,e.clientY);if(s&&s[0]===this._viewportElement)for(var o=0,r=s.length;r>o;o++)s[o]===i&&(n=!0),_.hasClass(s[o],I._ClassNames.pivotHeader)&&(t=s[o]);n||(t=null)}t&&this._activateHeader(t)},e.prototype._elementPointerDownHandler=function(e){if(!M){var t=e.target;this._elementPointerDownPoint={x:e.clientX,y:e.clientY,type:e.pointerType||"mouse",time:Date.now(),inHeaders:this._headersContainerElement.contains(t)}}},e.prototype._elementPointerUpHandler=function(e){if(!this._elementPointerDownPoint||this.locked)return void(this._elementPointerDownPoint=null);var t=e.target,i=32,n=.4,s=Math.abs(e.clientY-this._elementPointerDownPoint.y),o=e.clientX-this._elementPointerDownPoint.x,r=Math.abs(o*n),a=r>s&&Math.abs(o)>i&&(!_._supportsTouchDetection||this._elementPointerDownPoint.type===e.pointerType&&e.pointerType===k)&&(!this.element.classList.contains(I._ClassNames.pivotDisableContentSwipeNavigation)||this._elementPointerDownPoint.inHeaders&&this._headersContainerElement.contains(t));if(this._navigationHandled=!1,a){var l=Date.now()-this._elementPointerDownPoint.time;o*=Math.max(1,Math.pow(350/l,2)),o=this._rtl?-o:o;var h=this._getViewportWidth()/4;-h>o?(this._goNext(),this._navigationHandled=!0):o>h&&(this._goPrevious(),this._navigationHandled=!0)}if(!this._navigationHandled){for(;null!==t&&!_.hasClass(t,I._ClassNames.pivotHeader);)t=t.parentElement;null!==t&&(this._activateHeader(t),this._navigationHandled=!0)}this._elementPointerDownPoint=null},e.prototype._headersKeyDown=function(e){this.locked||(e.keyCode===D.leftArrow||e.keyCode===D.pageUp?(this._rtl?this._goNext():this._goPrevious(),e.preventDefault()):(e.keyCode===D.rightArrow||e.keyCode===D.pageDown)&&(this._rtl?this._goPrevious():this._goNext(),e.preventDefault()))},e.prototype._hideNavButtons=function(e){e&&this._headersContainerElement.contains(e.relatedTarget)||_.removeClass(this._headersContainerElement,I._ClassNames.pivotShowNavButtons)},e.prototype._hidePivotItem=function(e,t,i){return i||!w.isAnimationEnabled()?(e.style.display="none",this._hidePivotItemAnimation=a.wrap(),this._hidePivotItemAnimation):(this._hidePivotItemAnimation=w.executeTransition(e,{property:"opacity",delay:0,duration:67,timing:"linear",from:"",to:"0"}).then(function(){e.style.display="none"}),this._hidePivotItemAnimation)},e.prototype._MSManipulationStateChangedHandler=function(e){if(e.target===this._viewportElement&&e.currentState===_._MSManipulationEvent.MS_MANIPULATION_STATE_INERTIA){var t=e.inertiaDestinationX-this._getViewportWidth();t>0?this._goNext():0>t&&this._goPrevious()}},e.prototype._updatePointerType=function(e){this._pointerType!==(e.pointerType||T)&&(this._pointerType=e.pointerType||T,this._pointerType===k?(_.removeClass(this.element,I._ClassNames.pivotInputTypeMouse),_.addClass(this.element,I._ClassNames.pivotInputTypeTouch),this._hideNavButtons()):(_.removeClass(this.element,I._ClassNames.pivotInputTypeTouch),_.addClass(this.element,I._ClassNames.pivotInputTypeMouse)))},e.prototype._showNavButtons=function(e){this.locked||e&&e.pointerType===k||_.addClass(this._headersContainerElement,I._ClassNames.pivotShowNavButtons)},e.prototype._showPivotItem=function(e,t,i){function s(e){var t=e.getBoundingClientRect();return t.top<r.bottom&&t.bottom>r.top}if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(E.itemAnimationStart,!0,!1,null),e.style.display="",i||!w.isAnimationEnabled())return e.style.opacity="",this._showPivotItemAnimation=a.wrap(),this._showPivotItemAnimation;var o=this._rtl?!t:t,r=this._viewportElement.getBoundingClientRect(),l=e.querySelectorAll(".win-pivot-slide1"),h=e.querySelectorAll(".win-pivot-slide2"),u=e.querySelectorAll(".win-pivot-slide3");return l=Array.prototype.filter.call(l,s),h=Array.prototype.filter.call(h,s),u=Array.prototype.filter.call(u,s),this._showPivotItemAnimation=a.join([w.executeTransition(e,{property:"opacity",delay:0,duration:333,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"0",to:""}),w.executeTransition(e,{property:d._browserStyleEquivalents.transform.cssName,delay:0,duration:767,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"translateX("+(o?"-20px":"20px")+")",to:""}),n[o?"slideRightIn":"slideLeftIn"](null,l,h,u)]),this._showPivotItemAnimation},e.supportedForProcessing=!0,e._ClassNames=I._ClassNames,e._EventNames=E,e}();t.Pivot=B;var L=function(){function e(e){this.pivot=e}return e.prototype.exit=function(){},e.prototype.render=function(){},e.prototype.activateHeader=function(){},e.prototype.handleNavigation=function(){},e.prototype.handleResize=function(){},e.prototype.handleHeaderChanged=function(){},e.prototype.getCumulativeHeaderWidth=function(t){if(0===t)return 0;for(var i=this.pivot._headersContainerElement.children.length,n=0;t>n;n++){var s=this.renderHeader(n,!1);this.pivot._headersContainerElement.appendChild(s)}var o=0,r=this.pivot._rtl?this.pivot._headersContainerElement.lastElementChild:this.pivot._headersContainerElement.children[i],a=this.pivot._rtl?this.pivot._headersContainerElement.children[i]:this.pivot._headersContainerElement.lastElementChild;o=a.offsetLeft+a.offsetWidth-r.offsetLeft,o+=2*e.headerHorizontalMargin;for(var n=0;t>n;n++)this.pivot._headersContainerElement.removeChild(this.pivot._headersContainerElement.lastElementChild);return o},e.prototype.refreshHeadersState=function(e){e&&(this.cachedHeaderWidth=0);var t=this.cachedHeaderWidth||this.getCumulativeHeaderWidth(this.pivot.items.length);this.cachedHeaderWidth=t,t>this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof F)?(this.exit(),this.pivot._headersState=new F(this.pivot)):t<=this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof R)&&(this.exit(),this.pivot._headersState=new R(this.pivot))},e.prototype.renderHeader=function(t,n){function s(){o.pivot._disposed||o.pivot._headersContainerElement.contains(l)&&t!==o.pivot.selectedIndex&&"true"===l.getAttribute("aria-selected")&&(o.pivot.selectedIndex=t)}var o=this,r=_._syncRenderer(x),a=this.pivot.items.getAt(t),l=i.document.createElement("BUTTON");return l.setAttribute("type","button"),l.style.marginLeft=l.style.marginRight=e.headerHorizontalMargin+"px",_.addClass(l,I._ClassNames.pivotHeader),l._item=a,l._pivotItemIndex=t,r(a,l),n&&(l.setAttribute("aria-selected",""+(t===this.pivot.selectedIndex)),l.setAttribute("role","tab"),new _._MutationObserver(s).observe(l,{attributes:!0,attributeFilter:["aria-selected"]})),l},e.prototype.updateHeader=function(e){var t=this.pivot.items.indexOf(e),i=this.pivot._headersContainerElement.children[t];i.innerHTML="";var n=_._syncRenderer(x);n(e,i)},e.prototype.setActiveHeader=function(e){var t=!1,n=this.pivot._headersContainerElement.querySelector("."+I._ClassNames.pivotHeaderSelected);n&&(n.classList.remove(I._ClassNames.pivotHeaderSelected),n.setAttribute("aria-selected","false"),t=this.pivot._headersContainerElement.contains(i.document.activeElement)),e.classList.add(I._ClassNames.pivotHeaderSelected),e.setAttribute("aria-selected","true"),t&&this.pivot._headersContainerElement.focus()},e.headersContainerLeadingMargin=12,e.headerHorizontalMargin=12,e}(),R=function(e){function t(t){if(e.call(this,t),this._firstRender=!0,this._transitionAnimation=a.wrap(),t._headersContainerElement.children.length&&w.isAnimationEnabled()){var i=t._headersContainerElement.querySelector("."+I._ClassNames.pivotHeaderSelected),n=0,s=0;t._rtl?(n=i.offsetLeft+i.offsetWidth+L.headerHorizontalMargin,s=t._getHeaderItemsWidth()-this.getCumulativeHeaderWidth(t.selectedIndex)-L.headersContainerLeadingMargin,s+=parseFloat(t._headersContainerElement.style.marginLeft)):(n=i.offsetLeft,n+=parseFloat(t._headersContainerElement.style.marginLeft),s=this.getCumulativeHeaderWidth(t.selectedIndex)+L.headersContainerLeadingMargin+L.headerHorizontalMargin);var o=n-s;this.render();for(var r=d._browserStyleEquivalents.transform.cssName,l="translateX("+o+"px)",h=0,u=t._headersContainerElement.children.length;u>h;h++)t._headersContainerElement.children[h].style[r]=l;this._transitionAnimation=w.executeTransition(t._headersContainerElement.querySelectorAll("."+I._ClassNames.pivotHeader),{property:r,delay:0,duration:A,timing:"ease-out",to:""})}else this.render()}return s(t,e),t.prototype.exit=function(){this._transitionAnimation.cancel()},t.prototype.render=function(){var e=this.pivot;if(!e._pendingRefresh&&e._items){if(c._disposeElement(e._headersContainerElement),_.empty(e._headersContainerElement),e._rtl?(e._headersContainerElement.style.marginLeft="0px",e._headersContainerElement.style.marginRight=L.headersContainerLeadingMargin+"px"):(e._headersContainerElement.style.marginLeft=L.headersContainerLeadingMargin+"px",e._headersContainerElement.style.marginRight="0px"),e._viewportElement.style.overflow=1===e.items.length?"hidden":"",e.items.length){for(var t=0;t<e.items.length;t++){var i=this.renderHeader(t,!0);e._headersContainerElement.appendChild(i),t===e.selectedIndex&&i.classList.add(I._ClassNames.pivotHeaderSelected)}e._tabContainer.childFocus=e._headersContainerElement.children[e.selectedIndex]}this._firstRender=!1}},t.prototype.activateHeader=function(e){this.setActiveHeader(e),this.pivot._animateToPrevious=e._pivotItemIndex<this.pivot.selectedIndex,this.pivot.selectedIndex=e._pivotItemIndex},t.prototype.handleNavigation=function(e,t){this._firstRender&&this.render(),this.setActiveHeader(this.pivot._headersContainerElement.children[t]),this.pivot._tabContainer.childFocus=this.pivot._headersContainerElement.children[t]},t.prototype.handleResize=function(){this.refreshHeadersState(!1)},t.prototype.handleHeaderChanged=function(e){this.updateHeader(e),this.refreshHeadersState(!0)},t}(L),F=function(e){function t(t){if(e.call(this,t),this._blocked=!1,this._firstRender=!0,this._transitionAnimation=a.wrap(),t._slideHeadersAnimation=a.wrap(),t._headersContainerElement.children.length&&w.isAnimationEnabled()){var i=this,n=function(){i._blocked=!1,i.render()};this._blocked=!0;var s=t._headersContainerElement.querySelector("."+I._ClassNames.pivotHeaderSelected),o=0,r=0;t._rtl?(o=t._getHeaderItemsWidth()-L.headersContainerLeadingMargin,r=s.offsetLeft,r+=L.headerHorizontalMargin,r+=s.offsetWidth,r+=parseFloat(t._headersContainerElement.style.marginLeft)):(o=L.headersContainerLeadingMargin,r=s.offsetLeft,r-=L.headerHorizontalMargin,r+=parseFloat(t._headersContainerElement.style.marginLeft));for(var l=o-r,h=0;h<t.selectedIndex;h++)t._headersContainerElement.appendChild(t._headersContainerElement.children[h].cloneNode(!0));var u=d._browserStyleEquivalents.transform.cssName;this._transitionAnimation=w.executeTransition(t._headersContainerElement.querySelectorAll("."+I._ClassNames.pivotHeader),{property:u,delay:0,duration:A,timing:"ease-out",to:"translateX("+l+"px)"}).then(n,n)}else this.render()}return s(t,e),t.prototype.exit=function(){this._transitionAnimation.cancel(),this.pivot._slideHeadersAnimation.cancel()},t.prototype.render=function(e){var t=this.pivot;if(!this._blocked&&!t._pendingRefresh&&t._items){var n=t._headersContainerElement.contains(i.document.activeElement);if(c._disposeElement(t._headersContainerElement),_.empty(t._headersContainerElement),1===t._items.length){var s=this.renderHeader(0,!0);s.classList.add(I._ClassNames.pivotHeaderSelected),t._headersContainerElement.appendChild(s),t._viewportElement.style.overflow="hidden",t._headersContainerElement.style.marginLeft="0px",t._headersContainerElement.style.marginRight="0px"}else if(t._items.length>1){var o=t._items.length+(e?2:1),r=.8*t._getHeaderItemsWidth(),a=t.selectedIndex-1;t._viewportElement.style.overflow&&(t._viewportElement.style.overflow="");for(var l=0;o>l;l++){-1===a?a=t._items.length-1:a===t._items.length&&(a=0);var s=this.renderHeader(a,!0);t._headersContainerElement.appendChild(s),s.offsetWidth>r&&(s.style.textOverflow="ellipsis",s.style.width=r+"px"),a===t.selectedIndex&&s.classList.add(I._ClassNames.pivotHeaderSelected),a++}if(!t._firstLoad&&!this._firstRender){var h,u;e?(h="",u="0"):(h="0",u="");var m=t._headersContainerElement.children[o-1];m.style.opacity=h;var p=.167;m.style[d._browserStyleEquivalents.transition.scriptName]="opacity "+w._animationTimeAdjustment(p)+"s",i.getComputedStyle(m).opacity,m.style.opacity=u}t._headersContainerElement.children[0].setAttribute("aria-hidden","true"),t._headersContainerElement.style.marginLeft="0px",t._headersContainerElement.style.marginRight="0px";var f=t._rtl?"marginRight":"marginLeft",g=t._headersContainerElement.children[0],v=_.getTotalWidth(g)-L.headersContainerLeadingMargin;if(g!==t._headersContainerElement.children[0])return;t._headersContainerElement.style[f]=-1*v+"px",t._prevButton=i.document.createElement("button"),t._prevButton.setAttribute("type","button"),_.addClass(t._prevButton,I._ClassNames.pivotNavButton),_.addClass(t._prevButton,I._ClassNames.pivotNavButtonPrev),t._prevButton.addEventListener("click",function(){t.locked||(t._rtl?t._goNext():t._goPrevious())}),t._headersContainerElement.appendChild(t._prevButton),t._prevButton.style.left=t._rtl?"0px":v+"px",t._nextButton=i.document.createElement("button"),t._nextButton.setAttribute("type","button"),_.addClass(t._nextButton,I._ClassNames.pivotNavButton),_.addClass(t._nextButton,I._ClassNames.pivotNavButtonNext),t._nextButton.addEventListener("click",function(){t.locked||(t._rtl?t._goPrevious():t._goNext())}),t._headersContainerElement.appendChild(t._nextButton),t._nextButton.style.right=t._rtl?v+"px":"0px"}var y=t._headersContainerElement.children.length>1?1:0;t._tabContainer.childFocus=t._headersContainerElement.children[y],n&&t._headersContainerElement.focus(),this._firstRender=!1}},t.prototype.activateHeader=function(e){e.previousSibling&&(this.pivot.selectedIndex=e._pivotItemIndex)},t.prototype.handleNavigation=function(e,t,i){function n(e){return h?e.offsetParent.offsetWidth-e.offsetLeft-e.offsetWidth:e.offsetLeft}function s(){r._disposed||(o.render(e),r._slideHeadersAnimation=a.wrap())}var o=this,r=this.pivot;if(this._blocked||0>t||r._firstLoad)return void this.render(e);var l;if(e?l=r._headersContainerElement.children[0]:(i>t&&(t+=r._items.length),l=r._headersContainerElement.children[1+t-i]),!l)return void this.render(e);_.removeClass(r._headersContainerElement.children[1],I._ClassNames.pivotHeaderSelected),_.addClass(l,I._ClassNames.pivotHeaderSelected);var h=r._rtl,u=n(r._headersContainerElement.children[1])-n(l);h&&(u*=-1);var c;c=w.isAnimationEnabled()?w.executeTransition(r._headersContainerElement.querySelectorAll("."+I._ClassNames.pivotHeader),{property:d._browserStyleEquivalents.transform.cssName,delay:0,duration:A,timing:"ease-out",to:"translateX("+u+"px)"}):a.wrap(),r._slideHeadersAnimation=c.then(s,s)},t.prototype.handleResize=function(){this.refreshHeadersState(!1)},t.prototype.handleHeaderChanged=function(){this.render(),this.refreshHeadersState(!0)},t}(L);h.Class.mix(B,p.createEventProperties(E.itemAnimationEnd,E.itemAnimationStart,E.selectionChanged)),h.Class.mix(B,u.DOMEventMixin)}),n("WinJS/Controls/Pivot",["require","exports","../Core/_Base"],function(e,t,i){var n=null;i.Namespace.define("WinJS.UI",{Pivot:{get:function(){return n||e(["./Pivot/_Pivot"],function(e){n=e}),n.Pivot}}})}),n("WinJS/Controls/Hub/_Section",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior"],function(e,t,i,n,s,o,r,a,l,h,d,u){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{HubSection:i.Namespace._lazy(function(){var e={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get seeMore(){return o._getWinJSString("ui/seeMore").value}},c=i.Class.define(function(i,n){if(i=i||t.document.createElement("DIV"),n=n||{},i.winControl)throw new s("WinJS.UI.HubSection.DuplicateConstruction",e.duplicateConstruction);i.winControl=this,this._element=i,d.addClass(this.element,c._ClassName.hubSection),d.addClass(this.element,"win-disposable"),this._headerElement=t.document.createElement("DIV"),this._headerElement.className=c._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+c._ClassName.hubSectionInteractive+" "+c._ClassName.hubSectionHeaderTabStop+'"><div class="'+c._ClassName.hubSectionHeaderWrapper+'" tabindex="-1"><h2 class="win-type-subheader '+c._ClassName.hubSectionHeaderContent+'"></h2><span class="'+c._ClassName.hubSectionHeaderChevron+' win-type-body">'+e.seeMore+"</span></div></button>",this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,i.appendChild(this._headerElement),this._winKeyboard=new u._WinKeyboard(this._headerElement),this._contentElement=t.document.createElement("DIV"),this._contentElement.className=c._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",i.appendChild(this._contentElement);for(var o=this.element.firstChild;o!==this._headerElement;){var a=o.nextSibling;this._contentElement.appendChild(o),o=a}this._processors=[r.processAll],l.setOptions(this,n)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(e){this._isHeaderStatic=e,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),d.removeClass(this._headerTabStopElement,c._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),d.addClass(this._headerTabStopElement,c._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(e){this._header=e,this._renderHeader()}},_setHeaderTemplate:function(e){this._template=d._syncRenderer(e),this._renderHeader()},_renderHeader:function(){this._template&&(h._disposeElement(this._headerContentElement),d.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var e=this;return this._processed=(this._processors||[]).reduce(function(t,i){
return t.then(function(){return i(e.contentElement)})},this._processed||a.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,h._disposeElement(this._headerContentElement),h.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){t!==r.processAll&&(e._processors=e._processors||[],e._processors.push(t),e._processed&&e._process())})});return c})})}),n("require-style!less/styles-hub",[],function(){}),n("require-style!less/colors-hub",[],function(){}),n("WinJS/Controls/Hub",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_UI","./Hub/_Section","require-style!less/styles-hub","require-style!less/colors-hub"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C){"use strict";l.createAccentRule(".win-semanticzoom-zoomedoutview .win-hub-section-header-interactive .win-hub-section-header-content,             .win-hub-section-header-interactive .win-hub-section-header-chevron",[{name:"color",value:l.ColorTypes.accent}]),t.Namespace.define("WinJS.UI",{Hub:t.Namespace._lazy(function(){function l(t){var i=e.document.createTextNode("object"==typeof t.header?JSON.stringify(t.header):""+t.header);return i}var v=g.Key,w=s._createEventProperty,b={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},I=500,S={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},x={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},E={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},P=t.Class.define(function(t,i){if(t=t||e.document.createElement("DIV"),i=i||{},t.winControl)throw new n("WinJS.UI.Hub.DuplicateConstruction",T.duplicateConstruction);this._id=t.id||g._uniqueID(t),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),e.addEventListener("keydown",this._windowKeyDownHandlerBound),t.winControl=this,this._element=t,g.addClass(this.element,P._ClassName.hub),g.addClass(this.element,"win-disposable"),this._viewportElement=e.document.createElement("DIV"),this._viewportElement.className=P._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",T.hubViewportAriaLabel),this._surfaceElement=e.document.createElement("DIV"),this._surfaceElement.className=P._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,i.orientation||(this._orientation=y.Orientation.horizontal,g.addClass(this.element,P._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new _.wrap,this._currentIndexForSezo=0,this._parse(),f.setOptions(this,i),g._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this._resizeHandlerBound=this._resizeHandler.bind(this),this.element.addEventListener("mselementresize",this._resizeHandlerBound),g._resizeNotifier.subscribe(this.element,this._resizeHandlerBound),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this)),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(e){if(e!==this._orientation){if(this._measured=!1,this._names){var t={};t[this._names.scrollPos]=0,g.setScrollPosition(this._viewportElement,t)}e===y.Orientation.vertical?(g.removeClass(this.element,P._ClassName.hubHorizontal),g.addClass(this.element,P._ClassName.hubVertical)):(e=y.Orientation.horizontal,g.removeClass(this.element,P._ClassName.hubVertical),g.addClass(this.element,P._ClassName.hubHorizontal)),this._orientation=e,p.schedule(this._updateSnapList.bind(this),p.Priority.idle)}}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(e){var t=!this._pendingSections;this._pendingSections=e,this._refresh(),t&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=l),this._headerTemplate)},set:function(e){this._pendingHeaderTemplate=e||l,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(e){if(e=Math.max(0,e),this._pendingRefresh)this._pendingScrollLocation=e,this._pendingSectionOnScreen=null;else{this._measure();var t=Math.max(0,Math.min(this._scrollLength-this._viewportSize,e));this._scrollPosition=t;var i={};i[this._names.scrollPos]=t,g.setScrollPosition(this._viewportElement,i)}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var e=0;e<this._sectionSizes.length;e++){var t=this._sectionSizes[e];if(t.offset+t.size-t.borderEnd-t.paddingEnd>this._scrollPosition+this._startSpacer+t.borderStart+t.paddingStart)return e}return-1},set:function(e){e=Math.max(0,e),this._pendingRefresh?(this._pendingSectionOnScreen=e,this._pendingScrollLocation=null):(this._measure(),e>=0&&e<this._sectionSizes.length&&this._scrollToSection(e))}},indexOfFirstVisible:{get:function(){this._measure();for(var e=0;e<this._sectionSizes.length;e++){var t=this._sectionSizes[e];if(t.offset+t.size-t.borderEnd-t.paddingEnd>this._scrollPosition)return e}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var e=this._sectionSizes.length-1;e>=0;e--){var t=this._sectionSizes[e];if(t.offset+t.paddingStart+t.borderStart<this._scrollPosition+this._viewportSize)return e}return-1}},onheaderinvoked:w(b.headerInvoked),onloadingstatechanged:w(b.loadingStateChanged),oncontentanimating:w(b.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(P.LoadingState.loading),this._pendingRefresh=!0,p.schedule(this._refreshImpl.bind(this),p.Priority.high))},_refreshImpl:function(){if(!this._disposed){var e=_.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,d.isAnimationEnabled()))){var t=this._fireEvent(P._EventName.contentAnimating,{type:P.AnimationType.contentTransition});t&&(this._viewportElement.style["-ms-overflow-style"]="none",e=h.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=t}e.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var e=!1;if(this._pendingSections){for(e=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;){var t=this.element.firstElementChild;t.parentNode.removeChild(t)}g.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),e&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:this.scrollPosition=+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(P.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(e){if(!this._pendingSections){var t=e.detail.newValue,i=e.detail.oldValue;if(t._setHeaderTemplate(this.headerTemplate),t.element!==i.element){if(t.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);this._surfaceElement.insertBefore(t.element,i.element),this._surfaceElement.removeChild(i.element),this._measured=!1,this._setState(P.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(e){if(!this._pendingSections){var t=e.detail.index,i=e.detail.value;i._animation&&i._animation.cancel();var s,o=this._fireEvent(P._EventName.contentAnimating,{type:P.AnimationType.insert,index:t,section:i});if(o){for(var r=[],a=t+1;a<this.sections.length;a++)r.push(this.sections.getAt(a).element);s=new h._createUpdateListAnimation([i.element],[],r)}if(i.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);if(i._setHeaderTemplate(this.headerTemplate),t<this.sections.length-1?this._surfaceElement.insertBefore(i.element,this.sections.getAt(t+1).element):this._surfaceElement.appendChild(i.element),this._measured=!1,s){var l=s.execute();this.runningAnimations=_.join([this.runningAnimations,l])}this._setState(P.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(e){if(!this._pendingSections){var t=e.detail.newIndex,i=e.detail.value;t<this.sections.length-1?this._surfaceElement.insertBefore(i.element,this.sections.getAt(t+1).element):this._surfaceElement.appendChild(i.element),this._measured=!1,this._setState(P.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(e){if(!this._pendingSections){var t=e.detail.value,i=e.detail.index,n=_.wrap(),s=this._fireEvent(P._EventName.contentAnimating,{type:P.AnimationType.remove,index:i,section:t});if(s){for(var o=[],r=i;r<this.sections.length;r++)o.push(this.sections.getAt(r).element);var a=new h._createUpdateListAnimation([],[t.element],o);this._measure();var l=t.element.offsetTop,d=t.element.offsetLeft;t.element.style.position="absolute",t.element.style.top=l,t.element.style.left=d,t.element.style.opacity=0,this._measured=!1,n=a.execute().then(function(){t.element.style.position="",t.element.style.top="",t.element.style.left="",t.element.style.opacity=1}.bind(this))}n.done(function(){this._disposed||(this._surfaceElement.removeChild(t.element),this._measured=!1)}.bind(this)),t._animation=n,this.runningAnimations=_.join([this.runningAnimations,n]),this._setState(P.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(e,t){e&&(e.removeEventListener("itemchanged",this._handleSectionChangedBind),e.removeEventListener("iteminserted",this._handleSectionInsertedBind),e.removeEventListener("itemmoved",this._handleSectionMovedBind),e.removeEventListener("itemremoved",this._handleSectionRemovedBind),e.removeEventListener("reload",this._handleSectionReloadBind)),t&&(t.addEventListener("itemchanged",this._handleSectionChangedBind),t.addEventListener("iteminserted",this._handleSectionInsertedBind),t.addEventListener("itemmoved",this._handleSectionMovedBind),t.addEventListener("itemremoved",this._handleSectionRemovedBind),t.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var e=0;e<this.sections.length;e++){var t=this._sections.getAt(e);if(t._animation&&t._animation.cancel(),t.element.parentNode===this._surfaceElement)throw new n("WinJS.UI.Hub.DuplicateSection",T.duplicateSection);this._surfaceElement.appendChild(t.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var e=0;e<this.sections.length;e++){var t=this._sections.getAt(e);t._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(e){var t=this._sections.getAt(e);return t._process().then(function(){var e=t.contentElement.style;""!==e.visibility&&(e.visibility="")})},_loadSections:function(){function t(e){e.then(function(){p.schedule(i,p.Priority.idle)})}function i(){if(n===s._loadId&&!s._disposed)if(r.length){var e=r.shift(),i=s._loadSection(e);t(i)}else l.complete()}this._loadId++;var n=this._loadId,s=this,o=_.wrap(),r=[],a=_.wrap();if(this._showProgressPromise||(this._showProgressPromise=_.timeout(I).then(function(){this._disposed||(this._progressBar||(this._progressBar=e.document.createElement("progress"),g.addClass(this._progressBar,P._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var l=new m;a=l.promise;for(var u=[],c=Math.max(0,this.indexOfFirstVisible),f=Math.max(0,this.indexOfLastVisible),v=c;f>=v;v++)u.push(this._loadSection(v));for(c--,f++;c>=0||f<this.sections.length;)f<this.sections.length&&(r.push(f),f++),c>=0&&(r.push(c),c--);var y=_.join(u);y.done(function(){n!==this._loadId||s._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),p.schedule(function(){if(n===this._loadId&&!s._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&d.isAnimationEnabled()){var t={type:P.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(P._EventName.contentAnimating,t))&&(this._viewportElement.style["-ms-overflow-style"]="none",o=h.enterContent(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this)))}this._element===e.document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},p.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),t(y)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);_.join([this.runningAnimations,o,a]).done(function(){n!==this._loadId||s._disposed||(this.runningAnimations=_.wrap(),this._measured&&this._scrollLength!==this._viewportElement[this._names.scrollSize]&&(this._measured=!1),this._setState(P.LoadingState.complete),p.schedule(this._updateSnapList.bind(this),p.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(t){if(t!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+t+",info"),this._loadingState=t;var i=e.document.createEvent("CustomEvent");i.initCustomEvent(P._EventName.loadingStateChanged,!0,!1,{loadingState:t}),this._element.dispatchEvent(i)}},_parse:function(){for(var e=[],t=this.element.firstElementChild;t!==this._viewportElement;){c.processAll(t);var i=t.winControl;if(!i)throw new n("WinJS.UI.Hub.InvalidContent",T.invalidContent);e.push(i);var s=t.nextElementSibling;t=s}this.sections=new u.List(e)},_fireEvent:function(t,i){var n=e.document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!0,i),this.element.dispatchEvent(n)},_findHeaderTabStop:function(e){if(e.parentNode&&g._matchesSelector(e,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!g.hasClass(e,"win-hub-section-header-tabstop");)e=e.parentElement;return e}return null},_isInteractive:function(t){for(;t&&t!==e.document.body;){if(g.hasClass(t,"win-interactive"))return!0;t=t.parentElement}return!1},_clickHandler:function(e){var t=this._findHeaderTabStop(e.target);if(t&&!this._isInteractive(e.target)){var i=t.parentElement.parentElement.winControl;if(!i.isHeaderStatic){var n=this.sections.indexOf(i);this._fireEvent(P._EventName.headerInvoked,{index:n,section:i})}}},_resizeHandler:function(){this._measured=!1,p.schedule(this._updateSnapList.bind(this),p.Priority.idle)},_contentResizeHandler:function(){this._measured=!1,p.schedule(this._updateSnapList.bind(this),p.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=i._requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==P.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===e.getComputedStyle(this._element,null).direction,this._names=this.orientation===y.Orientation.vertical?S:this._rtl?x:E,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=g.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var t=e.getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(t[this._names.marginStart])+parseFloat(t[this._names.borderStart])+parseFloat(t[this._names.paddingStart]),this._endSpacer=parseFloat(t[this._names.marginEnd])+parseFloat(t[this._names.borderEnd])+parseFloat(t[this._names.paddingEnd]),this._sectionSizes=[];for(var i=0;i<this.sections.length;i++){var n=this.sections.getAt(i),s=e.getComputedStyle(n.element);this._sectionSizes[i]={offset:n.element[this._names.offsetPos],size:n.element[this._names.offsetSize],marginStart:parseFloat(s[this._names.marginStart]),marginEnd:parseFloat(s[this._names.marginEnd]),borderStart:parseFloat(s[this._names.borderStart]),borderEnd:parseFloat(s[this._names.borderEnd]),paddingStart:parseFloat(s[this._names.paddingStart]),paddingEnd:parseFloat(s[this._names.paddingEnd])},this._rtl&&this.orientation===y.Orientation.horizontal&&(this._sectionSizes[i].offset=this._viewportSize-(this._sectionSizes[i].offset+this._sectionSizes[i].size))}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var e="snapList(",t=0;t<this._sectionSizes.length;t++){t>0&&(e+=",");var i=this._sectionSizes[t];e+=i.offset-i.marginStart-this._startSpacer+"px"}e+=")";var n="",s="";this.orientation===y.Orientation.vertical?n=e:s=e,this._lastSnapPointY!==n&&(this._lastSnapPointY=n,this._viewportElement.style["-ms-scroll-snap-points-y"]=n),this._lastSnapPointX!==s&&(this._lastSnapPointX=s,this._viewportElement.style["-ms-scroll-snap-points-x"]=s),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(e,t){this._measure();var i=this._sectionSizes[e],n=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer);this._scrollTo(n,t)},_ensureVisible:function(e,t){this._measure();var i=this._ensureVisibleMath(e,this._scrollPosition);this._scrollTo(i,t)},_ensureVisibleMath:function(e,t){this._measure();var i=this._sectionSizes[e],n=Math.min(this._scrollLength-this._viewportSize,i.offset-i.marginStart-this._startSpacer),s=Math.max(0,i.offset+i.size+i.marginEnd+this._endSpacer-this._viewportSize+1);return t>n?t=n:s>t&&(t=Math.min(n,s)),t},_scrollTo:function(e,t){if(this._scrollPosition=e,t)this.orientation===y.Orientation.vertical?g._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):g._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var i={};i[this._names.scrollPos]=this._scrollPosition,g.setScrollPosition(this._viewportElement,i)}},_windowKeyDownHandler:function(e){if(e.keyCode===v.tab){this._tabSeenLast=!0;var t=this;i._yieldForEvents(function(){t._tabSeenLast=!1})}},_focusin:function(e){if(this._tabSeenLast){var t=this._findHeaderTabStop(e.target);if(t&&!this._isInteractive(e.target)){var i=this.sections.indexOf(t.parentElement.parentElement.winControl);i>-1&&this._ensureVisible(i,!0)}}for(var n=e.target;n&&!g.hasClass(n,C.HubSection._ClassName.hubSection);)n=n.parentElement;if(n){var i=this.sections.indexOf(n.winControl);i>-1&&(this._currentIndexForSezo=i)}if(e.target===this.element){var s;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(s=this._sectionToFocus,this._sectionToFocus=null):s=this.sectionOnScreen,this._moveFocusIn(s)}},_moveFocusIn:function(e){if(e>=0){for(var t=e;t<this.sections.length;t++){var i=this.sections.getAt(t),n=g._trySetActive(i._headerTabStopElement,this._viewportElement);if(n)return;if(g._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return}for(var t=e-1;t>=0;t--){var i=this.sections.getAt(t);if(g._setActiveFirstFocusableElement(i.contentElement,this._viewportElement))return;var n=g._trySetActive(i._headerTabStopElement,this._viewportElement);if(n)return}}},_keyDownHandler:function(e){if(!this._isInteractive(e.target)&&!g._hasCursorKeysBehaviors(e.target)){var t=this._rtl?v.rightArrow:v.leftArrow,i=this._rtl?v.leftArrow:v.rightArrow;if(e.keyCode===v.upArrow||e.keyCode===v.downArrow||e.keyCode===v.leftArrow||e.keyCode===v.rightArrow||e.keyCode===v.pageUp||e.keyCode===v.pageDown){var n=this._findHeaderTabStop(e.target);if(n){var s,o=this.sections.indexOf(n.parentElement.parentElement.winControl),r=!1;if(e.keyCode===v.pageDown||this.orientation===y.Orientation.horizontal&&e.keyCode===i||this.orientation===y.Orientation.vertical&&e.keyCode===v.downArrow){for(var a=o+1;a<this.sections.length;a++)if(this._tryFocus(a)){s=a;break}}else if(e.keyCode===v.pageUp||this.orientation===y.Orientation.horizontal&&e.keyCode===t||this.orientation===y.Orientation.vertical&&e.keyCode===v.upArrow)for(var a=o-1;a>=0;a--)if(this._tryFocus(a)){s=a;break}(e.keyCode===v.upArrow||e.keyCode===v.downArrow||e.keyCode===v.leftArrow||e.keyCode===v.rightArrow)&&(r=!0),+s===s&&(r?this._ensureVisible(s,!0):this._scrollToSection(s,!0),e.preventDefault())}}else if(e.keyCode===v.home||e.keyCode===v.end){this._measure();var l=Math.max(0,this._scrollLength-this._viewportSize);this._scrollTo(e.keyCode===v.home?0:l,!0),e.preventDefault()}}},_tryFocus:function(t){var i=this.sections.getAt(t);return g._setActive(i._headerTabStopElement,this._viewportElement),e.document.activeElement===i._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new M(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===y.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(e,t){var i;i=this.orientation===y.Orientation.horizontal?e:t,this._measure(),i+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var n=1;n<this._sectionSizes.length;n++){var s=this._sectionSizes[n];if(s.offset-s.marginStart>i){this._currentIndexForSezo=n-1;break}}},_getCurrentItem:function(){var e;if(this._sectionSizes.length>0){this._measure();var t=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),i=this._sectionSizes[t];e=this.orientation===y.Orientation.horizontal?{left:Math.max(0,i.offset-i.marginStart-this._scrollPosition),top:0,width:i.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,i.offset-i.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:i.size};var n=this.sections.getAt(t);return _.wrap({item:{data:n,index:t,groupIndexHint:t},position:e})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(e,t){if(e.index>=0&&e.index<this._sectionSizes.length){this._measure();var i,n=this._sectionSizes[e.index];i=this.orientation===y.Orientation.horizontal?t.left:t.top,this._sectionToFocus=e.index;var s=n.offset-i,s=this._ensureVisibleMath(e.index,s);this._scrollPosition=s;var o={};o[this._names.scrollPos]=this._scrollPosition,g.setScrollPosition(this._viewportElement,o)}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(e){var t="WinJS.UI.Hub:"+this._id+":"+e;a(t),o.log&&o.log(t,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,e.removeEventListener("keydown",this._windowKeyDownHandlerBound),g._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound),this._updateEvents(this._sections);for(var t=0;t<this.sections.length;t++)this.sections.getAt(t).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:b.contentAnimating,headerInvoked:b.headerInvoked,loadingStateChanged:b.loadingStateChanged}});t.Class.mix(P,f.DOMEventMixin);var M=t.Class.define(function(e){this._hub=e},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(e,t,i,n){this._hub._configureForZoom(e,t,i,n)},setCurrentItem:function(e,t){this._hub._setCurrentItem(e,t)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(e,t){return this._hub._positionItem(e,t)},endZoom:function(e){this._hub._endZoom(e)}}),T={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateSection(){return"Hub duplicate sections: Each HubSection must be unique"},get invalidContent(){return"Invalid content: Hub content must be made up of HubSections."},get hubViewportAriaLabel(){return r._getWinJSString("ui/hubViewportAriaLabel").value}};return P})})}),n("require-style!less/styles-lightdismissservice",[],function(){});var s=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};n("WinJS/_LightDismissService",["require","exports","./Application","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities","./Core/_Global","./Utilities/_KeyboardBehavior","./Core/_Log","./Core/_Resources"],function(e,t,i,n,o,r,a,l,h,d){e(["require-style!less/styles-lightdismissservice"]);var u=1e3,c={get closeOverlay(){return d._getWinJSString("ui/closeOverlay").value}};t._ClassNames={_clickEater:"win-clickeater"},t.LightDismissalReasons={tap:"tap",lostFocus:"lostFocus",escape:"escape",hardwareBackButton:"hardwareBackButton",windowResize:"windowResize",windowBlur:"windowBlur"},t.DismissalPolicies={light:function(e){switch(e.reason){case t.LightDismissalReasons.tap:case t.LightDismissalReasons.escape:return e.active?!0:(e.stopPropagation(),!1);case t.LightDismissalReasons.hardwareBackButton:return e.active?(e.preventDefault(),!0):(e.stopPropagation(),!1);case t.LightDismissalReasons.lostFocus:case t.LightDismissalReasons.windowResize:case t.LightDismissalReasons.windowBlur:return!0}},modal:function(e){switch(e.stopPropagation(),e.reason){case t.LightDismissalReasons.tap:case t.LightDismissalReasons.lostFocus:case t.LightDismissalReasons.windowResize:case t.LightDismissalReasons.windowBlur:return!1;case t.LightDismissalReasons.escape:return e.active;case t.LightDismissalReasons.hardwareBackButton:return e.preventDefault(),e.active}},sticky:function(e){return e.stopPropagation(),!1}};var _={keyDown:"keyDown",keyUp:"keyUp",keyPress:"keyPress"},m=function(){function e(e){this.element=e.element,this.element.tabIndex=e.tabIndex,this.onLightDismiss=e.onLightDismiss,e.onTakeFocus&&(this.onTakeFocus=e.onTakeFocus),e.onShouldLightDismiss&&(this.onShouldLightDismiss=e.onShouldLightDismiss),this._ldeOnKeyDownBound=this._ldeOnKeyDown.bind(this),this._ldeOnKeyUpBound=this._ldeOnKeyUp.bind(this),this._ldeOnKeyPressBound=this._ldeOnKeyPress.bind(this)}return e.prototype.restoreFocus=function(){var e=a.document.activeElement;if(e&&this.containsElement(e))return this._ldeCurrentFocus=e,!0;var t=!l._keyboardSeenLast;return this._ldeCurrentFocus&&this.containsElement(this._ldeCurrentFocus)&&r._tryFocusOnAnyElement(this._ldeCurrentFocus,t)},e.prototype._ldeOnKeyDown=function(e){this._ldeService.keyDown(this,e)},e.prototype._ldeOnKeyUp=function(e){this._ldeService.keyUp(this,e)},e.prototype._ldeOnKeyPress=function(e){this._ldeService.keyPress(this,e)},e.prototype.setZIndex=function(e){this.element.style.zIndex=e},e.prototype.getZIndexCount=function(){return 1},e.prototype.containsElement=function(e){return this.element.contains(e)},e.prototype.onTakeFocus=function(e){this.restoreFocus()||r._focusFirstFocusableElement(this.element,e)||r._tryFocusOnAnyElement(this.element,e)},e.prototype.onFocus=function(e){this._ldeCurrentFocus=e},e.prototype.onShow=function(e){this._ldeService=e,this.element.addEventListener("keydown",this._ldeOnKeyDownBound),this.element.addEventListener("keyup",this._ldeOnKeyUpBound),this.element.addEventListener("keypress",this._ldeOnKeyPressBound)},e.prototype.onHide=function(){this._ldeCurrentFocus=null,this._ldeService=null,this.element.removeEventListener("keydown",this._ldeOnKeyDownBound),this.element.removeEventListener("keyup",this._ldeOnKeyUpBound),this.element.removeEventListener("keypress",this._ldeOnKeyPressBound)},e.prototype.onKeyInStack=function(){},e.prototype.onShouldLightDismiss=function(){return!1},e.prototype.onLightDismiss=function(){},e}(),p=function(e){function i(){e.apply(this,arguments)}return s(i,e),i.prototype.onKeyInStack=function(){},i.prototype.onShouldLightDismiss=function(e){return t.DismissalPolicies.light(e)},i}(m);t.LightDismissableElement=p;var f=function(e){function i(){e.apply(this,arguments)}return s(i,e),i.prototype.onKeyInStack=function(e){e.stopPropagation()},i.prototype.onShouldLightDismiss=function(e){return t.DismissalPolicies.modal(e)},i}(m);t.ModalElement=f;var g=function(){function e(){}return e.prototype.setZIndex=function(){},e.prototype.getZIndexCount=function(){return 1},e.prototype.containsElement=function(e){return a.document.body.contains(e)},e.prototype.onTakeFocus=function(e){this.currentFocus&&this.containsElement(this.currentFocus)&&r._tryFocusOnAnyElement(this.currentFocus,e)},e.prototype.onFocus=function(e){this.currentFocus=e},e.prototype.onShow=function(){},e.prototype.onHide=function(){this.currentFocus=null},e.prototype.onKeyInStack=function(){},e.prototype.onShouldLightDismiss=function(){return!1},e.prototype.onLightDismiss=function(){},e}(),v=function(){function e(){this._debug=!1,this._clients=[],
this._notifying=!1,this._bodyClient=new g,this._updateDom_rendered={serviceActive:!1},this._clickEaterEl=this._createClickEater(),this._onBeforeRequestingFocusOnKeyboardInputBound=this._onBeforeRequestingFocusOnKeyboardInput.bind(this),this._onFocusInBound=this._onFocusIn.bind(this),this._onKeyDownBound=this._onKeyDown.bind(this),this._onWindowResizeBound=this._onWindowResize.bind(this),this._onClickEaterPointerUpBound=this._onClickEaterPointerUp.bind(this),this._onClickEaterPointerCancelBound=this._onClickEaterPointerCancel.bind(this),i.addEventListener("backclick",this._onBackClick.bind(this)),a.window.addEventListener("blur",this._onWindowBlur.bind(this)),this.shown(this._bodyClient)}return e.prototype.shown=function(e){var t=this._clients.indexOf(e);-1===t&&(this._clients.push(e),e.onShow(this),this._updateDom())},e.prototype.hidden=function(e){var t=this._clients.indexOf(e);-1!==t&&(this._clients.splice(t,1),e.setZIndex(""),e.onHide(),this._updateDom())},e.prototype.updated=function(){this._updateDom()},e.prototype.keyDown=function(e,t){t.keyCode===r.Key.escape?this._escapePressed(t):this._dispatchKeyboardEvent(e,_.keyDown,t)},e.prototype.keyUp=function(e,t){this._dispatchKeyboardEvent(e,_.keyUp,t)},e.prototype.keyPress=function(e,t){this._dispatchKeyboardEvent(e,_.keyPress,t)},e.prototype.isShown=function(e){return-1!==this._clients.indexOf(e)},e.prototype.isTopmost=function(e){return e===this._clients[this._clients.length-1]},e.prototype._setDebug=function(e){this._debug=e},e.prototype._updateDom=function(e){e=e||{};var t=!!e.activeDismissableNeedsFocus,n=this._updateDom_rendered;if(!this._notifying){var s=this._clients.length>1;if(s!==n.serviceActive){if(s)i.addEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),r._addEventListener(a.document.documentElement,"focusin",this._onFocusInBound),a.document.documentElement.addEventListener("keydown",this._onKeyDownBound),a.window.addEventListener("resize",this._onWindowResizeBound),this._bodyClient.currentFocus=a.document.activeElement,a.document.body.appendChild(this._clickEaterEl);else{i.removeEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),r._removeEventListener(a.document.documentElement,"focusin",this._onFocusInBound),a.document.documentElement.removeEventListener("keydown",this._onKeyDownBound),a.window.removeEventListener("resize",this._onWindowResizeBound);var o=this._clickEaterEl.parentNode;o&&o.removeChild(this._clickEaterEl)}n.serviceActive=s}var h=0,d=u+1;this._clients.forEach(function(e){var t=d+h;e.setZIndex(""+t),d=t,h=e.getZIndexCount()+1}),s&&(this._clickEaterEl.style.zIndex=""+(d-1));var c=this._clients.length>0?this._clients[this._clients.length-1]:null;if(this._activeDismissable!==c&&(this._activeDismissable=c,t=!0),t){var _=!l._keyboardSeenLast;this._activeDismissable&&this._activeDismissable.onTakeFocus(_)}}},e.prototype._dispatchKeyboardEvent=function(e,t,i){var n=this._clients.indexOf(e);if(-1!==n)for(var s={type:t,keyCode:i.keyCode,propagationStopped:!1,stopPropagation:function(){this.propagationStopped=!0,i.stopPropagation()}},o=this._clients.slice(0,n+1),r=o.length-1;r>=0&&!s.propagationStopped;r--)o[r].onKeyInStack(s)},e.prototype._dispatchLightDismiss=function(e,t,i){if(this._notifying)return void(h.log&&h.log('_LightDismissService ignored dismiss trigger to avoid re-entrancy: "'+e+'"',"winjs _LightDismissService","warning"));if(t=t||this._clients.slice(0),0!==t.length){this._notifying=!0;for(var n={reason:e,active:!1,_stop:!1,stopPropagation:function(){this._stop=!0},_doDefault:!0,preventDefault:function(){this._doDefault=!1}},s=t.length-1;s>=0&&!n._stop;s--)n.active=this._activeDismissable===t[s],t[s].onShouldLightDismiss(n)&&t[s].onLightDismiss(n);return this._notifying=!1,this._updateDom(i),n._doDefault}},e.prototype._onBeforeRequestingFocusOnKeyboardInput=function(){return!0},e.prototype._clickEaterTapped=function(){this._dispatchLightDismiss(t.LightDismissalReasons.tap)},e.prototype._onFocusIn=function(e){for(var i=e.target,n=this._clients.length-1;n>=0&&!this._clients[n].containsElement(i);n--);-1!==n&&this._clients[n].onFocus(i),n+1<this._clients.length&&this._dispatchLightDismiss(t.LightDismissalReasons.lostFocus,this._clients.slice(n+1),{activeDismissableNeedsFocus:!0})},e.prototype._onKeyDown=function(e){e.keyCode===r.Key.escape&&this._escapePressed(e)},e.prototype._escapePressed=function(e){e.preventDefault(),e.stopPropagation(),this._dispatchLightDismiss(t.LightDismissalReasons.escape)},e.prototype._onBackClick=function(){var e=this._dispatchLightDismiss(t.LightDismissalReasons.hardwareBackButton);return!e},e.prototype._onWindowResize=function(){this._dispatchLightDismiss(t.LightDismissalReasons.windowResize)},e.prototype._onWindowBlur=function(){if(!this._debug)if(a.document.hasFocus()){var e=a.document.activeElement;e&&"IFRAME"===e.tagName&&!e.msLightDismissBlur&&(e.addEventListener("blur",this._onWindowBlur.bind(this),!1),e.msLightDismissBlur=!0)}else this._dispatchLightDismiss(t.LightDismissalReasons.windowBlur)},e.prototype._createClickEater=function(){var e=a.document.createElement("section");return e.className=t._ClassNames._clickEater,r._addEventListener(e,"pointerdown",this._onClickEaterPointerDown.bind(this),!0),e.addEventListener("click",this._onClickEaterClick.bind(this),!0),e.setAttribute("role","menuitem"),e.setAttribute("aria-label",c.closeOverlay),e.setAttribute("unselectable","on"),e},e.prototype._onClickEaterPointerDown=function(e){e.stopPropagation(),e.preventDefault(),this._clickEaterPointerId=e.pointerId,this._registeredClickEaterCleanUp||(r._addEventListener(a.window,"pointerup",this._onClickEaterPointerUpBound),r._addEventListener(a.window,"pointercancel",this._onClickEaterPointerCancelBound),this._registeredClickEaterCleanUp=!0)},e.prototype._onClickEaterPointerUp=function(e){var t=this;if(e.stopPropagation(),e.preventDefault(),e.pointerId===this._clickEaterPointerId){this._resetClickEaterPointerState();var i=a.document.elementFromPoint(e.clientX,e.clientY);i===this._clickEaterEl&&(this._skipClickEaterClick=!0,o._yieldForEvents(function(){t._skipClickEaterClick=!1}),this._clickEaterTapped())}},e.prototype._onClickEaterClick=function(e){e.stopPropagation(),e.preventDefault(),this._skipClickEaterClick||this._clickEaterTapped()},e.prototype._onClickEaterPointerCancel=function(e){e.pointerId===this._clickEaterPointerId&&this._resetClickEaterPointerState()},e.prototype._resetClickEaterPointerState=function(){this._registeredClickEaterCleanUp&&(r._removeEventListener(a.window,"pointerup",this._onClickEaterPointerUpBound),r._removeEventListener(a.window,"pointercancel",this._onClickEaterPointerCancelBound)),this._clickEaterPointerId=null,this._registeredClickEaterCleanUp=!1},e}(),y=new v;t.shown=y.shown.bind(y),t.hidden=y.hidden.bind(y),t.updated=y.updated.bind(y),t.isShown=y.isShown.bind(y),t.isTopmost=y.isTopmost.bind(y),t.keyDown=y.keyDown.bind(y),t.keyUp=y.keyUp.bind(y),t.keyPress=y.keyPress.bind(y),t._clickEaterTapped=y._clickEaterTapped.bind(y),t._onBackClick=y._onBackClick.bind(y),t._setDebug=y._setDebug.bind(y),n.Namespace.define("WinJS.UI._LightDismissService",{shown:t.shown,hidden:t.hidden,updated:t.updated,isShown:t.isShown,isTopmost:t.isTopmost,keyDown:t.keyDown,keyUp:t.keyUp,keyPress:t.keyPress,_clickEaterTapped:t._clickEaterTapped,_onBackClick:t._onBackClick,_setDebug:t._setDebug,LightDismissableElement:p,DismissalPolicies:t.DismissalPolicies,LightDismissalReasons:t.LightDismissalReasons,_ClassNames:t._ClassNames,_service:y})}),n("WinJS/Controls/_LegacyAppBar/_Constants",["exports","../../Core/_Base"],function(e,t){"use strict";t.Namespace._moduleDefine(e,null,{appBarClass:"win-navbar",firstDivClass:"win-firstdiv",finalDivClass:"win-finaldiv",invokeButtonClass:"win-navbar-invokebutton",ellipsisClass:"win-navbar-ellipsis",primaryCommandsClass:"win-primarygroup",secondaryCommandsClass:"win-secondarygroup",commandLayoutClass:"win-commandlayout",menuLayoutClass:"win-menulayout",topClass:"win-top",bottomClass:"win-bottom",showingClass:"win-navbar-opening",shownClass:"win-navbar-opened",hidingClass:"win-navbar-closing",hiddenClass:"win-navbar-closed",compactClass:"win-navbar-compact",minimalClass:"win-navbar-minimal",menuContainerClass:"win-navbar-menu",appBarPlacementTop:"top",appBarPlacementBottom:"bottom",appBarLayoutCustom:"custom",appBarLayoutCommands:"commands",appBarLayoutMenu:"menu",appBarInvokeButtonWidth:32,typeSeparator:"separator",typeContent:"content",typeButton:"button",typeToggle:"toggle",typeFlyout:"flyout",appBarCommandClass:"win-command",appBarCommandGlobalClass:"win-global",appBarCommandSelectionClass:"win-selection",sectionSelection:"selection",sectionGlobal:"global",sectionPrimary:"primary",sectionSecondary:"secondary",menuCommandClass:"win-command",menuCommandButtonClass:"win-command-button",menuCommandToggleClass:"win-command-toggle",menuCommandFlyoutClass:"win-command-flyout",menuCommandFlyoutActivatedClass:"win-command-flyout-activated",menuCommandSeparatorClass:"win-command-separator",_menuCommandInvokedEvent:"_invoked",menuClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",menuContainsFlyoutCommandClass:"win-menu-containsflyoutcommand",menuMouseSpacingClass:"win-menu-mousespacing",menuTouchSpacingClass:"win-menu-touchspacing",menuCommandHoverDelay:400,overlayClass:"win-overlay",flyoutClass:"win-flyout",flyoutLightClass:"win-ui-light",settingsFlyoutClass:"win-settingsflyout",scrollsClass:"win-scrolls",pinToRightEdge:-1,pinToBottomEdge:-1,separatorWidth:34,buttonWidth:68,narrowClass:"win-narrow",wideClass:"win-wide",_visualViewportClass:"win-visualviewport-space",commandPropertyMutated:"_commandpropertymutated",commandVisibilityChanged:"commandvisibilitychanged"})}),n("WinJS/Utilities/_KeyboardInfo",["require","exports","../Core/_BaseCoreUtils","../Core/_Global","../Core/_WinRT"],function(e,t,i,n,s){"use strict";var o={visualViewportClass:"win-visualviewport-space",scrollTimeout:150};t._KeyboardInfo,t._KeyboardInfo={get _visible(){try{return s.Windows.UI.ViewManagement.InputPane&&s.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(e){return!1}},get _extraOccluded(){var e=0;return!t._KeyboardInfo._isResized&&s.Windows.UI.ViewManagement.InputPane&&(e=s.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height),e},get _isResized(){var e=n.document.documentElement.clientHeight/n.innerHeight,t=n.document.documentElement.clientWidth/n.innerWidth;return.99>t/e},get _visibleDocBottom(){return t._KeyboardInfo._visibleDocTop+t._KeyboardInfo._visibleDocHeight},get _visibleDocHeight(){return t._KeyboardInfo._visualViewportHeight-t._KeyboardInfo._extraOccluded},get _visibleDocTop(){return 0},get _visibleDocBottomOffset(){return t._KeyboardInfo._extraOccluded},get _visualViewportHeight(){var e=t._KeyboardInfo._visualViewportSpace;return e.height},get _visualViewportWidth(){var e=t._KeyboardInfo._visualViewportSpace;return e.width},get _visualViewportSpace(){var e=n.document.body.querySelector("."+o.visualViewportClass);return e||(e=n.document.createElement("DIV"),e.className=o.visualViewportClass,n.document.body.appendChild(e)),e.getBoundingClientRect()},get _animationShowLength(){if(i.hasWinRT){if(s.Windows.UI.Core.AnimationMetrics){for(var e=s.Windows.UI.Core.AnimationMetrics,t=new e.AnimationDescription(e.AnimationEffect.showPanel,e.AnimationEffectTarget.primary),n=t.animations,o=0,r=0;r<n.size;r++){var a=n[r];o=Math.max(o,a.delay+a.duration)}return o}var l=300,h=50;return h+l}return 0},get _scrollTimeout(){return o.scrollTimeout},get _layoutViewportCoords(){var e=n.window.pageYOffset-n.document.documentElement.scrollTop,t=n.document.documentElement.clientHeight-(e+this._visibleDocHeight);return{visibleDocTop:e,visibleDocBottom:t}}}}),n("require-style!less/styles-overlay",[],function(){}),n("require-style!less/colors-overlay",[],function(){}),n("WinJS/Controls/Flyout/_Overlay",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../_Accents","../../Animations","../../Application","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardInfo","../_LegacyAppBar/_Constants","require-style!less/styles-overlay","require-style!less/colors-overlay"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v){"use strict";h.createAccentRule("button[aria-checked=true].win-command:before,         .win-menu-containsflyoutcommand button.win-command-flyout-activated:before",[{name:"background-color",value:h.ColorTypes.accent},{name:"border-color",value:h.ColorTypes.accent}]),h.createAccentRule(".win-flyout, .win-settingsflyout",[{name:"border-color",value:h.ColorTypes.accent}]),n.Namespace._moduleDefine(e,"WinJS.UI",{_Overlay:n.Namespace._lazy(function(){function e(e,i,n){var s=t.document.querySelectorAll("."+v.overlayClass);if(s)for(var o=s.length,r=0;o>r;r++){var a=s[r],l=a.winControl;if(!l._disposed&&l){var h=l[i](e);if(n&&h)return h}}}function s(e){if(!e)return[];"string"!=typeof e&&e&&e.length||(e=[e]);var i,n=[];for(i=0;i<e.length;i++)if(e[i])if("string"==typeof e[i]){var s=t.document.getElementById(e[i]);s&&n.push(s)}else n.push(e[i].element?e[i].element:e[i]);return n}var r=n.Class.define(function(){this._currentState=r.states.off,this._inputPaneShowing=this._inputPaneShowing.bind(this),this._inputPaneHiding=this._inputPaneHiding.bind(this),this._documentScroll=this._documentScroll.bind(this),this._windowResized=this._windowResized.bind(this)},{initialize:function(){this._toggleListeners(r.states.on)},reset:function(){this._toggleListeners(r.states.off),this._toggleListeners(r.states.on)},_inputPaneShowing:function(t){l(r.profilerString+"_showingKeyboard,StartTM"),e(t,"_showingKeyboard"),l(r.profilerString+"_showingKeyboard,StopTM")},_inputPaneHiding:function(t){l(r.profilerString+"_hidingKeyboard,StartTM"),e(t,"_hidingKeyboard"),l(r.profilerString+"_hidingKeyboard,StopTM")},_documentScroll:function(t){l(r.profilerString+"_checkScrollPosition,StartTM"),e(t,"_checkScrollPosition"),l(r.profilerString+"_checkScrollPosition,StopTM")},_windowResized:function(t){l(r.profilerString+"_baseResize,StartTM"),e(t,"_baseResize"),l(r.profilerString+"_baseResize,StopTM")},_toggleListeners:function(e){var n;if(this._currentState!==e){if(e===r.states.on?n="addEventListener":e===r.states.off&&(n="removeEventListener"),i.Windows.UI.ViewManagement.InputPane){var s=i.Windows.UI.ViewManagement.InputPane.getForCurrentView();s[n]("showing",this._inputPaneShowing,!1),s[n]("hiding",this._inputPaneHiding,!1),t.document[n]("scroll",this._documentScroll,!1)}t.addEventListener("resize",this._windowResized,!1),this._currentState=e}}},{profilerString:{get:function(){return"WinJS.UI._Overlay Global Listener:"}},states:{get:function(){return{off:0,on:1}}}}),h={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get mustContainCommands(){return"Invalid HTML: AppBars/Menus must contain only AppBarCommands/MenuCommands"},get closeOverlay(){return a._getWinJSString("ui/closeOverlay").value}},u=n.Class.define(function(e,t){this._baseOverlayConstructor(e,t)},{_baseOverlayConstructor:function(e,i){this._disposed=!1,e||(e=t.document.createElement("div"));var n=e.winControl;if(n)throw new o("WinJS.UI._Overlay.DuplicateConstruction",h.duplicateConstruction);this._element||(this._element=e),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,e.winControl=this,f.addClass(this._element,v.overlayClass),f.addClass(this._element,"win-disposable");var s=this._element.getAttribute("unselectable");(null===s||void 0===s)&&this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=_.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,i&&p.setOptions(this,i),u._globalEventListeners.initialize()},element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},_show:function(){this._baseShow()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext},set:function(e){var t=this.hidden;!e&&t?this.show():e&&!t&&this.hide()}},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_baseShow:function(){if(this._animating||this._needToHandleHidingKeyboard)return this._doNext="show",!1;if("visible"!==this._element.style.visibility){this._element.winAnimating="showing",this._element.style.display="",this._element.style.visibility="hidden",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._beforeShow(),this._sendEvent(u.beforeShow),this._ensurePosition();var e=this;return this._animationPromise=this._currentAnimateIn().then(function(){e._baseEndShow()},function(){e._baseEndShow()}),!0}return!1},_beforeShow:function(){},_ensurePosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="","show"===this._doNext&&(this._doNext=""),this._sendEvent(u.afterShow),this._writeProfilerMark("show,StopTM"),m.schedule(this._checkDoNext,m.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_baseHide:function(){if(this._animating)return this._doNext="hide",!1;if(this._needToHandleHidingKeyboard&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(u.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var e=this;this._animationPromise=this._currentAnimateOut().then(function(){e._baseEndHide()},function(){e._baseEndHide()})}return!0}return!1},_baseEndHide:function(){this._disposed||(this._beforeEndHide(),this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._afterHide(),this._sendEvent(u.afterHide),this._writeProfilerMark("hide,StopTM"),m.schedule(this._checkDoNext,m.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_beforeEndHide:function(){},_afterHide:function(){},_checkDoNext:function(){this._animating||this._needToHandleHidingKeyboard||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",t.getComputedStyle(this._element,null).opacity,d.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,t.getComputedStyle(this._element,null).opacity,d.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(e,i){if(!this._disposed){var n=t.document.createEvent("CustomEvent");n.initEvent(e,!0,!0,i||{}),this._element.dispatchEvent(n)}},_showCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands(i.commands,[],t)},_hideCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands([],i.commands,t)},_showOnlyCommands:function(e,t){var i=this._resolveCommands(e);this._showAndHideCommands(i.commands,i.others,t)},_showAndHideCommands:function(e,t,i){i||this.hidden&&!this._animating?(this._showAndHideFast(e,t),this._removeFromQueue(e,this._queuedToShow),this._removeFromQueue(t,this._queuedToHide)):(this._updateAnimateQueue(e,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(t,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(e,t){var i;for(i=0;i<e.length;i++){var n;for(n=0;n<t.length;n++)if(t[n]===e[i]){t.splice(n,1);break}}},_updateAnimateQueue:function(e,t,i){if(!this._disposed){var n;for(n=0;n<e.length;n++){var s;for(s=0;s<t.length&&t[s]!==e[n];s++);for(s===t.length&&(t[s]=e[n]),s=0;s<i.length;s++)if(i[s]===e[n]){i.splice(s,1);break}}this._queuedCommandAnimation||(this._animating||m.schedule(this._checkDoNext,m.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(e,t){var i,n;for(i=0;i<e.length;i++)n=e[i],n&&n.style&&(n.style.visibility="",n.style.display="");for(i=0;i<t.length;i++)n=t[i],n&&n.style&&(n.style.visibility="hidden",n.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),m.schedule(this._checkDoNext,m.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var e,i=this._queuedToShow,n=this._queuedToHide,s=this._findSiblings(i.concat(n));for(e=0;e<i.length;e++)i[e]&&i[e].style&&t.document.body.contains(i[e])?"hidden"!==i[e].style.visibility&&"0"!==i[e].style.opacity&&(s.push(i[e]),i.splice(e,1),e--):(i.splice(e,1),e--);for(e=0;e<n.length;e++)n[e]&&n[e].style&&t.document.body.contains(n[e])&&"hidden"!==n[e].style.visibility&&"0"!==n[e].style.opacity||(n.splice(e,1),e--);var o=this._baseBeginAnimateCommands(i,n,s),r=this;o?o.done(function(){r._baseEndAnimateCommands(n)},function(){r._baseEndAnimateCommands(n)}):m.schedule(function(){r._baseEndAnimateCommands([])},m.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(e,i,n){this._beginAnimateCommands(e,i,this._getVisibleCommands(n));var s=null,o=null;i.length>0&&(o=d.createDeleteFromListAnimation(i,0===e.length?n:void 0)),e.length>0&&(s=d.createAddToListAnimation(e,n));for(var r=0,a=i.length;a>r;r++){var l=i[r].getBoundingClientRect(),h=t.getComputedStyle(i[r]);i[r].style.top=l.top-parseFloat(h.marginTop)+"px",i[r].style.left=l.left-parseFloat(h.marginLeft)+"px",i[r].style.opacity=0,i[r].style.position="fixed"}this._element.winAnimating="rearranging";var u=null;for(o&&(u=o.execute()),r=0;r<e.length;r++)e[r].style.visibility="",e[r].style.display="",e[r].style.opacity=1;if(s){var c=s.execute();u=u?_.join([u,c]):c}return u},_beginAnimateCommands:function(){},_getVisibleCommands:function(e){var t,i=e,n=[];i||(i=this.element.querySelectorAll(".win-command"));for(var s=0,o=i.length;o>s;s++)t=i[s].winControl||i[s],t.hidden||n.push(t);return n},_baseEndAnimateCommands:function(e){if(!this._disposed){var t;for(t=0;t<e.length;t++)e[t].style.position="",e[t].style.top="",e[t].style.left="",e[t].getBoundingClientRect(),e[t].style.visibility="hidden",e[t].style.display="none",e[t].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(e){e=s(e);var t={};t.commands=[],t.others=[];var i,n,o=this.element.querySelectorAll(".win-command");for(i=0;i<o.length;i++){var r=!1;for(n=0;n<e.length;n++)if(e[n]===o[i]){t.commands.push(o[i]),e.splice(n,1),r=!0;break}r||t.others.push(o[i])}return t},_findSiblings:function(e){var t,i,n=[],s=this.element.querySelectorAll(".win-command");for(t=0;t<s.length;t++){var o=!1;for(i=0;i<e.length;i++)if(e[i]===s[t]){e.splice(i,1),o=!0;break}o||n.push(s[t])}return n},_baseResize:function(e){this._resize(e)},_hideOrDismiss:function(){var e=this._element;e&&f.hasClass(e,v.settingsFlyoutClass)?this._dismiss():e&&f.hasClass(e,v.appBarClass)?this.close():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(e,t){for(var i=e.children,n=new Array(i.length),s=0;s<i.length;s++){if(!f.hasClass(i[s],"win-command")&&i[s].getAttribute("data-win-control")!==t)throw new o("WinJS.UI._Overlay.MustContainCommands",h.mustContainCommands);c.processAll(i[s]),n[s]=i[s].winControl}return n},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||u._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var e=this._element.firstElementChild.tabIndex,i=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var n=f._focusLastFocusableElement(this._element);return n&&u._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=e,this._element.lastElementChild.tabIndex=i,n}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||u._trySetActive(this._element)},_focusOnFirstFocusableElement:function(e,i){if(this._element.firstElementChild){var n=this._element.firstElementChild.tabIndex,s=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var o=f._focusFirstFocusableElement(this._element,e,i);return o&&u._trySelect(t.document.activeElement),this._element.firstElementChild.tabIndex=n,this._element.lastElementChild.tabIndex=s,o}return!1},_writeProfilerMark:function(e){l("WinJS.UI._Overlay:"+this._id+":"+e)}},{_isFlyoutVisible:function(){for(var e=t.document.querySelectorAll("."+v.flyoutClass),i=0;i<e.length;i++){var n=e[i].winControl;if(n&&!n.hidden)return!0}return!1},_trySetActive:function(e,i){return e&&t.document.body&&t.document.body.contains(e)&&f._setActive(e,i)?e===t.document.activeElement:!1},_trySelect:function(e){try{e&&e.select&&e.select()}catch(t){}},_sizeOfDocument:function(){return{width:t.document.documentElement.offsetWidth,height:t.document.documentElement.offsetHeight}},_getParentControlUsingClassName:function(e,i){for(;e&&e!==t.document.body;){if(f.hasClass(e,i))return e.winControl;e=e.parentNode}return null},_globalEventListeners:new r,_hideAppBars:function(e){var t=e.map(function(e){return e.close(),e._animationPromise});return _.join(t)},_showAppBars:function(e){var t=e.map(function(e){return e._show(),e._animationPromise});return _.join(t)},_keyboardInfo:g._KeyboardInfo,_scrollTimeout:g._KeyboardInfo._scrollTimeout,beforeShow:"beforeshow",beforeHide:"beforehide",afterShow:"aftershow",afterHide:"afterhide",commonstrings:{get cannotChangeCommandsWhenVisible(){return"Invalid argument: You must call hide() before changing {0} commands"},get cannotChangeHiddenProperty(){return"Unable to set hidden property while parent {0} is visible."}}});return n.Class.mix(u,p.DOMEventMixin),u})})}),n("WinJS/Controls/Flyout",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../_Signal","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_KeyboardBehavior","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Flyout:i.Namespace._lazy(function(){function e(e,i){return _.convertToPixels(e,t.getComputedStyle(e,null)[i])}function p(t){return{marginTop:e(t,"marginTop"),marginBottom:e(t,"marginBottom"),marginLeft:e(t,"marginLeft"),marginRight:e(t,"marginRight"),totalWidth:_.getTotalWidth(t),totalHeight:_.getTotalHeight(t),contentWidth:_.getContentWidth(t),contentHeight:_.getContentHeight(t)}}var v=_.Key,y={get ariaLabel(){return a._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return"Invalid argument: Flyout anchor element not found in DOM."},get badPlacement(){return"Invalid argument: Flyout placement should be 'top' (default), 'bottom', 'left', 'right', 'auto', 'autohorizontal', or 'autovertical'."},get badAlignment(){return"Invalid argument: Flyout alignment should be 'center' (default), 'left', or 'right'."},get noCoordinates(){return"Invalid argument: Flyout coordinates must contain a valid x,y pair."}},C=o._createEventProperty,w=i.Class.define(function(e){this._onLightDismiss=e,this._currentlyFocusedClient=null,this._clients=[]},{shown:function(e){e._focusable=!0;var t=this._clients.indexOf(e);-1===t&&(this._clients.push(e),e.onShow(this),u.isShown(this)?(u.updated(this),this._activateTopFocusableClientIfNeeded()):u.shown(this))},hiding:function(e){var t=this._clients.indexOf(e);-1!==t&&(this._clients[t]._focusable=!1,this._activateTopFocusableClientIfNeeded())},hidden:function(e){var t=this._clients.indexOf(e);-1!==t&&(this._clients.splice(t,1),e.setZIndex(""),e.onHide(),0===this._clients.length?u.hidden(this):(u.updated(this),this._activateTopFocusableClientIfNeeded()))},keyDown:function(e,t){u.keyDown(this,t)},keyUp:function(e,t){u.keyUp(this,t)},keyPress:function(e,t){u.keyPress(this,t)},clients:{get:function(){return this._clients}},_clientForElement:function(e){for(var t=this._clients.length-1;t>=0;t--)if(this._clients[t].containsElement(e))return this._clients[t];return null},_focusableClientForElement:function(e){for(var t=this._clients.length-1;t>=0;t--)if(this._clients[t]._focusable&&this._clients[t].containsElement(e))return this._clients[t];return null},_getTopmostFocusableClient:function(){for(var e=this._clients.length-1;e>=0;e--){var t=this._clients[e];if(t&&t._focusable)return t}return null},_activateTopFocusableClientIfNeeded:function(){var e=this._getTopmostFocusableClient();if(e&&u.isTopmost(this)){var t=!m._keyboardSeenLast;e.onTakeFocus(t)}},setZIndex:function(e){this._clients.forEach(function(t,i){t.setZIndex(e+i)},this)},getZIndexCount:function(){return this._clients.length},containsElement:function(e){return!!this._clientForElement(e)},onTakeFocus:function(e){var i=this._focusableClientForElement(t.document.activeElement);!i&&-1!==this._clients.indexOf(this._currentlyFocusedClient)&&this._currentlyFocusedClient._focusable&&(i=this._currentlyFocusedClient),i||(i=this._getTopmostFocusableClient()),this._currentlyFocusedClient=i,i&&i.onTakeFocus(e)},onFocus:function(e){this._currentlyFocusedClient=this._clientForElement(e),this._currentlyFocusedClient&&this._currentlyFocusedClient.onFocus(e)},onShow:function(){},onHide:function(){this._currentlyFocusedClient=null},onKeyInStack:function(e){var t=this._clients.indexOf(this._currentlyFocusedClient);if(-1!==t)for(var i=this._clients.slice(0,t+1),n=i.length-1;n>=0&&!e.propagationStopped;n--)i[n]._focusable&&i[n].onKeyInStack(e)},onShouldLightDismiss:function(e){return u.DismissalPolicies.light(e)},onLightDismiss:function(e){this._onLightDismiss(e)}}),b=i.Class.define(function(){var e=this;this._dismissableLayer=new w(function(t){t.reason===u.LightDismissalReasons.escape?e.collapseFlyout(e.getAt(e.length-1)):e.collapseAll()}),this._cascadingStack=[],this._handleKeyDownInCascade_bound=this._handleKeyDownInCascade.bind(this),this._inputType=null},{appendFlyout:function(e){if(r.log&&this.reentrancyLock&&r.log("_CascadeManager is attempting to append a Flyout through reentrancy.","winjs _CascadeManager","error"),this.indexOf(e)<0){var t=this.collapseAll;if(e._positionRequest instanceof S.AnchorPositioning){var i=this.indexOfElement(e._positionRequest.anchor);i>=0&&(t=function(){this.collapseFlyout(this.getAt(i+1))})}t.call(this),e.element.addEventListener("keydown",this._handleKeyDownInCascade_bound,!1),this._cascadingStack.push(e)}},collapseFlyout:function(e){if(!this.reentrancyLock&&e&&this.indexOf(e)>=0){this.reentrancyLock=!0;var t=new d;this.unlocked=t.promise;

for(var i;this.length&&e!==i;)i=this._cascadingStack.pop(),i.element.removeEventListener("keydown",this._handleKeyDownInCascade_bound,!1),i._hide();0===this._cascadingStack.length&&(this._inputType=null),this.reentrancyLock=!1,this.unlocked=null,t.complete()}},flyoutShown:function(e){this._dismissableLayer.shown(e._dismissable)},flyoutHiding:function(e){this._dismissableLayer.hiding(e._dismissable)},flyoutHidden:function(e){this._dismissableLayer.hidden(e._dismissable)},collapseAll:function(){var e=this.getAt(0);e&&this.collapseFlyout(e)},indexOf:function(e){return this._cascadingStack.indexOf(e)},indexOfElement:function(e){for(var t=-1,i=0,n=this.length;n>i;i++){var s=this.getAt(i);if(s.element.contains(e)){t=i;break}}return t},length:{get:function(){return this._cascadingStack.length}},getAt:function(e){return this._cascadingStack[e]},handleFocusIntoFlyout:function(e){var t=this.indexOfElement(e.target);if(t>=0){var i=this.getAt(t+1);this.collapseFlyout(i)}},inputType:{get:function(){return this._inputType||(this._inputType=m._lastInputType),this._inputType}},dismissableLayer:{get:function(){return this._dismissableLayer}},_handleKeyDownInCascade:function(e){var i="rtl"===t.getComputedStyle(e.target).direction,n=i?v.rightArrow:v.leftArrow,s=e.target;if(e.keyCode===n){var o=this.indexOfElement(s);if(o>=1){var r=this.getAt(o);this.collapseFlyout(r),e.preventDefault()}}else(e.keyCode===v.alt||e.keyCode===v.F10)&&this.collapseAll()}}),I={top:{top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},bottom:{top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},left:{top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},right:{top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"}},S={AnchorPositioning:i.Class.define(function(e,i,n){if("string"==typeof e?e=t.document.getElementById(e):e&&e.element&&(e=e.element),!e)throw new s("WinJS.UI.Flyout.NoAnchor",y.noAnchor);this.anchor=e,this.placement=i,this.alignment=n},{getTopLeft:function(e,t){function i(e){a(e)?(x=o(e)-S,C=g._Overlay._keyboardInfo._visibleDocTop,b=I.top):(x=r(e)-S,C=f.pinToBottomEdge,b=I.bottom),w=!0}function n(e,t){return(g._Overlay._keyboardInfo._visibleDocHeight-e.height)/2>=t.totalHeight}function o(e){return e.top-g._Overlay._keyboardInfo._visibleDocTop}function r(e){return g._Overlay._keyboardInfo._visibleDocBottom-e.bottom}function a(e){return o(e)>r(e)}function l(e,t){return C=e-t.totalHeight,b=I.top,C>=g._Overlay._keyboardInfo._visibleDocTop&&C+t.totalHeight<=g._Overlay._keyboardInfo._visibleDocBottom}function h(e,t){return C=e,b=I.bottom,C>=g._Overlay._keyboardInfo._visibleDocTop&&C+t.totalHeight<=g._Overlay._keyboardInfo._visibleDocBottom}function d(e,t){return v=e-t.totalWidth,b=I.left,v>=0&&v+t.totalWidth<=g._Overlay._keyboardInfo._visualViewportWidth}function u(e,t){return v=e,b=I.right,v>=0&&v+t.totalWidth<=g._Overlay._keyboardInfo._visualViewportWidth}function c(e,t){C=e.top+e.height/2-t.totalHeight/2,C<g._Overlay._keyboardInfo._visibleDocTop?C=g._Overlay._keyboardInfo._visibleDocTop:C+t.totalHeight>=g._Overlay._keyboardInfo._visibleDocBottom&&(C=f.pinToBottomEdge)}function _(e,t,i){if("center"===i)v=e.left+e.width/2-t.totalWidth/2;else if("left"===i)v=e.left;else{if("right"!==i)throw new s("WinJS.UI.Flyout.BadAlignment",y.badAlignment);v=e.right-t.totalWidth}0>v?v=0:v+t.totalWidth>=g._Overlay._keyboardInfo._visualViewportWidth&&(v=f.pinToRightEdge)}var m;try{m=this.anchor.getBoundingClientRect()}catch(p){throw new s("WinJS.UI.Flyout.NoAnchor",y.noAnchor)}var v,C,w,b,S=e.totalHeight-e.contentHeight,x=e.contentHeight,E=this.alignment;switch(this.placement){case"top":l(m.top,e)||(C=g._Overlay._keyboardInfo._visibleDocTop,w=!0,x=o(m)-S),_(m,e,E);break;case"bottom":h(m.bottom,e)||(C=f.pinToBottomEdge,w=!0,x=r(m)-S),_(m,e,E);break;case"left":d(m.left,e)||(v=0),c(m,e);break;case"right":u(m.right,e)||(v=f.pinToRightEdge),c(m,e);break;case"autovertical":l(m.top,e)||h(m.bottom,e)||i(m),_(m,e,E);break;case"autohorizontal":d(m.left,e)||u(m.right,e)||(v=f.pinToRightEdge),c(m,e);break;case"auto":n(m,e)?(l(m.top,e)||h(m.bottom,e),_(m,e,E)):d(m.left,e)||u(m.right,e)?c(m,e):(i(m),_(m,e,E));break;case"_cascade":h(m.top-e.marginTop,e)||l(m.bottom+e.marginBottom,e)||c(m,e);var P=3,M=m.right-e.marginLeft-P,T=m.left+e.marginRight+P;t?d(T,e)||u(M,e)||(v=0,b=I.left):u(M,e)||d(T,e)||(v=f.pinToRightEdge,b=I.right);break;default:throw new s("WinJS.UI.Flyout.BadPlacement",y.badPlacement)}return{left:v,top:C,animOffset:b,doesScroll:w,contentHeight:x,verticalMarginBorderPadding:S}}}),CoordinatePositioning:i.Class.define(function(e){if(e.clientX===+e.clientX&&e.clientY===+e.clientY){var t=e;e={x:t.clientX,y:t.clientY}}else if(e.x!==+e.x||e.y!==+e.y)throw new s("WinJS.UI.Flyout.NoCoordinates",y.noCoordinates);this.coordinates=e},{getTopLeft:function(e,t){var i=this.coordinates,n=e.totalWidth-e.marginLeft-e.marginRight,s=t?n:0,o=e.totalHeight-e.contentHeight,r=e.contentHeight,a=i.y-e.marginTop,l=i.x-e.marginLeft-s;return 0>a?a=0:a+e.totalHeight>g._Overlay._keyboardInfo._visibleDocBottom&&(a=f.pinToBottomEdge),0>l?l=0:l+e.totalWidth>g._Overlay._keyboardInfo._visualViewportWidth&&(l=f.pinToRightEdge),{left:l,top:a,verticalMarginBorderPadding:o,contentHeight:r,doesScroll:!1,animOffset:I.top}}})},x=i.Class.derive(g._Overlay,function(e,i){i=i||{},this._element=e||t.document.createElement("div"),this._id=this._element.id||_._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,i);var n=this._element.getElementsByTagName("*"),s=this._addFirstDiv();s.tabIndex=_._getLowestTabIndexInList(n);var o=this._addFinalDiv();return o.tabIndex=_._getHighestTabIndexInList(n),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(e,t){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(e,t),this._element.style.visibilty="hidden",this._element.style.display="none",_.addClass(this._element,f.flyoutClass);var i=this;this._dismissable=new u.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){i.hide()},onTakeFocus:function(){i._dismissable.restoreFocus()||(_.hasClass(i.element,f.menuClass)?g._Overlay._trySetActive(i._element):i._focusOnFirstFocusableElementOrThis())}});var n=this._element.getAttribute("role");(null===n||""===n||void 0===n)&&(_.hasClass(this._element,f.menuClass)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var s=this._element.getAttribute("aria-label");(null===s||""===s||void 0===s)&&this._element.setAttribute("aria-label",y.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,_._addEventListener(this.element,"focusin",this._handleFocusIn.bind(this),!1)},anchor:{get:function(){return this._anchor},set:function(e){this._anchor=e}},placement:{get:function(){return this._placement},set:function(e){if("top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e&&"auto"!==e&&"autohorizontal"!==e&&"autovertical"!==e)throw new s("WinJS.UI.Flyout.BadPlacement",y.badPlacement);this._placement=e}},alignment:{get:function(){return this._alignment},set:function(e){if("right"!==e&&"left"!==e&&"center"!==e)throw new s("WinJS.UI.Flyout.BadAlignment",y.badAlignment);this._alignment=e}},disabled:{get:function(){return!!this._element.disabled},set:function(e){e=!!e;var t=!!this._element.disabled;t!==e&&(this._element.disabled=e,!this.hidden&&this._element.disabled&&this.hide())}},onbeforeshow:C(g._Overlay.beforeShow),onaftershow:C(g._Overlay.afterShow),onbeforehide:C(g._Overlay.beforeHide),onafterhide:C(g._Overlay.afterHide),_dispose:function(){c.disposeSubTree(this.element),this._hide(),x._cascadeManager.flyoutHidden(this),this.anchor=null},show:function(e,t,i){this._writeProfilerMark("show,StartTM"),this._positionRequest=new S.AnchorPositioning(e||this._anchor,t||this._placement,i||this._alignment),this._show()},_show:function(){this._baseFlyoutShow()},showAt:function(e){this._writeProfilerMark("show,StartTM"),this._positionRequest=new S.CoordinatePositioning(e),this._show()},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){x._cascadeManager.collapseFlyout(this),this._baseHide()&&x._cascadeManager.flyoutHiding(this)},_beforeEndHide:function(){x._cascadeManager.flyoutHidden(this)},_baseFlyoutShow:function(){if(!this.disabled&&!this._disposed)if(x._cascadeManager.appendFlyout(this),this._element.winAnimating)this._doNext="show";else if(x._cascadeManager.reentrancyLock){this._doNext="show";var e=this;x._cascadeManager.unlocked.then(function(){e._checkDoNext()})}else if(this._baseShow()){if(!_.hasClass(this.element,"win-menu")){var t=this._element.getElementsByTagName("*"),i=this.element.querySelectorAll(".win-first");this.element.children.length&&!_.hasClass(this.element.children[0],f.firstDivClass)&&(i&&i.length>0&&i.item(0).parentNode.removeChild(i.item(0)),i=this._addFirstDiv()),i.tabIndex=_._getLowestTabIndexInList(t);var n=this.element.querySelectorAll(".win-final");_.hasClass(this.element.children[this.element.children.length-1],f.finalDivClass)||(n&&n.length>0&&n.item(0).parentNode.removeChild(n.item(0)),n=this._addFinalDiv()),n.tabIndex=_._getHighestTabIndexInList(t)}x._cascadeManager.flyoutShown(this)}},_lightDismiss:function(){x._cascadeManager.collapseAll()},_ensurePosition:function(){this._keyboardMovedUs=!1,this._clearAdjustedStyles(),this._setAlignment();var e=p(this._element),i="rtl"===t.getComputedStyle(this._element).direction;this._currentPosition=this._positionRequest.getTopLeft(e,i),this._currentPosition.top<0?(this._element.style.bottom=g._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"),this._currentPosition.left<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._currentPosition.left+"px",this._element.style.right="auto"),this._currentPosition.doesScroll&&(_.addClass(this._element,f.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),g._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_clearAdjustedStyles:function(){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",_.removeClass(this._element,f.scrollsClass),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),_.removeClass(this._element,"win-rightalign"),_.removeClass(this._element,"win-leftalign")},_setAlignment:function(){switch(this._positionRequest.alignment){case"left":_.addClass(this._element,"win-leftalign");break;case"right":_.addClass(this._element,"win-rightalign")}},_showingKeyboard:function(e){if(!this.hidden&&(e.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var i=this;t.setTimeout(function(){i._adjustForKeyboard(),i._baseAnimateIn()},g._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._needToHandleHidingKeyboard){var e=this;n._setImmediate(function(){(!e.hidden||e._animating)&&e._ensurePosition()}),this._needToHandleHidingKeyboard=!1}},_checkKeyboardFit:function(){var e=!1,t=g._Overlay._keyboardInfo._visibleDocHeight,i=this._currentPosition.contentHeight+this._currentPosition.verticalMarginBorderPadding;i>t?(e=!0,this._currentPosition.top=f.pinToBottomEdge,this._currentPosition.contentHeight=t-this._currentPosition.verticalMarginBorderPadding,this._currentPosition.doesScroll=!0):this._currentPosition.top>=0&&this._currentPosition.top+i>g._Overlay._keyboardInfo._visibleDocBottom?(this._currentPosition.top=f.pinToBottomEdge,e=!0):this._currentPosition.top===f.pinToBottomEdge&&(e=!0),this._keyboardMovedUs=e},_adjustForKeyboard:function(){this._currentPosition.doesScroll&&(this._lastMaxHeight||(_.addClass(this._element,f.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(g._Overlay._keyboardInfo._isResized)this._needToHandleHidingKeyboard=!0;else{var e=this;n._setImmediate(function(){(!e.hidden||e._animating)&&e._ensurePosition()})}},_checkScrollPosition:function(e){(!this.hidden||e)&&(this._currentPosition.top<0?(this._element.style.bottom=g._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",h.showPopup(this._element,this._currentPosition.animOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,h.hidePopup(this._element,this._currentPosition.animOffset))},_hideAllOtherFlyouts:function(e){for(var i=t.document.querySelectorAll("."+f.flyoutClass),n=0;n<i.length;n++){var s=i[n].winControl;s&&!s.hidden&&s!==e&&s.hide()}},_handleKeyDown:function(e){e.keyCode!==v.space&&e.keyCode!==v.enter||this!==t.document.activeElement?!e.shiftKey||e.keyCode!==v.tab||this!==t.document.activeElement||e.altKey||e.ctrlKey||e.metaKey||(e.preventDefault(),e.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(e.preventDefault(),e.stopPropagation(),this.winControl.hide())},_handleFocusIn:function(e){this.element.contains(e.relatedTarget)||x._cascadeManager.handleFocusIntoFlyout(e)},_addFirstDiv:function(){var e=t.document.createElement("div");e.className=f.firstDivClass,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(e,this._element.children[0]):this._element.appendChild(e);var i=this;return _._addEventListener(e,"focusin",function(){i._focusOnLastFocusableElementOrThis()},!1),e},_addFinalDiv:function(){var e=t.document.createElement("div");e.className=f.finalDivClass,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),this._element.appendChild(e);var i=this;return _._addEventListener(e,"focusin",function(){i._focusOnFirstFocusableElementOrThis()},!1),e},_writeProfilerMark:function(e){l("WinJS.UI.Flyout:"+this._id+":"+e)}},{_cascadeManager:new b});return x})})}),n("WinJS/Controls/CommandingSurface/_Constants",["require","exports"],function(e,t){t.ClassNames={controlCssClass:"win-commandingsurface",disposableCssClass:"win-disposable",actionAreaCssClass:"win-commandingsurface-actionarea",actionAreaContainerCssClass:"win-commandingsurface-actionareacontainer",overflowButtonCssClass:"win-commandingsurface-overflowbutton",spacerCssClass:"win-commandingsurface-spacer",ellipsisCssClass:"win-commandingsurface-ellipsis",overflowAreaCssClass:"win-commandingsurface-overflowarea",overflowAreaContainerCssClass:"win-commandingsurface-overflowareacontainer",contentFlyoutCssClass:"win-commandingsurface-contentflyout",emptyCommandingSurfaceCssClass:"win-commandingsurface-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",insetOutlineClass:"win-commandingsurface-insetoutline",openingClass:"win-commandingsurface-opening",openedClass:"win-commandingsurface-opened",closingClass:"win-commandingsurface-closing",closedClass:"win-commandingsurface-closed",noneClass:"win-commandingsurface-closeddisplaynone",minimalClass:"win-commandingsurface-closeddisplayminimal",compactClass:"win-commandingsurface-closeddisplaycompact",fullClass:"win-commandingsurface-closeddisplayfull",overflowTopClass:"win-commandingsurface-overflowtop",overflowBottomClass:"win-commandingsurface-overflowbottom"},t.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},t.actionAreaCommandWidth=68,t.actionAreaSeparatorWidth=34,t.actionAreaOverflowButtonWidth=32,t.overflowCommandHeight=44,t.overflowSeparatorHeight=12,t.controlMinWidth=t.actionAreaOverflowButtonWidth,t.overflowAreaMaxWidth=480,t.heightOfMinimal=24,t.heightOfCompact=48,t.contentMenuCommandDefaultLabel="Custom content",t.defaultClosedDisplayMode="compact",t.defaultOpened=!1,t.defaultOverflowDirection="bottom",t.typeSeparator="separator",t.typeContent="content",t.typeButton="button",t.typeToggle="toggle",t.typeFlyout="flyout",t.commandSelector=".win-command",t.primaryCommandSection="primary",t.secondaryCommandSection="secondary"}),n("WinJS/Controls/ToolBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(e,t,i){t.ClassNames={controlCssClass:"win-toolbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-toolbar-actionarea",overflowButtonCssClass:"win-toolbar-overflowbutton",spacerCssClass:"win-toolbar-spacer",ellipsisCssClass:"win-toolbar-ellipsis",overflowAreaCssClass:"win-toolbar-overflowarea",contentFlyoutCssClass:"win-toolbar-contentflyout",emptytoolbarCssClass:"win-toolbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-toolbar-opened",closedClass:"win-toolbar-closed",compactClass:"win-toolbar-closeddisplaycompact",fullClass:"win-toolbar-closeddisplayfull",overflowTopClass:"win-toolbar-overflowtop",overflowBottomClass:"win-toolbar-overflowbottom",placeHolderCssClass:"win-toolbar-placeholder"},t.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},t.OverflowDirection={top:"top",bottom:"bottom"},t.overflowAreaMaxWidth=i.overflowAreaMaxWidth,t.controlMinWidth=i.controlMinWidth,t.defaultClosedDisplayMode="compact",t.defaultOpened=!1,t.typeSeparator="separator",t.typeContent="content",t.typeButton="button",t.typeToggle="toggle",t.typeFlyout="flyout",t.commandSelector=".win-command",t.primaryCommandSection="primary",t.secondaryCommandSection="secondary"}),n("WinJS/Controls/AppBar/_Icon",["exports","../../Core/_Base","../../Core/_Resources"],function(e,t,i){"use strict";var n=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview","hamburger"],s=n.reduce(function(e,t){return e[t]={get:function(){return i._getWinJSString("ui/appBarIcons/"+t).value}},e},{});t.Namespace._moduleDefine(e,"WinJS.UI.AppBarIcon",s)}),n("WinJS/Controls/AppBar/_Command",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../Flyout/_Overlay","../Tooltip","../_LegacyAppBar/_Constants","./_Icon"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{AppBarCommand:n.Namespace._lazy(function(){function e(e){var i=this.winControl;if(i){if(i._type===_.typeToggle)i.selected=!i.selected;else if(i._type===_.typeFlyout&&i._flyout){var n=i._flyout;"string"==typeof n&&(n=t.document.getElementById(n)),n.show||(n=n.winControl),n&&n.show&&n.show(this,"autovertical")}i.onclick&&i.onclick(e)}}function p(e,t){var i=e[t],n=e.constructor.prototype,s=f(n,t)||{},o=s.get.bind(e)||function(){return i},r=s.set.bind(e)||function(e){i=e};Object.defineProperty(e,t,{get:function(){return o()},set:function(i){var n=o();r(i);var s=o();this._disposed||n===i||n===s||e._disposed||e._propertyMutations.dispatchEvent(_.commandPropertyMutated,{command:e,propertyName:t,oldValue:n,newValue:s})}})}function f(e,t){for(var i=null;e&&!i;)i=Object.getOwnPropertyDescriptor(e,t),e=Object.getPrototypeOf(e);return i}var g=n.Class.define(function(){this._observer=s._merge({},r.eventMixin)},{bind:function(e){this._observer.addEventListener(_.commandPropertyMutated,e)},unbind:function(e){this._observer.removeEventListener(_.commandPropertyMutated,e)},dispatchEvent:function(e,t){this._observer.dispatchEvent(e,t)}}),v={get ariaLabel(){return a._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badDivElement(){return"Invalid argument: For a content command, the element must be null or a div element"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"},get badPriority(){return"Invalid argument: the priority of an {0} must be a non-negative integer"}},y=n.Class.define(function(t,i){if(t&&t.winControl)throw new o("WinJS.UI.AppBarCommand.DuplicateConstruction",v.duplicateConstruction);if(this._disposed=!1,i||(i={}),i.type||(this._type=_.typeButton),i.section=i.section||_.sectionPrimary,this._element=t,i.type===_.typeContent?this._createContent():i.type===_.typeSeparator?this._createSeparator():this._createButton(),d.addClass(this._element,"win-disposable"),this._element.winControl=this,d.addClass(this._element,_.appBarCommandClass),i.onclick&&(this.onclick=i.onclick),i.onclick=e,l.setOptions(this,i),this._type!==_.typeToggle||i.selected||(this.selected=!1),this._type!==_.typeSeparator){var n=this._element.getAttribute("role");(null===n||""===n||void 0===n)&&(n=this._type===_.typeToggle?"menuitemcheckbox":this._type===_.typeContent?"group":"menuitem",this._element.setAttribute("role",n),this._type===_.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var s=this._element.getAttribute("aria-label");(null===s||""===s||void 0===s)&&this._element.setAttribute("aria-label",v.ariaLabel)}this._propertyMutations=new g;var r=this;C.forEach(function(e){p(r,e)})},{id:{get:function(){return this._element.id},set:function(e){e&&!this._element.id&&(this._element.id=e)}},type:{get:function(){return this._type},set:function(e){this._type||(this._type=e!==_.typeContent&&e!==_.typeFlyout&&e!==_.typeToggle&&e!==_.typeSeparator?_.typeButton:e)}},label:{get:function(){return this._label},set:function(e){this._label=e,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(e){this._icon=m[e]||e,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",d.addClass(this._imageSpan,"win-commandglyph")):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",d.removeClass(this._imageSpan,"win-commandglyph")))}},onclick:{get:function(){return this._onclick},set:function(e){if(e&&"function"!=typeof e)throw new o("WinJS.UI.AppBarCommand.BadClick",a._formatString(v.badClick,"AppBarCommand"));this._onclick=e}},priority:{get:function(){return this._priority},set:function(e){if(!(void 0===e||"number"==typeof e&&e>=0))throw new o("WinJS.UI.AppBarCommand.BadPriority",a._formatString(v.badPriority,"AppBarCommand"));this._priority=e}},flyout:{get:function(){var e=this._flyout;return"string"==typeof e&&(e=t.document.getElementById(e)),e&&!e.element&&e.winControl&&(e=e.winControl),e},set:function(e){var t=e;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=d._uniqueID(t),t=t.id))),"string"==typeof t&&this._element.setAttribute("aria-owns",t),this._flyout=e}},section:{get:function(){return this._section},set:function(e){(!this._section||i.Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(e)}},tooltip:{get:function(){return this._tooltip},set:function(e){this._tooltip=e,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(e){this._element.setAttribute("aria-checked",e)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(e){this._element.disabled=e}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(e){if(e!==this.hidden){var t=this._element.style,i=t.visibility,n=t.display;e?(t.visibility="hidden",t.display="none"):(t.visibility="",t.display="inline-block"),this._sendEvent(_.commandVisibilityChanged)||(t.visibility=i,t.display=n)}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(e){this._firstElementFocus=e===this.element?null:e,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(e){this._lastElementFocus=e===this.element?null:e,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===_.typeContent&&h.disposeSubTree(this.element))},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass&&d.removeClass(this._element,this._extraClass),this._extraClass=e,d.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new o("WinJS.UI.AppBarCommand.BadDivElement",v.badDivElement)}else this._element=t.document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new o("WinJS.UI.AppBarCommand.BadHrElement",v.badHrElement)}else this._element=t.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new o("WinJS.UI.AppBarCommand.BadButtonElement",v.badButtonElement);var e=this._element.getAttribute("type");(null===e||""===e||void 0===e)&&this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=t.document.createElement("button");this._element.type="button",this._iconSpan=t.document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=t.document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=t.document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new c.Tooltip(this._element);var i=this;this._tooltipControl.addEventListener("beforeopen",function(){i._hideIfFullSize&&!u._Overlay._getParentControlUsingClassName(i._element.parentElement,_.reducedClass)&&i._tooltipControl.close()},!1)},_setSection:function(e){e||(e=_.sectionPrimary),this._section&&(this._section===_.sectionGlobal?d.removeClass(this._element,_.appBarCommandGlobalClass):this.section===_.sectionSelection&&d.removeClass(this._element,_.appBarCommandSelectionClass)),this._section=e,e===_.sectionGlobal?d.addClass(this._element,_.appBarCommandGlobalClass):e===_.sectionSelection&&d.addClass(this._element,_.appBarCommandSelectionClass)},_updateTabStop:function(){this.element.tabIndex=this._firstElementFocus||this._lastElementFocus?-1:0},_isFocusable:function(){return!this.hidden&&this._type!==_.typeSeparator&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)},_sendEvent:function(e,i){if(!this._disposed){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,i||{}),this._element.dispatchEvent(n)}}}),C=["label","disabled","flyout","extraClass","selected","onclick","hidden"];return y})}),n.Namespace._moduleDefine(e,"WinJS.UI",{Command:n.Namespace._lazy(function(){return e.AppBarCommand})})}),n("WinJS/Controls/Menu/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Promise","../../Utilities/_Control","../../Utilities/_ElementUtilities","../_LegacyAppBar/_Constants","../Flyout/_Overlay"],function(e,t,i,n,s,o,r,a,l,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{MenuCommand:i.Namespace._lazy(function(){var e={get ariaLabel(){return s._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},d=i.Class.define(function(t,i){if(t&&t.winControl)throw new n("WinJS.UI.MenuCommand.DuplicateConstruction",e.duplicateConstruction);if(this._disposed=!1,i||(i={}),i.type||(this._type=l.typeButton),this._element=t,i.type===l.typeSeparator?this._createSeparator():this._createButton(),a.addClass(this._element,"win-disposable"),
this._element.winControl=this,a.addClass(this._element,l.menuCommandClass),i.selected||i.type!==l.typeToggle||(this.selected=!1),i.onclick&&(this.onclick=i.onclick),i.onclick=this._handleClick.bind(this),r.setOptions(this,i),this._type!==l.typeSeparator){var s=this._element.getAttribute("role");(null===s||""===s||void 0===s)&&(s="menuitem",this._type===l.typeToggle&&(s="menuitemcheckbox"),this._element.setAttribute("role",s),this._type===l.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var o=this._element.getAttribute("aria-label");(null===o||""===o||void 0===o)&&this._element.setAttribute("aria-label",e.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(e){this._element.id||(this._element.id=e)}},type:{get:function(){return this._type},set:function(e){this._type||(e!==l.typeButton&&e!==l.typeFlyout&&e!==l.typeToggle&&e!==l.typeSeparator&&(e=l.typeButton),this._type=e,e===l.typeButton?a.addClass(this.element,l.menuCommandButtonClass):e===l.typeFlyout?(a.addClass(this.element,l.menuCommandFlyoutClass),this.element.addEventListener("keydown",this._handleKeyDown.bind(this),!1)):e===l.typeSeparator?a.addClass(this.element,l.menuCommandSeparatorClass):e===l.typeToggle&&a.addClass(this.element,l.menuCommandToggleClass))}},label:{get:function(){return this._label},set:function(e){this._label=e||"",this._labelSpan&&(this._labelSpan.textContent=this.label),this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(t){if(t&&"function"!=typeof t)throw new n("WinJS.UI.MenuCommand.BadClick",s._formatString(e.badClick,"MenuCommand"));this._onclick=t}},flyout:{get:function(){var e=this._flyout;return"string"==typeof e&&(e=t.document.getElementById(e)),e&&!e.element&&(e=e.winControl),e},set:function(e){var t=e;t&&"string"!=typeof t&&(t.element&&(t=t.element),t&&(t.id?t=t.id:(t.id=a._uniqueID(t),t=t.id))),"string"==typeof t&&this._element.setAttribute("aria-owns",t),this._flyout!==e&&d._deactivateFlyoutCommand(this),this._flyout=e}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(e){this._element.setAttribute("aria-checked",!!e)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(e){e=!!e,e&&this.type===l.typeFlyout&&d._deactivateFlyoutCommand(this),this._element.disabled=e}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(e){var t=h._Overlay._getParentControlUsingClassName(this._element,l.menuClass);if(t&&!t.hidden)throw new n("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",s._formatString(h._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var i=this._element.style;e?(this.type===l.typeFlyout&&d._deactivateFlyoutCommand(this),i.visibility="hidden",i.display="none"):(i.visibility="",i.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(e){this._extraClass&&a.removeClass(this._element,this._extraClass),this._extraClass=e,a.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0)},addEventListener:function(e,t,i){return this._element.addEventListener(e,t,i)},removeEventListener:function(e,t,i){return this._element.removeEventListener(e,t,i)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new n("WinJS.UI.MenuCommand.BadHrElement",e.badHrElement)}else this._element=t.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new n("WinJS.UI.MenuCommand.BadButtonElement",e.badButtonElement)}else this._element=t.document.createElement("button");this._element.innerHTML='<div class="win-menucommand-liner"><span class="win-toggleicon" aria-hidden="true"></span><span class="win-label" aria-hidden="true"></span><span class="win-flyouticon" aria-hidden="true"></span></div>',this._element.type="button",this._menuCommandLiner=this._element.firstElementChild,this._toggleSpan=this._menuCommandLiner.firstElementChild,this._labelSpan=this._toggleSpan.nextElementSibling,this._flyoutSpan=this._labelSpan.nextElementSibling},_sendEvent:function(e,i){if(!this._disposed){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!0,i||{}),this._element.dispatchEvent(n)}},_invoke:function(e){this.hidden||this.disabled||this._disposed||(this._type===l.typeToggle?this.selected=!this.selected:this._type===l.typeFlyout&&d._activateFlyoutCommand(this),e&&"click"===e.type&&this.onclick&&this.onclick(e),this._sendEvent(l._menuCommandInvokedEvent,{command:this}))},_handleClick:function(e){this._invoke(e)},_handleKeyDown:function(e){var i=a.Key,n="rtl"===t.getComputedStyle(this.element).direction,s=n?i.leftArrow:i.rightArrow;e.keyCode===s&&this.type===l.typeFlyout&&(this._invoke(e),e.preventDefault())}},{_activateFlyoutCommand:function(e){return new o(function(t,i){e=e.winControl||e;var n=e.flyout;n&&n.hidden&&n.show?(a.addClass(e.element,l.menuCommandFlyoutActivatedClass),n.addEventListener("beforehide",function s(){n.removeEventListener("beforehide",s,!1),a.removeClass(e.element,l.menuCommandFlyoutActivatedClass)},!1),n.addEventListener("aftershow",function o(){n.removeEventListener("aftershow",o,!1),t()},!1),n.show(e,"_cascade")):i()})},_deactivateFlyoutCommand:function(e){return new o(function(t){e=e.winControl||e,a.removeClass(e.element,l.menuCommandFlyoutActivatedClass);var i=e.flyout;i&&!i.hidden&&i.hide?(i.addEventListener("afterhide",function n(){i.removeEventListener("afterhide",n,!1),t()},!1),i.hide()):t()})}});return d})})});var s=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i};return n("WinJS/Controls/CommandingSurface/_MenuCommand",["require","exports","../Menu/_Command"],function(e,t,i){var n=function(e){function t(t,i){i&&i.beforeInvoke&&(this._beforeInvoke=i.beforeInvoke),e.call(this,t,i)}return s(t,e),t.prototype._invoke=function(t){this._beforeInvoke&&this._beforeInvoke(t),e.prototype._invoke.call(this,t)},t}(i.MenuCommand);t._MenuCommand=n}),n("WinJS/Utilities/_OpenCloseMachine",["require","exports","../Core/_Global","../Promise","../_Signal"],function(e,t,i,n,s){"use strict";function o(e){return n._cancelBlocker(e,function(){e.cancel()})}function r(){}function a(e,t){e._interruptibleWorkPromises=e._interruptibleWorkPromises||[];var i=new s;e._interruptibleWorkPromises.push(t(i.promise)),i.complete()}function l(){(this._interruptibleWorkPromises||[]).forEach(function(e){e.cancel()})}var h={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",_openCloseStateSettled:"_openCloseStateSettled"},d=function(){function e(e){this._control=e,this._initializedSignal=new s,this._disposed=!1,this._setState(u.Init)}return e.prototype.exitInit=function(){this._initializedSignal.complete()},e.prototype.updateDom=function(){this._state.updateDom()},e.prototype.open=function(){this._state.open()},e.prototype.close=function(){this._state.close()},Object.defineProperty(e.prototype,"opened",{get:function(){return this._state.opened},set:function(e){e?this.open():this.close()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._setState(u.Disposed),this._disposed=!0,this._control=null},e.prototype._setState=function(e,t){this._disposed||(this._state&&this._state.exit(),this._state=new e,this._state.machine=this,this._state.enter(t))},e.prototype._fireEvent=function(e,t){t=t||{};var n=t.detail||null,s=!!t.cancelable,o=i.document.createEvent("CustomEvent");return o.initCustomEvent(e,!0,s,n),this._control.eventElement.dispatchEvent(o)},e.prototype._fireBeforeOpen=function(){return this._fireEvent(h.beforeOpen,{cancelable:!0})},e.prototype._fireBeforeClose=function(){return this._fireEvent(h.beforeClose,{cancelable:!0})},e}();t.OpenCloseMachine=d;var u;!function(e){function t(){this.machine._control.onUpdateDom()}var i=function(){function e(){this.name="Init",this.exit=l,this.updateDom=r}return e.prototype.enter=function(){var e=this;a(this,function(t){return t.then(function(){return e.machine._initializedSignal.promise}).then(function(){e.machine._control.onUpdateDomWithIsOpened(e._opened),e.machine._setState(e._opened?u:n)})})},Object.defineProperty(e.prototype,"opened",{get:function(){return this._opened},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._opened=!0},e.prototype.close=function(){this._opened=!1},e}();e.Init=i;var n=function(){function e(){this.name="Closed",this.exit=r,this.opened=!1,this.close=r,this.updateDom=t}return e.prototype.enter=function(e){e=e||{},e.openIsPending&&this.open(),this.machine._fireEvent(h._openCloseStateSettled)},e.prototype.open=function(){this.machine._setState(s)},e}(),s=function(){function e(){this.name="BeforeOpen",this.exit=l,this.opened=!1,this.open=r,this.close=r,this.updateDom=t}return e.prototype.enter=function(){var e=this;a(this,function(t){return t.then(function(){return e.machine._fireBeforeOpen()}).then(function(t){e.machine._setState(t?d:n)})})},e}(),d=function(){function e(){this.name="Opening",this.exit=l,this.updateDom=r}return e.prototype.enter=function(){var e=this;a(this,function(t){return t.then(function(){return e._closeIsPending=!1,o(e.machine._control.onOpen())}).then(function(){e.machine._fireEvent(h.afterOpen)}).then(function(){e.machine._control.onUpdateDom(),e.machine._setState(u,{closeIsPending:e._closeIsPending})})})},Object.defineProperty(e.prototype,"opened",{get:function(){return!this._closeIsPending},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._closeIsPending=!1},e.prototype.close=function(){this._closeIsPending=!0},e}(),u=function(){function e(){this.name="Opened",this.exit=r,this.opened=!0,this.open=r,this.updateDom=t}return e.prototype.enter=function(e){e=e||{},e.closeIsPending&&this.close(),this.machine._fireEvent(h._openCloseStateSettled)},e.prototype.close=function(){this.machine._setState(c)},e}(),c=function(){function e(){this.name="BeforeClose",this.exit=l,this.opened=!0,this.open=r,this.close=r,this.updateDom=t}return e.prototype.enter=function(){var e=this;a(this,function(t){return t.then(function(){return e.machine._fireBeforeClose()}).then(function(t){e.machine._setState(t?_:u)})})},e}(),_=function(){function e(){this.name="Closing",this.exit=l,this.updateDom=r}return e.prototype.enter=function(){var e=this;a(this,function(t){return t.then(function(){return e._openIsPending=!1,o(e.machine._control.onClose())}).then(function(){e.machine._fireEvent(h.afterClose)}).then(function(){e.machine._control.onUpdateDom(),e.machine._setState(n,{openIsPending:e._openIsPending})})})},Object.defineProperty(e.prototype,"opened",{get:function(){return this._openIsPending},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._openIsPending=!0},e.prototype.close=function(){this._openIsPending=!1},e}(),m=function(){function e(){this.name="Disposed",this.enter=r,this.exit=r,this.opened=!1,this.open=r,this.close=r,this.updateDom=r}return e}();e.Disposed=m}(u||(u={}))}),n("require-style!less/styles-commandingsurface",[],function(){}),n("require-style!less/colors-commandingsurface",[],function(){}),n("WinJS/Controls/CommandingSurface/_CommandingSurface",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../BindingList","../../ControlProcessor","../CommandingSurface/_Constants","../AppBar/_Command","../CommandingSurface/_MenuCommand","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Controls/Flyout","../../Core/_Global","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Promise","../../Core/_Resources","../../Scheduler","../../Utilities/_OpenCloseMachine","../../_Signal","../../Core/_WriteProfilerMark"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C,w,b,I,S,x){function E(e,t){t&&c.addClass(e,t)}function P(e,t){t&&c.removeClass(e,t)}function M(e,t){return e.filter(function(e){return t.indexOf(e)<0})}e(["require-style!less/styles-commandingsurface"]),e(["require-style!less/colors-commandingsurface"]);var T={get overflowButtonAriaLabel(){return w._getWinJSString("ui/commandingSurfaceOverflowButtonAriaLabel").value},get badData(){return"Invalid argument: The data property must an instance of a WinJS.Binding.List"},get mustContainCommands(){return"The commandingSurface can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},k={bottom:"bottom",top:"top"},D={};D[k.top]=a.ClassNames.overflowTopClass,D[k.bottom]=a.ClassNames.overflowBottomClass;var A={none:"none",minimal:"minimal",compact:"compact",full:"full"},O={};O[A.none]=a.ClassNames.noneClass,O[A.minimal]=a.ClassNames.minimalClass,O[A.compact]=a.ClassNames.compactClass,O[A.full]=a.ClassNames.fullClass;var B=function(){function e(e,t){var i=this;if(void 0===t&&(t={}),this._hoverable=g.isHoverable,this._dataChangedEvents=["itemchanged","iteminserted","itemmoved","itemremoved","reload"],this._updateDomImpl=function(){var e={closedDisplayMode:void 0,isOpenedMode:void 0,overflowDirection:void 0,overflowAlignmentOffset:void 0},t=function(){var t=e;if(t.isOpenedMode!==i._isOpenedMode&&(i._isOpenedMode?(P(i._dom.root,a.ClassNames.closedClass),E(i._dom.root,a.ClassNames.openedClass)):(P(i._dom.root,a.ClassNames.openedClass),E(i._dom.root,a.ClassNames.closedClass)),t.isOpenedMode=i._isOpenedMode),t.closedDisplayMode!==i.closedDisplayMode&&(P(i._dom.root,O[t.closedDisplayMode]),E(i._dom.root,O[i.closedDisplayMode]),t.closedDisplayMode=i.closedDisplayMode),t.overflowDirection!==i.overflowDirection&&(P(i._dom.root,D[t.overflowDirection]),E(i._dom.root,D[i.overflowDirection]),t.overflowDirection=i.overflowDirection),i._overflowAlignmentOffset!==t.overflowAlignmentOffset){var n=i._rtl?"left":"right",s=i._overflowAlignmentOffset+"px";i._dom.overflowAreaContainer.style[n]=s}},n={newDataStage:3,measuringStage:2,layoutStage:1,idle:0},s=n.idle,o=function(){i._writeProfilerMark("_updateDomImpl_updateCommands,info");for(var e=s;e!==n.idle;){var t=e,o=!1;switch(e){case n.newDataStage:e=n.measuringStage,o=i._processNewData();break;case n.measuringStage:e=n.layoutStage,o=i._measure();break;case n.layoutStage:e=n.idle,o=i._layoutCommands()}if(!o){e=t;break}}s=e,e===n.idle&&i._layoutCompleteCallback&&i._layoutCompleteCallback()};return{get renderedState(){return{get closedDisplayMode(){return e.closedDisplayMode},get isOpenedMode(){return e.isOpenedMode},get overflowDirection(){return e.overflowDirection},get overflowAlignmentOffset(){return e.overflowAlignmentOffset}}},update:function(){t(),o()},dataDirty:function(){s=Math.max(n.newDataStage,s)},measurementsDirty:function(){s=Math.max(n.measuringStage,s)},layoutDirty:function(){s=Math.max(n.layoutStage,s)},get _currentLayoutStage(){return s}}}(),this._writeProfilerMark("constructor,StartTM"),e&&e.winControl)throw new _("WinJS.UI._CommandingSurface.DuplicateConstruction",T.duplicateConstruction);this._initializeDom(e||f.document.createElement("div")),this._machine=t.openCloseMachine||new I.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){return i.synchronousOpen(),C.wrap()},onClose:function(){return i.synchronousClose(),C.wrap()},onUpdateDom:function(){i._updateDomImpl.update()},onUpdateDomWithIsOpened:function(e){e?i.synchronousOpen():i.synchronousClose()}}),this._disposed=!1,this._primaryCommands=[],this._secondaryCommands=[],this._refreshBound=this._refresh.bind(this),this._resizeHandlerBound=this._resizeHandler.bind(this),this._winKeyboard=new v._WinKeyboard(this._dom.root),this._refreshPending=!1,this._rtl=!1,this._initializedSignal=new S,this._isOpenedMode=a.defaultOpened,this._menuCommandProjections=[],this.overflowDirection=a.defaultOverflowDirection,this.closedDisplayMode=a.defaultClosedDisplayMode,this.opened=this._isOpenedMode,t.data||(t=s._shallowCopy(t),t.data=t.data||this._getDataFromDOMElements()),d.setOptions(this,t),c._resizeNotifier.subscribe(this._dom.root,this._resizeHandlerBound),this._dom.root.addEventListener("keydown",this._keyDownHandler.bind(this)),c._inDom(this._dom.root).then(function(){i._rtl="rtl"===f.getComputedStyle(i._dom.root).direction,t.openCloseMachine||i._machine.exitInit(),i._initializedSignal.complete(),i._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(e.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){if(this._writeProfilerMark("set_data,info"),e!==this.data){if(!(e instanceof o.List))throw new _("WinJS.UI._CommandingSurface.BadData",T.badData);this._data&&this._removeDataListeners(),this._data=e,this._addDataListeners(),this._dataUpdated()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(e){this._writeProfilerMark("set_closedDisplayMode,info");var t=e!==this._closedDisplayMode;A[e]&&t&&(this._closedDisplayMode=e,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overflowDirection",{get:function(){return this._overflowDirection},set:function(e){var t=e!==this._overflowDirection;k[e]&&t&&(this._overflowDirection=e,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opened",{get:function(){return this._machine.opened},set:function(e){this._machine.opened=e},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._machine.open()},e.prototype.close=function(){this._machine.close()},e.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),c._resizeNotifier.unsubscribe(this._dom.root,this._resizeHandlerBound),this._contentFlyout&&(this._contentFlyout.dispose(),this._contentFlyout.element.parentNode.removeChild(this._contentFlyout.element)),u.disposeSubTree(this._dom.root))},e.prototype.forceLayout=function(){this._updateDomImpl.measurementsDirty(),this._machine.updateDom()},e.prototype.getBoundingRects=function(){return{commandingSurface:this._dom.root.getBoundingClientRect(),overflowArea:this._dom.overflowArea.getBoundingClientRect()}},e.prototype.getCommandById=function(e){if(this._data)for(var t=0,i=this._data.length;i>t;t++){var n=this._data.getAt(t);if(n.id===e)return n}return null},e.prototype.showOnlyCommands=function(e){if(this._data){for(var t=0,i=this._data.length;i>t;t++)this._data.getAt(t).hidden=!0;for(var t=0,i=e.length;i>t;t++){var n="string"==typeof e[t]?this.getCommandById(e[t]):e[t];n&&(n.hidden=!1)}}},e.prototype.deferredDomUpate=function(){this._machine.updateDom()},e.prototype.createOpenAnimation=function(e){y.log&&this._updateDomImpl.renderedState.isOpenedMode&&y.log("The CommandingSurface should only attempt to create an open animation when it's not already opened");var t=this;return{execute:function(){c.addClass(t.element,a.ClassNames.openingClass);var n=t.getBoundingRects();return t._dom.overflowAreaContainer.style.width=n.overflowArea.width+"px",t._dom.overflowAreaContainer.style.height=n.overflowArea.height+"px",i._commandingSurfaceOpenAnimation({actionAreaClipper:t._dom.actionAreaContainer,actionArea:t._dom.actionArea,overflowAreaClipper:t._dom.overflowAreaContainer,overflowArea:t._dom.overflowArea,oldHeight:e,newHeight:n.commandingSurface.height,overflowAreaHeight:n.overflowArea.height,menuPositionedAbove:t.overflowDirection===k.top}).then(function(){c.removeClass(t.element,a.ClassNames.openingClass),t._clearAnimation()})}}},e.prototype.createCloseAnimation=function(e){y.log&&!this._updateDomImpl.renderedState.isOpenedMode&&y.log("The CommandingSurface should only attempt to create an closed animation when it's not already closed");var t=this.getBoundingRects().commandingSurface.height,n=this._dom.overflowArea.offsetHeight,s=(this._dom.overflowArea.offsetTop,this);return{execute:function(){return c.addClass(s.element,a.ClassNames.closingClass),i._commandingSurfaceCloseAnimation({actionAreaClipper:s._dom.actionAreaContainer,actionArea:s._dom.actionArea,overflowAreaClipper:s._dom.overflowAreaContainer,overflowArea:s._dom.overflowArea,oldHeight:t,newHeight:e,overflowAreaHeight:n,menuPositionedAbove:s.overflowDirection===k.top}).then(function(){c.removeClass(s.element,a.ClassNames.closingClass),s._clearAnimation()})}}},Object.defineProperty(e.prototype,"initialized",{get:function(){return this._initializedSignal.promise},enumerable:!0,configurable:!0}),e.prototype._writeProfilerMark=function(e){x("WinJS.UI._CommandingSurface:"+this._id+":"+e)},e.prototype._initializeDom=function(e){var t=this;this._writeProfilerMark("_intializeDom,info"),e.winControl=this,this._id=e.id||c._uniqueID(e),e.hasAttribute("tabIndex")||(e.tabIndex=-1),c.addClass(e,a.ClassNames.controlCssClass),c.addClass(e,a.ClassNames.disposableCssClass);var i=f.document.createElement("div");c.addClass(i,a.ClassNames.actionAreaCssClass),c._reparentChildren(e,i);var n=document.createElement("DIV");c.addClass(n,a.ClassNames.insetOutlineClass);var s=f.document.createElement("div");c.addClass(s,a.ClassNames.actionAreaContainerCssClass),s.appendChild(i),s.appendChild(n),e.appendChild(s);var o=f.document.createElement("div");c.addClass(o,a.ClassNames.spacerCssClass),i.appendChild(o);var r=f.document.createElement("button");r.tabIndex=0,r.innerHTML="<span class='"+a.ClassNames.ellipsisCssClass+"'></span>",c.addClass(r,a.ClassNames.overflowButtonCssClass),i.appendChild(r),r.addEventListener("click",function(){t.opened=!t.opened});var l=f.document.createElement("div");c.addClass(l,a.ClassNames.overflowAreaCssClass),c.addClass(l,a.ClassNames.menuCssClass);var h=f.document.createElement("DIV");c.addClass(h,a.ClassNames.insetOutlineClass);var d=f.document.createElement("div");c.addClass(d,a.ClassNames.overflowAreaContainerCssClass),d.appendChild(l),d.appendChild(h),e.appendChild(d),this._dom={root:e,actionArea:i,actionAreaContainer:s,spacer:o,overflowButton:r,overflowArea:l,overflowAreaContainer:d}},e.prototype._getFocusableElementsInfo=function(){var e=this,t={elements:[],focusedIndex:-1},i=Array.prototype.slice.call(this._dom.actionArea.children),i=Array.prototype.slice.call(this._dom.actionArea.children);return"none"!==this._dom.overflowArea.style.display&&(i=i.concat(Array.prototype.slice.call(this._dom.overflowArea.children))),i.forEach(function(i){e._isElementFocusable(i)&&(t.elements.push(i),i.contains(f.document.activeElement)&&(t.focusedIndex=t.elements.length-1))}),t},e.prototype._dataUpdated=function(){var e=this;this._primaryCommands=[],this._secondaryCommands=[],this.data.length>0&&this.data.forEach(function(t){"secondary"===t.section?e._secondaryCommands.push(t):e._primaryCommands.push(t)}),this._updateDomImpl.dataDirty(),this._machine.updateDom()},e.prototype._refresh=function(){var e=this;this._refreshPending||(this._refreshPending=!0,b.schedule(function(){e._refreshPending&&!e._disposed&&(e._refreshPending=!1,e._dataUpdated())},b.Priority.high,null,"WinJS.UI._CommandingSurface._refresh"))},e.prototype._addDataListeners=function(){var e=this;this._dataChangedEvents.forEach(function(t){e._data.addEventListener(t,e._refreshBound,!1)})},e.prototype._removeDataListeners=function(){var e=this;this._dataChangedEvents.forEach(function(t){e._data.removeEventListener(t,e._refreshBound,!1)})},e.prototype._isElementFocusable=function(e){var t=!1;if(e){var i=e.winControl;t=i?"none"!==i.element.style.display&&i.type!==a.typeSeparator&&!i.hidden&&!i.disabled&&(!i.firstElementFocus||i.firstElementFocus.tabIndex>=0||i.lastElementFocus.tabIndex>=0):"none"!==e.style.display&&"hidden"!==getComputedStyle(e).visibility&&e.tabIndex>=0}return t},e.prototype._isCommandInActionArea=function(e){return e&&e.winControl&&e.parentElement===this._dom.actionArea},e.prototype._getLastElementFocus=function(e){return this._isCommandInActionArea(e)?e.winControl.lastElementFocus:e},e.prototype._getFirstElementFocus=function(e){return this._isCommandInActionArea(e)?e.winControl.firstElementFocus:e},e.prototype._keyDownHandler=function(e){if(!e.altKey){if(c._matchesSelector(e.target,".win-interactive, .win-interactive *"))return;var t,i=c.Key,n=this._getFocusableElementsInfo();if(n.elements.length)switch(e.keyCode){case this._rtl?i.rightArrow:i.leftArrow:case i.upArrow:var s=Math.max(0,n.focusedIndex-1);t=this._getLastElementFocus(n.elements[s%n.elements.length]);break;case this._rtl?i.leftArrow:i.rightArrow:case i.downArrow:var s=Math.min(n.focusedIndex+1,n.elements.length-1);t=this._getFirstElementFocus(n.elements[s]);break;case i.home:var s=0;t=this._getFirstElementFocus(n.elements[s]);break;case i.end:var s=n.elements.length-1;t=this._getLastElementFocus(n.elements[s])}t&&t!==f.document.activeElement&&(t.focus(),e.preventDefault())}},e.prototype._getDataFromDOMElements=function(){this._writeProfilerMark("_getDataFromDOMElements,info"),r.processAll(this._dom.actionArea,!0);for(var e,t=[],i=this._dom.actionArea.children.length,n=0;i>n;n++)if(e=this._dom.actionArea.children[n],e.winControl&&e.winControl instanceof l.AppBarCommand)t.push(e.winControl);else if(e!==this._dom.overflowButton&&e!==this._dom.spacer)throw new _("WinJS.UI._CommandingSurface.MustContainCommands",T.mustContainCommands);return new o.List(t)},e.prototype._canMeasure=function(){return(this._updateDomImpl.renderedState.isOpenedMode||this._updateDomImpl.renderedState.closedDisplayMode===A.compact||this._updateDomImpl.renderedState.closedDisplayMode===A.full)&&f.document.body.contains(this._dom.root)&&this._dom.actionArea.offsetWidth>0},e.prototype._resizeHandler=function(){if(this._canMeasure()){var e=c._getPreciseContentWidth(this._dom.actionArea);this._cachedMeasurements&&this._cachedMeasurements.actionAreaContentBoxWidth!==e&&(this._cachedMeasurements.actionAreaContentBoxWidth=e,this._updateDomImpl.layoutDirty(),this._machine.updateDom())}else this._updateDomImpl.measurementsDirty()},e.prototype.synchronousOpen=function(){this._overflowAlignmentOffset=0,this._isOpenedMode=!0,this._updateDomImpl.update(),this._overflowAlignmentOffset=this._computeAdjustedOverflowAreaOffset(),this._updateDomImpl.update()},e.prototype._computeAdjustedOverflowAreaOffset=function(){y.log&&(!this._updateDomImpl.renderedState.isOpenedMode&&y.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered opened"),0!==this._updateDomImpl.renderedState.overflowAlignmentOffset&&y.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered with an overflowAlignementOffset of 0"));var e=(this._dom.overflowArea,this.getBoundingRects()),t=0;if(this._rtl){var i=window.innerWidth,n=e.overflowArea.right;t=Math.min(i-n,0)}else{var s=e.overflowArea.left;t=Math.min(0,s)}return t},e.prototype.synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl.update()},e.prototype.updateDom=function(){this._updateDomImpl.update()},e.prototype._getDataChangeInfo=function(){var e=[],t=[],i=[],n=[],s=[],o=[],r=[],l=[];return Array.prototype.forEach.call(this._dom.actionArea.querySelectorAll(a.commandSelector),function(e){"none"!==e.style.display&&n.push(e),s.push(e)}),this.data.forEach(function(e){"none"!==e.element.style.display?o.push(e.element):r.push(e.element),l.push(e.element)}),t=M(n,o),i=M(n,t),e=M(o,n).concat(r),{newElements:l,currentElements:s,added:e,deleted:t,affected:i}},e.prototype._processNewData=function(){var e=this;this._writeProfilerMark("_processNewData,info");var t=this._getDataChangeInfo(),n=i._createUpdateListAnimation(t.added,t.deleted,t.affected);return t.deleted.forEach(function(t){var i=t.winControl;i&&i._propertyMutations&&i._propertyMutations.unbind(e._refreshBound)}),t.added.forEach(function(t){var i=t.winControl;i&&i._propertyMutations&&i._propertyMutations.bind(e._refreshBound)}),t.currentElements.forEach(function(e){e.parentElement&&e.parentElement.removeChild(e)}),t.newElements.forEach(function(t){e._dom.actionArea.appendChild(t)}),this._dom.actionArea.appendChild(this._dom.overflowButton),this.data.length>0?c.removeClass(this._dom.root,a.ClassNames.emptyCommandingSurfaceCssClass):c.addClass(this._dom.root,a.ClassNames.emptyCommandingSurfaceCssClass),n.execute(),!0},e.prototype._measure=function(){var e=this;if(this._writeProfilerMark("_measure,info"),this._canMeasure()){var t=c._getPreciseTotalWidth(this._dom.overflowButton),i=c._getPreciseContentWidth(this._dom.actionArea),n=0,s=0,o={};return this._primaryCommands.forEach(function(t){var i=t.element.style.display;t.element.style.display="",t.type===a.typeContent?o[e._commandUniqueId(t)]=c._getPreciseTotalWidth(t.element):t.type===a.typeSeparator?n||(n=c._getPreciseTotalWidth(t.element)):s||(s=c._getPreciseTotalWidth(t.element)),t.element.style.display=i}),this._cachedMeasurements={contentCommandWidths:o,separatorWidth:n,standardCommandWidth:s,overflowButtonWidth:t,actionAreaContentBoxWidth:i},!0}return!1},e.prototype._layoutCommands=function(){var e=this;this._writeProfilerMark("_layoutCommands,StartTM"),this._primaryCommands.forEach(function(e){e.element.style.display=e.hidden?"none":""});var t=this._getVisiblePrimaryCommandsLocation();this._hideSeparatorsIfNeeded(t.actionArea),t.overflowArea.forEach(function(e){e.element.style.display="none"}),this._secondaryCommands.forEach(function(e){e.element.style.display="none"});var i=t.overflowArea,n=i.length>0||this._secondaryCommands.length>0;this._dom.overflowButton.style.display=n?"":"none";var s=function(e){return e.type===a.typeContent},o=i.some(s)||this._secondaryCommands.some(s);o&&!this._contentFlyout&&(this._contentFlyoutInterior=f.document.createElement("div"),c.addClass(this._contentFlyoutInterior,a.ClassNames.contentFlyoutCssClass),this._contentFlyout=new p.Flyout,this._contentFlyout.element.appendChild(this._contentFlyoutInterior),f.document.body.appendChild(this._contentFlyout.element),this._contentFlyout.onbeforeshow=function(){c.empty(e._contentFlyoutInterior),c._reparentChildren(e._chosenCommand.element,e._contentFlyoutInterior)},this._contentFlyout.onafterhide=function(){c._reparentChildren(e._contentFlyoutInterior,e._chosenCommand.element)}),c.empty(this._dom.overflowArea),this._menuCommandProjections.map(function(e){e.dispose()});var r=!1,l=[];i.forEach(function(t){t.type===a.typeToggle&&(r=!0),l.push(e._projectAsMenuCommand(t))});var d=this._secondaryCommands.length;if(i.length>0&&d>0){var u=new h._MenuCommand(null,{type:a.typeSeparator});l.push(u)}return this._secondaryCommands.forEach(function(t){t.hidden||(t.type===a.typeToggle&&(r=!0),l.push(e._projectAsMenuCommand(t)))}),this._hideSeparatorsIfNeeded(l),l.forEach(function(t){e._dom.overflowArea.appendChild(t.element)}),this._menuCommandProjections=l,c[r?"addClass":"removeClass"](this._dom.overflowArea,a.ClassNames.menuContainsToggleCommandClass),this._writeProfilerMark("_layoutCommands,StopTM"),!0},e.prototype._commandUniqueId=function(e){return c._uniqueID(e.element)},e.prototype._getVisiblePrimaryCommandsInfo=function(){for(var e=0,t=[],i=0,n=0,s=this._primaryCommands.length-1;s>=0;s--){var o=this._primaryCommands[s];o.hidden||(i=void 0===o.priority?n--:o.priority,e="none"===o.element.style.display?0:this._getCommandWidth(o),t.unshift({command:o,width:e,priority:i}))}return t},e.prototype._getVisiblePrimaryCommandsLocation=function(){this._writeProfilerMark("_getVisiblePrimaryCommandsLocation,info");for(var e=[],t=[],i=0,n=this._secondaryCommands.length>0,s=this._getVisiblePrimaryCommandsInfo(),o=s.slice(0).sort(function(e,t){return e.priority-t.priority}),r=Number.MAX_VALUE,a=this._cachedMeasurements.actionAreaContentBoxWidth,l=0,h=o.length;h>l;l++)if(a-=o[l].width,i=n||h-1>l?this._cachedMeasurements.overflowButtonWidth:0,0>a-i){r=o[l].priority-1;
break}return s.forEach(function(i){i.priority<=r?e.push(i.command):t.push(i.command)}),{actionArea:e,overflowArea:t}},e.prototype._getCommandWidth=function(e){return e.type===a.typeContent?this._cachedMeasurements.contentCommandWidths[this._commandUniqueId(e)]:e.type===a.typeSeparator?this._cachedMeasurements.separatorWidth:this._cachedMeasurements.standardCommandWidth},e.prototype._projectAsMenuCommand=function(e){var t=this,i=new h._MenuCommand(null,{label:e.label,type:(e.type===a.typeContent?a.typeFlyout:e.type)||a.typeButton,disabled:e.disabled,flyout:e.flyout,beforeInvoke:function(){t._chosenCommand=i._originalICommand,t._chosenCommand.type===a.typeToggle&&(t._chosenCommand.selected=!t._chosenCommand.selected)}});return e.selected&&(i.selected=!0),e.extraClass&&(i.extraClass=e.extraClass),e.type===a.typeContent?(i.label||(i.label=a.contentMenuCommandDefaultLabel),i.flyout=this._contentFlyout):i.onclick=e.onclick,i._originalICommand=e,i},e.prototype._hideSeparatorsIfNeeded=function(e){var t,i=a.typeSeparator,n=e.length;e.forEach(function(e){e.type===a.typeSeparator&&i===a.typeSeparator&&(e.element.style.display="none"),i=e.type});for(var s=n-1;s>=0&&(t=e[s],t.type===a.typeSeparator);s--)t.element.style.display="none"},e.prototype._clearAnimation=function(){var e=s._browserStyleEquivalents.transform.scriptName;this._dom.actionAreaContainer.style[e]="",this._dom.actionArea.style[e]="",this._dom.overflowAreaContainer.style[e]="",this._dom.overflowArea.style[e]=""},e.ClosedDisplayMode=A,e.OverflowDirection=k,e.supportedForProcessing=!0,e}();t._CommandingSurface=B,n.Class.mix(B,m.createEventProperties(a.EventNames.beforeOpen,a.EventNames.afterOpen,a.EventNames.beforeClose,a.EventNames.afterClose)),n.Class.mix(B,d.DOMEventMixin)}),n("WinJS/Controls/CommandingSurface",["require","exports"],function(e){function t(){return i||e(["./CommandingSurface/_CommandingSurface"],function(e){i=e}),i._CommandingSurface}var i=null,n=Object.create({},{_CommandingSurface:{get:function(){return t()}}});return n}),n("require-style!less/styles-toolbar",[],function(){}),n("WinJS/Controls/ToolBar/_ToolBar",["require","exports","../../Core/_Base","../ToolBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m){function p(e,t){t&&a.addClass(e,t)}function f(e,t){t&&a.removeClass(e,t)}e(["require-style!less/styles-toolbar"]);var g={get ariaLabel(){return c._getWinJSString("ui/toolbarAriaLabel").value},get overflowButtonAriaLabel(){return c._getWinJSString("ui/toolbarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The toolbar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},v={compact:"compact",full:"full"},y={};y[v.compact]=n.ClassNames.compactClass,y[v.full]=n.ClassNames.fullClass;var C=function(){function e(e,t){var i=this;if(void 0===t&&(t={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,closedDisplayMode:void 0,prevInlineWidth:void 0},this._writeProfilerMark("constructor,StartTM"),e&&e.winControl)throw new l("WinJS.UI.ToolBar.DuplicateConstruction",g.duplicateConstruction);this._initializeDom(e||d.document.createElement("div"));var r=new _.OpenCloseMachine({eventElement:this.element,onOpen:function(){var e=i._commandingSurface.createOpenAnimation(i._getClosedHeight());return i._synchronousOpen(),e.execute()},onClose:function(){var e=i._commandingSurface.createCloseAnimation(i._getClosedHeight());return e.execute().then(function(){i._synchronousClose()})},onUpdateDom:function(){i._updateDomImpl()},onUpdateDomWithIsOpened:function(e){i._isOpenedMode=e,i._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),a._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new s._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:r}),p(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),n.ClassNames.actionAreaCssClass),p(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),n.ClassNames.overflowAreaCssClass),p(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),n.ClassNames.overflowButtonCssClass),p(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),n.ClassNames.ellipsisCssClass),this._isOpenedMode=n.defaultOpened,this._dismissable=new u.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){i.close()}}),this.closedDisplayMode=n.defaultClosedDisplayMode,this.opened=this._isOpenedMode,o.setOptions(this,t),a._inDom(this.element).then(function(){return i._commandingSurface.initialized}).then(function(){r.exitInit(),i._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(e.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(e){this._commandingSurface.data=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(e){v[e]&&(this._commandingSurface.closedDisplayMode=e,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(e){this._commandingSurface.opened=e},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._commandingSurface.open()},e.prototype.close=function(){this._commandingSurface.close()},e.prototype.dispose=function(){this._disposed||(this._disposed=!0,u.hidden(this._dismissable),this._commandingSurface.dispose(),this._synchronousClose(),a._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),r.disposeSubTree(this.element))},e.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},e.prototype.getCommandById=function(e){return this._commandingSurface.getCommandById(e)},e.prototype.showOnlyCommands=function(e){return this._commandingSurface.showOnlyCommands(e)},e.prototype._writeProfilerMark=function(e){m("WinJS.UI.ToolBar:"+this._id+":"+e)},e.prototype._initializeDom=function(e){this._writeProfilerMark("_intializeDom,info"),e.winControl=this,this._id=e.id||a._uniqueID(e),a.addClass(e,n.ClassNames.controlCssClass),a.addClass(e,n.ClassNames.disposableCssClass);var t=e.getAttribute("role");t||e.setAttribute("role","menubar");var i=e.getAttribute("aria-label");i||e.setAttribute("aria-label",g.ariaLabel);var s=document.createElement("DIV");a._reparentChildren(e,s),e.appendChild(s);var o=d.document.createElement("DIV");a.addClass(o,n.ClassNames.placeHolderCssClass),r.markDisposable(o,this.dispose.bind(this)),this._dom={root:e,commandingSurfaceEl:s,placeHolder:o}},e.prototype._handleShowingKeyboard=function(){this.close()},e.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},e.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},e.prototype._updateDomImpl=function(){var e=this._updateDomImpl_renderedState;e.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),e.isOpenedMode=this._isOpenedMode),e.closedDisplayMode!==this.closedDisplayMode&&(f(this._dom.root,y[e.closedDisplayMode]),p(this._dom.root,y[this.closedDisplayMode]),e.closedDisplayMode=this.closedDisplayMode),this._commandingSurface.updateDom()},e.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var e=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,e&&this._synchronousOpen()}return this._cachedClosedHeight},e.prototype._updateDomImpl_renderOpened=function(){var e=this;this._updateDomImpl_renderedState.prevInlineWidth=this._dom.root.style.width;var t=this._dom.root.getBoundingClientRect(),i=a._getPreciseContentWidth(this._dom.root),s=a._getPreciseContentHeight(this._dom.root),o=getComputedStyle(this._dom.root),r=a._convertToPrecisePixels(o.paddingTop),l=a._convertToPrecisePixels(o.borderTopWidth),h=a._getPreciseMargins(this._dom.root),c=t.top+l+r,_=c+s,m=this._dom.placeHolder,p=m.style;p.width=t.width+"px",p.height=t.height+"px",p.marginTop=h.top+"px",p.marginRight=h.right+"px",p.marginBottom=h.bottom+"px",p.marginLeft=h.left+"px",a._maintainFocus(function(){e._dom.root.parentElement.insertBefore(m,e._dom.root),d.document.body.appendChild(e._dom.root),e._dom.root.style.width=i+"px",e._dom.root.style.left=t.left-h.left+"px";var s=0,o=d.innerHeight,r=c-s,l=o-_;r>l?(e._commandingSurface.overflowDirection=n.OverflowDirection.top,e._dom.root.style.bottom=o-t.bottom-h.bottom+"px"):(e._commandingSurface.overflowDirection=n.OverflowDirection.bottom,e._dom.root.style.top=s+t.top-h.top+"px"),a.addClass(e._dom.root,n.ClassNames.openedClass),a.removeClass(e._dom.root,n.ClassNames.closedClass)}),this._commandingSurface.synchronousOpen(),u.shown(this._dismissable)},e.prototype._updateDomImpl_renderClosed=function(){var e=this;a._maintainFocus(function(){if(e._dom.placeHolder.parentElement){var t=e._dom.placeHolder;t.parentElement.insertBefore(e._dom.root,t),t.parentElement.removeChild(t)}e._dom.root.style.top="",e._dom.root.style.right="",e._dom.root.style.bottom="",e._dom.root.style.left="",e._dom.root.style.width=e._updateDomImpl_renderedState.prevInlineWidth,a.addClass(e._dom.root,n.ClassNames.closedClass),a.removeClass(e._dom.root,n.ClassNames.openedClass)}),this._commandingSurface.synchronousClose(),u.hidden(this._dismissable)},e.ClosedDisplayMode=v,e.supportedForProcessing=!0,e}();t.ToolBar=C,i.Class.mix(C,h.createEventProperties(n.EventNames.beforeOpen,n.EventNames.afterOpen,n.EventNames.beforeClose,n.EventNames.afterClose)),i.Class.mix(C,o.DOMEventMixin)}),n("WinJS/Controls/ToolBar",["require","exports","../Core/_Base"],function(e,t,i){var n=null;i.Namespace.define("WinJS.UI",{ToolBar:{get:function(){return n||e(["./ToolBar/_ToolBar"],function(e){n=e}),n.ToolBar}}})}),n("WinJS/Controls/_LegacyAppBar/_Layouts",["exports","../../Animations/_TransitionAnimation","../../BindingList","../../Core/_BaseUtils","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Controls/ToolBar","../../Controls/ToolBar/_Constants","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../AppBar/_Command","./_Constants"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g){"use strict";o.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarBaseLayout:o.Namespace._lazy(function(){var e=g.appBarLayoutCustom,t={get nullCommand(){return"Invalid argument: command must not be null"}},i=o.Class.define(function(e,t){this._disposed=!1,t=t||{},_.setOptions(this,t),e&&this.connect(e)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||e}},commandsInOrder:{get:function(){var e=this.appBarEl.querySelectorAll("."+g.appBarCommandClass);return Array.prototype.map.call(e,function(e){return e.winControl})}},connect:function(e){this.className&&p.addClass(e,this.className),this.appBarEl=e},disconnect:function(){this.className&&p.removeClass(this.appBarEl,this.className),this.appBarEl=null,this.dispose()},layout:function(e){for(var t=e.length,i=0;t>i;i++){var n=this.sanitizeCommand(e[i]);this.appBarEl.appendChild(n._element)}},showCommands:function(e){this.appBarEl.winControl._showCommands(e)},showOnlyCommands:function(e){this.appBarEl.winControl._showOnlyCommands(e)},hideCommands:function(e){this.appBarEl.winControl._hideCommands(e)},sanitizeCommand:function(e){if(!e)throw new r("WinJS.UI.AppBar.NullCommand",t.nullCommand);return e=e.winControl||e,e._element||(e=new f.AppBarCommand(null,e)),e._element.parentElement&&e._element.parentElement.removeChild(e._element),e},dispose:function(){this._disposed=!0},disposeChildren:function(){var e=this.appBarEl.querySelectorAll("."+g.firstDivClass);e=e.length>=1?e[0]:null;var t=this.appBarEl.querySelectorAll("."+g.finalDivClass);t=t.length>=1?t[0]:null;for(var i=this.appBarEl.children,n=i.length,s=0;n>s;s++){var o=i[s];o!==e&&o!==t&&m.disposeSubTree(o)}},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){},positionChanging:function(){return u.wrap()},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar()}});return i})}),o.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarCommandsLayout:o.Namespace._lazy(function(){var t=g.commandLayoutClass,i=g.appBarLayoutCommands,n=o.Class.derive(e._AppBarBaseLayout,function(n){e._AppBarBaseLayout.call(this,n,{_className:t,_type:i}),this._commandLayoutsInit(n)},{commandsInOrder:{get:function(){return this._originalCommands.filter(function(e){return this.appBarEl.contains(e.element)},this)}},layout:function(e){p.empty(this._primaryCommands),p.empty(this._secondaryCommands),this._originalCommands=[];for(var t=0,i=e.length;i>t;t++){var n=this.sanitizeCommand(e[t]);this._originalCommands.push(n),"primary"===n.section||"global"===n.section?this._primaryCommands.appendChild(n._element):this._secondaryCommands.appendChild(n._element)}this.appBarEl.appendChild(this._secondaryCommands),this.appBarEl.appendChild(this._primaryCommands),this._needToMeasureNewCommands=!0,c.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),c.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},disposeChildren:function(){m.disposeSubTree(this._primaryCommands),m.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(e){var t=p.Key;if(!p._matchesSelector(e.target,".win-interactive, .win-interactive *")){var i="rtl"===s.getComputedStyle(this.appBarEl).direction,n=i?t.rightArrow:t.leftArrow,o=i?t.leftArrow:t.rightArrow;if(e.keyCode===n||e.keyCode===o||e.keyCode===t.home||e.keyCode===t.end){var r,a=this._primaryCommands.contains(s.document.activeElement),l=this._getFocusableCommandsInLogicalOrder(a);if(l.length)switch(e.keyCode){case n:var h=Math.max(-1,l.focusedIndex-1)+l.length;r=l[h%l.length].winControl.lastElementFocus;break;case o:var h=l.focusedIndex+1+l.length;r=l[h%l.length].winControl.firstElementFocus;break;case t.home:var h=0;r=l[h].winControl.firstElementFocus;break;case t.end:var h=l.length-1;r=l[h].winControl.lastElementFocus}r&&r!==s.document.activeElement&&(r.focus(),e.preventDefault())}}},commandsUpdated:function(e){var t=e?e:this.commandsInOrder.filter(function(e){return!e.hidden});this._fullSizeWidthOfLastKnownVisibleCommands=this._getWidthOfFullSizeCommands(t)},beginAnimateCommands:function(e,t,i){this._scaleAfterAnimations=!1;var n=this._getWidthOfFullSizeCommands(e)-this._getWidthOfFullSizeCommands(t);if(n>0){var s=i.concat(e);this.commandsUpdated(s),this.scale()}else 0>n&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.opened&&this.scale())},disconnect:function(){e._AppBarBaseLayout.prototype.disconnect.call(this)},_getWidthOfFullSizeCommands:function(e){this._needToMeasureNewCommands&&this._measureContentCommands();var t=0,i=0,n=0;if(!e)return this._fullSizeWidthOfLastKnownVisibleCommands;for(var s,o=0,r=e.length;r>o;o++)s=e[o].winControl||e[o],s._type===g.typeSeparator?i++:s._type!==g.typeContent?n++:t+=s._fullSizeWidth;return t+=i*g.separatorWidth+n*g.buttonWidth},_getFocusableCommandsInLogicalOrder:function(){var e=this._secondaryCommands.children,t=this._primaryCommands.children,i=-1,n=function(e){for(var t=[],n=0,o=e.length;o>n;n++){var r=e[n];if(p.hasClass(r,g.appBarCommandClass)&&r.winControl){var a=r.contains(s.document.activeElement);(r.winControl._isFocusable()||a)&&(t.push(r),a&&(i=t.length-1))}}return t},o=Array.prototype.slice.call(e).concat(Array.prototype.slice.call(t)),r=n(o);return r.focusedIndex=i,r},_commandLayoutsInit:function(){this._primaryCommands=s.document.createElement("DIV"),this._secondaryCommands=s.document.createElement("DIV"),p.addClass(this._primaryCommands,g.primaryCommandsClass),p.addClass(this._secondaryCommands,g.secondaryCommandsClass)},_scaleHelper:function(){var e="minimal"===this.appBarEl.winControl.closedDisplayMode?g.appBarInvokeButtonWidth:0;return s.document.documentElement.clientWidth-e},_measureContentCommands:function(){if(s.document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;var e=p.hasClass(this.appBarEl,"win-navbar-closed");p.removeClass(this.appBarEl,"win-navbar-closed");var t=this.appBarEl.style.display;this.appBarEl.style.display="";for(var i,n,o=this.appBarEl.querySelectorAll("div."+g.appBarCommandClass),r=0,a=o.length;a>r;r++)n=o[r],n.winControl&&n.winControl._type===g.typeContent&&(i=n.style.display,n.style.display="",n.winControl._fullSizeWidth=p.getTotalWidth(n)||0,n.style.display=i);this.appBarEl.style.display=t,e&&p.addClass(this.appBarEl,"win-navbar-closed"),this.commandsUpdated()}}});return n})}),o.Namespace._moduleDefine(e,"WinJS.UI",{_AppBarMenuLayout:o.Namespace._lazy(function(){function r(e,i){var o=i.duration*t._animationFactor,r=n._browserStyleEquivalents.transition.scriptName;e.style[r]=o+"ms "+y.cssName+" "+i.timing,e.style[y.scriptName]=i.to;var a;return new u(function(t){var i=function(t){t.target===e&&t.propertyName===y.cssName&&a()},l=!1;a=function(){l||(s.clearTimeout(h),e.removeEventListener(n._browserEventEquivalents.transitionEnd,i),e.style[r]="",l=!0),t()};var h=s.setTimeout(function(){h=s.setTimeout(a,o)},50);e.addEventListener(n._browserEventEquivalents.transitionEnd,i)},function(){a()})}function a(e,t,i){var n=i.anchorTrailingEdge?i.to.total-i.from.total:i.from.total-i.to.total,o="width"===i.dimension?"translateX":"translateY",a=i.dimension,l=i.duration||367,h=i.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";e.style[a]=i.to.total+"px",e.style[y.scriptName]=o+"("+n+"px)",t.style[a]=i.to.content+"px",t.style[y.scriptName]=o+"("+-n+"px)",s.getComputedStyle(e).opacity,s.getComputedStyle(t).opacity;var d={duration:l,timing:h,to:""};return u.join([r(e,d),r(t,d)])}function c(e,t,i){var o=i.anchorTrailingEdge?i.from.total-i.to.total:i.to.total-i.from.total,a="width"===i.dimension?"translateX":"translateY",l=i.duration||367,h=i.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";e.style[y.scriptName]="",t.style[y.scriptName]="",s.getComputedStyle(e).opacity,s.getComputedStyle(t).opacity;var d={duration:l,timing:h},c=n._merge(d,{to:a+"("+o+"px)"}),_=n._merge(d,{to:a+"("+-o+"px)"});return u.join([r(e,c),r(t,_)])}function _(e,t,i){return i.to.total>i.from.total?a(e,t,i):i.to.total<i.from.total?c(e,t,i):u.as()}var f=g.menuLayoutClass,v=g.appBarLayoutMenu,y=n._browserStyleEquivalents.transform,C=o.Class.derive(e._AppBarBaseLayout,function(t){e._AppBarBaseLayout.call(this,t,{_className:f,_type:v}),this._tranformNames=n._browserStyleEquivalents.transform,this._animationCompleteBound=this._animationComplete.bind(this),this._positionToolBarBound=this._positionToolBar.bind(this)},{commandsInOrder:{get:function(){return this._originalCommands}},layout:function(e){this._writeProfilerMark("layout,info"),e=e||[],this._originalCommands=[];var t=this;e.forEach(function(e){t._originalCommands.push(t.sanitizeCommand(e))}),this._displayedCommands=this._originalCommands.slice(0),this._menu?p.empty(this._menu):(this._menu=s.document.createElement("div"),p.addClass(this._menu,g.menuContainerClass)),this.appBarEl.appendChild(this._menu),this._toolbarEl=s.document.createElement("div"),this._menu.appendChild(this._toolbarEl),this._createToolBar(e)},showCommands:function(e){var t=this._getCommandsElements(e),i=[],n=[],s=this;this._originalCommands.forEach(function(e){(t.indexOf(e.element)>=0||s._displayedCommands.indexOf(e)>=0)&&(n.push(e),i.push(e))}),this._displayedCommands=n,this._updateData(i)},showOnlyCommands:function(e){this._displayedCommands=[],this.showCommands(e)},hideCommands:function(e){var t=this._getCommandsElements(e),i=[],n=[],s=this;this._originalCommands.forEach(function(e){-1===t.indexOf(e.element)&&s._displayedCommands.indexOf(e)>=0&&(n.push(e),i.push(e))}),this._displayedCommands=n,this._updateData(i)},connect:function(t){this._writeProfilerMark("connect,info"),e._AppBarBaseLayout.prototype.connect.call(this,t),this._id=p._uniqueID(t)},resize:function(){this._writeProfilerMark("resize,info"),this._initialized&&(this._forceLayoutPending=!0)},positionChanging:function(e,t){return this._writeProfilerMark("positionChanging from:"+e+" to: "+t+",info"),this._animationPromise=this._animationPromise||u.wrap(),this._animating&&this._animationPromise.cancel(),this._animating=!0,"shown"===t||"shown"!==e&&"compact"===t?(this._positionToolBar(),this._animationPromise=this._animateToolBarEntrance()):this._animationPromise="minimal"===e||"compact"===e||"hidden"===e?u.wrap():this._animateToolBarExit(),this._animationPromise.then(this._animationCompleteBound,this._animationCompleteBound),this._animationPromise},disposeChildren:function(){this._writeProfilerMark("disposeChildren,info"),this._toolbar&&m.disposeSubTree(this._toolbarEl),this._originalCommands=[],this._displayedCommands=[]},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar(!0,this._menu)},_updateData:function(e){var t=p.hasClass(this.appBarEl,"win-navbar-closed"),n=p.hasClass(this.appBarEl,"win-navbar-opened");p.removeClass(this.appBarEl,"win-navbar-closed");var s=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar.data=new i.List(e),t&&this._positionToolBar(),this.appBarEl.style.display=s,t&&p.addClass(this.appBarEl,"win-navbar-closed"),n&&(this._positionToolBar(),this._animateToolBarEntrance())},_getCommandsElements:function(e){if(!e)return[];"string"!=typeof e&&e&&e.length||(e=[e]);for(var t=[],i=0,n=e.length;n>i;i++)if(e[i])if("string"==typeof e[i]){var o=s.document.getElementById(e[i]);if(o)t.push(o);else for(var r=0,a=this._originalCommands.length;a>r;r++){var o=this._originalCommands[r].element;o.id===e[i]&&t.push(o)}}else t.push(e[i].element?e[i].element:e[i]);return t},_animationComplete:function(){this._disposed||(this._animating=!1)},_createToolBar:function(){this._writeProfilerMark("_createToolBar,info");var e=p.hasClass(this.appBarEl,"win-navbar-closed");p.removeClass(this.appBarEl,"win-navbar-closed");var t=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar=new h.ToolBar(this._toolbarEl,{data:new i.List(this._originalCommands),shownDisplayMode:"full"});var n=this;this._appbarInvokeButton=this.appBarEl.querySelector("."+g.invokeButtonClass),this._overflowButton=this._toolbarEl.querySelector("."+d.overflowButtonCssClass),this._overflowButton.addEventListener("click",function(){n._appbarInvokeButton.click()}),this._positionToolBar(),this.appBarEl.style.display=t,e&&p.addClass(this.appBarEl,"win-navbar-closed")},_positionToolBar:function(){this._disposed||(this._writeProfilerMark("_positionToolBar,info"),this._initialized=!0)},_animateToolBarEntrance:function(){this._writeProfilerMark("_animateToolBarEntrance,info"),this._forceLayoutPending&&(this._forceLayoutPending=!1,this._toolbar.forceLayout(),this._positionToolBar());var e=this._isMinimal()?0:this.appBarEl.offsetHeight;if(this._isBottom()){var t=this._menu.offsetHeight-e;return this._executeTranslate(this._menu,"translateY("+-t+"px)")}return _(this._menu,this._toolbarEl,{from:{content:e,total:e},to:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},dimension:"height",duration:400,timing:"ease-in"})},_animateToolBarExit:function(){this._writeProfilerMark("_animateToolBarExit,info");var e=this._isMinimal()?0:this.appBarEl.offsetHeight;return this._isBottom()?this._executeTranslate(this._menu,"none"):_(this._menu,this._toolbarEl,{from:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},to:{content:e,total:e},dimension:"height",duration:400,timing:"ease-in"})},_executeTranslate:function(e,i){return t.executeTransition(e,{property:this._tranformNames.cssName,delay:0,duration:400,timing:"ease-in",to:i})},_isMinimal:function(){return"minimal"===this.appBarEl.winControl.closedDisplayMode},_isBottom:function(){return"bottom"===this.appBarEl.winControl.placement},_writeProfilerMark:function(e){l("WinJS.UI._AppBarMenuLayout:"+this._id+":"+e)}});return C})})}),n("WinJS/Controls/_LegacyAppBar",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Promise","../Scheduler","../_LightDismissService","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./_LegacyAppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","./Flyout/_Overlay","../Application"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C,w,b){"use strict";n.Namespace._moduleDefine(e,"WinJS.UI",{_LegacyAppBar:n.Namespace._lazy(function(){function e(e){var i=t.document.querySelectorAll("."+v.appBarClass);if(i)for(var n=i.length,s=0;n>s;s++){var o=i[s],r=o.winControl;r&&!o.disabled&&r._manipulationChanged(e)}}var f={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},C=r._createEventProperty,w={none:0,hidden:0,minimal:25,compact:48},I={none:"hidden",hidden:"hidden",minimal:"minimal",shown:"shown",compact:"compact"},S={none:"none",minimal:"minimal",compact:"compact"},x="shown",E="hidden",P=!1,M={get ariaLabel(){return a._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get cannotChangePlacementWhenVisible(){return"Invalid argument: The placement property cannot be set when the AppBar is visible, call hide() first"},get cannotChangeLayoutWhenVisible(){return"Invalid argument: The layout property cannot be set when the AppBar is visible, call hide() first"}},T=n.Class.derive(b._Overlay,function(i,n){this._initializing=!0,n=n||{},this._element=i||t.document.createElement("div"),this._id=this._element.id||p._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),p.addClass(this._element,v.appBarClass);var s=this;this._dismissable=new c.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){s.close()},onTakeFocus:function(){s._dismissable.restoreFocus()||s._layoutImpl.setFocusOnShow()}});var o=this._element.getAttribute("role");o||this._element.setAttribute("role","menubar");var r=this._element.getAttribute("aria-label");r||this._element.setAttribute("aria-label",M.ariaLabel),this._baseOverlayConstructor(this._element),this._lastPositionVisited=I.none,p.addClass(this._element,v.hiddenClass),this._invokeButton=t.document.createElement("button"),this._invokeButton.tabIndex=0,this._invokeButton.setAttribute("type","button"),this._invokeButton.innerHTML="<span class='"+v.ellipsisClass+"'></span>",p.addClass(this._invokeButton,v.invokeButtonClass),this._element.appendChild(this._invokeButton),this._invokeButton.addEventListener("click",function(){s.opened?s._hide():s._show()},!1),this._layout=v.appBarLayoutCustom,delete n._layout,this.placement=n.placement||v.appBarPlacementBottom,this.closedDisplayMode=n.closedDisplayMode||S.compact,_.setOptions(this,n);var a=this._commandsUpdated.bind(this);return this._element.addEventListener(v.commandVisibilityChanged,function(e){s._disposed||(s.opened&&e.preventDefault(),a())}),this._initializing=!1,this._setFocusToAppBarBound=this._setFocusToAppBar.bind(this),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),P||(t.document.addEventListener("MSManipulationStateChanged",e,!1),P=!0),this.closedDisplayMode===S.none&&this.layout===v.appBarLayoutCommands&&(this._element.style.display="none"),this._winKeyboard=new g._WinKeyboard(this._element),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(e){var t=!1;if(i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),t=!0),this.opened)throw new o("WinJS.UI._LegacyAppBar.CannotChangePlacementWhenVisible",M.cannotChangePlacementWhenVisible);this._placement=e===v.appBarPlacementTop?v.appBarPlacementTop:v.appBarPlacementBottom,this._placement===v.appBarPlacementTop?(p.addClass(this._element,v.topClass),p.removeClass(this._element,v.bottomClass)):this._placement===v.appBarPlacementBottom&&(p.removeClass(this._element,v.topClass),p.addClass(this._element,v.bottomClass)),this._ensurePosition(),t&&this._show()}},_layout:{get:function(){return this._layoutImpl.type},set:function(e){e!==v.appBarLayoutCommands&&e!==v.appBarLayoutCustom&&e!==v.appBarLayoutMenu;var t=!1;if(i.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),t=!0),this.opened)throw new o("WinJS.UI._LegacyAppBar.CannotChangeLayoutWhenVisible",M.cannotChangeLayoutWhenVisible);var n;this._initializing||(n=this._layoutImpl.commandsInOrder,this._layoutImpl.disconnect()),this._layoutImpl=e===v.appBarLayoutCommands?new y._AppBarCommandsLayout:e===v.appBarLayoutMenu?new y._AppBarMenuLayout:new y._AppBarBaseLayout,this._layoutImpl.connect(this._element),n&&n.length&&this._layoutCommands(n),t&&this._show()},configurable:!0},commands:{set:function(e){if(this.opened)throw new o("WinJS.UI._LegacyAppBar.CannotChangeCommandsWhenVisible",a._formatString(b._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"_LegacyAppBar"));this._initializing||this._disposeChildren(),this._layoutCommands(e)}},_layoutCommands:function(e){p.empty(this._element),this._element.appendChild(this._invokeButton),Array.isArray(e)||(e=[e]),this._layoutImpl.layout(e)},closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(e){var t=this._closedDisplayMode;if(t!==e){var i=p.hasClass(this._element,v.hiddenClass)||p.hasClass(this._element,v.hidingClass);e===S.none?(this._closedDisplayMode=S.none,i&&t||(p.removeClass(this._element,v.minimalClass),p.removeClass(this._element,v.compactClass))):e===S.minimal?(this._closedDisplayMode=S.minimal,i&&t&&t!==S.none||(p.addClass(this._element,v.minimalClass),p.removeClass(this._element,v.compactClass))):(this._closedDisplayMode=S.compact,p.addClass(this._element,v.compactClass),p.removeClass(this._element,v.minimalClass)),this._layoutImpl.resize(),i&&this._changeVisiblePosition(I[this._closedDisplayMode])}}},opened:{get:function(){return!p.hasClass(this._element,v.hiddenClass)&&!p.hasClass(this._element,v.hidingClass)&&this._doNext!==I.minimal&&this._doNext!==I.compact&&this._doNext!==I.none},set:function(e){var t=this.opened;e&&!t?this._show():!e&&t&&this._hide()}},onbeforeopen:C(f.beforeOpen),onafteropen:C(f.afterOpen),onbeforeclose:C(f.beforeClose),onafterclose:C(f.afterClose),getCommandById:function(e){var t=this._layoutImpl.commandsInOrder.filter(function(t){return t.id===e||t.element.id===e});return 1===t.length?t[0]:0===t.length?null:t},showCommands:function(e){if(!e)throw new o("WinJS.UI._LegacyAppBar.RequiresCommands",M.requiresCommands);this._layoutImpl.showCommands(e)},hideCommands:function(e){if(!e)throw new o("WinJS.UI._LegacyAppBar.RequiresCommands",M.requiresCommands);this._layoutImpl.hideCommands(e)},showOnlyCommands:function(e){
if(!e)throw new o("WinJS.UI._LegacyAppBar.RequiresCommands",M.requiresCommands);this._layoutImpl.showOnlyCommands(e)},open:function(){this._writeProfilerMark("show,StartTM"),this._show()},_show:function(){var e=I.shown,t=null;this.disabled||!p.hasClass(this._element,v.hiddenClass)&&!p.hasClass(this._element,v.hidingClass)||(t=x),this._changeVisiblePosition(e,t),t&&(this._updateFirstAndFinalDiv(),c.shown(this._dismissable))},close:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(e){var e=e||I[this.closedDisplayMode],t=null;p.hasClass(this._element,v.hiddenClass)||p.hasClass(this._element,v.hidingClass)||(t=E),this._changeVisiblePosition(e,t)},_dispose:function(){m.disposeSubTree(this.element),c.hidden(this._dismissable),this._layoutImpl.dispose(),this.disabled=!0,this.close()},_disposeChildren:function(){this._layoutImpl.disposeChildren()},_handleKeyDown:function(e){this._invokeButton.contains(t.document.activeElement)||this._layoutImpl.handleKeyDown(e)},_visiblePixels:{get:function(){return{hidden:w.hidden,minimal:w.minimal,compact:Math.max(this._heightWithoutLabels||0,w.compact),shown:this._element.offsetHeight}}},_visiblePosition:{get:function(){return this._animating&&I[this._element.winAnimating]?this._element.winAnimating:this._lastPositionVisited}},_visible:{get:function(){return this._visiblePosition!==I.none}},_changeVisiblePosition:function(e,t){if(this._visiblePosition===e&&!this._keyboardObscured||this.disabled&&e!==I.disabled)this._afterPositionChange(null);else if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)this._doNext=e,this._afterPositionChange(null);else{this._element.winAnimating=e;var i=this._initializing?!1:!0,n=this._lastPositionVisited;this._element.style.display="";var s=e===I.hidden;this._keyboardObscured&&(s?i=!1:n=I.hidden,this._keyboardObscured=!1),t===x?this._beforeShow():t===E&&this._beforeHide(),this._ensurePosition(),this._element.style.opacity=1,this._element.style.visibility="visible",this._animationPromise=i?this._animatePositionChange(n,e):d.wrap(),this._animationPromise.then(function(){this._afterPositionChange(e,t)}.bind(this),function(){this._afterPositionChange(e,t)}.bind(this))}},_afterPositionChange:function(e,t){if(!this._disposed){if(e){e===I.minimal&&(p.addClass(this._element,v.minimalClass),p.removeClass(this._element,v.compactClass)),e===I.hidden&&this.closedDisplayMode===S.none&&(p.removeClass(this._element,v.minimalClass),p.removeClass(this._element,v.compactClass)),this._element.winAnimating="",this._lastPositionVisited=e,this._doNext===this._lastPositionVisited&&(this._doNext=""),t===E&&c.hidden(this._dismissable),e===I.hidden&&(this._element.style.visibility="hidden",this._element.style.display="none");var i=s._browserStyleEquivalents.transform.scriptName;this._element.style[i]="",t===x?this._afterShow():t===E&&this._afterHide(),u.schedule(this._checkDoNext,u.Priority.normal,this,"WinJS.UI._LegacyAppBar._checkDoNext")}this._afterPositionChangeCallBack()}},_afterPositionChangeCallBack:function(){},_beforeShow:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._layoutImpl.scale(),this.closedDisplayMode===S.compact&&(this._heightWithoutLabels=this._element.offsetHeight),p.removeClass(this._element,v.hiddenClass),p.addClass(this._element,v.showingClass),this._sendEvent(f.beforeOpen)},_afterShow:function(){p.removeClass(this._element,v.showingClass),p.addClass(this._element,v.shownClass),this._sendEvent(f.afterOpen),this._writeProfilerMark("show,StopTM")},_beforeHide:function(){p.removeClass(this._element,v.shownClass),p.addClass(this._element,v.hidingClass),this._sendEvent(f.beforeClose)},_afterHide:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),p.removeClass(this._element,v.hidingClass),p.addClass(this._element,v.hiddenClass),this._sendEvent(f.afterClose),this._writeProfilerMark("hide,StopTM")},_animatePositionChange:function(e,t){var i,n=this._layoutImpl.positionChanging(e,t),s=this._visiblePixels[e],o=this._visiblePixels[t],r=Math.abs(o-s),a=this._placement===v.appBarPlacementTop?-r:r;if(this._placement===v.appBarPlacementTop&&(e===I.shown&&t===I.compact||e===I.compact&&t===I.shown)&&(a=0),o>s){var l={top:a+"px",left:"0px"};i=h.showEdgeUI(this._element,l,{mechanism:"transition"})}else{var u={top:a+"px",left:"0px"};i=h.hideEdgeUI(this._element,u,{mechanism:"transition"})}return d.join([n,i])},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||(this._doNext===I.disabled||this._doNext===I.hidden||this._doNext===I.minimal||this._doNext===I.compact?(this._hide(this._doNext),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():this._doNext===I.shown&&(this._show(),this._doNext=""))},_setFocusToAppBar:function(e,t){this._focusOnFirstFocusableElement(e,t)||b._Overlay._trySetActive(this._element,t)},_commandsUpdated:function(){this._initializing||(this._layoutImpl.commandsUpdated(),this._layoutImpl.scale())},_beginAnimateCommands:function(e,t,i){this._layoutImpl.beginAnimateCommands(e,t,i)},_endAnimateCommands:function(){this._layoutImpl.endAnimateCommands(),this._endAnimateCommandsCallBack()},_endAnimateCommandsCallBack:function(){},_getTopOfVisualViewport:function(){return b._Overlay._keyboardInfo._visibleDocTop},_getAdjustedBottom:function(){return b._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(e){if(this._keyboardObscured=!1,this._needToHandleHidingKeyboard=!1,!b._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._needToHandleShowingKeyboard=!0,this.opened&&this._element.contains(t.document.activeElement)&&(e.ensuredFocusedElementInView=!0),this._visible&&this._placement!==v.appBarPlacementTop&&b._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var i=this;t.setTimeout(function(e){i._checkKeyboardTimer(e)},b._Overlay._keyboardInfo._animationShowLength+b._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._needToHandleShowingKeyboard=!1,this._needToHandleHidingKeyboard=!0,b._Overlay._keyboardInfo._isResized||((this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""),this._needToHandleHidingKeyboard=!1)},_resize:function(e){this._needToHandleShowingKeyboard?this._visible&&(this._placement===v.appBarPlacementTop||this._keyboardObscured||(this._element.style.display="none")):this._needToHandleHidingKeyboard&&(this._needToHandleHidingKeyboard=!1,(this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display="")),this._initializing||this._layoutImpl.resize(e)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(e){0===e.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){if(this._needToHandleShowingKeyboard)if(this._needToHandleShowingKeyboard=!1,this._keyboardObscured||this._placement===v.appBarPlacementTop&&0===b._Overlay._keyboardInfo._visibleDocTop)this._checkDoNext();else{var e=this._visiblePosition;this._lastPositionVisited=I.hidden,this._changeVisiblePosition(e,!1)}this._scrollHappened=!1},_ensurePosition:function(){var e=this._computePositionOffset();this._element.style.bottom=e.bottom,this._element.style.top=e.top},_computePositionOffset:function(){var e={};return this._placement===v.appBarPlacementBottom?(e.bottom=this._getAdjustedBottom()+"px",e.top=""):this._placement===v.appBarPlacementTop&&(e.bottom="",e.top=this._getTopOfVisualViewport()+"px"),e},_checkScrollPosition:function(){return this._needToHandleShowingKeyboard?void(this._scrollHappened=!0):void((this._visible||this._animating)&&(this._ensurePosition(),this._checkDoNext()))},_alreadyInPlace:function(){var e=this._computePositionOffset();return e.top===this._element.style.top&&e.bottom===this._element.style.bottom},_updateFirstAndFinalDiv:function(){var e=this._element.querySelectorAll("."+v.firstDivClass);e=e.length>=1?e[0]:null;var i=this._element.querySelectorAll("."+v.finalDivClass);i=i.length>=1?i[0]:null,e&&this._element.children[0]!==e&&(e.parentNode.removeChild(e),e=null),i&&this._element.children[this._element.children.length-1]!==i&&(i.parentNode.removeChild(i),i=null),e||(e=t.document.createElement("div"),e.style.display="inline",e.className=v.firstDivClass,e.tabIndex=-1,e.setAttribute("aria-hidden","true"),p._addEventListener(e,"focusin",this._focusOnLastFocusableElementOrThis.bind(this),!1),this._element.children[0]?this._element.insertBefore(e,this._element.children[0]):this._element.appendChild(e)),i||(i=t.document.createElement("div"),i.style.display="inline",i.className=v.finalDivClass,i.tabIndex=-1,i.setAttribute("aria-hidden","true"),p._addEventListener(i,"focusin",this._focusOnFirstFocusableElementOrThis.bind(this),!1),this._element.appendChild(i)),this._element.children[this._element.children.length-2]!==this._invokeButton&&this._element.insertBefore(this._invokeButton,i);var n=this._element.getElementsByTagName("*"),s=p._getHighestTabIndexInList(n);this._invokeButton.tabIndex=s,e&&(e.tabIndex=p._getLowestTabIndexInList(n)),i&&(i.tabIndex=s)},_writeProfilerMark:function(e){l("WinJS.UI._LegacyAppBar:"+this._id+":"+e)}},{_Events:f});return T})})}),n("WinJS/Controls/Menu",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./Flyout","./Flyout/_Overlay","./Menu/_Command"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{Menu:i.Namespace._lazy(function(){function e(e){var t=e.element||e;return l._matchesSelector(t,"."+u.menuClass+" ."+u.menuCommandClass)}var h=l.Key,p={get ariaLabel(){return o._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get nullCommand(){return"Invalid argument: command must not be null"}},f=i.Class.derive(c.Flyout,function(e,i){i=i||{},this._element=e||t.document.createElement("div"),this._id=this._element.id||l._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!i.commands&&this._element&&(i=n._shallowCopy(i),i.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var s=this._element?this._element.getAttribute("role"):null,o=this._element?this._element.getAttribute("aria-label"):null;this._baseFlyoutConstructor(this._element,i),(null===s||""===s||void 0===s)&&this._element.setAttribute("role","menu"),(null===o||""===o||void 0===o)&&this._element.setAttribute("aria-label",p.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!0),this._element.addEventListener(u._menuCommandInvokedEvent,this._handleCommandInvoked.bind(this),!1),this._element.addEventListener("mouseover",this._handleMouseOver.bind(this),!1),this._element.addEventListener("mouseout",this._handleMouseOut.bind(this),!1),l.addClass(this._element,u.menuClass),this._winKeyboard=new d._WinKeyboard(this._element),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(e){if(!this.hidden)throw new s("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",o._formatString(_._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));l.empty(this._element),Array.isArray(e)||(e=[e]);for(var t=e.length,i=0;t>i;i++)this._addCommand(e[i])}},getCommandById:function(e){for(var t=this.element.querySelectorAll("#"+e),i=[],n=0,s=t.length;s>n;n++)t[n].winControl&&i.push(t[n].winControl);return 1===i.length?i[0]:0===i.length?null:i},showCommands:function(e){if(!e)throw new s("WinJS.UI.Menu.RequiresCommands",p.requiresCommands);this._showCommands(e,!0)},hideCommands:function(e){if(!e)throw new s("WinJS.UI.Menu.RequiresCommands",p.requiresCommands);this._hideCommands(e,!0)},showOnlyCommands:function(e){if(!e)throw new s("WinJS.UI.Menu.RequiresCommands",p.requiresCommands);this._showOnlyCommands(e,!0)},_hide:function(){this._hoverPromise&&this._hoverPromise.cancel(),c.Flyout.prototype._hide.call(this)},_afterHide:function(){l.removeClass(this.element,u.menuMouseSpacingClass),l.removeClass(this.element,u.menuTouchSpacingClass)},_beforeShow:function(){l.hasClass(this.element,u.menuMouseSpacingClass)||l.hasClass(this.element,u.menuTouchSpacingClass)||l.addClass(this.element,c.Flyout._cascadeManager.inputType===d._InputTypes.mouse||c.Flyout._cascadeManager.inputType===d._InputTypes.keyboard?u.menuMouseSpacingClass:u.menuTouchSpacingClass),this._checkMenuCommands()},_addCommand:function(e){if(!e)throw new s("WinJS.UI.Menu.NullCommand",p.nullCommand);e._element||(e=new m.MenuCommand(null,e)),e._element.parentElement&&e._element.parentElement.removeChild(e._element),this._element.appendChild(e._element)},_dispose:function(){this._hoverPromise&&this._hoverPromise.cancel(),c.Flyout.prototype._dispose.call(this)},_commandsUpdated:function(){this.hidden||this._checkMenuCommands()},_checkMenuCommands:function(){var e=this._element.querySelectorAll(".win-command"),t=!1,i=!1;if(e)for(var n=0,s=e.length;s>n;n++){var o=e[n].winControl;o&&!o.hidden&&(t||o.type!==u.typeToggle||(t=!0),i||o.type!==u.typeFlyout||(i=!0))}l[t?"addClass":"removeClass"](this._element,u.menuContainsToggleCommandClass),l[i?"addClass":"removeClass"](this._element,u.menuContainsFlyoutCommandClass)},_handleKeyDown:function(e){e.keyCode===h.upArrow?(f._focusOnPreviousElement(this.element),e.preventDefault()):e.keyCode===h.downArrow?(f._focusOnNextElement(this.element),e.preventDefault()):e.keyCode!==h.space&&e.keyCode!==h.enter||this.element!==t.document.activeElement?e.keyCode===h.tab&&e.preventDefault():(e.preventDefault(),this.hide())},_handleFocusIn:function(t){var i=t.target;if(e(i)){var n=i.winControl;if(l.hasClass(n.element,u.menuCommandFlyoutActivatedClass))n.flyout.element.focus();else{var s=this.element.querySelector("."+u.menuCommandFlyoutActivatedClass);s&&m.MenuCommand._deactivateFlyoutCommand(s)}}else i===this.element&&c.Flyout.prototype._handleFocusIn.call(this,t)},_handleCommandInvoked:function(e){this._hoverPromise&&this._hoverPromise.cancel();var t=e.detail.command;t._type!==u.typeFlyout&&t._type!==u.typeSeparator&&this._lightDismiss()},_hoverPromise:null,_handleMouseOver:function(t){var i=t.target;if(e(i)){var n=i.winControl,s=this;i.focus&&(i.focus(),l.removeClass(i,"win-keyboard"),n.type===u.typeFlyout&&n.flyout&&n.flyout.hidden&&(this._hoverPromise=this._hoverPromise||a.timeout(u.menuCommandHoverDelay).then(function(){s.hidden||s._disposed||n._invoke(t),s._hoverPromise=null},function(){s._hoverPromise=null})))}},_handleMouseOut:function(i){var n=i.target;e(n)&&!n.contains(i.relatedTarget)&&(n===t.document.activeElement&&this.element.focus(),this._hoverPromise&&this._hoverPromise.cancel())},_writeProfilerMark:function(e){r("WinJS.UI.Menu:"+this._id+":"+e)}});return f._focusOnNextElement=function(e){var i=t.document.activeElement;do i=i===e?i.firstElementChild:i.nextElementSibling,i?i.focus():i=e;while(i!==t.document.activeElement)},f._focusOnPreviousElement=function(e){var i=t.document.activeElement;do i=i===e?i.lastElementChild:i.previousElementSibling,i?i.focus():i=e;while(i!==t.document.activeElement)},f})})}),n("WinJS/Controls/AutoSuggestBox/_SearchSuggestionManagerShim",["exports","../../_Signal","../../Core/_Base","../../Core/_BaseUtils","../../Core/_Events","../../BindingList"],function(e,t,i,n,s){"use strict";var o={reset:0,itemInserted:1,itemRemoved:2,itemChanged:3},r={Query:0,Result:1,Separator:2},a=i.Class.derive(Array,function(){},{reset:function(){this.length=0,this.dispatchEvent("vectorchanged",{collectionChange:o.reset,index:0})},insert:function(e,t){this.splice(e,0,t),this.dispatchEvent("vectorchanged",{collectionChange:o.itemInserted,index:e})},remove:function(e){this.splice(e,1),this.dispatchEvent("vectorchanged",{collectionChange:o.itemRemoved,index:e})}});i.Class.mix(a,s.eventMixin);var l=i.Class.define(function(){this._data=[]},{size:{get:function(){return this._data.length}},appendQuerySuggestion:function(e){this._data.push({kind:r.Query,text:e})},appendQuerySuggestions:function(e){e.forEach(this.appendQuerySuggestion.bind(this))},appendResultSuggestion:function(e,t,i,n,s){this._data.push({kind:r.Result,text:e,detailText:t,tag:i,imageUrl:n,imageAlternateText:s,image:null})},appendSearchSeparator:function(e){this._data.push({kind:r.Separator,text:e})}}),h=i.Class.define(function(e,t,i){this._queryText=e,this._language=t,this._linguisticDetails=i,this._searchSuggestionCollection=new l},{language:{get:function(){return this._language}},linguisticDetails:{get:function(){return this._linguisticDetails}},queryText:{get:function(){return this._queryText}},searchSuggestionCollection:{get:function(){return this._searchSuggestionCollection}},getDeferral:function(){return this._deferralSignal||(this._deferralSignal=new t)},_deferralSignal:null}),d=i.Class.define(function(){this._updateVector=this._updateVector.bind(this),this._suggestionVector=new a,this._query="",this._history={"":[]},this._dataSource=[],this.searchHistoryContext="",this.searchHistoryEnabled=!0},{addToHistory:function(e){if(e&&e.trim()){for(var t=this._history[this.searchHistoryContext],i=-1,n=0,s=t.length;s>n;n++){var o=t[n];if(o.text.toLowerCase()===e.toLowerCase()){i=n;break}}i>=0&&t.splice(i,1),t.splice(0,0,{text:e,kind:r.Query}),this._updateVector()}},clearHistory:function(){this._history[this.searchHistoryContext]=[],this._updateVector()},setLocalContentSuggestionSettings:function(){},setQuery:function(e){function t(e){i._dataSource=e,i._updateVector()}var i=this;this._query=e;var n=new h(e);this.dispatchEvent("suggestionsrequested",{request:n}),n._deferralSignal?n._deferralSignal.promise.then(t.bind(this,n.searchSuggestionCollection._data)):t(n.searchSuggestionCollection._data)},searchHistoryContext:{get:function(){return""+this._searchHistoryContext},set:function(e){e=""+e,this._history[e]||(this._history[e]=[]),this._searchHistoryContext=e}},searchHistoryEnabled:{get:function(){return this._searchHistoryEnabled},set:function(e){this._searchHistoryEnabled=e}},suggestions:{get:function(){return this._suggestionVector}},_updateVector:function(){for(this.suggestions.insert(this.suggestions.length,{text:"",kind:r.Query});this.suggestions.length>1;)this.suggestions.remove(0);var e=0,t={};if(this.searchHistoryEnabled){var i=this._query.toLowerCase();this._history[this.searchHistoryContext].forEach(function(n){var s=n.text.toLowerCase();0===s.indexOf(i)&&(this.suggestions.insert(e,n),t[s]=!0,e++)},this)}this._dataSource.forEach(function(i){i.kind===r.Query?t[i.text.toLowerCase()]||(this.suggestions.insert(e,i),e++):(this.suggestions.insert(e,i),e++)},this),this.suggestions.remove(this.suggestions.length-1)}});i.Class.mix(d,s.eventMixin),i.Namespace._moduleDefine(e,null,{_CollectionChange:o,_SearchSuggestionKind:r,_SearchSuggestionManagerShim:d})}),n("require-style!less/styles-autosuggestbox",[],function(){}),n("require-style!less/colors-autosuggestbox",[],function(){}),n("WinJS/Controls/AutoSuggestBox",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","../Animations","../BindingList","../Promise","./Repeater","./AutoSuggestBox/_SearchSuggestionManagerShim","require-style!less/styles-autosuggestbox","require-style!less/colors-autosuggestbox"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f){"use strict";u.createAccentRule("html.win-hoverable .win-autosuggestbox .win-autosuggestbox-suggestion-selected:hover",[{name:"background-color",value:u.ColorTypes.listSelectHover}]),u.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected",[{name:"background-color",value:u.ColorTypes.listSelectRest}]),u.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected.win-autosuggestbox-suggestion-selected:hover:active",[{name:"background-color",value:u.ColorTypes.listSelectPress}]);var g={asb:"win-autosuggestbox",asbDisabled:"win-autosuggestbox-disabled",asbFlyout:"win-autosuggestbox-flyout",asbFlyoutAbove:"win-autosuggestbox-flyout-above",asbBoxFlyoutHighlightText:"win-autosuggestbox-flyout-highlighttext",asbHitHighlightSpan:"win-autosuggestbox-hithighlight-span",asbInput:"win-autosuggestbox-input",asbInputFocus:"win-autosuggestbox-input-focus",asbSuggestionQuery:"win-autosuggestbox-suggestion-query",asbSuggestionResult:"win-autosuggestbox-suggestion-result",asbSuggestionResultText:"win-autosuggestbox-suggestion-result-text",asbSuggestionResultDetailedText:"win-autosuggestbox-suggestion-result-detailed-text",asbSuggestionSelected:"win-autosuggestbox-suggestion-selected",asbSuggestionSeparator:"win-autosuggestbox-suggestion-separator"};n.Namespace._moduleDefine(e,"WinJS.UI",{AutoSuggestBox:n.Namespace._lazy(function(){function e(e,i,n,s){function o(e,i,n){var s=t.document.createElement("span");return s.textContent=i,s.setAttribute("aria-hidden","true"),s.classList.add(g.asbHitHighlightSpan),e.insertBefore(s,n),s}if(n){l.query("."+g.asbHitHighlightSpan,e).forEach(function(e){e.parentNode.removeChild(e)});var r=e.firstChild,a=i.hits;!a&&s&&i.kind!==f._SearchSuggestionKind.Separator&&(a=s.find(n));for(var d=I._sortAndMergeHits(a),u=0,c=0;c<d.length;c++){var _=d[c];o(e,n.substring(u,_.startPosition),r),u=_.startPosition+_.length;var m=o(e,n.substring(_.startPosition,u),r);h.addClass(m,g.asbBoxFlyoutHighlightText)}u<n.length&&o(e,n.substring(u),r)}}function d(e){var t={ctrlKey:1,altKey:2,shiftKey:4},i=0;return e.ctrlKey&&(i|=t.ctrlKey),e.altKey&&(i|=t.altKey),e.shiftKey&&(i|=t.shiftKey),i}function u(i,n){function s(e){i._internalFocusMove=!0,i._inputElement.focus(),i._processSuggestionChosen(n,e)}var o=t.document.createElement("div"),a=new t.Image;a.style.opacity=0;var l=function(e){function t(){a.removeEventListener("load",t,!1),c.fadeIn(a)}a.addEventListener("load",t,!1),a.src=e};null!==n.image?n.image.openReadAsync().then(function(e){null!==e&&l(t.URL.createObjectURL(e,{oneTimeOnly:!0}))}):null!==n.imageUrl&&l(n.imageUrl),a.setAttribute("aria-hidden","true"),o.appendChild(a);var d=t.document.createElement("div");h.addClass(d,g.asbSuggestionResultText),e(d,n,n.text),d.title=n.text,d.setAttribute("aria-hidden","true"),o.appendChild(d);var u=t.document.createElement("br");d.appendChild(u);var _=t.document.createElement("span");h.addClass(_,g.asbSuggestionResultDetailedText),e(_,n,n.detailText),_.title=n.detailText,_.setAttribute("aria-hidden","true"),d.appendChild(_),h.addClass(o,g.asbSuggestionResult),h._addEventListener(o,"click",function(e){i._isFlyoutPointerDown||s(e)}),h._addEventListener(o,"pointerup",s),o.setAttribute("role","option");var m=r._formatString(b.ariaLabelResult,n.text,n.detailText);return o.setAttribute("aria-label",m),o}function v(i,n){function s(e){i._internalFocusMove=!0,i._inputElement.focus(),i._processSuggestionChosen(n,e)}var o=t.document.createElement("div");e(o,n,n.text),o.title=n.text,o.classList.add(g.asbSuggestionQuery),h._addEventListener(o,"click",function(e){i._isFlyoutPointerDown||s(e)}),h._addEventListener(o,"pointerup",s);var a=r._formatString(b.ariaLabelQuery,n.text);return o.setAttribute("role","option"),o.setAttribute("aria-label",a),o}function y(e){var i=t.document.createElement("div");if(e.text.length>0){var n=t.document.createElement("div");n.textContent=e.text,n.title=e.text,n.setAttribute("aria-hidden","true"),i.appendChild(n)}i.insertAdjacentHTML("beforeend","<hr/>"),h.addClass(i,g.asbSuggestionSeparator),i.setAttribute("role","separator");var s=r._formatString(b.ariaLabelSeparator,e.text);return i.setAttribute("aria-label",s),i}var C=h.Key,w={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested"},b={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get invalidSuggestionKind(){return"Error: Invalid suggestion kind."},get ariaLabel(){return r._getWinJSString("ui/autoSuggestBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return r._getWinJSString("ui/autoSuggestBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return r._getWinJSString("ui/autoSuggestBoxAriaLabelInputPlaceHolder").value},get ariaLabelQuery(){return r._getWinJSString("ui/autoSuggestBoxAriaLabelQuery").value},get ariaLabelResult(){return r._getWinJSString("ui/autoSuggestBoxAriaLabelResult").value},get ariaLabelSeparator(){return r._getWinJSString("ui/autoSuggestBoxAriaLabelSeparator").value}},I=n.Class.define(function(e,i){if(e=e||t.document.createElement("div"),i=i||{},e.winControl)throw new s("WinJS.UI.AutoSuggestBox.DuplicateConstruction",b.duplicateConstruction);this._suggestionsChangedHandler=this._suggestionsChangedHandler.bind(this),this._suggestionsRequestedHandler=this._suggestionsRequestedHandler.bind(this),this._element=e,e.winControl=this,e.classList.add(g.asb),e.classList.add("win-disposable"),this._setupDOM(),this._setupSSM(),this._chooseSuggestionOnEnter=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._flyoutOpenPromise=m.wrap(),this._lastKeyPressLanguage="",this._prevLinguisticDetails=this._getLinguisticDetails(),this._prevQueryText="",a.setOptions(this,i),this._hideFlyout()},{onresultsuggestionchosen:o._createEventProperty(w.resultsuggestionchosen),onquerychanged:o._createEventProperty(w.querychanged),onquerysubmitted:o._createEventProperty(w.querysubmitted),onsuggestionsrequested:o._createEventProperty(w.suggestionsrequested),element:{get:function(){return this._element}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(e){this._chooseSuggestionOnEnter=!!e}},disabled:{get:function(){return this._inputElement.disabled},set:function(e){this._inputElement.disabled!==!!e&&(e?this._disableControl():this._enableControl())}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(e){this._inputElement.placeholder=e,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(e){this._inputElement.value="",this._inputElement.value=e}},searchHistoryDisabled:{get:function(){return!this._suggestionManager.searchHistoryEnabled},set:function(e){this._suggestionManager.searchHistoryEnabled=!e}},searchHistoryContext:{get:function(){return this._suggestionManager.searchHistoryContext},set:function(e){this._suggestionManager.searchHistoryContext=e}},dispose:function(){this._disposed||(this._flyoutOpenPromise.cancel(),this._suggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandler),this._suggestionManager=null,this._suggestions=null,this._hitFinder=null,this._disposed=!0)},setLocalContentSuggestionSettings:function(e){this._suggestionManager.setLocalContentSuggestionSettings(e)},_setupDOM:function(){function e(e){return o._renderSuggestion(e)}var i=this._flyoutPointerReleasedHandler.bind(this),n=this._inputOrImeChangeHandler.bind(this);this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",b.ariaLabel),this._element.setAttribute("role","group"),this._inputElement=t.document.createElement("input"),this._inputElement.autocorrect="off",this._inputElement.type="search",this._inputElement.classList.add(g.asbInput),this._inputElement.classList.add("win-textbox"),this._inputElement.setAttribute("role","textbox"),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),this._inputElement.addEventListener("focus",this._inputFocusHandler.bind(this)),this._inputElement.addEventListener("blur",this._inputBlurHandler.bind(this)),this._inputElement.addEventListener("input",n),this._inputElement.addEventListener("compositionstart",n),this._inputElement.addEventListener("compositionupdate",n),this._inputElement.addEventListener("compositionend",n),h._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),this._updateInputElementAriaLabel(),this._element.appendChild(this._inputElement);var s=this._tryGetInputContext();s&&(s.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),s.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))),this._flyoutElement=t.document.createElement("div"),this._flyoutElement.classList.add(g.asbFlyout),this._flyoutElement.addEventListener("blur",this._flyoutBlurHandler.bind(this)),h._addEventListener(this._flyoutElement,"pointerup",i),h._addEventListener(this._flyoutElement,"pointercancel",i),h._addEventListener(this._flyoutElement,"pointerout",i),h._addEventListener(this._flyoutElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),this._element.appendChild(this._flyoutElement);var o=this;this._suggestionsData=new _.List,this._repeaterElement=t.document.createElement("div"),this._repeater=new p.Repeater(this._repeaterElement,{data:this._suggestionsData,template:e}),h._ensureId(this._repeaterElement),this._repeaterElement.setAttribute("role","listbox"),this._repeaterElement.setAttribute("aria-live","polite"),this._flyoutElement.appendChild(this._repeaterElement)},_setupSSM:function(){this._suggestionManager=new f._SearchSuggestionManagerShim,this._suggestions=this._suggestionManager.suggestions,this._suggestions.addEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandler)},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutElement.style.display="none")},_showFlyout:function(){var e=this._prevNumSuggestions||0;if(this._prevNumSuggestions=this._suggestionsData.length,(!this._isFlyoutShown()||e!==this._suggestionsData.length)&&0!==this._suggestionsData.length){this._flyoutElement.style.display="block";var i=this._inputElement.getBoundingClientRect(),n=this._flyoutElement.getBoundingClientRect(),s=t.document.documentElement.clientWidth,o=i.top,r=t.document.documentElement.clientHeight-i.bottom;this._flyoutBelowInput=r>=o,this._flyoutBelowInput?(this._flyoutElement.classList.remove(g.asbFlyoutAbove),this._flyoutElement.scrollTop=0):(this._flyoutElement.classList.add(g.asbFlyoutAbove),this._flyoutElement.scrollTop=this._flyoutElement.scrollHeight-this._flyoutElement.clientHeight),this._addFlyoutIMEPaddingIfRequired();var a;a="rtl"===t.getComputedStyle(this._flyoutElement).direction?i.right-n.width>=0||i.left+n.width>s:i.left+n.width>s&&i.right-n.width>=0,this._flyoutElement.style.left=a?i.width-n.width-this._element.clientLeft+"px":"-"+this._element.clientLeft+"px",this._flyoutElement.style.touchAction=this._flyoutElement.scrollHeight>n.height?"pan-y":"none",this._flyoutOpenPromise.cancel();var l=this._flyoutBelowInput?"WinJS-flyoutBelowASB-showPopup":"WinJS-flyoutAboveASB-showPopup";this._flyoutOpenPromise=c.showPopup(this._flyoutElement,{top:"0px",left:"0px",keyframe:l})}},_addFlyoutIMEPaddingIfRequired:function(){var e=this._tryGetInputContext();if(e&&this._isFlyoutShown()&&this._flyoutBelowInput){var t=this._flyoutElement.getBoundingClientRect(),i=e.getCandidateWindowClientRect(),n=this._inputElement.getBoundingClientRect(),s=n.bottom,o=n.bottom+t.height;if(!(i.top>o||i.bottom<s)){var r=c.createRepositionAnimation(this._flyoutElement);i.width<.45*n.width?this._flyoutElement.style.marginLeft=i.width+"px":this._flyoutElement.style.marginTop=i.bottom-i.top+4+"px",
r.execute()}}},_findNextSuggestionElementIndex:function(e){for(var t=0>e?0:e+1,i=t;i<this._suggestionsData.length;i++)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_findPreviousSuggestionElementIndex:function(e){for(var t=e>=this._suggestionsData.length?this._suggestionsData.length-1:e-1,i=t;i>=0;i--)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_isFlyoutShown:function(){return"none"!==this._flyoutElement.style.display},_isSuggestionSelectable:function(e){return e.kind===f._SearchSuggestionKind.Query||e.kind===f._SearchSuggestionKind.Result},_processSuggestionChosen:function(e,t){this.queryText=e.text,e.kind===f._SearchSuggestionKind.Query?this._submitQuery(e.text,!1,t):e.kind===f._SearchSuggestionKind.Result&&this._fireEvent(w.resultsuggestionchosen,{tag:e.tag,keyModifiers:d(t),storageFile:null}),this._hideFlyout()},_selectSuggestionAtIndex:function(e){function t(e){var t=i._flyoutElement.getBoundingClientRect().bottom-i._flyoutElement.getBoundingClientRect().top;if(e.offsetTop+e.offsetHeight>i._flyoutElement.scrollTop+t){var n=e.offsetTop+e.offsetHeight-(i._flyoutElement.scrollTop+t);h._zoomTo(i._flyoutElement,{contentX:0,contentY:i._flyoutElement.scrollTop+n,viewportX:0,viewportY:0})}else e.offsetTop<i._flyoutElement.scrollTop&&h._zoomTo(i._flyoutElement,{contentX:0,contentY:e.offsetTop,viewportX:0,viewportY:0})}for(var i=this,n=null,s=0;s<this._suggestionsData.length;s++)n=this._repeater.elementFromIndex(s),s!==e?(n.classList.remove(g.asbSuggestionSelected),n.setAttribute("aria-selected","false")):(n.classList.add(g.asbSuggestionSelected),t(n),n.setAttribute("aria-selected","true"));this._currentSelectedIndex=e,n?this._inputElement.setAttribute("aria-activedescendant",this._repeaterElement.id+e):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_updateFakeFocus:function(){var e;e=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(e)},_updateQueryTextWithSuggestionText:function(e){e>=0&&e<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(e).text)},_disableControl:function(){this._isFlyoutShown()&&this._hideFlyout(),this._element.disabled=!0,this._element.classList.add(g.asbDisabled),this._inputElement.disabled=!0},_enableControl:function(){this._element.disabled=!1,this._element.classList.remove(g.asbDisabled),this._inputElement.disabled=!1,t.document.activeElement===this._element&&h._setActive(this._inputElement)},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,i),this._element.dispatchEvent(n)},_getLinguisticDetails:function(e,t){function n(e,t,n,s,o){for(var r=null,a=[],l=0;l<e.length;l++)a[l]=s+e[l]+o;if(i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails)try{r=new i.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(a,t,n)}catch(h){}return r||(r={queryTextAlternatives:a,queryTextCompositionStart:t,queryTextCompositionLength:n}),r}var s=null;if(this._inputElement.value===this._prevQueryText&&e&&this._prevLinguisticDetails&&t)s=this._prevLinguisticDetails;else{var o=[],r=0,a=0,l="",h="";if(t){var d=this._tryGetInputContext();d&&d.getCompositionAlternatives&&(o=d.getCompositionAlternatives(),r=d.compositionStartOffset,a=d.compositionEndOffset-d.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||a>0?(l=this._inputElement.value.substring(0,r),h=this._inputElement.value.substring(r+a)):(l=this._inputElement.value.substring(0,this._prevCompositionStart),h=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength)))}s=n(o,r,a,l,h)}return s},_isElementInSearchControl:function(e){return this.element.contains(e)||this.element===e},_renderSuggestion:function(e){var t=null;if(!e)return t;if(e.kind===f._SearchSuggestionKind.Query)t=v(this,e);else if(e.kind===f._SearchSuggestionKind.Separator)t=y(e);else{if(e.kind!==f._SearchSuggestionKind.Result)throw new s("WinJS.UI.AutoSuggestBox.invalidSuggestionKind",b.invalidSuggestionKind);t=u(this,e)}return t},_shouldIgnoreInput:function(){var e=this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey;return e||this._isFlyoutPointerDown},_submitQuery:function(e,t,n){this._disposed||(i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(w.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,t),queryText:e,keyModifiers:d(n)}),this._suggestionManager&&this._suggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_tryGetInputContext:function(){if(this._inputElement.msGetInputContext)try{return this._inputElement.msGetInputContext()}catch(e){return null}return null},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?r._formatString(b.ariaLabelInputPlaceHolder,this._inputElement.placeholder):b.ariaLabelInputNoPlaceHolder)},_flyoutBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)?this._internalFocusMove=!0:(this._element.classList.remove(g.asbInputFocus),this._hideFlyout())},_flyoutPointerDownHandler:function(e){function t(){if(n)for(var e=0;e<i._suggestionsData.length;e++)if(i._repeater.elementFromIndex(e)===n)return e;return-1}var i=this,n=e.target;for(this._isFlyoutPointerDown=!0;n&&n.parentNode!==this._repeaterElement;)n=n.parentNode;var s=t();s>=0&&s<this._suggestionsData.length&&this._currentFocusedIndex!==s&&this._isSuggestionSelectable(this._suggestionsData.getAt(s))&&(this._currentFocusedIndex=s,this._selectSuggestionAtIndex(s),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),e.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var e=c.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",e.execute()}},_inputBlurHandler:function(){this._isElementInSearchControl(t.document.activeElement)||(this._element.classList.remove(g.asbInputFocus),this._hideFlyout()),this.queryText=this._prevQueryText,this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_inputFocusHandler:function(e){this._inputElement.value!==this._prevQueryText&&i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):null),e.target!==this._inputElement||this._internalFocusMove||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),this._internalFocusMove=!1,this._element.classList.add(g.asbInputFocus)},_inputOrImeChangeHandler:function(){function e(e){var i=!1;return(t._prevLinguisticDetails.queryTextCompositionStart!==e.queryTextCompositionStart||t._prevLinguisticDetails.queryTextCompositionLength!==e.queryTextCompositionLength||t._prevLinguisticDetails.queryTextAlternatives.length!==e.queryTextAlternatives.length)&&(i=!0),t._prevLinguisticDetails=e,i}var t=this;if(!this._shouldIgnoreInput()){var n=this._getLinguisticDetails(!1,!0),e=e(n);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||n.queryTextCompositionLength>0)&&(this._prevCompositionStart=n.queryTextCompositionStart,this._prevCompositionLength=n.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!e)return;this._prevQueryText=this._inputElement.value,i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag),i.Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new i.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):null),this._fireEvent(w.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:n}),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,n)}},_inputPointerDownHandler:function(){t.document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_keyDownHandler:function(e){function t(t){i._currentFocusedIndex=t,i._selectSuggestionAtIndex(t),e.preventDefault(),e.stopPropagation()}var i=this;if(this._lastKeyPressLanguage=e.locale,e.keyCode===C.tab?this._isProcessingTabKey=!0:e.keyCode===C.upArrow?this._isProcessingUpKey=!0:e.keyCode===C.downArrow?this._isProcessingDownKey=!0:e.keyCode===C.enter&&"ko"===e.locale&&(this._isProcessingEnterKey=!0),e.keyCode!==C.IME)if(e.keyCode===C.tab){var n=!0;e.shiftKey?-1!==this._currentFocusedIndex&&(t(-1),n=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._flyoutBelowInput?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!==this._currentFocusedIndex&&(t(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),n=!1)),n&&this._hideFlyout()}else if(e.keyCode===C.escape)-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,t(-1)):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),e.preventDefault(),e.stopPropagation());else if(this._flyoutBelowInput&&e.keyCode===C.upArrow||!this._flyoutBelowInput&&e.keyCode===C.downArrow){var s;-1!==this._currentSelectedIndex?(s=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===s&&(this.queryText=this._prevQueryText)):s=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),t(s),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else if(this._flyoutBelowInput&&e.keyCode===C.downArrow||!this._flyoutBelowInput&&e.keyCode===C.upArrow){var o=this._findNextSuggestionElementIndex(this._currentSelectedIndex);-1!==this._currentSelectedIndex&&-1===o&&(this.queryText=this._prevQueryText),t(o),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else e.keyCode===C.enter&&(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,e):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),e),this._hideFlyout())},_keyUpHandler:function(e){e.keyCode===C.tab?this._isProcessingTabKey=!1:e.keyCode===C.upArrow?this._isProcessingUpKey=!1:e.keyCode===C.downArrow?this._isProcessingDownKey=!1:e.keyCode===C.enter&&(this._isProcessingEnterKey=!1)},_keyPressHandler:function(e){this._lastKeyPressLanguage=e.locale},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var e=c.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",e.execute()}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_suggestionsChangedHandler:function(i){var n=i.collectionChange||i.detail.collectionChange,s=+i.index===i.index?i.index:i.detail.index,o=f._CollectionChange;if(n===o.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(n===o.itemInserted){var r=this._suggestions[s];this._suggestionsData.splice(s,0,r),this._showFlyout()}else if(n===o.itemRemoved)1===this._suggestionsData.length&&(h._setActive(this._inputElement),this._hideFlyout()),this._suggestionsData.splice(s,1);else if(n===o.itemChanged){var r=this._suggestions[s];if(r!==this._suggestionsData.getAt(s))this._suggestionsData.setAt(s,r);else{var a=this._repeater.elementFromIndex(s);if(h.hasClass(a,g.asbSuggestionQuery))e(a,r,r.text);else{var l=a.querySelector("."+g.asbSuggestionResultText);if(l){e(l,r,r.text);var d=a.querySelector("."+g.asbSuggestionResultDetailedText);d&&e(d,r,r.detailText)}}}}t.document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(e){i.Windows.Globalization.Language&&(this._lastKeyPressLanguage=i.Windows.Globalization.Language.currentInputMethodLanguageTag);var t,n=e.request||e.detail.request;this._fireEvent(w.suggestionsrequested,{setPromise:function(e){t=n.getDeferral(),e.then(function(){t.complete()})},searchSuggestionCollection:n.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})}},{createResultSuggestionImage:function(e){return i.Windows.Foundation.Uri&&i.Windows.Storage.Streams.RandomAccessStreamReference?i.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new i.Windows.Foundation.Uri(e)):e},_EventNames:w,_sortAndMergeHits:function(e){function t(e,t){var i=0;return e.startPosition<t.startPosition?i=-1:e.startPosition>t.startPosition&&(i=1),i}function i(e,t,i){if(0===i)e.push(t);else{var n=e[e.length-1],s=n.startPosition+n.length;if(t.startPosition<=s){var o=t.startPosition+t.length;o>s&&(n.length=o-n.startPosition)}else e.push(t)}return e}var n=[];if(e){for(var s=new Array(e.length),o=0;o<e.length;o++)s.push({startPosition:e[o].startPosition,length:e[o].length});s.sort(t),s.reduce(i,n)}return n}});return n.Class.mix(I,a.DOMEventMixin),I})}),e.ClassNames=g}),n("require-style!less/styles-searchbox",[],function(){}),n("require-style!less/colors-searchbox",[],function(){}),n("WinJS/Controls/SearchBox",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","./AutoSuggestBox","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","./AutoSuggestBox/_SearchSuggestionManagerShim","../Application","require-style!less/styles-searchbox","require-style!less/colors-searchbox"],function(e,t,i,n,s,o,r,a,l,h,d,u){"use strict";a.createAccentRule("html.win-hoverable .win-searchbox-button:not(.win-searchbox-button-disabled):hover",[{name:"color",value:a.ColorTypes.accent}]),a.createAccentRule(".win-searchbox-button.win-searchbox-button:not(.win-searchbox-button-disabled):hover:active",[{name:"background-color",value:a.ColorTypes.accent}]),i.Namespace.define("WinJS.UI",{SearchBox:i.Namespace._lazy(function(){var n={searchBox:"win-searchbox",searchBoxDisabled:"win-searchbox-disabled",searchBoxInput:"win-searchbox-input",searchBoxInputFocus:"win-searchbox-input-focus",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxFlyoutHighlightText:"win-searchbox-flyout-highlighttext",searchBoxHitHighlightSpan:"win-searchbox-hithighlight-span",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionResultText:"win-searchbox-suggestion-result-text",searchBoxSuggestionResultDetailedText:"win-searchbox-suggestion-result-detailed-text",searchBoxSuggestionSelected:"win-searchbox-suggestion-selected",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxButtonInputFocus:"win-searchbox-button-input-focus",searchBoxButtonDisabled:"win-searchbox-button-disabled"},s={receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},a={get invalidSearchBoxSuggestionKind(){return"Error: Invalid search suggestion kind."},get ariaLabel(){return o._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return o._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return o._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value},get searchBoxDeprecated(){return"SearchBox is deprecated and may not be available in future releases. Instead use AutoSuggestBox."}},c=i.Class.derive(r.AutoSuggestBox,function(t,i){h._deprecated(a.searchBoxDeprecated),this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._buttonElement=e.document.createElement("div"),this._focusOnKeyboardInput=!1,r.AutoSuggestBox.call(this,t,i),this.element.classList.add(n.searchBox),this._flyoutElement.classList.add(n.searchBoxFlyout),this._inputElement.classList.add(n.searchBoxInput),this._inputElement.addEventListener("blur",this._searchboxInputBlurHandler.bind(this)),this._inputElement.addEventListener("focus",this._searchboxInputFocusHandler.bind(this)),this._buttonElement.tabIndex=-1,this._buttonElement.classList.add(n.searchBoxButton),this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),h._addEventListener(this._buttonElement,"pointerdown",this._buttonPointerDownHandler.bind(this)),this.element.appendChild(this._buttonElement)},{focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(e){this._focusOnKeyboardInput&&!e?u._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&e&&u._applicationListener.addEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._focusOnKeyboardInput=!!e}},dispose:function(){this._disposed||(r.AutoSuggestBox.prototype.dispose.call(this),this._focusOnKeyboardInput&&u._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind))},_disableControl:function(){r.AutoSuggestBox.prototype._disableControl.call(this),this._buttonElement.disabled=!0,this._buttonElement.classList.add(n.searchBoxButtonDisabled),this.element.classList.add(n.searchBoxDisabled)},_enableControl:function(){r.AutoSuggestBox.prototype._enableControl.call(this),this._buttonElement.disabled=!1,this._buttonElement.classList.remove(n.searchBoxButtonDisabled),this.element.classList.remove(n.searchBoxDisabled)},_renderSuggestion:function(e){var t=r.AutoSuggestBox.prototype._renderSuggestion.call(this,e);if(e.kind===d._SearchSuggestionKind.Query)t.classList.add(n.searchBoxSuggestionQuery);else if(e.kind===d._SearchSuggestionKind.Separator)t.classList.add(n.searchBoxSuggestionSeparator);else{t.classList.add(n.searchBoxSuggestionResult);var i=t.querySelector("."+r.ClassNames.asbSuggestionResultText);i.classList.add(n.searchBoxSuggestionResultText);var s=t.querySelector("."+r.ClassNames.asbSuggestionResultDetailedText);s.classList.add(n.searchBoxSuggestionResultDetailedText);for(var o=t.querySelectorAll("."+r.ClassNames.asbHitHighlightSpan),a=0,l=o.length;l>a;a++)o[a].classList.add(n.searchBoxHitHighlightSpan);for(var h=t.querySelectorAll("."+r.ClassNames.asbBoxFlyoutHighlightText),a=0,l=h.length;l>a;a++)h[a].classList.add(n.searchBoxFlyoutHighlightText)}return t},_selectSuggestionAtIndex:function(e){r.AutoSuggestBox.prototype._selectSuggestionAtIndex.call(this,e);var t=this.element.querySelector("."+n.searchBoxSuggestionSelected);t&&t.classList.remove(n.searchBoxSuggestionSelected);var i=this.element.querySelector("."+r.ClassNames.asbSuggestionSelected);i&&i.classList.add(n.searchBoxSuggestionSelected)},_shouldIgnoreInput:function(){var e=r.AutoSuggestBox.prototype._shouldIgnoreInput(),t=h._matchesSelector(this._buttonElement,":active");return e||t},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?o._formatString(a.ariaLabelInputPlaceHolder,this._inputElement.placeholder):a.ariaLabelInputNoPlaceHolder)},_buttonPointerDownHandler:function(e){this._inputElement.focus(),e.preventDefault()},_buttonClickHandler:function(e){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,e),this._hideFlyout()},_searchboxInputBlurHandler:function(){h.removeClass(this.element,n.searchBoxInputFocus),h.removeClass(this._buttonElement,n.searchBoxButtonInputFocus)},_searchboxInputFocusHandler:function(){h.addClass(this.element,n.searchBoxInputFocus),h.addClass(this._buttonElement,n.searchBoxButtonInputFocus)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(s.receivingfocusonkeyboardinput,null),e.document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(t){}}},{createResultSuggestionImage:function(e){return h._deprecated(a.searchBoxDeprecated),t.Windows.Foundation.Uri&&t.Windows.Storage.Streams.RandomAccessStreamReference?t.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new t.Windows.Foundation.Uri(e)):e},_getKeyModifiers:function(e){var t={ctrlKey:1,altKey:2,shiftKey:4},i=0;return e.ctrlKey&&(i|=t.ctrlKey),e.altKey&&(i|=t.altKey),e.shiftKey&&(i|=t.shiftKey),i},_isTypeToSearchKey:function(e){return e.shiftKey||e.ctrlKey||e.altKey?!1:!0}});return i.Class.mix(c,l.DOMEventMixin),c})})}),n("WinJS/Controls/SettingsFlyout",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Pages","../Promise","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g){"use strict";i.Namespace.define("WinJS.UI",{SettingsFlyout:i.Namespace._lazy(function(){function n(){if(t.Windows.UI.ApplicationSettings.SettingsEdgeLocation){var e=t.Windows.UI.ApplicationSettings;return e.SettingsPane.edge===e.SettingsEdgeLocation.left}return!1}function p(e,t){for(var i,n,s=e.querySelectorAll("."+f.settingsFlyoutClass),o=0;o<s.length;o++)if(n=s[o].winControl){if(n.settingsCommandId===t){i=n;break}s[o].id===t&&(i=i||n)}return i}var v,y=_.Key,C=o._createEventProperty,w="narrow",b="wide",I=i.Class.derive(g._Overlay,function(t,i){_._deprecated(x.settingsFlyoutIsDeprecated),this._element=t||e.document.createElement("div"),this._id=this._element.id||_._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,i),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._element.style.visibilty="hidden",this._element.style.display="none",_.addClass(this._element,f.settingsFlyoutClass);var n=this;this._dismissable=new u.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){n.hide()},onTakeFocus:function(e){if(!n._dismissable.restoreFocus()){var t=n.element.querySelector("."+f.firstDivClass);t&&(t.msSettingsFlyoutFocusOut||(_._addEventListener(t,"focusout",function(){v=1},!1),t.msSettingsFlyoutFocusOut=!0),v=0,_._tryFocus(t,e))}}}),m.query("div.win-content",this._element).forEach(function(e){_._matchesSelector(e,".win-ui-dark, .win-ui-dark *")||_.addClass(e,f.flyoutLightClass)});var s=this._element.getAttribute("role");(null===s||""===s||void 0===s)&&this._element.setAttribute("role","dialog");var o=this._element.getAttribute("aria-label");(null===o||""===o||void 0===o)&&this._element.setAttribute("aria-label",x.ariaLabel),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(e){_._deprecated(x.widthDeprecationMessage),e!==this._width&&(this._width===w?_.removeClass(this._element,f.narrowClass):this._width===b&&_.removeClass(this._element,f.wideClass),this._width=e,this._width===w?_.addClass(this._element,f.narrowClass):this._width===b&&_.addClass(this._element,f.wideClass))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(e){this._settingsCommandId=e}},disabled:{get:function(){return!!this._element.disabled},set:function(e){e=!!e;var t=!!this._element.disabled;t!==e&&(this._element.disabled=e,!this.hidden&&this._element.disabled&&this._dismiss())}},onbeforeshow:C(g._Overlay.beforeShow),onaftershow:C(g._Overlay.afterShow),onbeforehide:C(g._Overlay.beforeHide),onafterhide:C(g._Overlay.afterHide),show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){u.hidden(this._dismissable),c.disposeSubTree(this.element),this._dismiss()},_show:function(){if(this._baseShow()){if(!_.hasClass(this.element.children[0],f.firstDivClass)){var e=this.element.querySelectorAll("."+f.firstDivClass);e&&e.length>0&&e.item(0).parentNode.removeChild(e.item(0)),this._addFirstDiv()}if(!_.hasClass(this.element.children[this.element.children.length-1],f.finalDivClass)){var t=this.element.querySelectorAll("."+f.finalDivClass);t&&t.length>0&&t.item(0).parentNode.removeChild(t.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel(),u.shown(this._dismissable)}},_setBackButtonsAriaLabel:function(){for(var e,t=this.element.querySelectorAll(".win-backbutton"),i=0;i<t.length;i++)e=t[i].getAttribute("aria-label"),(null===e||""===e||void 0===e)&&t[i].setAttribute("aria-label",x.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()},_beforeEndHide:function(){u.hidden(this._dismissable)},_animateSlideIn:function(){var e=n(),t=e?"-100px":"100px";m.query("div.win-content",this._element).forEach(function(e){l.enterPage(e,{left:t})});var i,s=this._element.offsetWidth;return e?(i={top:"0px",left:"-"+s+"px"},this._element.style.right="auto",this._element.style.left="0px"):(i={top:"0px",left:s+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",l.showPanel(this._element,i)},_animateSlideOut:function(){var e,t=this._element.offsetWidth;return n()?(e={top:"0px",left:t+"px"},this._element.style.right="auto",this._element.style.left="-"+t+"px"):(e={top:"0px",left:"-"+t+"px"},this._element.style.right="-"+t+"px",this._element.style.left="auto"),l.showPanel(this._element,e)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(e){this._fragDiv=e}},_unloadPage:function(t){var i=t.currentTarget.winControl;i.removeEventListener(g._Overlay.afterHide,this._unloadPage,!1),d.as().then(function(){i._fragmentDiv&&(e.document.body.removeChild(i._fragmentDiv),i._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(g._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(t){if(t.keyCode!==y.space&&t.keyCode!==y.enter||this.children[0]!==e.document.activeElement){if(t.shiftKey&&t.keyCode===y.tab&&this.children[0]===e.document.activeElement){t.preventDefault(),t.stopPropagation();for(var i=this.getElementsByTagName("*"),n=i.length-2;n>=0&&(i[n].focus(),i[n]!==e.document.activeElement);n--);}}else t.preventDefault(),t.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var t=e.document.activeElement;if(v&&t&&_.hasClass(t,f.firstDivClass)){var i=this.parentElement.getElementsByTagName("*");if(!(i.length<=2)){var n,s=i[i.length-1].tabIndex;if(s){for(n=i.length-2;n>0;n--)if(i[n].tabIndex===s){i[n].focus();break}}else for(n=i.length-2;n>0&&("DIV"===i[n].tagName&&null===i[n].getAttribute("tabIndex")||(i[n].focus(),i[n]!==e.document.activeElement));n--);}}},_focusOnFirstFocusableElementFromParent:function(){var t=e.document.activeElement;if(t&&_.hasClass(t,f.finalDivClass)){var i=this.parentElement.getElementsByTagName("*");if(!(i.length<=2)){var n,s=i[0].tabIndex;if(s){for(n=1;n<i.length-1;n++)if(i[n].tabIndex===s){i[n].focus();break}}else for(n=1;n<i.length-1&&("DIV"===i[n].tagName&&null===i[n].getAttribute("tabIndex")||(i[n].focus(),i[n]!==e.document.activeElement));n++);}}},_addFirstDiv:function(){for(var t=this._element.getElementsByTagName("*"),i=0,n=0;n<t.length;n++)0<t[n].tabIndex&&(0===i||t[n].tabIndex<i)&&(i=t[n].tabIndex);var s=e.document.createElement("div");s.className=f.firstDivClass,s.style.display="inline",s.setAttribute("role","menuitem"),s.setAttribute("aria-hidden","true"),s.tabIndex=i,_._addEventListener(s,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(s,this._element.children[0]):this._element.appendChild(s)},_addFinalDiv:function(){for(var t=this._element.getElementsByTagName("*"),i=0,n=0;n<t.length;n++)t[n].tabIndex>i&&(i=t[n].tabIndex);var s=e.document.createElement("div");s.className=f.finalDivClass,s.style.display="inline",s.setAttribute("role","menuitem"),s.setAttribute("aria-hidden","true"),s.tabIndex=i,_._addEventListener(s,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(s)},_writeProfilerMark:function(e){a("WinJS.UI.SettingsFlyout:"+this._id+":"+e)}});I.show=function(){t.Windows.UI.ApplicationSettings.SettingsPane&&t.Windows.UI.ApplicationSettings.SettingsPane.show();for(var i=e.document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),n=i.length,s=0;n>s;s++){var o=i[s].winControl;o&&o._dismiss()}};var S={event:void 0};I.populateSettings=function(e){if(S.event=e.detail,S.event.applicationcommands){var i=t.Windows.UI.ApplicationSettings;Object.keys(S.event.applicationcommands).forEach(function(e){var t=S.event.applicationcommands[e];t.title||(t.title=e);var n=new i.SettingsCommand(e,t.title,I._onSettingsCommand);S.event.e.request.applicationCommands.append(n)})}},I._onSettingsCommand=function(e){var t=e.id;S.event.applicationcommands&&S.event.applicationcommands[t]&&I.showSettings(t,S.event.applicationcommands[t].href)},I.showSettings=function(t,i){var n=p(e.document,t);if(n)n.show();else{if(!i)throw new s("WinJS.UI.SettingsFlyout.BadReference",x.badReference);var o=e.document.createElement("div");o=e.document.body.appendChild(o),h.render(i,o).then(function(){n=p(o,t),n?(n._fragmentDiv=o,n.show()):e.document.body.removeChild(o)})}};var x={get ariaLabel(){return r._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return"Invalid argument: Invalid href to settings flyout fragment"},get backbuttonAriaLabel(){return r._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return"SettingsFlyout.width may be altered or unavailable in future versions. Instead, style the CSS width property on elements with the .win-settingsflyout class."},get settingsFlyoutIsDeprecated(){return"SettingsFlyout is deprecated and may not be available in future releases. Instead, put settings on their own page within the app."}};return I})})}),n("WinJS/Controls/NavBar/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Navigation","../../Utilities/_Control","../../Utilities/_ElementUtilities","../AppBar/_Icon"],function(e,t,i,n,s,o,r,a,l,h){"use strict";i.Namespace._moduleDefine(e,"WinJS.UI",{_WinPressed:i.Namespace._lazy(function(){var e=i.Class.define(function(e){this._element=e,l._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(i){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),i.isPrimary&&(this._pointerId&&this._resetPointer(),l._matchesSelector(i.target,".win-interactive, .win-interactive *")||(this._pointerId=i.pointerId,l._addEventListener(t,"pointerup",this._pointerUpBound,!0),l._addEventListener(t,"pointercancel",this._pointerCancelBound),l._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),l._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),
l.addClass(this._element,e.winPressed)))},_MSPointerOverHandler:function(t){this._pointerId===t.pointerId&&l.addClass(this._element,e.winPressed)},_MSPointerOutHandler:function(t){this._pointerId===t.pointerId&&l.removeClass(this._element,e.winPressed)},_MSPointerCancelHandler:function(e){this._pointerId===e.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(e){this._pointerId===e.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,l._removeEventListener(t,"pointerup",this._pointerUpBound,!0),l._removeEventListener(t,"pointercancel",this._pointerCancelBound,!0),l._removeEventListener(this._element,"pointerover",this._pointerOverBound,!0),l._removeEventListener(this._element,"pointerout",this._pointerOutBound,!0),l.removeClass(this._element,e.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return e}),NavBarCommand:i.Namespace._lazy(function(){var s=l.Key,d={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},u=i.Class.define(function(e,i){if(e=e||t.document.createElement("DIV"),i=i||{},e.winControl)throw new n("WinJS.UI.NavBarCommand.DuplicateConstruction",d.duplicateConstruction);e.winControl=this,this._element=e,l.addClass(this.element,u._ClassName.navbarcommand),l.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),e.addEventListener("keydown",this._keydownHandler.bind(this)),a.setOptions(this,i)},{element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(e){this._label=e,this._labelEl.textContent=e}},tooltip:{get:function(){return this._tooltip},set:function(e){this._tooltip=e,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(e){this._icon=h[e]||e,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},location:{get:function(){return this._location},set:function(e){this._location=e}},state:{get:function(){return this._state},set:function(e){this._state=e}},splitButton:{get:function(){return this._split},set:function(e){this._split=e,this._splitButtonEl.style.display=this._split?"":"none"}},splitOpened:{get:function(){return this._splitOpened},set:function(e){this._splitOpened!==!!e&&this._toggleSplit()}},_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(l.addClass(this._splitButtonEl,u._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","true")):(l.removeClass(this._splitButtonEl,u._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(u._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===t.getComputedStyle(this.element).direction}},_keydownHandler:function(e){if(!l._matchesSelector(e.target,".win-interactive, .win-interactive *")){var t=this._rtl?s.rightArrow:s.leftArrow,i=this._rtl?s.leftArrow:s.rightArrow;e.altKey||e.keyCode!==t&&e.keyCode!==s.home&&e.keyCode!==s.end||e.target!==this._splitButtonEl?e.altKey||e.keyCode!==i||!this.splitButton||e.target!==this._buttonEl&&!this._buttonEl.contains(e.target)?e.keyCode!==s.space&&e.keyCode!==s.enter||e.target!==this._buttonEl&&!this._buttonEl.contains(e.target)?e.keyCode!==s.space&&e.keyCode!==s.enter||e.target!==this._splitButtonEl||this._toggleSplit():(this.location&&r.navigate(this.location,this.state),this._fireEvent(u._EventName._invoked)):(l._setActive(this._splitButtonEl),e.keyCode===i&&e.stopPropagation(),e.preventDefault()):(l._setActive(this._buttonEl),e.keyCode===t&&e.stopPropagation(),e.preventDefault())}},_getFocusInto:function(e){var t=this._rtl?s.rightArrow:s.leftArrow;return e===t&&this.splitButton?this._splitButtonEl:this._buttonEl},_buildDom:function(){var t='<div tabindex="0" role="button" class="'+u._ClassName.navbarcommandbutton+'"><div class="'+u._ClassName.navbarcommandbuttoncontent+'"><div class="'+u._ClassName.navbarcommandicon+'"></div><div class="'+u._ClassName.navbarcommandlabel+'"></div></div></div><div tabindex="-1" aria-expanded="false" class="'+u._ClassName.navbarcommandsplitbutton+'"></div>';this.element.insertAdjacentHTML("afterBegin",t),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new e._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new e._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",l._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this));var i=new l._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));i.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this));for(var n=this._splitButtonEl.nextSibling;n;)this._buttonEl.insertBefore(n,this._contentEl),"#text"!==n.nodeName&&o.processAll(n),n=this._splitButtonEl.nextSibling},_handleButtonClick:function(e){var t=e.target;l._matchesSelector(t,".win-interactive, .win-interactive *")||(this.location&&r.navigate(this.location,this.state),this._fireEvent(u._EventName._invoked))},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!1,i),this.element.dispatchEvent(n)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:{navbarcommand:"win-navbarcommand",navbarcommandbutton:"win-navbarcommand-button",navbarcommandbuttoncontent:"win-navbarcommand-button-content",navbarcommandsplitbutton:"win-navbarcommand-splitbutton",navbarcommandsplitbuttonopened:"win-navbarcommand-splitbutton-opened",navbarcommandicon:"win-navbarcommand-icon",navbarcommandlabel:"win-navbarcommand-label"},_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return i.Class.mix(u,a.DOMEventMixin),u})})}),n("WinJS/Controls/NavBar/_Container",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../_LegacyAppBar/_Constants","../Repeater","./_Command"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f,g,v,y,C,w,b){"use strict";function I(){return null===t.document.activeElement||t.document.activeElement===t.document.body}i.Namespace._moduleDefine(e,"WinJS.UI",{NavBarContainer:i.Namespace._lazy(function(){var e=g.Key,S=3e3,x=g._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",E=0,P=o._createEventProperty,M={invoked:"invoked",splittoggle:"splittoggle"},T={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarContainerViewportAriaLabel(){return a._getWinJSString("ui/navBarContainerViewportAriaLabel").value}},k=i.Class.define(function(e,i){if(e=e||t.document.createElement("DIV"),this._id=e.id||g._uniqueID(e),this._writeProfilerMark("constructor,StartTM"),i=i||{},e.winControl)throw new s("WinJS.UI.NavBarContainer.DuplicateConstruction",T.duplicateConstruction);e.winControl=this,this._element=e,g.addClass(this.element,k._ClassName.navbarcontainer),g.addClass(this.element,"win-disposable"),e.getAttribute("tabIndex")||(e.tabIndex=-1),this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this),this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this),this._currentManipulationState=E,this._panningDisabled=!g._supportsSnapPoints,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),_.addEventListener("navigated",this._closeSplitAndResetBound),this.layout=i.layout||y.Orientation.horizontal,i.maxRows&&(this.maxRows=i.maxRows),i.template&&(this.template=i.template),i.data&&(this.data=i.data),i.fixedSize&&(this.fixedSize=i.fixedSize),f._setOptions(this,i,!0),this._duringConstructor=!1,i.currentIndex&&(this.currentIndex=i.currentIndex),this._updatePageUI(),p.schedule(function(){this._updateAppBarReference()},p.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize"),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(e){if(this._template=e,this._repeater){var i=this.element.contains(t.document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}}},_render:function(e){var i=t.document.createElement("div"),n=this._template;n&&(n.render?n.render(e,i):n.winControl&&n.winControl.render?n.winControl.render(e,i):i.appendChild(n(e)));var s=new b.NavBarCommand(i,e);return s._element},data:{get:function(){return this._repeater&&this._repeater.data},set:function(e){e||(e=new u.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var i=this.element.contains(t.document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new w.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(e),this._repeater.data=e,this._addDataChangedEvents(e),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),i&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(e){e=+e===e?e:1,this._maxRows=Math.max(1,e),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(e){e===y.Orientation.vertical?(this._layout=y.Orientation.vertical,g.removeClass(this.element,k._ClassName.horizontal),g.addClass(this.element,k._ClassName.vertical)):(this._layout=y.Orientation.horizontal,g.removeClass(this.element,k._ClassName.vertical),g.addClass(this.element,k._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(e){if(e===+e){var i=this.element.contains(t.document.activeElement);this._keyboardBehavior.currentIndex=e,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),i&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(e){this._fixedSize=!!e,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:P(M.invoked),onsplittoggle:P(M.splittoggle),forceLayout:function(){this._resizeHandler(),this._measured&&(this._scrollPosition=g.getScrollPosition(this._viewportEl)[this.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"]),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._appBarEl.removeEventListener("afteropen",this._focusCurrentItemPassivelyBound));for(var e=this.element.parentNode;e&&!g.hasClass(e,C.appBarClass);)e=e.parentNode;this._appBarEl=e,this._appBarEl&&(this._appBarEl.addEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.addEventListener("afteropen",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(e){this._elementHadFocus=t.document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===e.type?this._surfaceEl.children[e.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===e.type?this._surfaceEl.children[e.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===e.type?this._surfaceEl.children[e.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===e.type&&this._closeSplitIfOpen())},_dataChanged:function(e){this._measured=!1,"itemremoved"===e.type?e.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:e.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===e.type?e.detail.index===this._keyboardBehavior.currentIndex&&I()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===e.type?e.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===e.type?e.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=e.detail.newIndex,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===e.type&&(this._keyboardBehavior.currentIndex=0,I()&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(e){e.addEventListener("itemchanged",this._dataChangingBound),e.addEventListener("iteminserted",this._dataChangingBound),e.addEventListener("itemmoved",this._dataChangingBound),e.addEventListener("itemremoved",this._dataChangingBound),e.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(e){e.pointerType===x&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(e){e.pointerType!==x&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=m.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),g._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),g._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),g._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=t.document.createElement("div"),g.addClass(this._pageindicatorsEl,k._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=t.document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=t.document.createElement("div"),g.addClass(this._viewportEl,k._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",T.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),g._resizeNotifier.subscribe(this._element,this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=t.document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=t.document.createElement("div"),g.addClass(this._surfaceEl,k._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener("_invoked",this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener("_splittoggle",this._navbarCommandSplitToggleHandler.bind(this)),g._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var e=this.element.firstElementChild;e!==this._pageindicatorsEl;)this._surfaceEl.appendChild(e),c.process(e),e=this.element.firstElementChild;this._leftArrowEl=t.document.createElement("div"),g.addClass(this._leftArrowEl,k._ClassName.navleftarrow),g.addClass(this._leftArrowEl,k._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=m.wrap(),this._rightArrowEl=t.document.createElement("div"),g.addClass(this._rightArrowEl,k._ClassName.navrightarrow),g.addClass(this._rightArrowEl,k._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=m.wrap(),this._keyboardBehavior=new v._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl}),this._winKeyboard=new v._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var e=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.min(Math.floor(this._keyboardBehavior.currentIndex/e)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(e*t,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var e=this._sizes.rowsPerPage*this._sizes.columnsPerPage,t=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/e)-1);this._keyboardBehavior.currentIndex=Math.max(e*t,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===y.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var e=this.layout===y.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(t.getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(t.getComputedStyle(this._viewportEl).height);e&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&!this._appBarEl.winControl.opened?(p.schedule(this._resizeImplBound,p.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeopen",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(i){var n=i.keyCode;if(!i.altKey&&(n===e.pageUp||n===e.pageDown)){var s=i.target;if(g._matchesSelector(s,".win-interactive, .win-interactive *"))return;var o=this._keyboardBehavior.currentIndex;this._measure();var r=this._sizes,a=Math.floor(o/(r.columnsPerPage*r.rowsPerPage)),l=null;if(n===e.pageUp){if(this.layout===y.Orientation.horizontal){var h=a*r.columnsPerPage*r.rowsPerPage;o===h&&this._surfaceEl.children[o].winControl._buttonEl===t.document.activeElement?o-=r.columnsPerPage*r.rowsPerPage:o=h}else{var d=this._surfaceEl.children[o],u=d.offsetTop,c=u+d.offsetHeight,_=this._zooming?this._zoomPosition:this._scrollPosition;if(u>=_&&c<_+r.viewportOffsetHeight)for(;o>0&&this._surfaceEl.children[o-1].offsetTop>_;)o--;if(this._keyboardBehavior.currentIndex===o){var m=c-r.viewportOffsetHeight;for(o=Math.max(0,o-1);o>0&&this._surfaceEl.children[o-1].offsetTop>m;)o--;l=o>0?this._surfaceEl.children[o].offsetTop-this._sizes.itemMarginTop:0}}o=Math.max(o,0),this._keyboardBehavior.currentIndex=o;var p=this._surfaceEl.children[o].winControl._buttonEl;null!==l&&this._scrollTo(l),g._setActive(p,this._viewportEl)}else{if(this.layout===y.Orientation.horizontal){var f=(a+1)*r.columnsPerPage*r.rowsPerPage-1;o===f?o+=r.columnsPerPage*r.rowsPerPage:o=f}else{var d=this._surfaceEl.children[this._keyboardBehavior.currentIndex],u=d.offsetTop,c=u+d.offsetHeight,_=this._zooming?this._zoomPosition:this._scrollPosition;if(u>=_&&c<_+r.viewportOffsetHeight)for(;o<this._surfaceEl.children.length-1&&this._surfaceEl.children[o+1].offsetTop+this._surfaceEl.children[o+1].offsetHeight<_+r.viewportOffsetHeight;)o++;if(o===this._keyboardBehavior.currentIndex){var v=u+r.viewportOffsetHeight;for(o=Math.min(this._surfaceEl.children.length-1,o+1);o<this._surfaceEl.children.length-1&&this._surfaceEl.children[o+1].offsetTop+this._surfaceEl.children[o+1].offsetHeight<v;)o++;l=o<this._surfaceEl.children.length-1?this._surfaceEl.children[o+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}o=Math.min(o,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=o;var p=this._surfaceEl.children[o].winControl._buttonEl;null!==l&&this._scrollTo(l);try{g._setActive(p,this._viewportEl)}catch(C){}}}},_focusHandler:function(e){var t=e.target;this._surfaceEl.contains(t)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(e){var t=e.target;if(t!==this._surfaceEl){for(;t.parentNode!==this._surfaceEl;)t=t.parentNode;for(var i=-1;t;)i++,t=t.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(i)}},_ensureVisible:function(e,t){if(this._measure(),this.layout===y.Orientation.horizontal){var i=Math.floor(e/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(i*this._sizes.viewportOffsetWidth,t)}else{var n,s=this._surfaceEl.children[e];n=e>0?s.offsetTop-this._sizes.itemMarginTop:0;var o;o=e<this._surfaceEl.children.length-1?this._surfaceEl.children[e+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var r=this._zooming?this._zoomPosition:this._scrollPosition;r=Math.max(r,o),r=Math.min(r,n),this._scrollTo(r,t)}},_scrollTo:function(e,t){if(this._measure(),e=this.layout===y.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,e)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,e)),t){if(Math.abs(this._scrollPosition-e)>1){this._zooming=!1,this._scrollPosition=e,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen();var i={};i[this.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"]=e,g.setScrollPosition(this._viewportEl,i)}}else(!this._zooming&&Math.abs(this._scrollPosition-e)>1||this._zooming&&Math.abs(this._zoomPosition-e)>1)&&(this._zoomPosition=e,this._zooming=!0,this.layout===y.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",g._zoomTo(this._viewportEl,{contentX:e,contentY:0,viewportX:0,viewportY:0})):g._zoomTo(this._viewportEl,{contentX:0,contentY:e,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(e){this._currentManipulationState=e.currentState,e.currentState===e.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),t.clearTimeout(this._manipulationStateTimeoutId),e.currentState===e.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=t.setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var e=this;this._checkingScroll=n._requestAnimationFrame(function(){if(!e._disposed){e._checkingScroll=null;var t=g.getScrollPosition(e._viewportEl)[e.layout===y.Orientation.horizontal?"scrollLeft":"scrollTop"];t!==e._scrollPosition&&(e._scrollPosition=t,e._closeSplitIfOpen()),e._updatePageUI(),e._zooming||e._currentManipulationState!==E||e._updateCurrentIndexIfPageChanged()}})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===y.Orientation.horizontal){this._measure();var e=this._currentPage,i=e*this._sizes.rowsPerPage*this._sizes.columnsPerPage,n=(e+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<i||this._keyboardBehavior.currentIndex>n)&&(this._keyboardBehavior.currentIndex=i,this.element.contains(t.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var e=this._sizes;e.rtl="rtl"===t.getComputedStyle(this._element).direction;var i=this._surfaceEl.children.length;if(i>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var n=this._surfaceEl.firstElementChild;n.style.margin="",n.style.width="";var s=t.getComputedStyle(n);e.itemOffsetWidth=parseFloat(t.getComputedStyle(n).width),0===n.offsetWidth&&(e.itemOffsetWidth=0),e.itemMarginLeft=parseFloat(s.marginLeft),e.itemMarginRight=parseFloat(s.marginRight),e.itemWidth=e.itemOffsetWidth+e.itemMarginLeft+e.itemMarginRight,e.itemOffsetHeight=parseFloat(t.getComputedStyle(n).height),0===n.offsetHeight&&(e.itemOffsetHeight=0),e.itemMarginTop=parseFloat(s.marginTop),e.itemMarginBottom=parseFloat(s.marginBottom),e.itemHeight=e.itemOffsetHeight+e.itemMarginTop+e.itemMarginBottom,e.itemOffsetWidth>0&&e.itemOffsetHeight>0&&(e.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")}if(e.viewportOffsetWidth=parseFloat(t.getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(e.viewportOffsetWidth=0),e.viewportOffsetHeight=parseFloat(t.getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(e.viewportOffsetHeight=0),this._measured=0===e.viewportOffsetWidth||0===e.itemOffsetHeight?!1:!0,this.layout===y.Orientation.horizontal){this._scrollPosition=g.getScrollPosition(this._viewportEl).scrollLeft,e.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(t.getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(t.getComputedStyle(this._leftArrowEl).marginRight);var o=e.viewportOffsetWidth-2*e.leadingEdge;e.maxColumns=e.itemWidth?Math.max(1,Math.floor(o/e.itemWidth)):1,e.rowsPerPage=Math.min(this.maxRows,Math.ceil(i/e.maxColumns)),e.columnsPerPage=Math.min(e.maxColumns,i),e.pages=Math.ceil(i/(e.columnsPerPage*e.rowsPerPage)),e.trailingEdge=e.leadingEdge,e.extraSpace=o-e.columnsPerPage*e.itemWidth,this._scrollLength=e.viewportOffsetWidth*e.pages,this._keyboardBehavior.fixedSize=e.rowsPerPage,this._keyboardBehavior.fixedDirection=v._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=e.itemHeight*e.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,e.leadingEdge=0,e.rowsPerPage=i,e.columnsPerPage=1,e.pages=1,e.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=e.columnsPerPage,this._keyboardBehavior.fixedDirection=v._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else e.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var e=this._sizes,t=this._surfaceEl.children.length,i=0;t>i;i++){var n,s,o=this._surfaceEl.children[i],r="";if(this.layout===y.Orientation.horizontal){var a=Math.floor(i/e.rowsPerPage),l=a%e.columnsPerPage===0,h=a%e.columnsPerPage===e.columnsPerPage-1,d=e.trailingEdge;if(this.fixedSize)d+=e.extraSpace;else{var u=e.extraSpace-(e.maxColumns-e.columnsPerPage)*e.itemWidth;r=e.itemOffsetWidth+u/e.maxColumns+"px"}var c,_;e.rtl?(c=l?e.leadingEdge:0,_=h?d:0):(c=h?d:0,_=l?e.leadingEdge:0),n=c+e.itemMarginRight+"px",s=_+e.itemMarginLeft+"px"}else n="",s="";o.style.marginRight!==n&&(o.style.marginRight=n),o.style.marginLeft!==s&&(o.style.marginLeft=s),o.style.width!==r&&(o.style.width=r)}},_updatePageUI:function(){this._measure();var e=this._currentPage;this._hasPreviousContent=0!==e,this._hasNextContent=e<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+k._ClassName.indicator+'"></span>'));for(var t=0;t<this._pageindicatorsEl.children.length;t++)t===e?g.addClass(this._pageindicatorsEl.children[t],k._ClassName.currentindicator):g.removeClass(this._pageindicatorsEl.children[t],k._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX=this._panningDisabled?"hidden":"",
this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==y.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var i=e*this._sizes.rowsPerPage*this._sizes.columnsPerPage,n=this._surfaceEl.children[i].winControl._buttonEl;g._ensureId(n),this._ariaStartMarker.setAttribute("aria-flowto",n.id);var s=Math.min(this._surfaceEl.children.length-1,(e+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),o=this._surfaceEl.children[s].winControl._buttonEl;g._ensureId(o),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",o.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var e=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,t=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,i=this;(this._mouseInViewport||this._panningDisabled)&&e?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||h.fadeIn(this._leftArrowEl)):(e?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||m.timeout(d._animationTimeAdjustment(S)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=m.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||h.fadeOut(this._leftArrowEl).then(function(){i._leftArrowEl.style.visibility="hidden"})}.bind(this))),(this._mouseInViewport||this._panningDisabled)&&t?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||h.fadeIn(this._rightArrowEl)):(t?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||m.timeout(d._animationTimeAdjustment(S)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=m.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||h.fadeOut(this._rightArrowEl).then(function(){i._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(e){for(var t=e.target,i=-1;t;)i++,t=t.previousSibling;this._fireEvent(k._EventName.invoked,{index:i,navbarCommand:e.target.winControl,data:this._repeater?this._repeater.data.getAt(i):null})},_navbarCommandSplitToggleHandler:function(e){for(var t=e.target,i=-1;t;)i++,t=t.previousSibling;var n=e.target.winControl;this._closeSplitIfOpen(),n.splitOpened&&(this._currentSplitNavItem=n),this._fireEvent(k._EventName.splitToggle,{opened:n.splitOpened,index:i,navbarCommand:n,data:this._repeater?this._repeater.data.getAt(i):null})},_fireEvent:function(e,i){var n=t.document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!1,i),this.element.dispatchEvent(n)},_writeProfilerMark:function(e){var t="WinJS.UI.NavBarContainer:"+this._id+":"+e;l(t),r.log&&r.log(t,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound)),_.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),g._resizeNotifier.unsubscribe(this._element,this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:M.invoked,splitToggle:M.splittoggle}});return i.Class.mix(k,f.DOMEventMixin),k})})}),n("require-style!less/styles-navbar",[],function(){}),n("require-style!less/colors-navbar",[],function(){}),n("WinJS/Controls/NavBar",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","./_LegacyAppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/styles-navbar","require-style!less/colors-navbar"],function(e,t,i,n,s,o,r,a,l,h,d,u){"use strict";d.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover",[{name:"background-color",value:d.ColorTypes.listSelectHover}]),d.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover.win-pressed",[{name:"background-color",value:d.ColorTypes.listSelectPress}]),d.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened",[{name:"background-color",value:d.ColorTypes.listSelectRest}]),d.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened.win-pressed",[{name:"background-color",value:d.ColorTypes.listSelectPress}]);var c="custom";i.Namespace.define("WinJS.UI",{NavBar:i.Namespace._lazy(function(){var h="childrenprocessed",d=s._createEventProperty,_=i.Class.derive(u._LegacyAppBar,function(e,i){i=i||{},i=n._shallowCopy(i),i.placement=i.placement||"top",i.layout=c,i.closedDisplayMode=i.closedDisplayMode||"minimal",u._LegacyAppBar.call(this,e,i),this._element.addEventListener("beforeopen",this._handleBeforeShow.bind(this)),l.addClass(this.element,_._ClassName.navbar),t.Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():a.schedule(this._processChildren.bind(this),a.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(e){var t="none"===e?"none":"minimal";Object.getOwnPropertyDescriptor(u._LegacyAppBar.prototype,"closedDisplayMode").set.call(this,t),this._closedDisplayMode=t}},onchildrenprocessed:d(h),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var e=this,t=r.as();return this._processors&&this._processors.forEach(function(i){for(var n=0,s=e.element.children.length;s>n;n++)!function(e){t=t.then(function(){i(e)})}(e.element.children[n])}),t.then(function(){e._writeProfilerMark("processChildren,StopTM"),e._fireEvent(_._EventName.childrenProcessed)},function(){e._writeProfilerMark("processChildren,StopTM"),e._fireEvent(_._EventName.childrenProcessed)})}return r.wrap()},_show:function(){if(!this.disabled){var e=this;this._processChildren().then(function(){u._LegacyAppBar.prototype._show.call(e)})}},_handleBeforeShow:function(){if(!this._disposed)for(var e=this.element.querySelectorAll(".win-navbarcontainer"),t=0;t<e.length;t++)e[t].winControl.forceLayout()},_fireEvent:function(t,i){var n=e.document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!1,i||{}),this.element.dispatchEvent(n)},_writeProfilerMark:function(e){o("WinJS.UI.NavBar:"+this._id+":"+e)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:h},isDeclarativeControlContainer:n.markSupportedForProcessing(function(e,t){if(e._processed)for(var i=0,n=e.element.children.length;n>i;i++)t(e.element.children[i]);else e._processors=e._processors||[],e._processors.push(t)})});return _})})}),n("require-style!less/styles-viewbox",[],function(){}),n("WinJS/Controls/ViewBox",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-viewbox"],function(e,t,i,n,s,o,r,a,l){"use strict";t.Namespace.define("WinJS.UI",{ViewBox:t.Namespace._lazy(function(){function s(e){if(e&&!e._resizing){e._resizing=e._resizing||0,e._resizing++;try{e._updateLayout()}finally{e._resizing--}}}function h(e){e.target&&s(e.target.winControl)}function d(e){e.target&&s(e.target.parentElement.winControl)}var u={get invalidViewBoxChildren(){return"ViewBox expects to only have one child element"}},c=t.Class.define(function(t){this._disposed=!1,this._element=t||e.document.createElement("div");var i=this.element;i.winControl=this,l.addClass(i,"win-disposable"),l.addClass(i,"win-viewbox"),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===e.getComputedStyle(this.element).direction}},_initialize:function(){var e=this.element;if(e.firstElementChild!==this._sizer){if(i.validation&&1!==e.childElementCount)throw new n("WinJS.UI.ViewBox.InvalidChildren",u.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var t=e.firstElementChild;if(this._sizer=t,t&&(l._resizeNotifier.subscribe(e,h),e.addEventListener("mselementresize",h),l._resizeNotifier.subscribe(t,d),t.addEventListener("mselementresize",d)),0===e.clientWidth&&0===e.clientHeight){var s=this;o.schedule(function(){s._updateLayout()},o.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var e=this._sizer;if(e){var t=this.element,n=e.clientWidth,s=e.clientHeight,o=t.clientWidth,r=t.clientHeight,a=o/n,l=r/s,h=Math.min(a,l),d=Math.abs(o-n*h)/2,u=Math.abs(r-s*h)/2,c=this._rtl;this._sizer.style[i._browserStyleEquivalents.transform.scriptName]="translate("+(c?"-":"")+d+"px,"+u+"px) scale("+h+")",this._sizer.style[i._browserStyleEquivalents["transform-origin"].scriptName]=c?"top right":"top left"}},dispose:function(){this._disposed||(this.element&&l._resizeNotifier.unsubscribe(this.element,h),this._sizer&&l._resizeNotifier.unsubscribe(this._sizer,d),this._disposed=!0,a.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return t.Class.mix(c,r.DOMEventMixin),c})})}),n("require-style!less/styles-contentdialog",[],function(){}),n("require-style!less/colors-contentdialog",[],function(){}),n("WinJS/Controls/ContentDialog",["../Application","../Utilities/_Dispose","../_Accents","../Promise","../_Signal","../_LightDismissService","../Core/_BaseUtils","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_Events","../Core/_ErrorFromName","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Animations","require-style!less/styles-contentdialog","require-style!less/colors-contentdialog"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f){"use strict";i.createAccentRule(".win-contentdialog-dialog",[{name:"outline-color",value:i.ColorTypes.accent}]),h.Namespace.define("WinJS.UI",{ContentDialog:h.Namespace._lazy(function(){function e(e){return n._cancelBlocker(e,function(){e.cancel()})}function i(e){e.ensuredFocusedElementInView=!0,this.dialog._renderForInputPane(e.occludedRect.height)}function c(){this.dialog._clearInputPaneRendering()}function p(){}function g(e,t){e._interruptibleWorkPromises=e._interruptibleWorkPromises||[];var i=new s;e._interruptibleWorkPromises.push(t(e,i.promise)),i.complete()}function v(){(this._interruptibleWorkPromises||[]).forEach(function(e){e.cancel()})}var y={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get controlDisposed(){return"Cannot interact with the control after it has been disposed"},get contentDialogAlreadyShowing(){return"Cannot show a ContentDialog if there is already a ContentDialog that is showing"}},C={none:"none",primary:"primary",secondary:"secondary"},w={contentDialog:"win-contentdialog",backgroundOverlay:"win-contentdialog-backgroundoverlay",dialog:"win-contentdialog-dialog",title:"win-contentdialog-title",content:"win-contentdialog-content",commands:"win-contentdialog-commands",primaryCommand:"win-contentdialog-primarycommand",secondaryCommand:"win-contentdialog-secondarycommand",_verticalAlignment:"win-contentdialog-verticalalignment",_scroller:"win-contentdialog-scroller",_column0or1:"win-contentdialog-column0or1",_visible:"win-contentdialog-visible",_tabStop:"win-contentdialog-tabstop",_commandSpacer:"win-contentdialog-commandspacer"},b={beforeShow:"beforeshow",afterShow:"aftershow",beforeHide:"beforehide",afterHide:"afterhide"},I=96,S={Init:h.Class.define(null,{name:"Init",hidden:!0,enter:function(){var e=this.dialog;e._dismissable=new o.ModalElement({element:e._dom.root,tabIndex:e._dom.root.hasAttribute("tabIndex")?e._dom.root.tabIndex:-1,onLightDismiss:function(){e.hide(C.none)},onTakeFocus:function(t){e._dismissable.restoreFocus()||m._focusFirstFocusableElement(e._dom.content)||m._tryFocusOnAnyElement(e._dom.dialog,t)}}),this.dialog._dismissedSignal=null,this.dialog._setState(S.Hidden,!1)},exit:p,show:function(){throw"It's illegal to call show on the Init state"},hide:p,onCommandClicked:p,onInputPaneShown:p,onInputPaneHidden:p}),Hidden:h.Class.define(null,{name:"Hidden",hidden:!0,enter:function(e){e&&this.show()},exit:p,show:function(){var e=this.dialog._dismissedSignal=new s;return this.dialog._setState(S.BeforeShow),e.promise},hide:p,onCommandClicked:p,onInputPaneShown:p,onInputPaneHidden:p}),BeforeShow:h.Class.define(null,{name:"BeforeShow",hidden:!0,enter:function(){g(this,function(e,t){return t.then(function(){return e.dialog._fireBeforeShow()}).then(function(t){return t||e.dialog._cancelDismissalPromise(null),t}).then(function(t){t?e.dialog._setState(S.Showing):e.dialog._setState(S.Hidden,!1)})})},exit:v,show:function(){return n.wrapError(new u("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",y.contentDialogAlreadyShowing))},hide:p,onCommandClicked:p,onInputPaneShown:p,onInputPaneHidden:p}),Showing:h.Class.define(null,{name:"Showing",hidden:{get:function(){return!!this._pendingHide}},enter:function(){g(this,function(e,t){return t.then(function(){if(e._pendingHide=null,m.addClass(e.dialog._dom.root,w._visible),e.dialog._addExternalListeners(),l.Windows.UI.ViewManagement.InputPane){var t=l.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height;t>0&&e.dialog._renderForInputPane(t)}return o.shown(e.dialog._dismissable),e.dialog._playEntranceAnimation()}).then(function(){e.dialog._fireEvent(b.afterShow)}).then(function(){e.dialog._setState(S.Shown,e._pendingHide)})})},exit:v,show:function(){if(this._pendingHide){var e=this._pendingHide.dismissalResult;return this._pendingHide=null,this.dialog._resetDismissalPromise(e,new s).promise}return n.wrapError(new u("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",y.contentDialogAlreadyShowing))},hide:function(e){this._pendingHide={dismissalResult:e}},onCommandClicked:p,onInputPaneShown:i,onInputPaneHidden:c}),Shown:h.Class.define(null,{name:"Shown",hidden:!1,enter:function(e){e&&this.hide(e.dismissalResult)},exit:p,show:function(){return n.wrapError(new u("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",y.contentDialogAlreadyShowing))},hide:function(e){this.dialog._setState(S.BeforeHide,e)},onCommandClicked:function(e){this.hide(e)},onInputPaneShown:i,onInputPaneHidden:c}),BeforeHide:h.Class.define(null,{name:"BeforeHide",hidden:!1,enter:function(e){g(this,function(t,i){return i.then(function(){return t.dialog._fireBeforeHide(e)}).then(function(i){i?t.dialog._setState(S.Hiding,e):t.dialog._setState(S.Shown,null)})})},exit:v,show:function(){return n.wrapError(new u("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",y.contentDialogAlreadyShowing))},hide:p,onCommandClicked:p,onInputPaneShown:i,onInputPaneHidden:c}),Hiding:h.Class.define(null,{name:"Hiding",hidden:{get:function(){return!this._showIsPending}},enter:function(e){g(this,function(t,i){return i.then(function(){t._showIsPending=!1,t.dialog._resetDismissalPromise(e,null)}).then(function(){return t.dialog._playExitAnimation()}).then(function(){t.dialog._removeExternalListeners(),o.hidden(t.dialog._dismissable),m.removeClass(t.dialog._dom.root,w._visible),t.dialog._clearInputPaneRendering(),t.dialog._fireAfterHide(e)}).then(function(){t.dialog._setState(S.Hidden,t._showIsPending)})})},exit:v,show:function(){return this._showIsPending?n.wrapError(new u("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",y.contentDialogAlreadyShowing)):(this._showIsPending=!0,this.dialog._dismissedSignal=new s,this.dialog._dismissedSignal.promise)},hide:function(e){this._showIsPending&&(this._showIsPending=!1,this.dialog._resetDismissalPromise(e,null))},onCommandClicked:p,onInputPaneShown:p,onInputPaneHidden:p}),Disposed:h.Class.define(null,{name:"Disposed",hidden:!0,enter:function(){o.hidden(this.dialog._dismissable),this.dialog._removeExternalListeners(),this.dialog._dismissedSignal&&this.dialog._dismissedSignal.error(new u("WinJS.UI.ContentDialog.ControlDisposed",y.controlDisposed))},exit:p,show:function(){return n.wrapError(new u("WinJS.UI.ContentDialog.ControlDisposed",y.controlDisposed))},hide:p,onCommandClicked:p,onInputPaneShown:p,onInputPaneHidden:p})},x=h.Class.define(function(e,t){if(e&&e.winControl)throw new u("WinJS.UI.ContentDialog.DuplicateConstruction",y.duplicateConstruction);t=t||{},this._onInputPaneShownBound=this._onInputPaneShown.bind(this),this._onInputPaneHiddenBound=this._onInputPaneHidden.bind(this),this._disposed=!1,this._resizedForInputPane=!1,this._currentFocus=null,this._initializeDom(e||a.document.createElement("div")),this._setState(S.Init),this.title="",this.primaryCommandText="",this.primaryCommandDisabled=!1,this.secondaryCommandText="",this.secondaryCommandDisabled=!1,_.setOptions(this,t)},{element:{get:function(){return this._dom.root}},title:{get:function(){return this._title},set:function(e){e=e||"",this._title!==e&&(this._title=e,this._dom.title.textContent=e,this._dom.title.style.display=e?"":"none")}},primaryCommandText:{get:function(){return this._primaryCommandText},set:function(e){e=e||"",this._primaryCommandText!==e&&(this._primaryCommandText=e,this._dom.commands[0].textContent=e,this._updateCommandsUI())}},secondaryCommandText:{get:function(){return this._secondaryCommandText},set:function(e){e=e||"",this._secondaryCommandText!==e&&(this._secondaryCommandText=e,this._dom.commands[1].textContent=e,this._updateCommandsUI())}},primaryCommandDisabled:{get:function(){return this._primaryCommandDisabled},set:function(e){e=!!e,this._primaryCommandDisabled!==e&&(this._primaryCommandDisabled=e,this._dom.commands[0].disabled=e)}},secondaryCommandDisabled:{get:function(){return this._secondaryCommandDisabled},set:function(e){e=!!e,this._secondaryCommandDisabled!==e&&(this._secondaryCommandDisabled=e,this._dom.commands[1].disabled=e)}},hidden:{get:function(){return this._state.hidden},set:function(e){if(!e&&this._state.hidden){var t=function(){};this.show().done(t,t)}else e&&!this._state.hidden&&this.hide(C.none)}},dispose:function(){this._disposed||(this._setState(S.Disposed),this._disposed=!0,t._disposeElement(this._dom.content))},show:function(){return this._state.show()},hide:function(e){this._state.hide(void 0===e?C.none:e)},_initializeDom:function(e){var t=a.document.createElement("div");t.className=w.content,m._reparentChildren(e,t),e.winControl=this,m.addClass(e,w.contentDialog),m.addClass(e,w._verticalAlignment),m.addClass(e,"win-disposable"),e.innerHTML='<div class="'+w.backgroundOverlay+'"></div><div class="'+w._tabStop+'"></div><div tabindex="-1" role="dialog" class="'+w.dialog+'"><div class="'+w.title+'"></div><div class="'+w._scroller+'"></div><div class="'+w.commands+'"><button type="button" class="'+w._commandSpacer+' win-button"></button><button type="button" class="'+w.primaryCommand+' win-button"></button><button type="button" class="'+w.secondaryCommand+' win-button"></button></div></div><div class="'+w._tabStop+'"></div><div class="'+w._column0or1+'"></div>';var i={};i.root=e,i.backgroundOverlay=i.root.firstElementChild,i.startBodyTab=i.backgroundOverlay.nextElementSibling,i.dialog=i.startBodyTab.nextElementSibling,i.title=i.dialog.firstElementChild,i.scroller=i.title.nextElementSibling,i.commandContainer=i.scroller.nextElementSibling,i.commandSpacer=i.commandContainer.firstElementChild,i.commands=[],i.commands.push(i.commandSpacer.nextElementSibling),i.commands.push(i.commands[0].nextElementSibling),i.endBodyTab=i.dialog.nextElementSibling,i.content=t,this._dom=i,i.scroller.appendChild(i.content),m._ensureId(i.title),m._ensureId(i.startBodyTab),m._ensureId(i.endBodyTab),i.dialog.setAttribute("aria-labelledby",i.title.id),i.startBodyTab.setAttribute("x-ms-aria-flowfrom",i.endBodyTab.id),i.endBodyTab.setAttribute("aria-flowto",i.startBodyTab.id),this._updateTabIndices(),i.root.addEventListener("keydown",this._onKeyDownEnteringElement.bind(this),!0),m._addEventListener(i.root,"pointerdown",this._onPointerDown.bind(this)),m._addEventListener(i.root,"pointerup",this._onPointerUp.bind(this)),i.root.addEventListener("click",this._onClick.bind(this)),m._addEventListener(i.startBodyTab,"focusin",this._onStartBodyTabFocusIn.bind(this)),m._addEventListener(i.endBodyTab,"focusin",this._onEndBodyTabFocusIn.bind(this)),i.commands[0].addEventListener("click",this._onCommandClicked.bind(this,C.primary)),i.commands[1].addEventListener("click",this._onCommandClicked.bind(this,C.secondary))},_updateCommandsUI:function(){this._dom.commands[0].style.display=this.primaryCommandText?"":"none",this._dom.commands[1].style.display=this.secondaryCommandText?"":"none",this._dom.commandSpacer.style.display=this.primaryCommandText&&!this.secondaryCommandText||!this.primaryCommandText&&this.secondaryCommandText?"":"none"},_updateTabIndices:function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=r._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},_updateTabIndicesImpl:function(){var e=m._getHighAndLowTabIndices(this._dom.content);this._dom.startBodyTab.tabIndex=e.lowest,this._dom.commands[0].tabIndex=e.highest,this._dom.commands[1].tabIndex=e.highest,this._dom.endBodyTab.tabIndex=e.highest},_elementInDialog:function(e){return this._dom.dialog.contains(e)||e===this._dom.startBodyTab||e===this._dom.endBodyTab},_onCommandClicked:function(e){this._state.onCommandClicked(e)},_onPointerDown:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onPointerUp:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onClick:function(e){e.stopPropagation(),this._elementInDialog(e.target)||e.preventDefault()},_onKeyDownEnteringElement:function(e){e.keyCode===m.Key.tab&&this._updateTabIndices()},_onStartBodyTabFocusIn:function(){m._focusLastFocusableElement(this._dom.dialog)},_onEndBodyTabFocusIn:function(){m._focusFirstFocusableElement(this._dom.dialog)},_onInputPaneShown:function(e){this._state.onInputPaneShown(e.detail.originalEvent)},_onInputPaneHidden:function(){this._state.onInputPaneHidden()},_setState:function(e,t){this._disposed||(this._state&&this._state.exit(),this._state=new e,this._state.dialog=this,this._state.enter(t))},_resetDismissalPromise:function(e,t){var i=this._dismissedSignal,n=this._dismissedSignal=t;return i.complete({result:e}),n},_cancelDismissalPromise:function(e){var t=this._dismissedSignal,i=this._dismissedSignal=e;return t.cancel(),i},_fireEvent:function(e,t){t=t||{};var i=t.detail||null,n=!!t.cancelable,s=a.document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,n,i),this._dom.root.dispatchEvent(s)},_fireBeforeShow:function(){return this._fireEvent(b.beforeShow,{cancelable:!0})},_fireBeforeHide:function(e){return this._fireEvent(b.beforeHide,{detail:{result:e},cancelable:!0})},_fireAfterHide:function(e){this._fireEvent(b.afterHide,{detail:{result:e}})},_playEntranceAnimation:function(){return e(f.fadeIn(this._dom.root))},_playExitAnimation:function(){return e(f.fadeOut(this._dom.root))},_addExternalListeners:function(){m._inputPaneListener.addEventListener(this._dom.root,"showing",this._onInputPaneShownBound),m._inputPaneListener.addEventListener(this._dom.root,"hiding",this._onInputPaneShownBound)},_removeExternalListeners:function(){m._inputPaneListener.removeEventListener(this._dom.root,"showing",this._onInputPaneShownBound),m._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._onInputPaneShownBound)},_renderForInputPane:function(e){this._clearInputPaneRendering();var t=this._dom.dialog,i=t.style,n=t.offsetLeft,s=t.offsetTop,o=t.offsetHeight,r=s+o,l=this._dom.root.offsetHeight-e,h=m.getTotalHeight(this._dom.title),d=m.getTotalHeight(this._dom.commandContainer);if(r>l){var u=o-(r-l);I>u-h-d&&this._dom.scroller.insertBefore(this._dom.title,this._dom.content),this._dom.root.style.display="block",i.height=u+"px",i.position="absolute",i.left=n+"px",i.top=s+"px",i.minHeight=0,this._resizedForInputPane=!0,a.document.activeElement.focus()}},_clearInputPaneRendering:function(){if(this._resizedForInputPane){this._dom.title.parentNode!==this._dom.dialog&&this._dom.dialog.insertBefore(this._dom.title,this._dom.scroller);var e=this._dom.dialog.style;this._dom.root.style.display="",e.height="",e.position="",e.left="",e.top="",e.minHeight="",this._resizedForInputPane=!1}}},{DismissalResult:C,_ClassNames:w});return h.Class.mix(x,d.createEventProperties("beforeshow","aftershow","beforehide","afterhide")),h.Class.mix(x,_.DOMEventMixin),x})})}),n("require-style!less/styles-splitview",[],function(){}),n("require-style!less/colors-splitview",[],function(){}),n("WinJS/Controls/SplitView/_SplitView",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Utilities/_OpenCloseMachine"],function(e,t,i,n,s,o,r,a,l,h,d,u,c){function _(e,t){t&&a.addClass(e,t)}function m(e,t){t&&a.removeClass(e,t)}function p(e,t){return t===C.width?{content:e.contentWidth,total:e.totalWidth}:{content:e.contentHeight,total:e.totalHeight}}e(["require-style!less/styles-splitview"]),e(["require-style!less/colors-splitview"]);var f=s._browserStyleEquivalents.transform,g={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},v={splitView:"win-splitview",pane:"win-splitview-pane",content:"win-splitview-content",paneClosed:"win-splitview-pane-closed",paneOpened:"win-splitview-pane-opened",_panePlaceholder:"win-splitview-paneplaceholder",_paneWrapper:"win-splitview-panewrapper",_contentWrapper:"win-splitview-contentwrapper",_placementLeft:"win-splitview-placementleft",_placementRight:"win-splitview-placementright",_placementTop:"win-splitview-placementtop",_placementBottom:"win-splitview-placementbottom",_closedDisplayNone:"win-splitview-closeddisplaynone",_closedDisplayInline:"win-splitview-closeddisplayinline",_openedDisplayInline:"win-splitview-openeddisplayinline",_openedDisplayOverlay:"win-splitview-openeddisplayoverlay"},y={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},C={width:"width",height:"height"},w={none:"none",inline:"inline"},b={inline:"inline",overlay:"overlay"},I={left:"left",right:"right",top:"top",bottom:"bottom"},S={};S[w.none]=v._closedDisplayNone,S[w.inline]=v._closedDisplayInline;var x={};x[b.overlay]=v._openedDisplayOverlay,x[b.inline]=v._openedDisplayInline;var E={};E[I.left]=v._placementLeft,E[I.right]=v._placementRight,E[I.top]=v._placementTop,E[I.bottom]=v._placementBottom;var P=function(){function e(e,t){var i=this;if(void 0===t&&(t={}),this._updateDomImpl_rendered={paneIsFirst:void 0,isOpenedMode:void 0,closedDisplayMode:void 0,openedDisplayMode:void 0,panePlacement:void 0,panePlaceholderWidth:void 0,panePlaceholderHeight:void 0,isOverlayShown:void 0},e&&e.winControl)throw new l("WinJS.UI.SplitView.DuplicateConstruction",g.duplicateConstruction);this._initializeDom(e||d.document.createElement("div")),this._machine=new c.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){i._cachedHiddenPaneThickness=null;var e=i._getHiddenPaneThickness();return i._isOpenedMode=!0,i._updateDomImpl(),i._playShowAnimation(e)},onClose:function(){return i._playHideAnimation(i._getHiddenPaneThickness()).then(function(){i._isOpenedMode=!1,i._updateDomImpl()})},onUpdateDom:function(){i._updateDomImpl()},onUpdateDomWithIsOpened:function(e){i._isOpenedMode=e,i._updateDomImpl()}}),this._disposed=!1,this._dismissable=new u.LightDismissableElement({element:this._dom.paneWrapper,tabIndex:-1,onLightDismiss:function(){i.closePane()},onTakeFocus:function(e){i._dismissable.restoreFocus()||a._tryFocusOnAnyElement(i._dom.pane,e)}}),this._cachedHiddenPaneThickness=null,this.paneOpened=!1,this.closedDisplayMode=w.inline,this.openedDisplayMode=b.overlay,this.panePlacement=I.left,o.setOptions(this,t),a._inDom(this._dom.root).then(function(){i._rtl="rtl"===d.getComputedStyle(i._dom.root).direction,i._machine.exitInit()})}return Object.defineProperty(e.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paneElement",{get:function(){return this._dom.pane},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentElement",{get:function(){return this._dom.content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(e){w[e]&&this._closedDisplayMode!==e&&(this._closedDisplayMode=e,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"openedDisplayMode",{get:function(){return this._openedDisplayMode},set:function(e){b[e]&&this._openedDisplayMode!==e&&(this._openedDisplayMode=e,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panePlacement",{get:function(){return this._panePlacement},set:function(e){I[e]&&this._panePlacement!==e&&(this._panePlacement=e,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paneOpened",{get:function(){return this._machine.opened},set:function(e){this._machine.opened=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),u.hidden(this._dismissable),r._disposeElement(this._dom.pane),r._disposeElement(this._dom.content))},e.prototype.openPane=function(){this._machine.open()},e.prototype.closePane=function(){this._machine.close()},e.prototype._initializeDom=function(e){var t=e.firstElementChild||d.document.createElement("div");a.addClass(t,v.pane),t.hasAttribute("tabIndex")||(t.tabIndex=-1);var i=d.document.createElement("div");a.addClass(i,v.content);for(var n=t.nextSibling;n;){var s=n.nextSibling;i.appendChild(n),n=s}var o=d.document.createElement("div");o.className=v._paneWrapper,o.appendChild(t);

var r=d.document.createElement("div");r.className=v._panePlaceholder;var l=d.document.createElement("div");l.className=v._contentWrapper,l.appendChild(i),e.winControl=this,a.addClass(e,v.splitView),a.addClass(e,"win-disposable"),this._dom={root:e,pane:t,paneWrapper:o,panePlaceholder:r,content:i,contentWrapper:l}},e.prototype._measureElement=function(e){var t=getComputedStyle(e),i=a._getPositionRelativeTo(e,this._dom.root),n=parseInt(t.marginLeft,10),s=parseInt(t.marginTop,10);return{left:i.left-n,top:i.top-s,contentWidth:a.getContentWidth(e),contentHeight:a.getContentHeight(e),totalWidth:a.getTotalWidth(e),totalHeight:a.getTotalHeight(e)}},e.prototype._setContentRect=function(e){var t=this._dom.contentWrapper.style;t.left=e.left+"px",t.top=e.top+"px",t.height=e.contentHeight+"px",t.width=e.contentWidth+"px"},e.prototype._prepareAnimation=function(e,t){var i=this._dom.paneWrapper.style;i.position="absolute",i.left=e.left+"px",i.top=e.top+"px",i.height=e.totalHeight+"px",i.width=e.totalWidth+"px";var n=this._dom.contentWrapper.style;n.position="absolute",this._setContentRect(t)},e.prototype._clearAnimation=function(){var e=this._dom.paneWrapper.style;e.position="",e.left="",e.top="",e.height="",e.width="",e[f.scriptName]="";var t=this._dom.contentWrapper.style;t.position="",t.left="",t.top="",t.height="",t.width="",t[f.scriptName]="";var i=this._dom.pane.style;i.height="",i.width="",i[f.scriptName]=""},e.prototype._getHiddenContentRect=function(e,t,i){if(this.openedDisplayMode===b.overlay)return e;var n=this._rtl?I.left:I.right,s=this.panePlacement===n||this.panePlacement===I.bottom?0:1,o={content:i.content-t.content,total:i.total-t.total};return this._horizontal?{left:e.left-s*o.total,top:e.top,contentWidth:e.contentWidth+o.content,contentHeight:e.contentHeight,totalWidth:e.totalWidth+o.total,totalHeight:e.totalHeight}:{left:e.left,top:e.top-s*o.total,contentWidth:e.contentWidth,contentHeight:e.contentHeight+o.content,totalWidth:e.totalWidth,totalHeight:e.totalHeight+o.total}},Object.defineProperty(e.prototype,"_horizontal",{get:function(){return this.panePlacement===I.left||this.panePlacement===I.right},enumerable:!0,configurable:!0}),e.prototype._getHiddenPaneThickness=function(){if(null===this._cachedHiddenPaneThickness)if(this._closedDisplayMode===w.none)this._cachedHiddenPaneThickness={content:0,total:0};else{this._isOpenedMode&&(a.removeClass(this._dom.root,v.paneOpened),a.addClass(this._dom.root,v.paneClosed));var e=this._measureElement(this._dom.pane);this._cachedHiddenPaneThickness=p(e,this._horizontal?C.width:C.height),this._isOpenedMode&&(a.removeClass(this._dom.root,v.paneClosed),a.addClass(this._dom.root,v.paneOpened))}return this._cachedHiddenPaneThickness},e.prototype._playShowAnimation=function(e){var t=this,n=this._horizontal?C.width:C.height,s=this._measureElement(this._dom.pane),o=this._measureElement(this._dom.content),r=p(s,n),a=this._getHiddenContentRect(o,e,r);this._prepareAnimation(s,a);var l=function(){var s=t._rtl?I.left:I.right,o=.3,a=e.total+o*(r.total-e.total);return i._resizeTransition(t._dom.paneWrapper,t._dom.pane,{from:a,to:r.total,actualSize:r.total,dimension:n,anchorTrailingEdge:t.panePlacement===s||t.panePlacement===I.bottom})},h=function(){return t.openedDisplayMode===b.inline&&t._setContentRect(o),l()};return h().then(function(){t._clearAnimation()})},e.prototype._playHideAnimation=function(e){var t=this,n=this._horizontal?C.width:C.height,s=this._measureElement(this._dom.pane),o=this._measureElement(this._dom.content),r=p(s,n),a=this._getHiddenContentRect(o,e,r);this._prepareAnimation(s,o);var l=function(){var s=t._rtl?I.left:I.right,o=.3,a=r.total-o*(r.total-e.total);return i._resizeTransition(t._dom.paneWrapper,t._dom.pane,{from:a,to:e.total,actualSize:r.total,dimension:n,anchorTrailingEdge:t.panePlacement===s||t.panePlacement===I.bottom})},h=function(){return t.openedDisplayMode===b.inline&&t._setContentRect(a),l()};return h().then(function(){t._clearAnimation()})},e.prototype._updateDomImpl=function(){var e=this._updateDomImpl_rendered,t=this.panePlacement===I.left||this.panePlacement===I.top;t!==e.paneIsFirst&&(t?(this._dom.root.appendChild(this._dom.panePlaceholder),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.contentWrapper)):(this._dom.root.appendChild(this._dom.contentWrapper),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.panePlaceholder))),e.paneIsFirst=t,e.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?(a.removeClass(this._dom.root,v.paneClosed),a.addClass(this._dom.root,v.paneOpened)):(a.removeClass(this._dom.root,v.paneOpened),a.addClass(this._dom.root,v.paneClosed))),e.isOpenedMode=this._isOpenedMode,e.panePlacement!==this.panePlacement&&(m(this._dom.root,E[e.panePlacement]),_(this._dom.root,E[this.panePlacement]),e.panePlacement=this.panePlacement),e.closedDisplayMode!==this.closedDisplayMode&&(m(this._dom.root,S[e.closedDisplayMode]),_(this._dom.root,S[this.closedDisplayMode]),e.closedDisplayMode=this.closedDisplayMode),e.openedDisplayMode!==this.openedDisplayMode&&(m(this._dom.root,x[e.openedDisplayMode]),_(this._dom.root,x[this.openedDisplayMode]),e.openedDisplayMode=this.openedDisplayMode);var i,n,s=this._isOpenedMode&&this.openedDisplayMode===b.overlay;if(s){var o=this._getHiddenPaneThickness();this._horizontal?(i=o.total+"px",n=""):(i="",n=o.total+"px")}else i="",n="";if(e.panePlaceholderWidth!==i||e.panePlaceholderHeight!==n){var r=this._dom.panePlaceholder.style;r.width=i,r.height=n,e.panePlaceholderWidth=i,e.panePlaceholderHeight=n}e.isOverlayShown!==s&&(s?u.shown(this._dismissable):u.hidden(this._dismissable),e.isOverlayShown=s)},e.ClosedDisplayMode=w,e.OpenedDisplayMode=b,e.PanePlacement=I,e.supportedForProcessing=!0,e._ClassNames=v,e}();t.SplitView=P,n.Class.mix(P,h.createEventProperties(y.beforeOpen,y.afterOpen,y.beforeClose,y.afterClose)),n.Class.mix(P,o.DOMEventMixin)}),n("WinJS/Controls/SplitView",["require","exports","../Core/_Base"],function(e,t,i){var n=null;i.Namespace.define("WinJS.UI",{SplitView:{get:function(){return n||e(["./SplitView/_SplitView"],function(e){n=e}),n.SplitView}}})}),n("require-style!less/styles-splitviewpanetoggle",[],function(){}),n("require-style!less/colors-splitviewpanetoggle",[],function(){}),n("WinJS/Controls/SplitViewPaneToggle/_SplitViewPaneToggle",["require","exports","../../Core/_Base","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardBehavior","../../Utilities/_Hoverable"],function(e,t,i,n,s,o,r,a,l,h){function d(e){return e&&e.winControl}function u(e){var t=d(e);return t?t.paneOpened:!1}h.isHoverable,e(["require-style!less/styles-splitviewpanetoggle"]),e(["require-style!less/colors-splitviewpanetoggle"]);var c={splitViewPaneToggle:"win-splitviewpanetoggle"},_={invoked:"invoked"},m={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: The SplitViewPaneToggle's element must be a button element"}},p=function(){function e(e,t){if(void 0===t&&(t={}),this._updateDom_rendered={splitView:void 0},e&&e.winControl)throw new o("WinJS.UI.SplitViewPaneToggle.DuplicateConstruction",m.duplicateConstruction);this._onPaneStateSettledBound=this._onPaneStateSettled.bind(this),this._ariaExpandedMutationObserver=new s._MutationObserver(this._onAriaExpandedPropertyChanged.bind(this)),this._initializeDom(e||a.document.createElement("button")),this._disposed=!1,this.splitView=null,n.setOptions(this,t),this._initialized=!0,this._updateDom()}return Object.defineProperty(e.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"splitView",{get:function(){return this._splitView},set:function(e){this._splitView=e,e&&(this._opened=u(e)),this._updateDom()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._splitView&&this._removeListeners(this._splitView))},e.prototype._initializeDom=function(e){if("BUTTON"!==e.tagName)throw new o("WinJS.UI.SplitViewPaneToggle.BadButtonElement",m.badButtonElement);e.winControl=this,s.addClass(e,c.splitViewPaneToggle),s.addClass(e,"win-disposable"),e.hasAttribute("type")||(e.type="button"),new l._WinKeyboard(e),e.addEventListener("click",this._onClick.bind(this)),this._dom={root:e}},e.prototype._updateDom=function(){if(this._initialized&&!this._disposed){var e=this._updateDom_rendered;if(this._splitView!==e.splitView&&(e.splitView&&(this._dom.root.removeAttribute("aria-controls"),this._removeListeners(e.splitView)),this._splitView&&(s._ensureId(this._splitView),this._dom.root.setAttribute("aria-controls",this._splitView.id),this._addListeners(this._splitView)),e.splitView=this._splitView),this._splitView){var t=this._opened?"true":"false";s._setAttribute(this._dom.root,"aria-expanded",t);var i=d(this._splitView);i&&(i.paneOpened=this._opened)}}},e.prototype._addListeners=function(e){e.addEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.observe(this._dom.root,{attributes:!0,attributeFilter:["aria-expanded"]})},e.prototype._removeListeners=function(e){e.removeEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.disconnect()},e.prototype._fireEvent=function(e){var t=a.document.createEvent("CustomEvent");return t.initCustomEvent(e,!0,!1,null),this._dom.root.dispatchEvent(t)},e.prototype._onPaneStateSettled=function(e){e.target===this._splitView&&(this._opened=u(this._splitView),this._updateDom())},e.prototype._onAriaExpandedPropertyChanged=function(){var e="true"===this._dom.root.getAttribute("aria-expanded");this._opened=e,this._updateDom()},e.prototype._onClick=function(){this._invoked()},e.prototype._invoked=function(){this._disposed||(this._splitView&&(this._opened=!this._opened,this._updateDom()),this._fireEvent(_.invoked))},e._ClassNames=c,e.supportedForProcessing=!0,e}();t.SplitViewPaneToggle=p,i.Class.mix(p,r.createEventProperties(_.invoked)),i.Class.mix(p,n.DOMEventMixin)}),n("WinJS/Controls/SplitViewPaneToggle",["require","exports","../Core/_Base"],function(e,t,i){var n=null;i.Namespace.define("WinJS.UI",{SplitViewPaneToggle:{get:function(){return n||e(["./SplitViewPaneToggle/_SplitViewPaneToggle"],function(e){n=e}),n.SplitViewPaneToggle}}})}),n("WinJS/Controls/AppBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(e,t,i){t.ClassNames={controlCssClass:"win-appbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-appbar-actionarea",overflowButtonCssClass:"win-appbar-overflowbutton",spacerCssClass:"win-appbar-spacer",ellipsisCssClass:"win-appbar-ellipsis",overflowAreaCssClass:"win-appbar-overflowarea",contentFlyoutCssClass:"win-appbar-contentflyout",emptyappbarCssClass:"win-appbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-appbar-opened",closedClass:"win-appbar-closed",noneClass:"win-appbar-closeddisplaynone",minimalClass:"win-appbar-closeddisplayminimal",compactClass:"win-appbar-closeddisplaycompact",fullClass:"win-appbar-closeddisplayfull",placementTopClass:"win-appbar-top",placementBottomClass:"win-appbar-bottom"},t.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},t.controlMinWidth=i.controlMinWidth,t.defaultClosedDisplayMode="compact",t.defaultOpened=!1,t.defaultPlacement="bottom",t.typeSeparator="separator",t.typeContent="content",t.typeButton="button",t.typeToggle="toggle",t.typeFlyout="flyout",t.commandSelector=".win-command",t.primaryCommandSection="primary",t.secondaryCommandSection="secondary"}),n("require-style!less/styles-appbar",[],function(){}),n("WinJS/Controls/AppBar/_AppBar",["require","exports","../../Core/_Base","../AppBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardInfo","../../_LightDismissService","../../Promise","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(e,t,i,n,s,o,r,a,l,h,d,u,c,_,m,p,f){function g(e,t){t&&a.addClass(e,t)}function v(e,t){t&&a.removeClass(e,t)}e(["require-style!less/styles-appbar"]);var y=u._KeyboardInfo,C={get ariaLabel(){return m._getWinJSString("ui/appBarAriaLabel").value},get overflowButtonAriaLabel(){return m._getWinJSString("ui/appBarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The AppBar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},w={none:"none",minimal:"minimal",compact:"compact",full:"full"},b={};b[w.none]=n.ClassNames.noneClass,b[w.minimal]=n.ClassNames.minimalClass,b[w.compact]=n.ClassNames.compactClass,b[w.full]=n.ClassNames.fullClass;var I={top:"top",bottom:"bottom"},S={};S[I.top]=n.ClassNames.placementTopClass,S[I.bottom]=n.ClassNames.placementBottomClass;var x=function(){function e(t,i){var r=this;if(void 0===i&&(i={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,placement:void 0,closedDisplayMode:void 0,adjustedOffsets:{top:void 0,bottom:void 0}},this._writeProfilerMark("constructor,StartTM"),t&&t.winControl)throw new l("WinJS.UI.AppBar.DuplicateConstruction",C.duplicateConstruction);this._initializeDom(t||d.document.createElement("div"));var h=new p.OpenCloseMachine({eventElement:this.element,onOpen:function(){var t=r._commandingSurface.createOpenAnimation(r._getClosedHeight());return r.element.style.position="fixed",r._placement===e.Placement.top?r.element.style.top=u._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":r.element.style.bottom=u._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",r._synchronousOpen(),t.execute().then(function(){r.element.style.position="",r.element.style.top=r._adjustedOffsets.top,r.element.style.bottom=r._adjustedOffsets.bottom})},onClose:function(){var t=r._commandingSurface.createCloseAnimation(r._getClosedHeight());return r.element.style.position="fixed",r._placement===e.Placement.top?r.element.style.top=u._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":r.element.style.bottom=u._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",t.execute().then(function(){r._synchronousClose(),r.element.style.position="",r.element.style.top=r._adjustedOffsets.top,r.element.style.bottom=r._adjustedOffsets.bottom})},onUpdateDom:function(){r._updateDomImpl()},onUpdateDomWithIsOpened:function(e){r._isOpenedMode=e,r._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),this._handleHidingKeyboardBound=this._handleHidingKeyboard.bind(this),a._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),a._inputPaneListener.addEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new s._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:h}),g(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),n.ClassNames.actionAreaCssClass),g(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),n.ClassNames.overflowAreaCssClass),g(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),n.ClassNames.overflowButtonCssClass),g(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),n.ClassNames.ellipsisCssClass),this._isOpenedMode=n.defaultOpened,this._dismissable=new c.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){r.close()}}),this.closedDisplayMode=n.defaultClosedDisplayMode,this.placement=n.defaultPlacement,this.opened=this._isOpenedMode,o.setOptions(this,i),a._inDom(this.element).then(function(){return r._commandingSurface.initialized}).then(function(){h.exitInit(),r._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(e.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(e){this._commandingSurface.data=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(e){w[e]&&(this._commandingSurface.closedDisplayMode=e,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placement",{get:function(){return this._placement},set:function(e){if(I[e]&&this._placement!==e){switch(this._placement=e,e){case I.top:this._commandingSurface.overflowDirection="bottom";break;case I.bottom:this._commandingSurface.overflowDirection="top"}this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(e){this._commandingSurface.opened=e},enumerable:!0,configurable:!0}),e.prototype.open=function(){this._commandingSurface.open()},e.prototype.close=function(){this._commandingSurface.close()},e.prototype.dispose=function(){this._disposed||(this._disposed=!0,c.hidden(this._dismissable),this._commandingSurface.dispose(),a._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),a._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),r.disposeSubTree(this.element))},e.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},e.prototype.getCommandById=function(e){return this._commandingSurface.getCommandById(e)},e.prototype.showOnlyCommands=function(e){return this._commandingSurface.showOnlyCommands(e)},e.prototype._writeProfilerMark=function(e){f("WinJS.UI.AppBar:"+this._id+":"+e)},e.prototype._initializeDom=function(e){this._writeProfilerMark("_intializeDom,info"),e.winControl=this,this._id=e.id||a._uniqueID(e),a.addClass(e,n.ClassNames.controlCssClass),a.addClass(e,n.ClassNames.disposableCssClass);var t=e.getAttribute("role");t||e.setAttribute("role","menubar");var i=e.getAttribute("aria-label");i||e.setAttribute("aria-label",C.ariaLabel);var s=document.createElement("DIV");a._reparentChildren(e,s),e.appendChild(s),this._dom={root:e,commandingSurfaceEl:s}},e.prototype._handleShowingKeyboard=function(e){var t=this;if(this._dom.root.contains(d.document.activeElement)){var i=e.detail.originalEvent;i.ensuredFocusedElementInView=!0}var n=y._animationShowLength+y._scrollTimeout;return _.timeout(n).then(function(){t._shouldAdjustForShowingKeyboard()&&!t._disposed&&(t._adjustedOffsets=t._computeAdjustedOffsets(),t._commandingSurface.deferredDomUpate())})},e.prototype._shouldAdjustForShowingKeyboard=function(){return y._visible&&!y._isResized},e.prototype._handleHidingKeyboard=function(){this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()},e.prototype._computeAdjustedOffsets=function(){var e={top:"",bottom:""};return this._placement===I.bottom?e.bottom=y._visibleDocBottomOffset+"px":this._placement===I.top&&(e.top=y._visibleDocTop+"px"),e},e.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},e.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},e.prototype._updateDomImpl=function(){var e=this._updateDomImpl_renderedState;e.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),e.isOpenedMode=this._isOpenedMode),e.placement!==this.placement&&(v(this._dom.root,S[e.placement]),g(this._dom.root,S[this.placement]),e.placement=this.placement),e.closedDisplayMode!==this.closedDisplayMode&&(v(this._dom.root,b[e.closedDisplayMode]),g(this._dom.root,b[this.closedDisplayMode]),e.closedDisplayMode=this.closedDisplayMode),e.adjustedOffsets.top!==this._adjustedOffsets.top&&(this._dom.root.style.top=this._adjustedOffsets.top,e.adjustedOffsets.top=this._adjustedOffsets.top),e.adjustedOffsets.bottom!==this._adjustedOffsets.bottom&&(this._dom.root.style.bottom=this._adjustedOffsets.bottom,e.adjustedOffsets.bottom=this._adjustedOffsets.bottom),this._commandingSurface.updateDom()},e.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var e=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,e&&this._synchronousOpen()}return this._cachedClosedHeight},e.prototype._updateDomImpl_renderOpened=function(){g(this._dom.root,n.ClassNames.openedClass),v(this._dom.root,n.ClassNames.closedClass),this._commandingSurface.synchronousOpen(),c.shown(this._dismissable)},e.prototype._updateDomImpl_renderClosed=function(){g(this._dom.root,n.ClassNames.closedClass),v(this._dom.root,n.ClassNames.openedClass),this._commandingSurface.synchronousClose(),c.hidden(this._dismissable)},e.ClosedDisplayMode=w,e.Placement=I,e.supportedForProcessing=!0,e}();t.AppBar=x,i.Class.mix(x,h.createEventProperties(n.EventNames.beforeOpen,n.EventNames.afterOpen,n.EventNames.beforeClose,n.EventNames.afterClose)),i.Class.mix(x,o.DOMEventMixin)}),n("WinJS/Controls/AppBar",["require","exports","../Core/_Base"],function(e,t,i){var n=null;i.Namespace.define("WinJS.UI",{AppBar:{get:function(){return n||e(["./AppBar/_AppBar"],function(e){n=e}),n.AppBar}}})}),n("ui",["WinJS/Core/_WinJS","WinJS/VirtualizedDataSource","WinJS/Controls/IntrinsicControls","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/_LegacyAppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox","WinJS/Controls/ContentDialog","WinJS/Controls/SplitView","WinJS/Controls/SplitViewPaneToggle","WinJS/Controls/ToolBar","WinJS/Controls/AppBar"],function(e){"use strict";return e}),i(["WinJS/Core/_WinJS","ui"],function(t){e.WinJS=t,"undefined"!=typeof module&&(module.exports=t)}),e.WinJS})}();